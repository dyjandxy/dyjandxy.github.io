(function(z,Ne){typeof exports=="object"&&typeof module<"u"?module.exports=Ne(require("wkt-parser")):typeof define=="function"&&define.amd?define(["wkt-parser"],Ne):z.proj4=Ne(z.wkt)})(this,function(z){"use strict";function Ne(g,b){if(g[b])return g[b];for(var C,G=Object.keys(g),k=b.toLowerCase().replace(li,""),Z=-1;++Z<G.length;)if(C=G[Z],C.toLowerCase().replace(li,"")===k)return g[C]}function Ve(g){var b=this;if(arguments.length===2){var C=arguments[1];typeof C=="string"?C.charAt(0)==="+"?Ve[g]=Kn(arguments[1]):Ve[g]=z(arguments[1]):Ve[g]=C}else if(arguments.length===1){if(Array.isArray(g))return g.map(function(G){Array.isArray(G)?Ve.apply(b,G):Ve(G)});if(typeof g=="string"){if(g in Ve)return Ve[g]}else"EPSG"in g?Ve["EPSG:"+g.EPSG]=g:"ESRI"in g?Ve["ESRI:"+g.ESRI]=g:"IAU2000"in g?Ve["IAU2000:"+g.IAU2000]=g:console.log(g);return}}function st(g){return typeof g=="string"}function Et(g){return g in Ve}function pi(g){return ei.some(function(b){return g.indexOf(b)>-1})}function Ni(g){var b=Ne(g,"authority");if(b){var C=Ne(b,"epsg");return C&&Yr.indexOf(C)>-1}}function An(g){var b=Ne(g,"extension");if(b)return Ne(b,"proj4")}function fn(g){return g[0]==="+"}function As(g){if(!st(g))return g;if(Et(g))return Ve[g];if(pi(g)){var b=z(g);if(Ni(b))return Ve["EPSG:3857"];var C=An(b);return C?Kn(C):b}return fn(g)?Kn(g):void 0}function Cs(g){return g}function Nn(g,b){var C=ms.length;return g.names?(ms[C]=g,g.names.forEach(function(G){wr[G.toLowerCase()]=C}),this):(console.log(b),!0)}function $r(g,b,C,G){var k=g*g,Z=b*b,j=(k-Z)/k,ee=0;return G?(k=(g*=1-j*(Zs+j*(Io+j*rl)))*g,j=0):ee=Math.sqrt(j),{es:j,e:ee,ep2:(k-Z)/Z}}function Ds(g,b,C,G,k){if(!g){var Z=Ne(Ot,G);Z||(Z=Kr),g=Z.a,b=Z.b,C=Z.rf}return C&&!b&&(b=(1-1/C)*g),(C===0||Math.abs(g-b)<pt)&&(k=!0,b=g),{a:g,b,rf:C,sphere:k}}function Kt(g,b,C,G,k,Z){var j={};return j.datum_type=g===void 0||g==="none"?ps:uc,b&&(j.datum_params=b.map(parseFloat),j.datum_params[0]===0&&j.datum_params[1]===0&&j.datum_params[2]===0||(j.datum_type=Jn),j.datum_params.length>3&&(j.datum_params[3]===0&&j.datum_params[4]===0&&j.datum_params[5]===0&&j.datum_params[6]===0||(j.datum_type=Ys,j.datum_params[3]*=yr,j.datum_params[4]*=yr,j.datum_params[5]*=yr,j.datum_params[6]=j.datum_params[6]/1e6+1))),j.a=C,j.b=G,j.es=k,j.ep2=Z,j}function qt(g,b){if(!(this instanceof qt))return new qt(g);b=b||function(re){if(re)throw re};var C=As(g);if(typeof C=="object"){var G=qt.projections.get(C.projName);if(G){if(C.datumCode&&C.datumCode!=="none"){var k=Ne(zi,C.datumCode);k&&(C.datum_params=k.towgs84?k.towgs84.split(","):null,C.ellps=k.ellipse,C.datumName=k.datumName?k.datumName:C.datumCode)}C.k0=C.k0||1,C.axis=C.axis||"enu",C.ellps=C.ellps||"wgs84";var Z=Ds(C.a,C.b,C.rf,C.ellps,C.sphere),j=$r(Z.a,Z.b,Z.rf,C.R_A),ee=C.datum||Kt(C.datumCode,C.datum_params,Z.a,Z.b,j.es,j.ep2);Zr(this,C),Zr(this,G),this.a=Z.a,this.b=Z.b,this.rf=Z.rf,this.sphere=Z.sphere,this.es=j.es,this.e=j.e,this.ep2=j.ep2,this.datum=ee,this.init(),b(null,this)}else b(g)}else b(g)}function Xi(g,b){return g.datum_type===b.datum_type&&!(g.a!==b.a||Math.abs(g.es-b.es)>5e-11)&&(g.datum_type===Jn?g.datum_params[0]===b.datum_params[0]&&g.datum_params[1]===b.datum_params[1]&&g.datum_params[2]===b.datum_params[2]:g.datum_type!==Ys||g.datum_params[0]===b.datum_params[0]&&g.datum_params[1]===b.datum_params[1]&&g.datum_params[2]===b.datum_params[2]&&g.datum_params[3]===b.datum_params[3]&&g.datum_params[4]===b.datum_params[4]&&g.datum_params[5]===b.datum_params[5]&&g.datum_params[6]===b.datum_params[6])}function L(g,b,C){var G,k,Z,j,ee=g.x,re=g.y,ue=g.z?g.z:0;if(re<-Qe&&re>-1.001*Qe)re=-Qe;else if(re>Qe&&re<1.001*Qe)re=Qe;else{if(re<-Qe)return{x:-1/0,y:-1/0,z:g.z};if(re>Qe)return{x:1/0,y:1/0,z:g.z}}return ee>Math.PI&&(ee-=2*Math.PI),k=Math.sin(re),j=Math.cos(re),Z=k*k,G=C/Math.sqrt(1-b*Z),{x:(G+ue)*j*Math.cos(ee),y:(G+ue)*j*Math.sin(ee),z:(G*(1-b)+ue)*k}}function qr(g,b,C,G){var k,Z,j,ee,re,ue,Pe,De,Ge,ht,Xe,dt,Ft,yt,wi,Gt,Ui=g.x,zt=g.y,Mi=g.z?g.z:0;if(k=Math.sqrt(Ui*Ui+zt*zt),Z=Math.sqrt(Ui*Ui+zt*zt+Mi*Mi),k/C<1e-12){if(yt=0,Z/C<1e-12)return wi=Qe,Gt=-G,{x:g.x,y:g.y,z:g.z}}else yt=Math.atan2(zt,Ui);j=Mi/Z,De=(ee=k/Z)*(1-b)*(re=1/Math.sqrt(1-b*(2-b)*ee*ee)),Ge=j*re,Ft=0;do Ft++,ue=b*(Pe=C/Math.sqrt(1-b*Ge*Ge))/(Pe+(Gt=k*De+Mi*Ge-Pe*(1-b*Ge*Ge))),dt=(Xe=j*(re=1/Math.sqrt(1-ue*(2-ue)*ee*ee)))*De-(ht=ee*(1-ue)*re)*Ge,De=ht,Ge=Xe;while(dt*dt>1e-24&&Ft<30);return wi=Math.atan(Xe/Math.abs(ht)),{x:yt,y:wi,z:Gt}}function cn(g,b,C){if(b===Jn)return{x:g.x+C[0],y:g.y+C[1],z:g.z+C[2]};if(b===Ys){var G=C[0],k=C[1],Z=C[2],j=C[3],ee=C[4],re=C[5],ue=C[6];return{x:ue*(g.x-re*g.y+ee*g.z)+G,y:ue*(re*g.x+g.y-j*g.z)+k,z:ue*(-ee*g.x+j*g.y+g.z)+Z}}}function Ps(g,b,C){if(b===Jn)return{x:g.x-C[0],y:g.y-C[1],z:g.z-C[2]};if(b===Ys){var G=C[0],k=C[1],Z=C[2],j=C[3],ee=C[4],re=C[5],ue=C[6],Pe=(g.x-G)/ue,De=(g.y-k)/ue,Ge=(g.z-Z)/ue;return{x:Pe+re*De-ee*Ge,y:-re*Pe+De+j*Ge,z:ee*Pe-j*De+Ge}}}function Ht(g){return g===Jn||g===Ys}function Vt(g){if(typeof Number.isFinite=="function"){if(Number.isFinite(g))return;throw new TypeError("coordinates must be finite numbers")}if(typeof g!="number"||g!==g||!isFinite(g))throw new TypeError("coordinates must be finite numbers")}function pn(g,b){return(g.datum.datum_type===Jn||g.datum.datum_type===Ys)&&b.datumCode!=="WGS84"||(b.datum.datum_type===Jn||b.datum.datum_type===Ys)&&g.datumCode!=="WGS84"}function Cn(g,b,C){var G;if(Array.isArray(C)&&(C=br(C)),wa(C),g.datum&&b.datum&&pn(g,b)&&(C=Cn(g,G=new qt("WGS84"),C),g=G),g.axis!=="enu"&&(C=vn(g,!1,C)),g.projName==="longlat")C={x:C.x*ki,y:C.y*ki,z:C.z||0};else if(g.to_meter&&(C={x:C.x*g.to_meter,y:C.y*g.to_meter,z:C.z||0}),!(C=g.inverse(C)))return;return g.from_greenwich&&(C.x+=g.from_greenwich),C=es(g.datum,b.datum,C),b.from_greenwich&&(C={x:C.x-b.from_greenwich,y:C.y,z:C.z||0}),b.projName==="longlat"?C={x:C.x*Wn,y:C.y*Wn,z:C.z||0}:(C=b.forward(C),b.to_meter&&(C={x:C.x/b.to_meter,y:C.y/b.to_meter,z:C.z||0})),b.axis!=="enu"?vn(b,!0,C):C}function mn(g,b,C){var G,k,Z;return Array.isArray(C)?(G=Cn(g,b,C)||{x:NaN,y:NaN},C.length>2?g.name!==void 0&&g.name==="geocent"||b.name!==void 0&&b.name==="geocent"?typeof G.z=="number"?[G.x,G.y,G.z].concat(C.splice(3)):[G.x,G.y,C[2]].concat(C.splice(3)):[G.x,G.y].concat(C.splice(2)):[G.x,G.y]):(k=Cn(g,b,C),(Z=Object.keys(C)).length===2||Z.forEach(function(j){if(g.name!==void 0&&g.name==="geocent"||b.name!==void 0&&b.name==="geocent"){if(j==="x"||j==="y"||j==="z")return}else if(j==="x"||j==="y")return;k[j]=C[j]}),k)}function On(g){return g instanceof qt?g:g.oProj?g.oProj:qt(g)}function nn(g,b,C){g=On(g);var G,k=!1;return b===void 0?(b=g,g=ba,k=!0):(b.x!==void 0||Array.isArray(b))&&(C=b,b=g,g=ba,k=!0),b=On(b),C?mn(g,b,C):(G={forward:function(Z){return mn(g,b,Z)},inverse:function(Z){return mn(b,g,Z)}},k&&(G.oProj=b),G)}function hs(g,b){return b=b||5,Po(sl({lat:g[1],lon:g[0]}),b)}function ds(g){var b=Do(vr(g.toUpperCase()));return b.lat&&b.lon?[b.lon,b.lat]:[(b.left+b.right)/2,(b.top+b.bottom)/2]}function Xr(g){return g*(Math.PI/180)}function ga(g){return g/Math.PI*180}function sl(g){var b,C,G,k,Z,j,ee,re=g.lat,ue=g.lon,Pe=6378137,De=Xr(re),Ge=Xr(ue);ee=Math.floor((ue+180)/6)+1,ue===180&&(ee=60),re>=56&&re<64&&ue>=3&&ue<12&&(ee=32),re>=72&&re<84&&(ue>=0&&ue<9?ee=31:ue>=9&&ue<21?ee=33:ue>=21&&ue<33?ee=35:ue>=33&&ue<42&&(ee=37)),j=Xr(6*(ee-1)-180+3),b=Pe/Math.sqrt(1-.00669438*Math.sin(De)*Math.sin(De)),C=Math.tan(De)*Math.tan(De),G=.006739496752268451*Math.cos(De)*Math.cos(De);var ht=.9996*b*((k=Math.cos(De)*(Ge-j))+(1-C+G)*k*k*k/6+(5-18*C+C*C+72*G-.39089081163157013)*k*k*k*k*k/120)+5e5,Xe=.9996*((Z=Pe*(.9983242984503243*De-.002514607064228144*Math.sin(2*De)+2639046602129982e-21*Math.sin(4*De)-3418046101696858e-24*Math.sin(6*De)))+b*Math.tan(De)*(k*k/2+(5-C+9*G+4*G*G)*k*k*k*k/24+(61-58*C+C*C+600*G-2.2240339282485886)*k*k*k*k*k*k/720));return re<0&&(Xe+=1e7),{northing:Math.round(Xe),easting:Math.round(ht),zoneNumber:ee,zoneLetter:va(re)}}function Do(g){var b=g.northing,C=g.easting,G=g.zoneLetter,k=g.zoneNumber;if(k<0||k>60)return null;var Z,j,ee,re,ue,Pe,De,Ge,ht=6378137,Xe=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),dt=C-5e5,Ft=b;G<"N"&&(Ft-=1e7),Pe=6*(k-1)-180+3,Ge=(De=Ft/.9996/6367449145945056e-9)+(3*Xe/2-27*Xe*Xe*Xe/32)*Math.sin(2*De)+(21*Xe*Xe/16-55*Xe*Xe*Xe*Xe/32)*Math.sin(4*De)+151*Xe*Xe*Xe/96*Math.sin(6*De),Z=ht/Math.sqrt(1-.00669438*Math.sin(Ge)*Math.sin(Ge)),j=Math.tan(Ge)*Math.tan(Ge),ee=.006739496752268451*Math.cos(Ge)*Math.cos(Ge),re=.99330562*ht/Math.pow(1-.00669438*Math.sin(Ge)*Math.sin(Ge),1.5),ue=dt/(.9996*Z);var yt=Ge-Z*Math.tan(Ge)/re*(ue*ue/2-(5+3*j+10*ee-4*ee*ee-.06065547077041606)*ue*ue*ue*ue/24+(61+90*j+298*ee+45*j*j-1.6983531815716497-3*ee*ee)*ue*ue*ue*ue*ue*ue/720);yt=ga(yt);var wi=(ue-(1+2*j+ee)*ue*ue*ue/6+(5-2*ee+28*j-3*ee*ee+.05391597401814761+24*j*j)*ue*ue*ue*ue*ue/120)/Math.cos(Ge);wi=Pe+ga(wi);var Gt;if(g.accuracy){var Ui=Do({northing:g.northing+g.accuracy,easting:g.easting+g.accuracy,zoneLetter:g.zoneLetter,zoneNumber:g.zoneNumber});Gt={top:Ui.lat,right:Ui.lon,bottom:yt,left:wi}}else Gt={lat:yt,lon:wi};return Gt}function va(g){var b="Z";return 84>=g&&g>=72?b="X":72>g&&g>=64?b="W":64>g&&g>=56?b="V":56>g&&g>=48?b="U":48>g&&g>=40?b="T":40>g&&g>=32?b="S":32>g&&g>=24?b="R":24>g&&g>=16?b="Q":16>g&&g>=8?b="P":8>g&&g>=0?b="N":0>g&&g>=-8?b="M":-8>g&&g>=-16?b="L":-16>g&&g>=-24?b="K":-24>g&&g>=-32?b="J":-32>g&&g>=-40?b="H":-40>g&&g>=-48?b="G":-48>g&&g>=-56?b="F":-56>g&&g>=-64?b="E":-64>g&&g>=-72?b="D":-72>g&&g>=-80&&(b="C"),b}function Po(g,b){var C="00000"+g.easting,G="00000"+g.northing;return g.zoneNumber+g.zoneLetter+Dn(g.easting,g.northing,g.zoneNumber)+C.substr(C.length-5,b)+G.substr(G.length-5,b)}function Dn(g,b,C){var G=ya(C);return Xs(Math.floor(g/1e5),Math.floor(b/1e5)%20,G)}function ya(g){var b=g%Is;return b===0&&(b=Is),b}function Xs(g,b,C){var G=C-1,k=Js.charCodeAt(G),Z=Fo.charCodeAt(G),j=k+g-1,ee=Z+b,re=!1;return j>Qr&&(j=j-Qr+Yi-1,re=!0),(j===jt||k<jt&&j>jt||(j>jt||k<jt)&&re)&&j++,(j===Zi||k<Zi&&j>Zi||(j>Zi||k<Zi)&&re)&&++j===jt&&j++,j>Qr&&(j=j-Qr+Yi-1),ee>Ks?(ee=ee-Ks+Yi-1,re=!0):re=!1,(ee===jt||Z<jt&&ee>jt||(ee>jt||Z<jt)&&re)&&ee++,(ee===Zi||Z<Zi&&ee>Zi||(ee>Zi||Z<Zi)&&re)&&++ee===jt&&ee++,ee>Ks&&(ee=ee-Ks+Yi-1),String.fromCharCode(j)+String.fromCharCode(ee)}function vr(g){if(g&&g.length===0)throw"MGRSPoint coverting from nothing";for(var b,C=g.length,G=null,k="",Z=0;!/[A-Z]/.test(b=g.charAt(Z));){if(Z>=2)throw"MGRSPoint bad conversion from: "+g;k+=b,Z++}var j=parseInt(k,10);if(Z===0||Z+3>C)throw"MGRSPoint bad conversion from: "+g;var ee=g.charAt(Z++);if(ee<="A"||ee==="B"||ee==="Y"||ee>="Z"||ee==="I"||ee==="O")throw"MGRSPoint zone letter "+ee+" not handled: "+g;G=g.substring(Z,Z+=2);for(var re=ya(j),ue=xa(G.charAt(0),re),Pe=cc(G.charAt(1),re);Pe<Lo(ee);)Pe+=2e6;var De=C-Z;if(De%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+g;var Ge,ht,Xe,dt,Ft,yt=De/2,wi=0,Gt=0;return yt>0&&(Ge=1e5/Math.pow(10,yt),ht=g.substring(Z,Z+yt),wi=parseFloat(ht)*Ge,Xe=g.substring(Z+yt),Gt=parseFloat(Xe)*Ge),dt=wi+ue,Ft=Gt+Pe,{easting:dt,northing:Ft,zoneLetter:ee,zoneNumber:j,accuracy:Ge}}function xa(g,b){for(var C=Js.charCodeAt(b-1),G=1e5,k=!1;C!==g.charCodeAt(0);){if(++C===jt&&C++,C===Zi&&C++,C>Qr){if(k)throw"Bad character: "+g;C=Yi,k=!0}G+=1e5}return G}function cc(g,b){if(g>"V")throw"MGRSPoint given invalid Northing "+g;for(var C=Fo.charCodeAt(b-1),G=0,k=!1;C!==g.charCodeAt(0);){if(++C===jt&&C++,C===Zi&&C++,C>Ks){if(k)throw"Bad character: "+g;C=Yi,k=!0}G+=1e5}return G}function Lo(g){var b;switch(g){case"C":b=11e5;break;case"D":b=2e6;break;case"E":b=28e5;break;case"F":b=37e5;break;case"G":b=46e5;break;case"H":b=55e5;break;case"J":b=64e5;break;case"K":b=73e5;break;case"L":b=82e5;break;case"M":b=91e5;break;case"N":b=0;break;case"P":b=8e5;break;case"Q":b=17e5;break;case"R":b=26e5;break;case"S":b=35e5;break;case"T":b=44e5;break;case"U":b=53e5;break;case"V":b=62e5;break;case"W":b=7e6;break;case"X":b=79e5;break;default:b=-1}if(b>=0)return b;throw"Invalid zone letter: "+g}function fs(g,b,C){if(!(this instanceof fs))return new fs(g,b,C);if(Array.isArray(g))this.x=g[0],this.y=g[1],this.z=g[2]||0;else if(typeof g=="object")this.x=g.x,this.y=g.y,this.z=g.z||0;else if(typeof g=="string"&&b===void 0){var G=g.split(",");this.x=parseFloat(G[0],10),this.y=parseFloat(G[1],10),this.z=parseFloat(G[2],10)||0}else this.x=g,this.y=b,this.z=C||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function kn(g){var b,C=[];return C[0]=g*pc,b=g*g,C[0]+=b*mc,C[1]=b*vc,b*=g,C[0]+=b*gc,C[1]+=b*yc,C[2]=b*xc,C}function Ro(g,b){var C=g+g;return g+b[0]*Math.sin(C)+b[1]*Math.sin(C+C)+b[2]*Math.sin(C+C+C)}function Ls(g,b,C,G){var k;return g<pt?(G.value=T.AREA_0,k=0):(k=Math.atan2(b,C),Math.abs(k)<=Yt?G.value=T.AREA_0:k>Yt&&k<=Qe+Yt?(G.value=T.AREA_1,k-=Qe):k>Qe+Yt||k<=-(Qe+Yt)?(G.value=T.AREA_2,k=k>=0?k-xi:k+xi):(G.value=T.AREA_3,k+=Qe)),k}function Bt(g,b){var C=g+b;return C<-xi?C+=xr:C>+xi&&(C-=xr),C}function gn(g,b,C,G){for(var k=b;G;--G){var Z=g(k);if(k-=Z,Math.abs(Z)<C)break}return k}z=z&&z.hasOwnProperty("default")?z.default:z;var Jn=1,Ys=2,uc=4,ps=5,yr=484813681109536e-20,Qe=Math.PI/2,Zs=.16666666666666666,Io=.04722222222222222,rl=.022156084656084655,pt=1e-10,ki=.017453292519943295,Wn=57.29577951308232,Yt=Math.PI/4,xr=2*Math.PI,xi=3.14159265359,ji={};ji.greenwich=0,ji.lisbon=-9.131906111111,ji.paris=2.337229166667,ji.bogota=-74.080916666667,ji.madrid=-3.687938888889,ji.rome=12.452333333333,ji.bern=7.439583333333,ji.jakarta=106.807719444444,ji.ferro=-17.666666666667,ji.brussels=4.367975,ji.stockholm=18.058277777778,ji.athens=23.7163375,ji.oslo=10.722916666667;var vi={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},li=/[\s_\-\/\(\)]/g,Kn=function(g){var b,C,G,k={},Z=g.split("+").map(function(ee){return ee.trim()}).filter(function(ee){return ee}).reduce(function(ee,re){var ue=re.split("=");return ue.push(!0),ee[ue[0].toLowerCase()]=ue[1],ee},{}),j={proj:"projName",datum:"datumCode",rf:function(ee){k.rf=parseFloat(ee)},lat_0:function(ee){k.lat0=ee*ki},lat_1:function(ee){k.lat1=ee*ki},lat_2:function(ee){k.lat2=ee*ki},lat_ts:function(ee){k.lat_ts=ee*ki},lon_0:function(ee){k.long0=ee*ki},lon_1:function(ee){k.long1=ee*ki},lon_2:function(ee){k.long2=ee*ki},alpha:function(ee){k.alpha=parseFloat(ee)*ki},lonc:function(ee){k.longc=ee*ki},x_0:function(ee){k.x0=parseFloat(ee)},y_0:function(ee){k.y0=parseFloat(ee)},k_0:function(ee){k.k0=parseFloat(ee)},k:function(ee){k.k0=parseFloat(ee)},a:function(ee){k.a=parseFloat(ee)},b:function(ee){k.b=parseFloat(ee)},r_a:function(){k.R_A=!0},zone:function(ee){k.zone=parseInt(ee,10)},south:function(){k.utmSouth=!0},towgs84:function(ee){k.datum_params=ee.split(",").map(function(re){return parseFloat(re)})},to_meter:function(ee){k.to_meter=parseFloat(ee)},units:function(ee){k.units=ee;var re=Ne(vi,ee);re&&(k.to_meter=re.to_meter)},from_greenwich:function(ee){k.from_greenwich=ee*ki},pm:function(ee){var re=Ne(ji,ee);k.from_greenwich=(re||parseFloat(ee))*ki},nadgrids:function(ee){ee==="@null"?k.datumCode="none":k.nadgrids=ee},axis:function(ee){ee.length===3&&"ewnsud".indexOf(ee.substr(0,1))!==-1&&"ewnsud".indexOf(ee.substr(1,1))!==-1&&"ewnsud".indexOf(ee.substr(2,1))!==-1&&(k.axis=ee)}};for(b in Z)C=Z[b],b in j?typeof(G=j[b])=="function"?G(C):k[G]=C:k[b]=C;return typeof k.datumCode=="string"&&k.datumCode!=="WGS84"&&(k.datumCode=k.datumCode.toLowerCase()),k};(function(g){g("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),g("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),g("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),g.WGS84=g["EPSG:4326"],g["EPSG:3785"]=g["EPSG:3857"],g.GOOGLE=g["EPSG:3857"],g["EPSG:900913"]=g["EPSG:3857"],g["EPSG:102113"]=g["EPSG:3857"]})(Ve);var ei=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Yr=["3857","900913","3785","102113"],Zr=function(g,b){g=g||{};var C,G;if(!b)return g;for(G in b)(C=b[G])!==void 0&&(g[G]=C);return g},Pn=function(g,b,C){var G=g*b;return C/Math.sqrt(1-G*G)},Jr=function(g){return g<0?-1:1},et=function(g){return Math.abs(g)<=xi?g:g-Jr(g)*xr},sn=function(g,b,C){var G=g*C,k=.5*g;return G=Math.pow((1-G)/(1+G),k),Math.tan(.5*(Qe-b))/G},Qn=function(g,b){for(var C,G,k=.5*g,Z=Qe-2*Math.atan(b),j=0;j<=15;j++)if(C=g*Math.sin(Z),G=Qe-2*Math.atan(b*Math.pow((1-C)/(1+C),k))-Z,Z+=G,Math.abs(G)<=1e-10)return Z;return-9999},Rs=[{init:function(){var g=this.b/this.a;this.es=1-g*g,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(g){var b=g.x,C=g.y;if(C*Wn>90&&C*Wn<-90&&b*Wn>180&&b*Wn<-180)return null;var G,k;if(Math.abs(Math.abs(C)-Qe)<=pt)return null;if(this.sphere)G=this.x0+this.a*this.k0*et(b-this.long0),k=this.y0+this.a*this.k0*Math.log(Math.tan(Yt+.5*C));else{var Z=Math.sin(C),j=sn(this.e,C,Z);G=this.x0+this.a*this.k0*et(b-this.long0),k=this.y0-this.a*this.k0*Math.log(j)}return g.x=G,g.y=k,g},inverse:function(g){var b,C,G=g.x-this.x0,k=g.y-this.y0;if(this.sphere)C=Qe-2*Math.atan(Math.exp(-k/(this.a*this.k0)));else{var Z=Math.exp(-k/(this.a*this.k0));if((C=Qn(this.e,Z))===-9999)return null}return b=et(this.long0+G/(this.a*this.k0)),g.x=b,g.y=C,g},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Cs,inverse:Cs,names:["longlat","identity"]}],wr={},ms=[],al={start:function(){Rs.forEach(Nn)},add:Nn,get:function(g){if(!g)return!1;var b=g.toLowerCase();return wr[b]!==void 0&&ms[wr[b]]?ms[wr[b]]:void 0}},Ot={};Ot.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},Ot.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},Ot.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},Ot.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},Ot.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},Ot.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},Ot.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},Ot.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},Ot.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},Ot.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},Ot.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},Ot.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},Ot.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},Ot.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},Ot.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},Ot.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},Ot.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},Ot.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},Ot.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},Ot.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},Ot.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},Ot.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},Ot.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},Ot.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},Ot.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},Ot.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},Ot.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},Ot.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},Ot.hough={a:6378270,rf:297,ellipseName:"Hough"},Ot.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},Ot.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},Ot.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},Ot.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},Ot.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},Ot.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},Ot.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},Ot.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},Ot.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},Ot.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},Ot.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},Ot.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var Kr=Ot.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Ot.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var zi={};zi.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},zi.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},zi.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},zi.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},zi.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},zi.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},zi.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},zi.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},zi.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},zi.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},zi.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},zi.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},zi.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},zi.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},zi.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},zi.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},zi.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},qt.projections=al,qt.projections.start();var es=function(g,b,C){return Xi(g,b)||g.datum_type===ps||b.datum_type===ps?C:g.es!==b.es||g.a!==b.a||Ht(g.datum_type)||Ht(b.datum_type)?(C=L(C,g.es,g.a),Ht(g.datum_type)&&(C=cn(C,g.datum_type,g.datum_params)),Ht(b.datum_type)&&(C=Ps(C,b.datum_type,b.datum_params)),qr(C,b.es,b.a,b.b)):C},vn=function(g,b,C){var G,k,Z,j=C.x,ee=C.y,re=C.z||0,ue={};for(Z=0;Z<3;Z++)if(!b||Z!==2||C.z!==void 0)switch(Z===0?(G=j,k="ew".indexOf(g.axis[Z])!==-1?"x":"y"):Z===1?(G=ee,k="ns".indexOf(g.axis[Z])!==-1?"y":"x"):(G=re,k="z"),g.axis[Z]){case"e":case"w":case"n":case"s":ue[k]=G;break;case"u":C[k]!==void 0&&(ue.z=G);break;case"d":C[k]!==void 0&&(ue.z=-G);break;default:return null}return ue},br=function(g){var b={x:g[0],y:g[1]};return g.length>2&&(b.z=g[2]),g.length>3&&(b.m=g[3]),b},wa=function(g){Vt(g.x),Vt(g.y)},ba=qt("WGS84"),Is=6,Js="AJSAJS",Fo="AFAFAF",Yi=65,jt=73,Zi=79,Ks=86,Qr=90,Qs={forward:hs,inverse:function(g){var b=Do(vr(g.toUpperCase()));return b.lat&&b.lon?[b.lon,b.lat,b.lon,b.lat]:[b.left,b.bottom,b.right,b.top]},toPoint:ds};fs.fromMGRS=function(g){return new fs(ds(g))},fs.prototype.toMGRS=function(g){return hs([this.x,this.y],g)};var Fs=.01068115234375,_a=function(g){var b=[];b[0]=1-g*(.25+g*(.046875+g*(.01953125+g*Fs))),b[1]=g*(.75-g*(.046875+g*(.01953125+g*Fs)));var C=g*g;return b[2]=C*(.46875-g*(.013020833333333334+.007120768229166667*g)),C*=g,b[3]=C*(.3645833333333333-.005696614583333333*g),b[4]=C*g*.3076171875,b},eo=function(g,b,C,G){return C*=b,b*=b,G[0]*g-C*(G[1]+b*(G[2]+b*(G[3]+b*G[4])))},Ma=function(g,b,C){for(var G=1/(1-b),k=g,Z=20;Z;--Z){var j=Math.sin(k),ee=1-b*j*j;if(ee=(eo(k,j,Math.cos(k),C)-g)*(ee*Math.sqrt(ee))*G,k-=ee,Math.abs(ee)<pt)return k}return k},ll={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=_a(this.es),this.ml0=eo(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(g){var b,C,G,k=g.x,Z=g.y,j=et(k-this.long0),ee=Math.sin(Z),re=Math.cos(Z);if(this.es){var ue=re*j,Pe=Math.pow(ue,2),De=this.ep2*Math.pow(re,2),Ge=Math.pow(De,2),ht=Math.abs(re)>pt?Math.tan(Z):0,Xe=Math.pow(ht,2),dt=Math.pow(Xe,2);b=1-this.es*Math.pow(ee,2),ue/=Math.sqrt(b);var Ft=eo(Z,ee,re,this.en);C=this.a*(this.k0*ue*(1+Pe/6*(1-Xe+De+Pe/20*(5-18*Xe+dt+14*De-58*Xe*De+Pe/42*(61+179*dt-dt*Xe-479*Xe)))))+this.x0,G=this.a*(this.k0*(Ft-this.ml0+ee*j*ue/2*(1+Pe/12*(5-Xe+9*De+4*Ge+Pe/30*(61+dt-58*Xe+270*De-330*Xe*De+Pe/56*(1385+543*dt-dt*Xe-3111*Xe))))))+this.y0}else{var yt=re*Math.sin(j);if(Math.abs(Math.abs(yt)-1)<pt)return 93;if(C=.5*this.a*this.k0*Math.log((1+yt)/(1-yt))+this.x0,G=re*Math.cos(j)/Math.sqrt(1-Math.pow(yt,2)),(yt=Math.abs(G))>=1){if(yt-1>pt)return 93;G=0}else G=Math.acos(G);Z<0&&(G=-G),G=this.a*this.k0*(G-this.lat0)+this.y0}return g.x=C,g.y=G,g},inverse:function(g){var b,C,G,k,Z=(g.x-this.x0)*(1/this.a),j=(g.y-this.y0)*(1/this.a);if(this.es)if(b=this.ml0+j/this.k0,C=Ma(b,this.es,this.en),Math.abs(C)<Qe){var ee=Math.sin(C),re=Math.cos(C),ue=Math.abs(re)>pt?Math.tan(C):0,Pe=this.ep2*Math.pow(re,2),De=Math.pow(Pe,2),Ge=Math.pow(ue,2),ht=Math.pow(Ge,2);b=1-this.es*Math.pow(ee,2);var Xe=Z*Math.sqrt(b)/this.k0,dt=Math.pow(Xe,2);G=C-(b*=ue)*dt/(1-this.es)*.5*(1-dt/12*(5+3*Ge-9*Pe*Ge+Pe-4*De-dt/30*(61+90*Ge-252*Pe*Ge+45*ht+46*Pe-dt/56*(1385+3633*Ge+4095*ht+1574*ht*Ge)))),k=et(this.long0+Xe*(1-dt/6*(1+2*Ge+Pe-dt/20*(5+28*Ge+24*ht+8*Pe*Ge+6*Pe-dt/42*(61+662*Ge+1320*ht+720*ht*Ge))))/re)}else G=Qe*Jr(j),k=0;else{var Ft=Math.exp(Z/this.k0),yt=.5*(Ft-1/Ft),wi=this.lat0+j/this.k0,Gt=Math.cos(wi);b=Math.sqrt((1-Math.pow(Gt,2))/(1+Math.pow(yt,2))),G=Math.asin(b),j<0&&(G=-G),k=yt===0&&Gt===0?0:et(Math.atan2(yt,Gt)+this.long0)}return g.x=k,g.y=G,g},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Ea=function(g){var b=Math.exp(g);return b=(b-1/b)/2},Bo=function(g,b){g=Math.abs(g),b=Math.abs(b);var C=Math.max(g,b),G=Math.min(g,b)/(C||1);return C*Math.sqrt(1+Math.pow(G,2))},Ji=function(g){var b=1+g,C=b-1;return C===0?g:g*Math.log(b)/C},Bs=function(g){var b=Math.abs(g);return b=Ji(b*(1+b/(Bo(1,b)+1))),g<0?-b:b},$n=function(g,b){for(var C,G=2*Math.cos(2*b),k=g.length-1,Z=g[k],j=0;--k>=0;)C=G*Z-j+g[k],j=Z,Z=C;return b+C*Math.sin(2*b)},Sa=function(g,b){for(var C,G=2*Math.cos(b),k=g.length-1,Z=g[k],j=0;--k>=0;)C=G*Z-j+g[k],j=Z,Z=C;return Math.sin(b)*C},No=function(g){var b=Math.exp(g);return b=(b+1/b)/2},_r=function(g,b,C){for(var G,k,Z=Math.sin(b),j=Math.cos(b),ee=Ea(C),re=No(C),ue=2*j*re,Pe=-2*Z*ee,De=g.length-1,Ge=g[De],ht=0,Xe=0,dt=0;--De>=0;)G=Xe,k=ht,Ge=ue*(Xe=Ge)-G-Pe*(ht=dt)+g[De],dt=Pe*Xe-k+ue*ht;return ue=Z*re,Pe=j*ee,[ue*Ge-Pe*dt,ue*dt+Pe*Ge]},Ns={init:function(){if(this.es===void 0||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var g=this.es/(1+Math.sqrt(1-this.es)),b=g/(2-g),C=b;this.cgb[0]=b*(2+b*(-2/3+b*(b*(116/45+b*(26/45+b*(-2854/675)))-2))),this.cbg[0]=b*(b*(2/3+b*(4/3+b*(-82/45+b*(32/45+b*(4642/4725)))))-2),C*=b,this.cgb[1]=C*(7/3+b*(b*(-227/45+b*(2704/315+b*(2323/945)))-1.6)),this.cbg[1]=C*(5/3+b*(-16/15+b*(-13/9+b*(904/315+b*(-1522/945))))),C*=b,this.cgb[2]=C*(56/15+b*(-136/35+b*(-1262/105+b*(73814/2835)))),this.cbg[2]=C*(-26/15+b*(34/21+b*(1.6+b*(-12686/2835)))),C*=b,this.cgb[3]=C*(4279/630+b*(-332/35+b*(-399572/14175))),this.cbg[3]=C*(1237/630+b*(b*(-24832/14175)-2.4)),C*=b,this.cgb[4]=C*(4174/315+b*(-144838/6237)),this.cbg[4]=C*(-734/315+b*(109598/31185)),C*=b,this.cgb[5]=C*(601676/22275),this.cbg[5]=C*(444337/155925),C=Math.pow(b,2),this.Qn=this.k0/(1+b)*(1+C*(.25+C*(1/64+C/256))),this.utg[0]=b*(b*(2/3+b*(-37/96+b*(1/360+b*(81/512+b*(-96199/604800)))))-.5),this.gtu[0]=b*(.5+b*(-2/3+b*(5/16+b*(41/180+b*(-127/288+b*(7891/37800)))))),this.utg[1]=C*(-1/48+b*(-1/15+b*(437/1440+b*(-46/105+b*(1118711/3870720))))),this.gtu[1]=C*(13/48+b*(b*(557/1440+b*(281/630+b*(-1983433/1935360)))-.6)),C*=b,this.utg[2]=C*(-17/480+b*(37/840+b*(209/4480+b*(-5569/90720)))),this.gtu[2]=C*(61/240+b*(-103/140+b*(15061/26880+b*(167603/181440)))),C*=b,this.utg[3]=C*(-4397/161280+b*(11/504+b*(830251/7257600))),this.gtu[3]=C*(49561/161280+b*(-179/168+b*(6601661/7257600))),C*=b,this.utg[4]=C*(-4583/161280+b*(108847/3991680)),this.gtu[4]=C*(34729/80640+b*(-3418889/1995840)),C*=b,this.utg[5]=-.03233083094085698*C,this.gtu[5]=.6650675310896665*C;var G=$n(this.cbg,this.lat0);this.Zb=-this.Qn*(G+Sa(this.gtu,2*G))},forward:function(g){var b=et(g.x-this.long0),C=g.y;C=$n(this.cbg,C);var G=Math.sin(C),k=Math.cos(C),Z=Math.sin(b),j=Math.cos(b);C=Math.atan2(G,j*k),b=Math.atan2(Z*k,Bo(G,k*j)),b=Bs(Math.tan(b));var ee=_r(this.gtu,2*C,2*b);C+=ee[0],b+=ee[1];var re,ue;return Math.abs(b)<=2.623395162778?(re=this.a*(this.Qn*b)+this.x0,ue=this.a*(this.Qn*C+this.Zb)+this.y0):(re=1/0,ue=1/0),g.x=re,g.y=ue,g},inverse:function(g){var b=(g.x-this.x0)*(1/this.a),C=(g.y-this.y0)*(1/this.a);C=(C-this.Zb)/this.Qn,b/=this.Qn;var G,k;if(Math.abs(b)<=2.623395162778){var Z=_r(this.utg,2*C,2*b);C+=Z[0],b+=Z[1],b=Math.atan(Ea(b));var j=Math.sin(C),ee=Math.cos(C),re=Math.sin(b),ue=Math.cos(b);C=Math.atan2(j*ue,Bo(re,ue*ee)),b=Math.atan2(re,ue*ee),G=et(b+this.long0),k=$n(this.cgb,C)}else G=1/0,k=1/0;return g.x=G,g.y=k,g},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},er=function(g,b){if(g===void 0){if((g=Math.floor(30*(et(b)+Math.PI)/Math.PI)+1)<0)return 0;if(g>60)return 60}return g},Ta={init:function(){var g=er(this.zone,this.long0);if(g===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(g)-183)*ki,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Ns.init.apply(this),this.forward=Ns.forward,this.inverse=Ns.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Oo=function(g,b){return Math.pow((1-g)/(1+g),b)},cl=20,Ln={init:function(){var g=Math.sin(this.lat0),b=Math.cos(this.lat0);b*=b,this.rc=Math.sqrt(1-this.es)/(1-this.es*g*g),this.C=Math.sqrt(1+this.es*b*b/(1-this.es)),this.phic0=Math.asin(g/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Yt)/(Math.pow(Math.tan(.5*this.lat0+Yt),this.C)*Oo(this.e*g,this.ratexp))},forward:function(g){var b=g.x,C=g.y;return g.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*C+Yt),this.C)*Oo(this.e*Math.sin(C),this.ratexp))-Qe,g.x=this.C*b,g},inverse:function(g){for(var b=g.x/this.C,C=g.y,G=Math.pow(Math.tan(.5*C+Yt)/this.K,1/this.C),k=cl;k>0&&(C=2*Math.atan(G*Oo(this.e*Math.sin(g.y),-.5*this.e))-Qe,!(Math.abs(C-g.y)<1e-14));--k)g.y=C;return k?(g.x=b,g.y=C,g):null},names:["gauss"]},ul={init:function(){Ln.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(g){var b,C,G,k;return g.x=et(g.x-this.long0),Ln.forward.apply(this,[g]),b=Math.sin(g.y),C=Math.cos(g.y),G=Math.cos(g.x),k=this.k0*this.R2/(1+this.sinc0*b+this.cosc0*C*G),g.x=k*C*Math.sin(g.x),g.y=k*(this.cosc0*b-this.sinc0*C*G),g.x=this.a*g.x+this.x0,g.y=this.a*g.y+this.y0,g},inverse:function(g){var b,C,G,k,Z;if(g.x=(g.x-this.x0)/this.a,g.y=(g.y-this.y0)/this.a,g.x/=this.k0,g.y/=this.k0,Z=Math.sqrt(g.x*g.x+g.y*g.y)){var j=2*Math.atan2(Z,this.R2);b=Math.sin(j),C=Math.cos(j),k=Math.asin(C*this.sinc0+g.y*b*this.cosc0/Z),G=Math.atan2(g.x*b,Z*this.cosc0*C-g.y*this.sinc0*b)}else k=this.phic0,G=0;return g.x=G,g.y=k,Ln.inverse.apply(this,[g]),g.x=et(g.x+this.long0),g},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},to={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pt&&(this.k0=.5*(1+Jr(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=pt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pt&&(this.k0=.5*this.cons*Pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/sn(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Pn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Qe,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(g){var b,C,G,k,Z,j,ee=g.x,re=g.y,ue=Math.sin(re),Pe=Math.cos(re),De=et(ee-this.long0);return Math.abs(Math.abs(ee-this.long0)-Math.PI)<=pt&&Math.abs(re+this.lat0)<=pt?(g.x=NaN,g.y=NaN,g):this.sphere?(b=2*this.k0/(1+this.sinlat0*ue+this.coslat0*Pe*Math.cos(De)),g.x=this.a*b*Pe*Math.sin(De)+this.x0,g.y=this.a*b*(this.coslat0*ue-this.sinlat0*Pe*Math.cos(De))+this.y0,g):(C=2*Math.atan(this.ssfn_(re,ue,this.e))-Qe,k=Math.cos(C),G=Math.sin(C),Math.abs(this.coslat0)<=pt?(Z=sn(this.e,re*this.con,this.con*ue),j=2*this.a*this.k0*Z/this.cons,g.x=this.x0+j*Math.sin(ee-this.long0),g.y=this.y0-this.con*j*Math.cos(ee-this.long0),g):(Math.abs(this.sinlat0)<pt?(b=2*this.a*this.k0/(1+k*Math.cos(De)),g.y=b*G):(b=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*G+this.cosX0*k*Math.cos(De))),g.y=b*(this.cosX0*G-this.sinX0*k*Math.cos(De))+this.y0),g.x=b*k*Math.sin(De)+this.x0,g))},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b,C,G,k,Z,j=Math.sqrt(g.x*g.x+g.y*g.y);if(this.sphere){var ee=2*Math.atan(j/(2*this.a*this.k0));return b=this.long0,C=this.lat0,j<=pt?(g.x=b,g.y=C,g):(C=Math.asin(Math.cos(ee)*this.sinlat0+g.y*Math.sin(ee)*this.coslat0/j),b=et(Math.abs(this.coslat0)<pt?this.lat0>0?this.long0+Math.atan2(g.x,-1*g.y):this.long0+Math.atan2(g.x,g.y):this.long0+Math.atan2(g.x*Math.sin(ee),j*this.coslat0*Math.cos(ee)-g.y*this.sinlat0*Math.sin(ee))),g.x=b,g.y=C,g)}if(Math.abs(this.coslat0)<=pt){if(j<=pt)return C=this.lat0,b=this.long0,g.x=b,g.y=C,g;g.x*=this.con,g.y*=this.con,G=j*this.cons/(2*this.a*this.k0),C=this.con*Qn(this.e,G),b=this.con*et(this.con*this.long0+Math.atan2(g.x,-1*g.y))}else k=2*Math.atan(j*this.cosX0/(2*this.a*this.k0*this.ms1)),b=this.long0,j<=pt?Z=this.X0:(Z=Math.asin(Math.cos(k)*this.sinX0+g.y*Math.sin(k)*this.cosX0/j),b=et(this.long0+Math.atan2(g.x*Math.sin(k),j*this.cosX0*Math.cos(k)-g.y*this.sinX0*Math.sin(k)))),C=-1*Qn(this.e,Math.tan(.5*(Qe+Z)));return g.x=b,g.y=C,g},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(g,b,C){return b*=C,Math.tan(.5*(Qe+g))*Math.pow((1-b)/(1+b),.5*C)}},hc={init:function(){var g=this.lat0;this.lambda0=this.long0;var b=Math.sin(g),C=this.a,G=1/this.rf,k=2*G-Math.pow(G,2),Z=this.e=Math.sqrt(k);this.R=this.k0*C*Math.sqrt(1-k)/(1-k*Math.pow(b,2)),this.alpha=Math.sqrt(1+k/(1-k)*Math.pow(Math.cos(g),4)),this.b0=Math.asin(b/this.alpha);var j=Math.log(Math.tan(Math.PI/4+this.b0/2)),ee=Math.log(Math.tan(Math.PI/4+g/2)),re=Math.log((1+Z*b)/(1-Z*b));this.K=j-this.alpha*ee+this.alpha*Z/2*re},forward:function(g){var b=Math.log(Math.tan(Math.PI/4-g.y/2)),C=this.e/2*Math.log((1+this.e*Math.sin(g.y))/(1-this.e*Math.sin(g.y))),G=-this.alpha*(b+C)+this.K,k=2*(Math.atan(Math.exp(G))-Math.PI/4),Z=this.alpha*(g.x-this.lambda0),j=Math.atan(Math.sin(Z)/(Math.sin(this.b0)*Math.tan(k)+Math.cos(this.b0)*Math.cos(Z))),ee=Math.asin(Math.cos(this.b0)*Math.sin(k)-Math.sin(this.b0)*Math.cos(k)*Math.cos(Z));return g.y=this.R/2*Math.log((1+Math.sin(ee))/(1-Math.sin(ee)))+this.y0,g.x=this.R*j+this.x0,g},inverse:function(g){for(var b=g.x-this.x0,C=g.y-this.y0,G=b/this.R,k=2*(Math.atan(Math.exp(C/this.R))-Math.PI/4),Z=Math.asin(Math.cos(this.b0)*Math.sin(k)+Math.sin(this.b0)*Math.cos(k)*Math.cos(G)),j=Math.atan(Math.sin(G)/(Math.cos(this.b0)*Math.cos(G)-Math.sin(this.b0)*Math.tan(k))),ee=this.lambda0+j/this.alpha,re=0,ue=Z,Pe=-1e3,De=0;Math.abs(ue-Pe)>1e-7;){if(++De>20)return;re=1/this.alpha*(Math.log(Math.tan(Math.PI/4+Z/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(ue))/2)),Pe=ue,ue=2*Math.atan(Math.exp(re))-Math.PI/2}return g.x=ee,g.y=ue,g},names:["somerc"]},dc={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var g=Math.sin(this.lat0),b=Math.cos(this.lat0),C=this.e*g;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(b,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-C*C);var G=sn(this.e,this.lat0,g),k=this.bl/b*Math.sqrt((1-this.es)/(1-C*C));k*k<1&&(k=1);var Z,j;if(isNaN(this.longc)){var ee=sn(this.e,this.lat1,Math.sin(this.lat1)),re=sn(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(k+Math.sqrt(k*k-1))*Math.pow(G,this.bl):this.el=(k-Math.sqrt(k*k-1))*Math.pow(G,this.bl);var ue=Math.pow(ee,this.bl),Pe=Math.pow(re,this.bl);j=.5*((Z=this.el/ue)-1/Z);var De=(this.el*this.el-Pe*ue)/(this.el*this.el+Pe*ue),Ge=(Pe-ue)/(Pe+ue),ht=et(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(De*Math.tan(.5*this.bl*ht)/Ge)/this.bl,this.long0=et(this.long0);var Xe=et(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*Xe)/j),this.alpha=Math.asin(k*Math.sin(this.gamma0))}else Z=this.lat0>=0?k+Math.sqrt(k*k-1):k-Math.sqrt(k*k-1),this.el=Z*Math.pow(G,this.bl),j=.5*(Z-1/Z),this.gamma0=Math.asin(Math.sin(this.alpha)/k),this.long0=this.longc-Math.asin(j*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(k*k-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(k*k-1),Math.cos(this.alpha))},forward:function(g){var b,C,G,k=g.x,Z=g.y,j=et(k-this.long0);if(Math.abs(Math.abs(Z)-Qe)<=pt)G=Z>0?-1:1,C=this.al/this.bl*Math.log(Math.tan(Yt+G*this.gamma0*.5)),b=-1*G*Qe*this.al/this.bl;else{var ee=sn(this.e,Z,Math.sin(Z)),re=this.el/Math.pow(ee,this.bl),ue=.5*(re-1/re),Pe=.5*(re+1/re),De=Math.sin(this.bl*j),Ge=(ue*Math.sin(this.gamma0)-De*Math.cos(this.gamma0))/Pe;C=Math.abs(Math.abs(Ge)-1)<=pt?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-Ge)/(1+Ge))/this.bl,b=Math.abs(Math.cos(this.bl*j))<=pt?this.al*this.bl*j:this.al*Math.atan2(ue*Math.cos(this.gamma0)+De*Math.sin(this.gamma0),Math.cos(this.bl*j))/this.bl}return this.no_rot?(g.x=this.x0+b,g.y=this.y0+C):(b-=this.uc,g.x=this.x0+C*Math.cos(this.alpha)+b*Math.sin(this.alpha),g.y=this.y0+b*Math.cos(this.alpha)-C*Math.sin(this.alpha)),g},inverse:function(g){var b,C;this.no_rot?(C=g.y-this.y0,b=g.x-this.x0):(C=(g.x-this.x0)*Math.cos(this.alpha)-(g.y-this.y0)*Math.sin(this.alpha),b=(g.y-this.y0)*Math.cos(this.alpha)+(g.x-this.x0)*Math.sin(this.alpha),b+=this.uc);var G=Math.exp(-1*this.bl*C/this.al),k=.5*(G-1/G),Z=.5*(G+1/G),j=Math.sin(this.bl*b/this.al),ee=(j*Math.cos(this.gamma0)+k*Math.sin(this.gamma0))/Z,re=Math.pow(this.el/Math.sqrt((1+ee)/(1-ee)),1/this.bl);return Math.abs(ee-1)<pt?(g.x=this.long0,g.y=Qe):Math.abs(ee+1)<pt?(g.x=this.long0,g.y=-1*Qe):(g.y=Qn(this.e,re),g.x=et(this.long0-Math.atan2(k*Math.cos(this.gamma0)-j*Math.sin(this.gamma0),Math.cos(this.bl*b/this.al))/this.bl)),g},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},tr={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<pt)){var g=this.b/this.a;this.e=Math.sqrt(1-g*g);var b=Math.sin(this.lat1),C=Math.cos(this.lat1),G=Pn(this.e,b,C),k=sn(this.e,this.lat1,b),Z=Math.sin(this.lat2),j=Math.cos(this.lat2),ee=Pn(this.e,Z,j),re=sn(this.e,this.lat2,Z),ue=sn(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>pt?this.ns=Math.log(G/ee)/Math.log(k/re):this.ns=b,isNaN(this.ns)&&(this.ns=b),this.f0=G/(this.ns*Math.pow(k,this.ns)),this.rh=this.a*this.f0*Math.pow(ue,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(g){var b=g.x,C=g.y;Math.abs(2*Math.abs(C)-Math.PI)<=pt&&(C=Jr(C)*(Qe-2*pt));var G,k,Z=Math.abs(Math.abs(C)-Qe);if(Z>pt)G=sn(this.e,C,Math.sin(C)),k=this.a*this.f0*Math.pow(G,this.ns);else{if((Z=C*this.ns)<=0)return null;k=0}var j=this.ns*et(b-this.long0);return g.x=this.k0*(k*Math.sin(j))+this.x0,g.y=this.k0*(this.rh-k*Math.cos(j))+this.y0,g},inverse:function(g){var b,C,G,k,Z,j=(g.x-this.x0)/this.k0,ee=this.rh-(g.y-this.y0)/this.k0;this.ns>0?(b=Math.sqrt(j*j+ee*ee),C=1):(b=-Math.sqrt(j*j+ee*ee),C=-1);var re=0;if(b!==0&&(re=Math.atan2(C*j,C*ee)),b!==0||this.ns>0){if(C=1/this.ns,G=Math.pow(b/(this.a*this.f0),C),(k=Qn(this.e,G))===-9999)return null}else k=-Qe;return Z=et(re/this.ns+this.long0),g.x=Z,g.y=k,g},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},ir={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(g){var b,C,G,k,Z,j,ee,re=g.x,ue=g.y,Pe=et(re-this.long0);return b=Math.pow((1+this.e*Math.sin(ue))/(1-this.e*Math.sin(ue)),this.alfa*this.e/2),C=2*(Math.atan(this.k*Math.pow(Math.tan(ue/2+this.s45),this.alfa)/b)-this.s45),G=-Pe*this.alfa,k=Math.asin(Math.cos(this.ad)*Math.sin(C)+Math.sin(this.ad)*Math.cos(C)*Math.cos(G)),Z=Math.asin(Math.cos(C)*Math.sin(G)/Math.cos(k)),j=this.n*Z,ee=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(k/2+this.s45),this.n),g.y=ee*Math.cos(j)/1,g.x=ee*Math.sin(j)/1,this.czech||(g.y*=-1,g.x*=-1),g},inverse:function(g){var b,C,G,k,Z,j,ee,re=g.x;g.x=g.y,g.y=re,this.czech||(g.y*=-1,g.x*=-1),Z=Math.sqrt(g.x*g.x+g.y*g.y),k=Math.atan2(g.y,g.x)/Math.sin(this.s0),G=2*(Math.atan(Math.pow(this.ro0/Z,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),b=Math.asin(Math.cos(this.ad)*Math.sin(G)-Math.sin(this.ad)*Math.cos(G)*Math.cos(k)),C=Math.asin(Math.cos(G)*Math.sin(k)/Math.cos(b)),g.x=this.long0-C/this.alfa,j=b,ee=0;var ue=0;do g.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(b/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(j))/(1-this.e*Math.sin(j)),this.e/2))-this.s45),Math.abs(j-g.y)<1e-10&&(ee=1),j=g.y,ue+=1;while(ee===0&&ue<15);return ue>=15?null:g},names:["Krovak","krovak"]},un=function(g,b,C,G,k){return g*k-b*Math.sin(2*k)+C*Math.sin(4*k)-G*Math.sin(6*k)},Mr=function(g){return 1-.25*g*(1+g/16*(3+1.25*g))},gs=function(g){return .375*g*(1+.25*g*(1+.46875*g))},Er=function(g){return .05859375*g*g*(1+.75*g)},nr=function(g){return g*g*g*(35/3072)},Sr=function(g,b,C){var G=b*C;return g/Math.sqrt(1-G*G)},sr=function(g){return Math.abs(g)<Qe?g:g-Jr(g)*Math.PI},ko=function(g,b,C,G,k){var Z,j;Z=g/b;for(var ee=0;ee<15;ee++)if(j=(g-(b*Z-C*Math.sin(2*Z)+G*Math.sin(4*Z)-k*Math.sin(6*Z)))/(b-2*C*Math.cos(2*Z)+4*G*Math.cos(4*Z)-6*k*Math.cos(6*Z)),Z+=j,Math.abs(j)<=1e-10)return Z;return NaN},fc={init:function(){this.sphere||(this.e0=Mr(this.es),this.e1=gs(this.es),this.e2=Er(this.es),this.e3=nr(this.es),this.ml0=this.a*un(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(g){var b,C,G=g.x,k=g.y;if(G=et(G-this.long0),this.sphere)b=this.a*Math.asin(Math.cos(k)*Math.sin(G)),C=this.a*(Math.atan2(Math.tan(k),Math.cos(G))-this.lat0);else{var Z=Math.sin(k),j=Math.cos(k),ee=Sr(this.a,this.e,Z),re=Math.tan(k)*Math.tan(k),ue=G*Math.cos(k),Pe=ue*ue,De=this.es*j*j/(1-this.es);b=ee*ue*(1-Pe*re*(1/6-(8-re+8*De)*Pe/120)),C=this.a*un(this.e0,this.e1,this.e2,this.e3,k)-this.ml0+ee*Z/j*Pe*(.5+(5-re+6*De)*Pe/24)}return g.x=b+this.x0,g.y=C+this.y0,g},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b,C,G=g.x/this.a,k=g.y/this.a;if(this.sphere){var Z=k+this.lat0;b=Math.asin(Math.sin(Z)*Math.cos(G)),C=Math.atan2(Math.tan(G),Math.cos(Z))}else{var j=this.ml0/this.a+k,ee=ko(j,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(ee)-Qe)<=pt)return g.x=this.long0,g.y=Qe,k<0&&(g.y*=-1),g;var re=Sr(this.a,this.e,Math.sin(ee)),ue=re*re*re/this.a/this.a*(1-this.es),Pe=Math.pow(Math.tan(ee),2),De=G*this.a/re,Ge=De*De;b=ee-re*Math.tan(ee)/ue*De*De*(.5-(1+3*Pe)*De*De/24),C=De*(1-Ge*(Pe/3+(1+3*Pe)*Pe*Ge/15))/Math.cos(ee)}return g.x=et(C+this.long0),g.y=sr(b),g},names:["Cassini","Cassini_Soldner","cass"]},ts=function(g,b){var C;return g>1e-7?(C=g*b,(1-g*g)*(b/(1-C*C)-.5/g*Math.log((1-C)/(1+C)))):2*b},pc=.3333333333333333,mc=.17222222222222222,gc=.10257936507936508,vc=.06388888888888888,yc=.0664021164021164,xc=.016415012942191543,wc={init:function(){var g=Math.abs(this.lat0);if(Math.abs(g-Qe)<pt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(g)<pt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var b;switch(this.qp=ts(this.e,1),this.mmf=.5/(1-this.es),this.apa=kn(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),b=Math.sin(this.lat0),this.sinb1=ts(this.e,b)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*b*b)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(g){var b,C,G,k,Z,j,ee,re,ue,Pe,De=g.x,Ge=g.y;if(De=et(De-this.long0),this.sphere){if(Z=Math.sin(Ge),Pe=Math.cos(Ge),G=Math.cos(De),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((C=this.mode===this.EQUIT?1+Pe*G:1+this.sinph0*Z+this.cosph0*Pe*G)<=pt)return null;b=(C=Math.sqrt(2/C))*Pe*Math.sin(De),C*=this.mode===this.EQUIT?Z:this.cosph0*Z-this.sinph0*Pe*G}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(G=-G),Math.abs(Ge+this.lat0)<pt)return null;C=Yt-.5*Ge,b=(C=2*(this.mode===this.S_POLE?Math.cos(C):Math.sin(C)))*Math.sin(De),C*=G}}else{switch(ee=0,re=0,ue=0,G=Math.cos(De),k=Math.sin(De),Z=Math.sin(Ge),j=ts(this.e,Z),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(ee=j/this.qp,re=Math.sqrt(1-ee*ee)),this.mode){case this.OBLIQ:ue=1+this.sinb1*ee+this.cosb1*re*G;break;case this.EQUIT:ue=1+re*G;break;case this.N_POLE:ue=Qe+Ge,j=this.qp-j;break;case this.S_POLE:ue=Ge-Qe,j=this.qp+j}if(Math.abs(ue)<pt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:ue=Math.sqrt(2/ue),C=this.mode===this.OBLIQ?this.ymf*ue*(this.cosb1*ee-this.sinb1*re*G):(ue=Math.sqrt(2/(1+re*G)))*ee*this.ymf,b=this.xmf*ue*re*k;break;case this.N_POLE:case this.S_POLE:j>=0?(b=(ue=Math.sqrt(j))*k,C=G*(this.mode===this.S_POLE?ue:-ue)):b=C=0}}return g.x=this.a*b+this.x0,g.y=this.a*C+this.y0,g},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b,C,G,k,Z,j,ee,re=g.x/this.a,ue=g.y/this.a;if(this.sphere){var Pe,De=0,Ge=0;if(Pe=Math.sqrt(re*re+ue*ue),(C=.5*Pe)>1)return null;switch(C=2*Math.asin(C),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(Ge=Math.sin(C),De=Math.cos(C)),this.mode){case this.EQUIT:C=Math.abs(Pe)<=pt?0:Math.asin(ue*Ge/Pe),re*=Ge,ue=De*Pe;break;case this.OBLIQ:C=Math.abs(Pe)<=pt?this.lat0:Math.asin(De*this.sinph0+ue*Ge*this.cosph0/Pe),re*=Ge*this.cosph0,ue=(De-Math.sin(C)*this.sinph0)*Pe;break;case this.N_POLE:ue=-ue,C=Qe-C;break;case this.S_POLE:C-=Qe}b=ue!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(re,ue):0}else{if(ee=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(re/=this.dd,ue*=this.dd,(j=Math.sqrt(re*re+ue*ue))<pt)return g.x=this.long0,g.y=this.lat0,g;k=2*Math.asin(.5*j/this.rq),G=Math.cos(k),re*=k=Math.sin(k),this.mode===this.OBLIQ?(ee=G*this.sinb1+ue*k*this.cosb1/j,Z=this.qp*ee,ue=j*this.cosb1*G-ue*this.sinb1*k):(ee=ue*k/j,Z=this.qp*ee,ue=j*G)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(ue=-ue),!(Z=re*re+ue*ue))return g.x=this.long0,g.y=this.lat0,g;ee=1-Z/this.qp,this.mode===this.S_POLE&&(ee=-ee)}b=Math.atan2(re,ue),C=Ro(Math.asin(ee),this.apa)}return g.x=et(this.long0+b),g.y=C,g},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},vs=function(g){return Math.abs(g)>1&&(g=g>1?1:-1),Math.asin(g)},Aa={init:function(){Math.abs(this.lat1+this.lat2)<pt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Pn(this.e3,this.sin_po,this.cos_po),this.qs1=ts(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Pn(this.e3,this.sin_po,this.cos_po),this.qs2=ts(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ts(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>pt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(g){var b=g.x,C=g.y;this.sin_phi=Math.sin(C),this.cos_phi=Math.cos(C);var G=ts(this.e3,this.sin_phi,this.cos_phi),k=this.a*Math.sqrt(this.c-this.ns0*G)/this.ns0,Z=this.ns0*et(b-this.long0),j=k*Math.sin(Z)+this.x0,ee=this.rh-k*Math.cos(Z)+this.y0;return g.x=j,g.y=ee,g},inverse:function(g){var b,C,G,k,Z,j;return g.x-=this.x0,g.y=this.rh-g.y+this.y0,this.ns0>=0?(b=Math.sqrt(g.x*g.x+g.y*g.y),G=1):(b=-Math.sqrt(g.x*g.x+g.y*g.y),G=-1),k=0,b!==0&&(k=Math.atan2(G*g.x,G*g.y)),G=b*this.ns0/this.a,this.sphere?j=Math.asin((this.c-G*G)/(2*this.ns0)):(C=(this.c-G*G)/this.ns0,j=this.phi1z(this.e3,C)),Z=et(k/this.ns0+this.long0),g.x=Z,g.y=j,g},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(g,b){var C,G,k,Z,j,ee=vs(.5*b);if(g<pt)return ee;for(var re=g*g,ue=1;ue<=25;ue++)if(C=Math.sin(ee),G=Math.cos(ee),k=g*C,Z=1-k*k,j=.5*Z*Z/G*(b/(1-re)-C/Z+.5/g*Math.log((1-k)/(1+k))),ee+=j,Math.abs(j)<=1e-7)return ee;return null}},hl={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(g){var b,C,G,k,Z,j,ee,re=g.x,ue=g.y;return G=et(re-this.long0),b=Math.sin(ue),C=Math.cos(ue),k=Math.cos(G),(Z=this.sin_p14*b+this.cos_p14*C*k)>0||Math.abs(Z)<=pt?(j=this.x0+1*this.a*C*Math.sin(G)/Z,ee=this.y0+1*this.a*(this.cos_p14*b-this.sin_p14*C*k)/Z):(j=this.x0+this.infinity_dist*C*Math.sin(G),ee=this.y0+this.infinity_dist*(this.cos_p14*b-this.sin_p14*C*k)),g.x=j,g.y=ee,g},inverse:function(g){var b,C,G,k,Z,j;return g.x=(g.x-this.x0)/this.a,g.y=(g.y-this.y0)/this.a,g.x/=this.k0,g.y/=this.k0,(b=Math.sqrt(g.x*g.x+g.y*g.y))?(k=Math.atan2(b,this.rc),C=Math.sin(k),G=Math.cos(k),j=vs(G*this.sin_p14+g.y*C*this.cos_p14/b),Z=Math.atan2(g.x*C,b*this.cos_p14*G-g.y*this.sin_p14*C),Z=et(this.long0+Z)):(j=this.phic0,Z=0),g.x=Z,g.y=j,g},names:["gnom"]},Ca=function(g,b){var C=1-(1-g*g)/(2*g)*Math.log((1-g)/(1+g));if(Math.abs(Math.abs(b)-C)<1e-6)return b<0?-1*Qe:Qe;for(var G,k,Z,j,ee=Math.asin(.5*b),re=0;re<30;re++)if(k=Math.sin(ee),Z=Math.cos(ee),j=g*k,G=Math.pow(1-j*j,2)/(2*Z)*(b/(1-g*g)-k/(1-j*j)+.5/g*Math.log((1-j)/(1+j))),ee+=G,Math.abs(G)<=1e-10)return ee;return NaN},dl={init:function(){this.sphere||(this.k0=Pn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(g){var b,C,G=g.x,k=g.y,Z=et(G-this.long0);if(this.sphere)b=this.x0+this.a*Z*Math.cos(this.lat_ts),C=this.y0+this.a*Math.sin(k)/Math.cos(this.lat_ts);else{var j=ts(this.e,Math.sin(k));b=this.x0+this.a*this.k0*Z,C=this.y0+this.a*j*.5/this.k0}return g.x=b,g.y=C,g},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b,C;return this.sphere?(b=et(this.long0+g.x/this.a/Math.cos(this.lat_ts)),C=Math.asin(g.y/this.a*Math.cos(this.lat_ts))):(C=Ca(this.e,2*g.y*this.k0/this.a),b=et(this.long0+g.x/(this.a*this.k0))),g.x=b,g.y=C,g},names:["cea"]},fl={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(g){var b=g.x,C=g.y,G=et(b-this.long0),k=sr(C-this.lat0);return g.x=this.x0+this.a*G*this.rc,g.y=this.y0+this.a*k,g},inverse:function(g){var b=g.x,C=g.y;return g.x=et(this.long0+(b-this.x0)/(this.a*this.rc)),g.y=sr(this.lat0+(C-this.y0)/this.a),g},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},zo=20,bc={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Mr(this.es),this.e1=gs(this.es),this.e2=Er(this.es),this.e3=nr(this.es),this.ml0=this.a*un(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(g){var b,C,G,k=g.x,Z=g.y,j=et(k-this.long0);if(G=j*Math.sin(Z),this.sphere)Math.abs(Z)<=pt?(b=this.a*j,C=-1*this.a*this.lat0):(b=this.a*Math.sin(G)/Math.tan(Z),C=this.a*(sr(Z-this.lat0)+(1-Math.cos(G))/Math.tan(Z)));else if(Math.abs(Z)<=pt)b=this.a*j,C=-1*this.ml0;else{var ee=Sr(this.a,this.e,Math.sin(Z))/Math.tan(Z);b=ee*Math.sin(G),C=this.a*un(this.e0,this.e1,this.e2,this.e3,Z)-this.ml0+ee*(1-Math.cos(G))}return g.x=b+this.x0,g.y=C+this.y0,g},inverse:function(g){var b,C,G,k,Z,j,ee,re,ue;if(G=g.x-this.x0,k=g.y-this.y0,this.sphere)if(Math.abs(k+this.a*this.lat0)<=pt)b=et(G/this.a+this.long0),C=0;else{j=this.lat0+k/this.a,ee=G*G/this.a/this.a+j*j,re=j;var Pe;for(Z=zo;Z;--Z)if(Pe=Math.tan(re),ue=-1*(j*(re*Pe+1)-re-.5*(re*re+ee)*Pe)/((re-j)/Pe-1),re+=ue,Math.abs(ue)<=pt){C=re;break}b=et(this.long0+Math.asin(G*Math.tan(re)/this.a)/Math.sin(C))}else if(Math.abs(k+this.ml0)<=pt)C=0,b=et(this.long0+G/this.a);else{j=(this.ml0+k)/this.a,ee=G*G/this.a/this.a+j*j,re=j;var De,Ge,ht,Xe,dt;for(Z=zo;Z;--Z)if(dt=this.e*Math.sin(re),De=Math.sqrt(1-dt*dt)*Math.tan(re),Ge=this.a*un(this.e0,this.e1,this.e2,this.e3,re),ht=this.e0-2*this.e1*Math.cos(2*re)+4*this.e2*Math.cos(4*re)-6*this.e3*Math.cos(6*re),Xe=Ge/this.a,ue=(j*(De*Xe+1)-Xe-.5*De*(Xe*Xe+ee))/(this.es*Math.sin(2*re)*(Xe*Xe+ee-2*j*Xe)/(4*De)+(j-Xe)*(De*ht-2/Math.sin(2*re))-ht),re-=ue,Math.abs(ue)<=pt){C=re;break}De=Math.sqrt(1-this.es*Math.pow(Math.sin(C),2))*Math.tan(C),b=et(this.long0+Math.asin(G*De/this.a)/Math.sin(C))}return g.x=b,g.y=C,g},names:["Polyconic","poly"]},io={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(g){var b,C=g.x,G=g.y-this.lat0,k=C-this.long0,Z=G/yr*1e-5,j=k,ee=1,re=0;for(b=1;b<=10;b++)ee*=Z,re+=this.A[b]*ee;var ue,Pe=re,De=j,Ge=1,ht=0,Xe=0,dt=0;for(b=1;b<=6;b++)ue=ht*Pe+Ge*De,Ge=Ge*Pe-ht*De,ht=ue,Xe=Xe+this.B_re[b]*Ge-this.B_im[b]*ht,dt=dt+this.B_im[b]*Ge+this.B_re[b]*ht;return g.x=dt*this.a+this.x0,g.y=Xe*this.a+this.y0,g},inverse:function(g){var b,C,G=g.x,k=g.y,Z=G-this.x0,j=(k-this.y0)/this.a,ee=Z/this.a,re=1,ue=0,Pe=0,De=0;for(b=1;b<=6;b++)C=ue*j+re*ee,re=re*j-ue*ee,ue=C,Pe=Pe+this.C_re[b]*re-this.C_im[b]*ue,De=De+this.C_im[b]*re+this.C_re[b]*ue;for(var Ge=0;Ge<this.iterations;Ge++){var ht,Xe=Pe,dt=De,Ft=j,yt=ee;for(b=2;b<=6;b++)ht=dt*Pe+Xe*De,Xe=Xe*Pe-dt*De,dt=ht,Ft+=(b-1)*(this.B_re[b]*Xe-this.B_im[b]*dt),yt+=(b-1)*(this.B_im[b]*Xe+this.B_re[b]*dt);Xe=1,dt=0;var wi=this.B_re[1],Gt=this.B_im[1];for(b=2;b<=6;b++)ht=dt*Pe+Xe*De,Xe=Xe*Pe-dt*De,dt=ht,wi+=b*(this.B_re[b]*Xe-this.B_im[b]*dt),Gt+=b*(this.B_im[b]*Xe+this.B_re[b]*dt);var Ui=wi*wi+Gt*Gt;Pe=(Ft*wi+yt*Gt)/Ui,De=(yt*wi-Ft*Gt)/Ui}var zt=Pe,Mi=De,ks=1,ys=0;for(b=1;b<=9;b++)ks*=zt,ys+=this.D[b]*ks;var ar=this.lat0+ys*yr*1e5,is=this.long0+Mi;return g.x=is,g.y=ar,g},names:["New_Zealand_Map_Grid","nzmg"]},Tr={init:function(){},forward:function(g){var b=g.x,C=g.y,G=et(b-this.long0),k=this.x0+this.a*G,Z=this.y0+this.a*Math.log(Math.tan(Math.PI/4+C/2.5))*1.25;return g.x=k,g.y=Z,g},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b=et(this.long0+g.x/this.a),C=2.5*(Math.atan(Math.exp(.8*g.y/this.a))-Math.PI/4);return g.x=b,g.y=C,g},names:["Miller_Cylindrical","mill"]},rr=20,or={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=_a(this.es)},forward:function(g){var b,C,G=g.x,k=g.y;if(G=et(G-this.long0),this.sphere){if(this.m)for(var Z=this.n*Math.sin(k),j=rr;j;--j){var ee=(this.m*k+Math.sin(k)-Z)/(this.m+Math.cos(k));if(k-=ee,Math.abs(ee)<pt)break}else k=this.n!==1?Math.asin(this.n*Math.sin(k)):k;b=this.a*this.C_x*G*(this.m+Math.cos(k)),C=this.a*this.C_y*k}else{var re=Math.sin(k),ue=Math.cos(k);C=this.a*eo(k,re,ue,this.en),b=this.a*G*ue/Math.sqrt(1-this.es*re*re)}return g.x=b,g.y=C,g},inverse:function(g){var b,C,G,k;return g.x-=this.x0,G=g.x/this.a,g.y-=this.y0,b=g.y/this.a,this.sphere?(b/=this.C_y,G/=this.C_x*(this.m+Math.cos(b)),this.m?b=vs((this.m*b+Math.sin(b))/this.n):this.n!==1&&(b=vs(Math.sin(b)/this.n)),G=et(G+this.long0),b=sr(b)):(b=Ma(g.y/this.a,this.es,this.en),(k=Math.abs(b))<Qe?(k=Math.sin(b),C=this.long0+g.x*Math.sqrt(1-this.es*k*k)/(this.a*Math.cos(b)),G=et(C)):k-pt<Qe&&(G=this.long0)),g.x=G,g.y=b,g},names:["Sinusoidal","sinu"]},Os={init:function(){},forward:function(g){for(var b=g.x,C=g.y,G=et(b-this.long0),k=C,Z=Math.PI*Math.sin(C);;){var j=-(k+Math.sin(k)-Z)/(1+Math.cos(k));if(k+=j,Math.abs(j)<pt)break}k/=2,Math.PI/2-Math.abs(C)<pt&&(G=0);var ee=.900316316158*this.a*G*Math.cos(k)+this.x0,re=1.4142135623731*this.a*Math.sin(k)+this.y0;return g.x=ee,g.y=re,g},inverse:function(g){var b,C;g.x-=this.x0,g.y-=this.y0,C=g.y/(1.4142135623731*this.a),Math.abs(C)>.999999999999&&(C=.999999999999),b=Math.asin(C);var G=et(this.long0+g.x/(.900316316158*this.a*Math.cos(b)));G<-Math.PI&&(G=-Math.PI),G>Math.PI&&(G=Math.PI),C=(2*b+Math.sin(2*b))/Math.PI,Math.abs(C)>1&&(C=1);var k=Math.asin(C);return g.x=G,g.y=k,g},names:["Mollweide","moll"]},no={init:function(){Math.abs(this.lat1+this.lat2)<pt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Mr(this.es),this.e1=gs(this.es),this.e2=Er(this.es),this.e3=nr(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Pn(this.e,this.sinphi,this.cosphi),this.ml1=un(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<pt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Pn(this.e,this.sinphi,this.cosphi),this.ml2=un(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=un(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(g){var b,C=g.x,G=g.y;if(this.sphere)b=this.a*(this.g-G);else{var k=un(this.e0,this.e1,this.e2,this.e3,G);b=this.a*(this.g-k)}var Z=this.ns*et(C-this.long0),j=this.x0+b*Math.sin(Z),ee=this.y0+this.rh-b*Math.cos(Z);return g.x=j,g.y=ee,g},inverse:function(g){g.x-=this.x0,g.y=this.rh-g.y+this.y0;var b,C,G,k;this.ns>=0?(C=Math.sqrt(g.x*g.x+g.y*g.y),b=1):(C=-Math.sqrt(g.x*g.x+g.y*g.y),b=-1);var Z=0;if(C!==0&&(Z=Math.atan2(b*g.x,b*g.y)),this.sphere)return k=et(this.long0+Z/this.ns),G=sr(this.g-C/this.a),g.x=k,g.y=G,g;var j=this.g-C/this.a;return G=ko(j,this.e0,this.e1,this.e2,this.e3),k=et(this.long0+Z/this.ns),g.x=k,g.y=G,g},names:["Equidistant_Conic","eqdc"]},Da={init:function(){this.R=this.a},forward:function(g){var b,C,G=g.x,k=g.y,Z=et(G-this.long0);Math.abs(k)<=pt&&(b=this.x0+this.R*Z,C=this.y0);var j=vs(2*Math.abs(k/Math.PI));(Math.abs(Z)<=pt||Math.abs(Math.abs(k)-Qe)<=pt)&&(b=this.x0,C=k>=0?this.y0+Math.PI*this.R*Math.tan(.5*j):this.y0+Math.PI*this.R*-Math.tan(.5*j));var ee=.5*Math.abs(Math.PI/Z-Z/Math.PI),re=ee*ee,ue=Math.sin(j),Pe=Math.cos(j),De=Pe/(ue+Pe-1),Ge=De*De,ht=De*(2/ue-1),Xe=ht*ht,dt=Math.PI*this.R*(ee*(De-Xe)+Math.sqrt(re*(De-Xe)*(De-Xe)-(Xe+re)*(Ge-Xe)))/(Xe+re);Z<0&&(dt=-dt),b=this.x0+dt;var Ft=re+De;return dt=Math.PI*this.R*(ht*Ft-ee*Math.sqrt((Xe+re)*(re+1)-Ft*Ft))/(Xe+re),C=k>=0?this.y0+dt:this.y0-dt,g.x=b,g.y=C,g},inverse:function(g){var b,C,G,k,Z,j,ee,re,ue,Pe,De,Ge,ht;return g.x-=this.x0,g.y-=this.y0,De=Math.PI*this.R,G=g.x/De,k=g.y/De,Z=G*G+k*k,j=-Math.abs(k)*(1+Z),ee=j-2*k*k+G*G,re=-2*j+1+2*k*k+Z*Z,ht=k*k/re+(2*ee*ee*ee/re/re/re-9*j*ee/re/re)/27,ue=(j-ee*ee/3/re)/re,Pe=2*Math.sqrt(-ue/3),De=3*ht/ue/Pe,Math.abs(De)>1&&(De=De>=0?1:-1),Ge=Math.acos(De)/3,C=g.y>=0?(-Pe*Math.cos(Ge+Math.PI/3)-ee/3/re)*Math.PI:-(-Pe*Math.cos(Ge+Math.PI/3)-ee/3/re)*Math.PI,b=Math.abs(G)<pt?this.long0:et(this.long0+Math.PI*(Z-1+Math.sqrt(1+2*(G*G-k*k)+Z*Z))/2/G),g.x=b,g.y=C,g},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},pl={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(g){var b,C,G,k,Z,j,ee,re,ue,Pe,De,Ge,ht,Xe,dt,Ft,yt,wi,Gt,Ui,zt,Mi,ks,ys=g.x,ar=g.y,is=Math.sin(g.y),Rn=Math.cos(g.y),di=et(ys-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=pt?(g.x=this.x0+this.a*(Qe-ar)*Math.sin(di),g.y=this.y0-this.a*(Qe-ar)*Math.cos(di),g):Math.abs(this.sin_p12+1)<=pt?(g.x=this.x0+this.a*(Qe+ar)*Math.sin(di),g.y=this.y0+this.a*(Qe+ar)*Math.cos(di),g):(wi=this.sin_p12*is+this.cos_p12*Rn*Math.cos(di),Ft=Math.acos(wi),yt=Ft?Ft/Math.sin(Ft):1,g.x=this.x0+this.a*yt*Rn*Math.sin(di),g.y=this.y0+this.a*yt*(this.cos_p12*is-this.sin_p12*Rn*Math.cos(di)),g):(b=Mr(this.es),C=gs(this.es),G=Er(this.es),k=nr(this.es),Math.abs(this.sin_p12-1)<=pt?(Z=this.a*un(b,C,G,k,Qe),j=this.a*un(b,C,G,k,ar),g.x=this.x0+(Z-j)*Math.sin(di),g.y=this.y0-(Z-j)*Math.cos(di),g):Math.abs(this.sin_p12+1)<=pt?(Z=this.a*un(b,C,G,k,Qe),j=this.a*un(b,C,G,k,ar),g.x=this.x0+(Z+j)*Math.sin(di),g.y=this.y0+(Z+j)*Math.cos(di),g):(ee=is/Rn,re=Sr(this.a,this.e,this.sin_p12),ue=Sr(this.a,this.e,is),Pe=Math.atan((1-this.es)*ee+this.es*re*this.sin_p12/(ue*Rn)),De=Math.atan2(Math.sin(di),this.cos_p12*Math.tan(Pe)-this.sin_p12*Math.cos(di)),Gt=De===0?Math.asin(this.cos_p12*Math.sin(Pe)-this.sin_p12*Math.cos(Pe)):Math.abs(Math.abs(De)-Math.PI)<=pt?-Math.asin(this.cos_p12*Math.sin(Pe)-this.sin_p12*Math.cos(Pe)):Math.asin(Math.sin(di)*Math.cos(Pe)/Math.sin(De)),Ge=this.e*this.sin_p12/Math.sqrt(1-this.es),ht=this.e*this.cos_p12*Math.cos(De)/Math.sqrt(1-this.es),Xe=Ge*ht,dt=ht*ht,Ui=Gt*Gt,zt=Ui*Gt,Mi=zt*Gt,ks=Mi*Gt,Ft=re*Gt*(1-Ui*dt*(1-dt)/6+zt/8*Xe*(1-2*dt)+Mi/120*(dt*(4-7*dt)-3*Ge*Ge*(1-7*dt))-ks/48*Xe),g.x=this.x0+Ft*Math.sin(De),g.y=this.y0+Ft*Math.cos(De),g))},inverse:function(g){g.x-=this.x0,g.y-=this.y0;var b,C,G,k,Z,j,ee,re,ue,Pe,De,Ge,ht,Xe,dt,Ft,yt,wi,Gt,Ui,zt,Mi,ks,ys;return this.sphere?(b=Math.sqrt(g.x*g.x+g.y*g.y))>2*Qe*this.a?void 0:(C=b/this.a,G=Math.sin(C),k=Math.cos(C),Z=this.long0,Math.abs(b)<=pt?j=this.lat0:(j=vs(k*this.sin_p12+g.y*G*this.cos_p12/b),ee=Math.abs(this.lat0)-Qe,Z=et(Math.abs(ee)<=pt?this.lat0>=0?this.long0+Math.atan2(g.x,-g.y):this.long0-Math.atan2(-g.x,g.y):this.long0+Math.atan2(g.x*G,b*this.cos_p12*k-g.y*this.sin_p12*G))),g.x=Z,g.y=j,g):(re=Mr(this.es),ue=gs(this.es),Pe=Er(this.es),De=nr(this.es),Math.abs(this.sin_p12-1)<=pt?(Ge=this.a*un(re,ue,Pe,De,Qe),b=Math.sqrt(g.x*g.x+g.y*g.y),ht=Ge-b,j=ko(ht/this.a,re,ue,Pe,De),Z=et(this.long0+Math.atan2(g.x,-1*g.y)),g.x=Z,g.y=j,g):Math.abs(this.sin_p12+1)<=pt?(Ge=this.a*un(re,ue,Pe,De,Qe),b=Math.sqrt(g.x*g.x+g.y*g.y),ht=b-Ge,j=ko(ht/this.a,re,ue,Pe,De),Z=et(this.long0+Math.atan2(g.x,g.y)),g.x=Z,g.y=j,g):(b=Math.sqrt(g.x*g.x+g.y*g.y),Ft=Math.atan2(g.x,g.y),Xe=Sr(this.a,this.e,this.sin_p12),yt=Math.cos(Ft),wi=this.e*this.cos_p12*yt,Gt=-wi*wi/(1-this.es),Ui=3*this.es*(1-Gt)*this.sin_p12*this.cos_p12*yt/(1-this.es),zt=b/Xe,Mi=zt-Gt*(1+Gt)*Math.pow(zt,3)/6-Ui*(1+3*Gt)*Math.pow(zt,4)/24,ks=1-Gt*Mi*Mi/2-zt*Mi*Mi*Mi/6,dt=Math.asin(this.sin_p12*Math.cos(Mi)+this.cos_p12*Math.sin(Mi)*yt),Z=et(this.long0+Math.asin(Math.sin(Ft)*Math.sin(Mi)/Math.cos(dt))),ys=Math.sin(dt),j=Math.atan2((ys-this.es*ks*this.sin_p12)*Math.tan(dt),ys*(1-this.es)),g.x=Z,g.y=j,g))},names:["Azimuthal_Equidistant","aeqd"]},p={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(g){var b,C,G,k,Z,j,ee,re=g.x,ue=g.y;return G=et(re-this.long0),b=Math.sin(ue),C=Math.cos(ue),k=Math.cos(G),((Z=this.sin_p14*b+this.cos_p14*C*k)>0||Math.abs(Z)<=pt)&&(j=1*this.a*C*Math.sin(G),ee=this.y0+1*this.a*(this.cos_p14*b-this.sin_p14*C*k)),g.x=j,g.y=ee,g},inverse:function(g){var b,C,G,k,Z,j,ee;return g.x-=this.x0,g.y-=this.y0,b=Math.sqrt(g.x*g.x+g.y*g.y),C=vs(b/this.a),G=Math.sin(C),k=Math.cos(C),j=this.long0,Math.abs(b)<=pt?(ee=this.lat0,g.x=j,g.y=ee,g):(ee=vs(k*this.sin_p14+g.y*G*this.cos_p14/b),Z=Math.abs(this.lat0)-Qe,Math.abs(Z)<=pt?(j=et(this.lat0>=0?this.long0+Math.atan2(g.x,-g.y):this.long0-Math.atan2(-g.x,g.y)),g.x=j,g.y=ee,g):(j=et(this.long0+Math.atan2(g.x*G,b*this.cos_p14*k-g.y*this.sin_p14*G)),g.x=j,g.y=ee,g))},names:["ortho"]},w={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},T={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},D={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Qe-Yt/2?this.face=w.TOP:this.lat0<=-(Qe-Yt/2)?this.face=w.BOTTOM:Math.abs(this.long0)<=Yt?this.face=w.FRONT:Math.abs(this.long0)<=Qe+Yt?this.face=this.long0>0?w.RIGHT:w.LEFT:this.face=w.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(g){var b,C,G,k,Z,j,ee={x:0,y:0},re={value:0};if(g.x-=this.long0,b=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(g.y)):g.y,C=g.x,this.face===w.TOP)k=Qe-b,C>=Yt&&C<=Qe+Yt?(re.value=T.AREA_0,G=C-Qe):C>Qe+Yt||C<=-(Qe+Yt)?(re.value=T.AREA_1,G=C>0?C-xi:C+xi):C>-(Qe+Yt)&&C<=-Yt?(re.value=T.AREA_2,G=C+Qe):(re.value=T.AREA_3,G=C);else if(this.face===w.BOTTOM)k=Qe+b,C>=Yt&&C<=Qe+Yt?(re.value=T.AREA_0,G=-C+Qe):C<Yt&&C>=-Yt?(re.value=T.AREA_1,G=-C):C<-Yt&&C>=-(Qe+Yt)?(re.value=T.AREA_2,G=-C-Qe):(re.value=T.AREA_3,G=C>0?-C+xi:-C-xi);else{var ue,Pe,De,Ge,ht,Xe;this.face===w.RIGHT?C=Bt(C,+Qe):this.face===w.BACK?C=Bt(C,+xi):this.face===w.LEFT&&(C=Bt(C,-Qe)),Ge=Math.sin(b),ht=Math.cos(b),Xe=Math.sin(C),ue=ht*Math.cos(C),Pe=ht*Xe,De=Ge,this.face===w.FRONT?G=Ls(k=Math.acos(ue),De,Pe,re):this.face===w.RIGHT?G=Ls(k=Math.acos(Pe),De,-ue,re):this.face===w.BACK?G=Ls(k=Math.acos(-ue),De,-Pe,re):this.face===w.LEFT?G=Ls(k=Math.acos(-Pe),De,ue,re):(k=G=0,re.value=T.AREA_0)}return j=Math.atan(12/xi*(G+Math.acos(Math.sin(G)*Math.cos(Yt))-Qe)),Z=Math.sqrt((1-Math.cos(k))/(Math.cos(j)*Math.cos(j))/(1-Math.cos(Math.atan(1/Math.cos(G))))),re.value===T.AREA_1?j+=Qe:re.value===T.AREA_2?j+=xi:re.value===T.AREA_3&&(j+=1.5*xi),ee.x=Z*Math.cos(j),ee.y=Z*Math.sin(j),ee.x=ee.x*this.a+this.x0,ee.y=ee.y*this.a+this.y0,g.x=ee.x,g.y=ee.y,g},inverse:function(g){var b,C,G,k,Z,j,ee,re,ue,Pe={lam:0,phi:0},De={value:0};if(g.x=(g.x-this.x0)/this.a,g.y=(g.y-this.y0)/this.a,C=Math.atan(Math.sqrt(g.x*g.x+g.y*g.y)),b=Math.atan2(g.y,g.x),g.x>=0&&g.x>=Math.abs(g.y)?De.value=T.AREA_0:g.y>=0&&g.y>=Math.abs(g.x)?(De.value=T.AREA_1,b-=Qe):g.x<0&&-g.x>=Math.abs(g.y)?(De.value=T.AREA_2,b=b<0?b+xi:b-xi):(De.value=T.AREA_3,b+=Qe),ue=xi/12*Math.tan(b),Z=Math.sin(ue)/(Math.cos(ue)-1/Math.sqrt(2)),j=Math.atan(Z),G=Math.cos(b),k=Math.tan(C),(ee=1-G*G*k*k*(1-Math.cos(Math.atan(1/Math.cos(j)))))<-1?ee=-1:ee>1&&(ee=1),this.face===w.TOP)re=Math.acos(ee),Pe.phi=Qe-re,De.value===T.AREA_0?Pe.lam=j+Qe:De.value===T.AREA_1?Pe.lam=j<0?j+xi:j-xi:De.value===T.AREA_2?Pe.lam=j-Qe:Pe.lam=j;else if(this.face===w.BOTTOM)re=Math.acos(ee),Pe.phi=re-Qe,De.value===T.AREA_0?Pe.lam=-j+Qe:De.value===T.AREA_1?Pe.lam=-j:De.value===T.AREA_2?Pe.lam=-j-Qe:Pe.lam=j<0?-j-xi:-j+xi;else{var Ge,ht,Xe;ue=(Ge=ee)*Ge,ht=(ue+=(Xe=ue>=1?0:Math.sqrt(1-ue)*Math.sin(j))*Xe)>=1?0:Math.sqrt(1-ue),De.value===T.AREA_1?(ue=ht,ht=-Xe,Xe=ue):De.value===T.AREA_2?(ht=-ht,Xe=-Xe):De.value===T.AREA_3&&(ue=ht,ht=Xe,Xe=-ue),this.face===w.RIGHT?(ue=Ge,Ge=-ht,ht=ue):this.face===w.BACK?(Ge=-Ge,ht=-ht):this.face===w.LEFT&&(ue=Ge,Ge=ht,ht=-ue),Pe.phi=Math.acos(-Xe)-Qe,Pe.lam=Math.atan2(ht,Ge),this.face===w.RIGHT?Pe.lam=Bt(Pe.lam,-Qe):this.face===w.BACK?Pe.lam=Bt(Pe.lam,-xi):this.face===w.LEFT&&(Pe.lam=Bt(Pe.lam,+Qe))}if(this.es!==0){var dt,Ft,yt;dt=Pe.phi<0?1:0,Ft=Math.tan(Pe.phi),yt=this.b/Math.sqrt(Ft*Ft+this.one_minus_f_squared),Pe.phi=Math.atan(Math.sqrt(this.a*this.a-yt*yt)/(this.one_minus_f*yt)),dt&&(Pe.phi=-Pe.phi)}return Pe.lam+=this.long0,g.x=Pe.lam,g.y=Pe.phi,g},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},H=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],U=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],q=.8487,me=1.3523,_e=Wn/5,Ce=1/_e,ze=18,Ke=function(g,b){return g[0]+b*(g[1]+b*(g[2]+b*g[3]))},Re=function(g,b){return g[1]+b*(2*g[2]+3*b*g[3])},$e={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(g){var b=et(g.x-this.long0),C=Math.abs(g.y),G=Math.floor(C*_e);G<0?G=0:G>=ze&&(G=ze-1),C=Wn*(C-Ce*G);var k={x:Ke(H[G],C)*b,y:Ke(U[G],C)};return g.y<0&&(k.y=-k.y),k.x=k.x*this.a*q+this.x0,k.y=k.y*this.a*me+this.y0,k},inverse:function(g){var b={x:(g.x-this.x0)/(this.a*q),y:Math.abs(g.y-this.y0)/(this.a*me)};if(b.y>=1)b.x/=H[ze][0],b.y=g.y<0?-Qe:Qe;else{var C=Math.floor(b.y*ze);for(C<0?C=0:C>=ze&&(C=ze-1);;)if(U[C][0]>b.y)--C;else{if(!(U[C+1][0]<=b.y))break;++C}var G=U[C],k=5*(b.y-G[0])/(U[C+1][0]-G[0]);k=gn(function(Z){return(Ke(G,Z)-b.y)/Re(G,Z)},k,pt,100),b.x/=Ke(H[C],k),b.y=(5*C+k)*ki,g.y<0&&(b.y=-b.y)}return b.x=et(b.x+this.long0),b},names:["Robinson","robin"]},Pt={init:function(){this.name="geocent"},forward:function(g){return L(g,this.es,this.a)},inverse:function(g){return qr(g,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};return nn.defaultDatum="WGS84",nn.Proj=qt,nn.WGS84=new nn.Proj("WGS84"),nn.Point=fs,nn.toPoint=br,nn.defs=Ve,nn.transform=Cn,nn.mgrs=Qs,nn.version="2.6.2",function(g){g.Proj.projections.add(ll),g.Proj.projections.add(Ns),g.Proj.projections.add(Ta),g.Proj.projections.add(ul),g.Proj.projections.add(to),g.Proj.projections.add(hc),g.Proj.projections.add(dc),g.Proj.projections.add(tr),g.Proj.projections.add(ir),g.Proj.projections.add(fc),g.Proj.projections.add(wc),g.Proj.projections.add(Aa),g.Proj.projections.add(hl),g.Proj.projections.add(dl),g.Proj.projections.add(fl),g.Proj.projections.add(bc),g.Proj.projections.add(io),g.Proj.projections.add(Tr),g.Proj.projections.add(or),g.Proj.projections.add(Os),g.Proj.projections.add(no),g.Proj.projections.add(Da),g.Proj.projections.add(pl),g.Proj.projections.add(p),g.Proj.projections.add(D),g.Proj.projections.add($e),g.Proj.projections.add(Pt)}(nn),nn});/*!
 * jQuery JavaScript Library v3.1.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2016-09-22T22:30Z
 */(function(z,Ne){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=z.document?Ne(z,!0):function(Ve){if(!Ve.document)throw new Error("jQuery requires a window with a document");return Ne(Ve)}:Ne(z)})(typeof window<"u"?window:this,function(z,Ne){"use strict";var Ve=[],st=z.document,Et=Object.getPrototypeOf,pi=Ve.slice,Ni=Ve.concat,An=Ve.push,fn=Ve.indexOf,As={},Cs=As.toString,Nn=As.hasOwnProperty,$r=Nn.toString,Ds=$r.call(Object),Kt={};function qt(p,w){w=w||st;var T=w.createElement("script");T.text=p,w.head.appendChild(T).parentNode.removeChild(T)}var Xi="3.1.1",L=function(p,w){return new L.fn.init(p,w)},qr=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,cn=/^-ms-/,Ps=/-([a-z])/g,Ht=function(p,w){return w.toUpperCase()};L.fn=L.prototype={jquery:Xi,constructor:L,length:0,toArray:function(){return pi.call(this)},get:function(p){return p==null?pi.call(this):p<0?this[p+this.length]:this[p]},pushStack:function(p){var w=L.merge(this.constructor(),p);return w.prevObject=this,w},each:function(p){return L.each(this,p)},map:function(p){return this.pushStack(L.map(this,function(w,T){return p.call(w,T,w)}))},slice:function(){return this.pushStack(pi.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(p){var w=this.length,T=+p+(p<0?w:0);return this.pushStack(T>=0&&T<w?[this[T]]:[])},end:function(){return this.prevObject||this.constructor()},push:An,sort:Ve.sort,splice:Ve.splice},L.extend=L.fn.extend=function(){var p,w,T,D,H,U,q=arguments[0]||{},me=1,_e=arguments.length,Ce=!1;for(typeof q=="boolean"&&(Ce=q,q=arguments[me]||{},me++),typeof q!="object"&&!L.isFunction(q)&&(q={}),me===_e&&(q=this,me--);me<_e;me++)if((p=arguments[me])!=null)for(w in p)T=q[w],D=p[w],q!==D&&(Ce&&D&&(L.isPlainObject(D)||(H=L.isArray(D)))?(H?(H=!1,U=T&&L.isArray(T)?T:[]):U=T&&L.isPlainObject(T)?T:{},q[w]=L.extend(Ce,U,D)):D!==void 0&&(q[w]=D));return q},L.extend({expando:"jQuery"+(Xi+Math.random()).replace(/\D/g,""),isReady:!0,error:function(p){throw new Error(p)},noop:function(){},isFunction:function(p){return L.type(p)==="function"},isArray:Array.isArray,isWindow:function(p){return p!=null&&p===p.window},isNumeric:function(p){var w=L.type(p);return(w==="number"||w==="string")&&!isNaN(p-parseFloat(p))},isPlainObject:function(p){var w,T;return!p||Cs.call(p)!=="[object Object]"?!1:(w=Et(p),w?(T=Nn.call(w,"constructor")&&w.constructor,typeof T=="function"&&$r.call(T)===Ds):!0)},isEmptyObject:function(p){var w;for(w in p)return!1;return!0},type:function(p){return p==null?p+"":typeof p=="object"||typeof p=="function"?As[Cs.call(p)]||"object":typeof p},globalEval:function(p){qt(p)},camelCase:function(p){return p.replace(cn,"ms-").replace(Ps,Ht)},nodeName:function(p,w){return p.nodeName&&p.nodeName.toLowerCase()===w.toLowerCase()},each:function(p,w){var T,D=0;if(Vt(p))for(T=p.length;D<T&&w.call(p[D],D,p[D])!==!1;D++);else for(D in p)if(w.call(p[D],D,p[D])===!1)break;return p},trim:function(p){return p==null?"":(p+"").replace(qr,"")},makeArray:function(p,w){var T=w||[];return p!=null&&(Vt(Object(p))?L.merge(T,typeof p=="string"?[p]:p):An.call(T,p)),T},inArray:function(p,w,T){return w==null?-1:fn.call(w,p,T)},merge:function(p,w){for(var T=+w.length,D=0,H=p.length;D<T;D++)p[H++]=w[D];return p.length=H,p},grep:function(p,w,T){for(var D,H=[],U=0,q=p.length,me=!T;U<q;U++)D=!w(p[U],U),D!==me&&H.push(p[U]);return H},map:function(p,w,T){var D,H,U=0,q=[];if(Vt(p))for(D=p.length;U<D;U++)H=w(p[U],U,T),H!=null&&q.push(H);else for(U in p)H=w(p[U],U,T),H!=null&&q.push(H);return Ni.apply([],q)},guid:1,proxy:function(p,w){var T,D,H;if(typeof w=="string"&&(T=p[w],w=p,p=T),!!L.isFunction(p))return D=pi.call(arguments,2),H=function(){return p.apply(w||this,D.concat(pi.call(arguments)))},H.guid=p.guid=p.guid||L.guid++,H},now:Date.now,support:Kt}),typeof Symbol=="function"&&(L.fn[Symbol.iterator]=Ve[Symbol.iterator]),L.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(p,w){As["[object "+w+"]"]=w.toLowerCase()});function Vt(p){var w=!!p&&"length"in p&&p.length,T=L.type(p);return T==="function"||L.isWindow(p)?!1:T==="array"||w===0||typeof w=="number"&&w>0&&w-1 in p}var pn=function(p){var w,T,D,H,U,q,me,_e,Ce,ze,Ke,Re,$e,Pt,g,b,C,G,k,Z="sizzle"+1*new Date,j=p.document,ee=0,re=0,ue=Wt(),Pe=Wt(),De=Wt(),Ge=function(te,de){return te===de&&(Ke=!0),0},ht={}.hasOwnProperty,Xe=[],dt=Xe.pop,Ft=Xe.push,yt=Xe.push,wi=Xe.slice,Gt=function(te,de){for(var be=0,Oe=te.length;be<Oe;be++)if(te[be]===de)return be;return-1},Ui="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",zt="[\\x20\\t\\r\\n\\f]",Mi="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ks="\\["+zt+"*("+Mi+")(?:"+zt+"*([*^$|!~]?=)"+zt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Mi+"))|)"+zt+"*\\]",ys=":("+Mi+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+ks+")*)|.*)\\)|)",ar=new RegExp(zt+"+","g"),is=new RegExp("^"+zt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+zt+"+$","g"),Rn=new RegExp("^"+zt+"*,"+zt+"*"),di=new RegExp("^"+zt+"*([>+~]|"+zt+")"+zt+"*"),ml=new RegExp("="+zt+`*([^\\]'"]*?)`+zt+"*\\]","g"),rt=new RegExp(ys),Se=new RegExp("^"+Mi+"$"),rn={ID:new RegExp("^#("+Mi+")"),CLASS:new RegExp("^\\.("+Mi+")"),TAG:new RegExp("^("+Mi+"|[*])"),ATTR:new RegExp("^"+ks),PSEUDO:new RegExp("^"+ys),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+zt+"*(even|odd|(([+-]|)(\\d*)n|)"+zt+"*(?:([+-]|)"+zt+"*(\\d+)|))"+zt+"*\\)|)","i"),bool:new RegExp("^(?:"+Ui+")$","i"),needsContext:new RegExp("^"+zt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+zt+"*((?:-\\d)?\\d*)"+zt+"*\\)|)(?=[^-]|$)","i")},Uo=/^(?:input|select|textarea|button)$/i,Go=/^h\d$/i,Pa=/^[^{]+\{\s*\[native \w/,oi=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,La=/[+~]/,_t=new RegExp("\\\\([\\da-f]{1,6}"+zt+"?|("+zt+")|.)","ig"),bi=function(te,de,be){var Oe="0x"+de-65536;return Oe!==Oe||be?de:Oe<0?String.fromCharCode(Oe+65536):String.fromCharCode(Oe>>10|55296,Oe&1023|56320)},_c=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Ei=function(te,de){return de?te==="\0"?"\uFFFD":te.slice(0,-1)+"\\"+te.charCodeAt(te.length-1).toString(16)+" ":"\\"+te},S=function(){Re()},Mc=oo(function(te){return te.disabled===!0&&("form"in te||"label"in te)},{dir:"parentNode",next:"legend"});try{yt.apply(Xe=wi.call(j.childNodes),j.childNodes),Xe[j.childNodes.length].nodeType}catch{yt={apply:Xe.length?function(de,be){Ft.apply(de,wi.call(be))}:function(de,be){for(var Oe=de.length,Te=0;de[Oe++]=be[Te++];);de.length=Oe-1}}}function _i(te,de,be,Oe){var Te,We,xe,ct,ut,It,Ct,Tt=de&&de.ownerDocument,Xt=de?de.nodeType:9;if(be=be||[],typeof te!="string"||!te||Xt!==1&&Xt!==9&&Xt!==11)return be;if(!Oe&&((de?de.ownerDocument||de:j)!==$e&&Re(de),de=de||$e,g)){if(Xt!==11&&(ut=oi.exec(te)))if(Te=ut[1]){if(Xt===9)if(xe=de.getElementById(Te)){if(xe.id===Te)return be.push(xe),be}else return be;else if(Tt&&(xe=Tt.getElementById(Te))&&k(de,xe)&&xe.id===Te)return be.push(xe),be}else{if(ut[2])return yt.apply(be,de.getElementsByTagName(te)),be;if((Te=ut[3])&&T.getElementsByClassName&&de.getElementsByClassName)return yt.apply(be,de.getElementsByClassName(Te)),be}if(T.qsa&&!De[te+" "]&&(!b||!b.test(te))){if(Xt!==1)Tt=de,Ct=te;else if(de.nodeName.toLowerCase()!=="object"){for((ct=de.getAttribute("id"))?ct=ct.replace(_c,Ei):de.setAttribute("id",ct=Z),It=q(te),We=It.length;We--;)It[We]="#"+ct+" "+Cr(It[We]);Ct=It.join(","),Tt=La.test(te)&&zs(de.parentNode)||de}if(Ct)try{return yt.apply(be,Tt.querySelectorAll(Ct)),be}catch{}finally{ct===Z&&de.removeAttribute("id")}}}return _e(te.replace(is,"$1"),de,be,Oe)}function Wt(){var te=[];function de(be,Oe){return te.push(be+" ")>D.cacheLength&&delete de[te.shift()],de[be+" "]=Oe}return de}function qn(te){return te[Z]=!0,te}function on(te){var de=$e.createElement("fieldset");try{return!!te(de)}catch{return!1}finally{de.parentNode&&de.parentNode.removeChild(de),de=null}}function so(te,de){for(var be=te.split("|"),Oe=be.length;Oe--;)D.attrHandle[be[Oe]]=de}function gl(te,de){var be=de&&te,Oe=be&&te.nodeType===1&&de.nodeType===1&&te.sourceIndex-de.sourceIndex;if(Oe)return Oe;if(be){for(;be=be.nextSibling;)if(be===de)return-1}return te?1:-1}function Ho(te){return function(de){var be=de.nodeName.toLowerCase();return be==="input"&&de.type===te}}function Vo(te){return function(de){var be=de.nodeName.toLowerCase();return(be==="input"||be==="button")&&de.type===te}}function ro(te){return function(de){return"form"in de?de.parentNode&&de.disabled===!1?"label"in de?"label"in de.parentNode?de.parentNode.disabled===te:de.disabled===te:de.isDisabled===te||de.isDisabled!==!te&&Mc(de)===te:de.disabled===te:"label"in de?de.disabled===te:!1}}function zn(te){return qn(function(de){return de=+de,qn(function(be,Oe){for(var Te,We=te([],be.length,de),xe=We.length;xe--;)be[Te=We[xe]]&&(be[Te]=!(Oe[Te]=be[Te]))})})}function zs(te){return te&&typeof te.getElementsByTagName<"u"&&te}T=_i.support={},U=_i.isXML=function(te){var de=te&&(te.ownerDocument||te).documentElement;return de?de.nodeName!=="HTML":!1},Re=_i.setDocument=function(te){var de,be,Oe=te?te.ownerDocument||te:j;return Oe===$e||Oe.nodeType!==9||!Oe.documentElement||($e=Oe,Pt=$e.documentElement,g=!U($e),j!==$e&&(be=$e.defaultView)&&be.top!==be&&(be.addEventListener?be.addEventListener("unload",S,!1):be.attachEvent&&be.attachEvent("onunload",S)),T.attributes=on(function(Te){return Te.className="i",!Te.getAttribute("className")}),T.getElementsByTagName=on(function(Te){return Te.appendChild($e.createComment("")),!Te.getElementsByTagName("*").length}),T.getElementsByClassName=Pa.test($e.getElementsByClassName),T.getById=on(function(Te){return Pt.appendChild(Te).id=Z,!$e.getElementsByName||!$e.getElementsByName(Z).length}),T.getById?(D.filter.ID=function(Te){var We=Te.replace(_t,bi);return function(xe){return xe.getAttribute("id")===We}},D.find.ID=function(Te,We){if(typeof We.getElementById<"u"&&g){var xe=We.getElementById(Te);return xe?[xe]:[]}}):(D.filter.ID=function(Te){var We=Te.replace(_t,bi);return function(xe){var ct=typeof xe.getAttributeNode<"u"&&xe.getAttributeNode("id");return ct&&ct.value===We}},D.find.ID=function(Te,We){if(typeof We.getElementById<"u"&&g){var xe,ct,ut,It=We.getElementById(Te);if(It){if(xe=It.getAttributeNode("id"),xe&&xe.value===Te)return[It];for(ut=We.getElementsByName(Te),ct=0;It=ut[ct++];)if(xe=It.getAttributeNode("id"),xe&&xe.value===Te)return[It]}return[]}}),D.find.TAG=T.getElementsByTagName?function(Te,We){if(typeof We.getElementsByTagName<"u")return We.getElementsByTagName(Te);if(T.qsa)return We.querySelectorAll(Te)}:function(Te,We){var xe,ct=[],ut=0,It=We.getElementsByTagName(Te);if(Te==="*"){for(;xe=It[ut++];)xe.nodeType===1&&ct.push(xe);return ct}return It},D.find.CLASS=T.getElementsByClassName&&function(Te,We){if(typeof We.getElementsByClassName<"u"&&g)return We.getElementsByClassName(Te)},C=[],b=[],(T.qsa=Pa.test($e.querySelectorAll))&&(on(function(Te){Pt.appendChild(Te).innerHTML="<a id='"+Z+"'></a><select id='"+Z+"-\r\\' msallowcapture=''><option selected=''></option></select>",Te.querySelectorAll("[msallowcapture^='']").length&&b.push("[*^$]="+zt+`*(?:''|"")`),Te.querySelectorAll("[selected]").length||b.push("\\["+zt+"*(?:value|"+Ui+")"),Te.querySelectorAll("[id~="+Z+"-]").length||b.push("~="),Te.querySelectorAll(":checked").length||b.push(":checked"),Te.querySelectorAll("a#"+Z+"+*").length||b.push(".#.+[+~]")}),on(function(Te){Te.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var We=$e.createElement("input");We.setAttribute("type","hidden"),Te.appendChild(We).setAttribute("name","D"),Te.querySelectorAll("[name=d]").length&&b.push("name"+zt+"*[*^$|!~]?="),Te.querySelectorAll(":enabled").length!==2&&b.push(":enabled",":disabled"),Pt.appendChild(Te).disabled=!0,Te.querySelectorAll(":disabled").length!==2&&b.push(":enabled",":disabled"),Te.querySelectorAll("*,:x"),b.push(",.*:")})),(T.matchesSelector=Pa.test(G=Pt.matches||Pt.webkitMatchesSelector||Pt.mozMatchesSelector||Pt.oMatchesSelector||Pt.msMatchesSelector))&&on(function(Te){T.disconnectedMatch=G.call(Te,"*"),G.call(Te,"[s!='']:x"),C.push("!=",ys)}),b=b.length&&new RegExp(b.join("|")),C=C.length&&new RegExp(C.join("|")),de=Pa.test(Pt.compareDocumentPosition),k=de||Pa.test(Pt.contains)?function(Te,We){var xe=Te.nodeType===9?Te.documentElement:Te,ct=We&&We.parentNode;return Te===ct||!!(ct&&ct.nodeType===1&&(xe.contains?xe.contains(ct):Te.compareDocumentPosition&&Te.compareDocumentPosition(ct)&16))}:function(Te,We){if(We){for(;We=We.parentNode;)if(We===Te)return!0}return!1},Ge=de?function(Te,We){if(Te===We)return Ke=!0,0;var xe=!Te.compareDocumentPosition-!We.compareDocumentPosition;return xe||(xe=(Te.ownerDocument||Te)===(We.ownerDocument||We)?Te.compareDocumentPosition(We):1,xe&1||!T.sortDetached&&We.compareDocumentPosition(Te)===xe?Te===$e||Te.ownerDocument===j&&k(j,Te)?-1:We===$e||We.ownerDocument===j&&k(j,We)?1:ze?Gt(ze,Te)-Gt(ze,We):0:xe&4?-1:1)}:function(Te,We){if(Te===We)return Ke=!0,0;var xe,ct=0,ut=Te.parentNode,It=We.parentNode,Ct=[Te],Tt=[We];if(!ut||!It)return Te===$e?-1:We===$e?1:ut?-1:It?1:ze?Gt(ze,Te)-Gt(ze,We):0;if(ut===It)return gl(Te,We);for(xe=Te;xe=xe.parentNode;)Ct.unshift(xe);for(xe=We;xe=xe.parentNode;)Tt.unshift(xe);for(;Ct[ct]===Tt[ct];)ct++;return ct?gl(Ct[ct],Tt[ct]):Ct[ct]===j?-1:Tt[ct]===j?1:0}),$e},_i.matches=function(te,de){return _i(te,null,null,de)},_i.matchesSelector=function(te,de){if((te.ownerDocument||te)!==$e&&Re(te),de=de.replace(ml,"='$1']"),T.matchesSelector&&g&&!De[de+" "]&&(!C||!C.test(de))&&(!b||!b.test(de)))try{var be=G.call(te,de);if(be||T.disconnectedMatch||te.document&&te.document.nodeType!==11)return be}catch{}return _i(de,$e,null,[te]).length>0},_i.contains=function(te,de){return(te.ownerDocument||te)!==$e&&Re(te),k(te,de)},_i.attr=function(te,de){(te.ownerDocument||te)!==$e&&Re(te);var be=D.attrHandle[de.toLowerCase()],Oe=be&&ht.call(D.attrHandle,de.toLowerCase())?be(te,de,!g):void 0;return Oe!==void 0?Oe:T.attributes||!g?te.getAttribute(de):(Oe=te.getAttributeNode(de))&&Oe.specified?Oe.value:null},_i.escape=function(te){return(te+"").replace(_c,Ei)},_i.error=function(te){throw new Error("Syntax error, unrecognized expression: "+te)},_i.uniqueSort=function(te){var de,be=[],Oe=0,Te=0;if(Ke=!T.detectDuplicates,ze=!T.sortStable&&te.slice(0),te.sort(Ge),Ke){for(;de=te[Te++];)de===te[Te]&&(Oe=be.push(Te));for(;Oe--;)te.splice(be[Oe],1)}return ze=null,te},H=_i.getText=function(te){var de,be="",Oe=0,Te=te.nodeType;if(Te){if(Te===1||Te===9||Te===11){if(typeof te.textContent=="string")return te.textContent;for(te=te.firstChild;te;te=te.nextSibling)be+=H(te)}else if(Te===3||Te===4)return te.nodeValue}else for(;de=te[Oe++];)be+=H(de);return be},D=_i.selectors={cacheLength:50,createPseudo:qn,match:rn,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(te){return te[1]=te[1].replace(_t,bi),te[3]=(te[3]||te[4]||te[5]||"").replace(_t,bi),te[2]==="~="&&(te[3]=" "+te[3]+" "),te.slice(0,4)},CHILD:function(te){return te[1]=te[1].toLowerCase(),te[1].slice(0,3)==="nth"?(te[3]||_i.error(te[0]),te[4]=+(te[4]?te[5]+(te[6]||1):2*(te[3]==="even"||te[3]==="odd")),te[5]=+(te[7]+te[8]||te[3]==="odd")):te[3]&&_i.error(te[0]),te},PSEUDO:function(te){var de,be=!te[6]&&te[2];return rn.CHILD.test(te[0])?null:(te[3]?te[2]=te[4]||te[5]||"":be&&rt.test(be)&&(de=q(be,!0))&&(de=be.indexOf(")",be.length-de)-be.length)&&(te[0]=te[0].slice(0,de),te[2]=be.slice(0,de)),te.slice(0,3))}},filter:{TAG:function(te){var de=te.replace(_t,bi).toLowerCase();return te==="*"?function(){return!0}:function(be){return be.nodeName&&be.nodeName.toLowerCase()===de}},CLASS:function(te){var de=ue[te+" "];return de||(de=new RegExp("(^|"+zt+")"+te+"("+zt+"|$)"))&&ue(te,function(be){return de.test(typeof be.className=="string"&&be.className||typeof be.getAttribute<"u"&&be.getAttribute("class")||"")})},ATTR:function(te,de,be){return function(Oe){var Te=_i.attr(Oe,te);return Te==null?de==="!=":de?(Te+="",de==="="?Te===be:de==="!="?Te!==be:de==="^="?be&&Te.indexOf(be)===0:de==="*="?be&&Te.indexOf(be)>-1:de==="$="?be&&Te.slice(-be.length)===be:de==="~="?(" "+Te.replace(ar," ")+" ").indexOf(be)>-1:de==="|="?Te===be||Te.slice(0,be.length+1)===be+"-":!1):!0}},CHILD:function(te,de,be,Oe,Te){var We=te.slice(0,3)!=="nth",xe=te.slice(-4)!=="last",ct=de==="of-type";return Oe===1&&Te===0?function(ut){return!!ut.parentNode}:function(ut,It,Ct){var Tt,Xt,Zt,Mt,Wi,hn,Un=We!==xe?"nextSibling":"previousSibling",Ai=ut.parentNode,Wo=ct&&ut.nodeName.toLowerCase(),Us=!Ct&&!ct,Gi=!1;if(Ai){if(We){for(;Un;){for(Mt=ut;Mt=Mt[Un];)if(ct?Mt.nodeName.toLowerCase()===Wo:Mt.nodeType===1)return!1;hn=Un=te==="only"&&!hn&&"nextSibling"}return!0}if(hn=[xe?Ai.firstChild:Ai.lastChild],xe&&Us){for(Mt=Ai,Zt=Mt[Z]||(Mt[Z]={}),Xt=Zt[Mt.uniqueID]||(Zt[Mt.uniqueID]={}),Tt=Xt[te]||[],Wi=Tt[0]===ee&&Tt[1],Gi=Wi&&Tt[2],Mt=Wi&&Ai.childNodes[Wi];Mt=++Wi&&Mt&&Mt[Un]||(Gi=Wi=0)||hn.pop();)if(Mt.nodeType===1&&++Gi&&Mt===ut){Xt[te]=[ee,Wi,Gi];break}}else if(Us&&(Mt=ut,Zt=Mt[Z]||(Mt[Z]={}),Xt=Zt[Mt.uniqueID]||(Zt[Mt.uniqueID]={}),Tt=Xt[te]||[],Wi=Tt[0]===ee&&Tt[1],Gi=Wi),Gi===!1)for(;(Mt=++Wi&&Mt&&Mt[Un]||(Gi=Wi=0)||hn.pop())&&!((ct?Mt.nodeName.toLowerCase()===Wo:Mt.nodeType===1)&&++Gi&&(Us&&(Zt=Mt[Z]||(Mt[Z]={}),Xt=Zt[Mt.uniqueID]||(Zt[Mt.uniqueID]={}),Xt[te]=[ee,Gi]),Mt===ut)););return Gi-=Te,Gi===Oe||Gi%Oe===0&&Gi/Oe>=0}}},PSEUDO:function(te,de){var be,Oe=D.pseudos[te]||D.setFilters[te.toLowerCase()]||_i.error("unsupported pseudo: "+te);return Oe[Z]?Oe(de):Oe.length>1?(be=[te,te,"",de],D.setFilters.hasOwnProperty(te.toLowerCase())?qn(function(Te,We){for(var xe,ct=Oe(Te,de),ut=ct.length;ut--;)xe=Gt(Te,ct[ut]),Te[xe]=!(We[xe]=ct[ut])}):function(Te){return Oe(Te,0,be)}):Oe}},pseudos:{not:qn(function(te){var de=[],be=[],Oe=me(te.replace(is,"$1"));return Oe[Z]?qn(function(Te,We,xe,ct){for(var ut,It=Oe(Te,null,ct,[]),Ct=Te.length;Ct--;)(ut=It[Ct])&&(Te[Ct]=!(We[Ct]=ut))}):function(Te,We,xe){return de[0]=Te,Oe(de,null,xe,be),de[0]=null,!be.pop()}}),has:qn(function(te){return function(de){return _i(te,de).length>0}}),contains:qn(function(te){return te=te.replace(_t,bi),function(de){return(de.textContent||de.innerText||H(de)).indexOf(te)>-1}}),lang:qn(function(te){return Se.test(te||"")||_i.error("unsupported lang: "+te),te=te.replace(_t,bi).toLowerCase(),function(de){var be;do if(be=g?de.lang:de.getAttribute("xml:lang")||de.getAttribute("lang"))return be=be.toLowerCase(),be===te||be.indexOf(te+"-")===0;while((de=de.parentNode)&&de.nodeType===1);return!1}}),target:function(te){var de=p.location&&p.location.hash;return de&&de.slice(1)===te.id},root:function(te){return te===Pt},focus:function(te){return te===$e.activeElement&&(!$e.hasFocus||$e.hasFocus())&&!!(te.type||te.href||~te.tabIndex)},enabled:ro(!1),disabled:ro(!0),checked:function(te){var de=te.nodeName.toLowerCase();return de==="input"&&!!te.checked||de==="option"&&!!te.selected},selected:function(te){return te.parentNode&&te.parentNode.selectedIndex,te.selected===!0},empty:function(te){for(te=te.firstChild;te;te=te.nextSibling)if(te.nodeType<6)return!1;return!0},parent:function(te){return!D.pseudos.empty(te)},header:function(te){return Go.test(te.nodeName)},input:function(te){return Uo.test(te.nodeName)},button:function(te){var de=te.nodeName.toLowerCase();return de==="input"&&te.type==="button"||de==="button"},text:function(te){var de;return te.nodeName.toLowerCase()==="input"&&te.type==="text"&&((de=te.getAttribute("type"))==null||de.toLowerCase()==="text")},first:zn(function(){return[0]}),last:zn(function(te,de){return[de-1]}),eq:zn(function(te,de,be){return[be<0?be+de:be]}),even:zn(function(te,de){for(var be=0;be<de;be+=2)te.push(be);return te}),odd:zn(function(te,de){for(var be=1;be<de;be+=2)te.push(be);return te}),lt:zn(function(te,de,be){for(var Oe=be<0?be+de:be;--Oe>=0;)te.push(Oe);return te}),gt:zn(function(te,de,be){for(var Oe=be<0?be+de:be;++Oe<de;)te.push(Oe);return te})}},D.pseudos.nth=D.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})D.pseudos[w]=Ho(w);for(w in{submit:!0,reset:!0})D.pseudos[w]=Vo(w);function Ar(){}Ar.prototype=D.filters=D.pseudos,D.setFilters=new Ar,q=_i.tokenize=function(te,de){var be,Oe,Te,We,xe,ct,ut,It=Pe[te+" "];if(It)return de?0:It.slice(0);for(xe=te,ct=[],ut=D.preFilter;xe;){(!be||(Oe=Rn.exec(xe)))&&(Oe&&(xe=xe.slice(Oe[0].length)||xe),ct.push(Te=[])),be=!1,(Oe=di.exec(xe))&&(be=Oe.shift(),Te.push({value:be,type:Oe[0].replace(is," ")}),xe=xe.slice(be.length));for(We in D.filter)(Oe=rn[We].exec(xe))&&(!ut[We]||(Oe=ut[We](Oe)))&&(be=Oe.shift(),Te.push({value:be,type:We,matches:Oe}),xe=xe.slice(be.length));if(!be)break}return de?xe.length:xe?_i.error(te):Pe(te,ct).slice(0)};function Cr(te){for(var de=0,be=te.length,Oe="";de<be;de++)Oe+=te[de].value;return Oe}function oo(te,de,be){var Oe=de.dir,Te=de.next,We=Te||Oe,xe=be&&We==="parentNode",ct=re++;return de.first?function(ut,It,Ct){for(;ut=ut[Oe];)if(ut.nodeType===1||xe)return te(ut,It,Ct);return!1}:function(ut,It,Ct){var Tt,Xt,Zt,Mt=[ee,ct];if(Ct){for(;ut=ut[Oe];)if((ut.nodeType===1||xe)&&te(ut,It,Ct))return!0}else for(;ut=ut[Oe];)if(ut.nodeType===1||xe)if(Zt=ut[Z]||(ut[Z]={}),Xt=Zt[ut.uniqueID]||(Zt[ut.uniqueID]={}),Te&&Te===ut.nodeName.toLowerCase())ut=ut[Oe]||ut;else{if((Tt=Xt[We])&&Tt[0]===ee&&Tt[1]===ct)return Mt[2]=Tt[2];if(Xt[We]=Mt,Mt[2]=te(ut,It,Ct))return!0}return!1}}function jo(te){return te.length>1?function(de,be,Oe){for(var Te=te.length;Te--;)if(!te[Te](de,be,Oe))return!1;return!0}:te[0]}function ao(te,de,be){for(var Oe=0,Te=de.length;Oe<Te;Oe++)_i(te,de[Oe],be);return be}function vl(te,de,be,Oe,Te){for(var We,xe=[],ct=0,ut=te.length,It=de!=null;ct<ut;ct++)(We=te[ct])&&(!be||be(We,Oe,Te))&&(xe.push(We),It&&de.push(ct));return xe}function fi(te,de,be,Oe,Te,We){return Oe&&!Oe[Z]&&(Oe=fi(Oe)),Te&&!Te[Z]&&(Te=fi(Te,We)),qn(function(xe,ct,ut,It){var Ct,Tt,Xt,Zt=[],Mt=[],Wi=ct.length,hn=xe||ao(de||"*",ut.nodeType?[ut]:ut,[]),Un=te&&(xe||!de)?vl(hn,Zt,te,ut,It):hn,Ai=be?Te||(xe?te:Wi||Oe)?[]:ct:Un;if(be&&be(Un,Ai,ut,It),Oe)for(Ct=vl(Ai,Mt),Oe(Ct,[],ut,It),Tt=Ct.length;Tt--;)(Xt=Ct[Tt])&&(Ai[Mt[Tt]]=!(Un[Mt[Tt]]=Xt));if(xe){if(Te||te){if(Te){for(Ct=[],Tt=Ai.length;Tt--;)(Xt=Ai[Tt])&&Ct.push(Un[Tt]=Xt);Te(null,Ai=[],Ct,It)}for(Tt=Ai.length;Tt--;)(Xt=Ai[Tt])&&(Ct=Te?Gt(xe,Xt):Zt[Tt])>-1&&(xe[Ct]=!(ct[Ct]=Xt))}}else Ai=vl(Ai===ct?Ai.splice(Wi,Ai.length):Ai),Te?Te(null,ct,Ai,It):yt.apply(ct,Ai)})}function xs(te){for(var de,be,Oe,Te=te.length,We=D.relative[te[0].type],xe=We||D.relative[" "],ct=We?1:0,ut=oo(function(Tt){return Tt===de},xe,!0),It=oo(function(Tt){return Gt(de,Tt)>-1},xe,!0),Ct=[function(Tt,Xt,Zt){var Mt=!We&&(Zt||Xt!==Ce)||((de=Xt).nodeType?ut(Tt,Xt,Zt):It(Tt,Xt,Zt));return de=null,Mt}];ct<Te;ct++)if(be=D.relative[te[ct].type])Ct=[oo(jo(Ct),be)];else{if(be=D.filter[te[ct].type].apply(null,te[ct].matches),be[Z]){for(Oe=++ct;Oe<Te&&!D.relative[te[Oe].type];Oe++);return fi(ct>1&&jo(Ct),ct>1&&Cr(te.slice(0,ct-1).concat({value:te[ct-2].type===" "?"*":""})).replace(is,"$1"),be,ct<Oe&&xs(te.slice(ct,Oe)),Oe<Te&&xs(te=te.slice(Oe)),Oe<Te&&Cr(te))}Ct.push(be)}return jo(Ct)}function Ec(te,de){var be=de.length>0,Oe=te.length>0,Te=function(We,xe,ct,ut,It){var Ct,Tt,Xt,Zt=0,Mt="0",Wi=We&&[],hn=[],Un=Ce,Ai=We||Oe&&D.find.TAG("*",It),Wo=ee+=Un==null?1:Math.random()||.1,Us=Ai.length;for(It&&(Ce=xe===$e||xe||It);Mt!==Us&&(Ct=Ai[Mt])!=null;Mt++){if(Oe&&Ct){for(Tt=0,!xe&&Ct.ownerDocument!==$e&&(Re(Ct),ct=!g);Xt=te[Tt++];)if(Xt(Ct,xe||$e,ct)){ut.push(Ct);break}It&&(ee=Wo)}be&&((Ct=!Xt&&Ct)&&Zt--,We&&Wi.push(Ct))}if(Zt+=Mt,be&&Mt!==Zt){for(Tt=0;Xt=de[Tt++];)Xt(Wi,hn,xe,ct);if(We){if(Zt>0)for(;Mt--;)Wi[Mt]||hn[Mt]||(hn[Mt]=dt.call(ut));hn=vl(hn)}yt.apply(ut,hn),It&&!We&&hn.length>0&&Zt+de.length>1&&_i.uniqueSort(ut)}return It&&(ee=Wo,Ce=Un),Wi};return be?qn(Te):Te}return me=_i.compile=function(te,de){var be,Oe=[],Te=[],We=De[te+" "];if(!We){for(de||(de=q(te)),be=de.length;be--;)We=xs(de[be]),We[Z]?Oe.push(We):Te.push(We);We=De(te,Ec(Te,Oe)),We.selector=te}return We},_e=_i.select=function(te,de,be,Oe){var Te,We,xe,ct,ut,It=typeof te=="function"&&te,Ct=!Oe&&q(te=It.selector||te);if(be=be||[],Ct.length===1){if(We=Ct[0]=Ct[0].slice(0),We.length>2&&(xe=We[0]).type==="ID"&&de.nodeType===9&&g&&D.relative[We[1].type]){if(de=(D.find.ID(xe.matches[0].replace(_t,bi),de)||[])[0],de)It&&(de=de.parentNode);else return be;te=te.slice(We.shift().value.length)}for(Te=rn.needsContext.test(te)?0:We.length;Te--&&(xe=We[Te],!D.relative[ct=xe.type]);)if((ut=D.find[ct])&&(Oe=ut(xe.matches[0].replace(_t,bi),La.test(We[0].type)&&zs(de.parentNode)||de))){if(We.splice(Te,1),te=Oe.length&&Cr(We),!te)return yt.apply(be,Oe),be;break}}return(It||me(te,Ct))(Oe,de,!g,be,!de||La.test(te)&&zs(de.parentNode)||de),be},T.sortStable=Z.split("").sort(Ge).join("")===Z,T.detectDuplicates=!!Ke,Re(),T.sortDetached=on(function(te){return te.compareDocumentPosition($e.createElement("fieldset"))&1}),on(function(te){return te.innerHTML="<a href='#'></a>",te.firstChild.getAttribute("href")==="#"})||so("type|href|height|width",function(te,de,be){if(!be)return te.getAttribute(de,de.toLowerCase()==="type"?1:2)}),(!T.attributes||!on(function(te){return te.innerHTML="<input/>",te.firstChild.setAttribute("value",""),te.firstChild.getAttribute("value")===""}))&&so("value",function(te,de,be){if(!be&&te.nodeName.toLowerCase()==="input")return te.defaultValue}),on(function(te){return te.getAttribute("disabled")==null})||so(Ui,function(te,de,be){var Oe;if(!be)return te[de]===!0?de.toLowerCase():(Oe=te.getAttributeNode(de))&&Oe.specified?Oe.value:null}),_i}(z);L.find=pn,L.expr=pn.selectors,L.expr[":"]=L.expr.pseudos,L.uniqueSort=L.unique=pn.uniqueSort,L.text=pn.getText,L.isXMLDoc=pn.isXML,L.contains=pn.contains,L.escapeSelector=pn.escape;var Cn=function(p,w,T){for(var D=[],H=T!==void 0;(p=p[w])&&p.nodeType!==9;)if(p.nodeType===1){if(H&&L(p).is(T))break;D.push(p)}return D},mn=function(p,w){for(var T=[];p;p=p.nextSibling)p.nodeType===1&&p!==w&&T.push(p);return T},On=L.expr.match.needsContext,nn=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,hs=/^.[^:#\[\.,]*$/;function ds(p,w,T){return L.isFunction(w)?L.grep(p,function(D,H){return!!w.call(D,H,D)!==T}):w.nodeType?L.grep(p,function(D){return D===w!==T}):typeof w!="string"?L.grep(p,function(D){return fn.call(w,D)>-1!==T}):hs.test(w)?L.filter(w,p,T):(w=L.filter(w,p),L.grep(p,function(D){return fn.call(w,D)>-1!==T&&D.nodeType===1}))}L.filter=function(p,w,T){var D=w[0];return T&&(p=":not("+p+")"),w.length===1&&D.nodeType===1?L.find.matchesSelector(D,p)?[D]:[]:L.find.matches(p,L.grep(w,function(H){return H.nodeType===1}))},L.fn.extend({find:function(p){var w,T,D=this.length,H=this;if(typeof p!="string")return this.pushStack(L(p).filter(function(){for(w=0;w<D;w++)if(L.contains(H[w],this))return!0}));for(T=this.pushStack([]),w=0;w<D;w++)L.find(p,H[w],T);return D>1?L.uniqueSort(T):T},filter:function(p){return this.pushStack(ds(this,p||[],!1))},not:function(p){return this.pushStack(ds(this,p||[],!0))},is:function(p){return!!ds(this,typeof p=="string"&&On.test(p)?L(p):p||[],!1).length}});var Xr,ga=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,sl=L.fn.init=function(p,w,T){var D,H;if(!p)return this;if(T=T||Xr,typeof p=="string")if(p[0]==="<"&&p[p.length-1]===">"&&p.length>=3?D=[null,p,null]:D=ga.exec(p),D&&(D[1]||!w))if(D[1]){if(w=w instanceof L?w[0]:w,L.merge(this,L.parseHTML(D[1],w&&w.nodeType?w.ownerDocument||w:st,!0)),nn.test(D[1])&&L.isPlainObject(w))for(D in w)L.isFunction(this[D])?this[D](w[D]):this.attr(D,w[D]);return this}else return H=st.getElementById(D[2]),H&&(this[0]=H,this.length=1),this;else return!w||w.jquery?(w||T).find(p):this.constructor(w).find(p);else{if(p.nodeType)return this[0]=p,this.length=1,this;if(L.isFunction(p))return T.ready!==void 0?T.ready(p):p(L)}return L.makeArray(p,this)};sl.prototype=L.fn,Xr=L(st);var Do=/^(?:parents|prev(?:Until|All))/,va={children:!0,contents:!0,next:!0,prev:!0};L.fn.extend({has:function(p){var w=L(p,this),T=w.length;return this.filter(function(){for(var D=0;D<T;D++)if(L.contains(this,w[D]))return!0})},closest:function(p,w){var T,D=0,H=this.length,U=[],q=typeof p!="string"&&L(p);if(!On.test(p)){for(;D<H;D++)for(T=this[D];T&&T!==w;T=T.parentNode)if(T.nodeType<11&&(q?q.index(T)>-1:T.nodeType===1&&L.find.matchesSelector(T,p))){U.push(T);break}}return this.pushStack(U.length>1?L.uniqueSort(U):U)},index:function(p){return p?typeof p=="string"?fn.call(L(p),this[0]):fn.call(this,p.jquery?p[0]:p):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(p,w){return this.pushStack(L.uniqueSort(L.merge(this.get(),L(p,w))))},addBack:function(p){return this.add(p==null?this.prevObject:this.prevObject.filter(p))}});function Po(p,w){for(;(p=p[w])&&p.nodeType!==1;);return p}L.each({parent:function(p){var w=p.parentNode;return w&&w.nodeType!==11?w:null},parents:function(p){return Cn(p,"parentNode")},parentsUntil:function(p,w,T){return Cn(p,"parentNode",T)},next:function(p){return Po(p,"nextSibling")},prev:function(p){return Po(p,"previousSibling")},nextAll:function(p){return Cn(p,"nextSibling")},prevAll:function(p){return Cn(p,"previousSibling")},nextUntil:function(p,w,T){return Cn(p,"nextSibling",T)},prevUntil:function(p,w,T){return Cn(p,"previousSibling",T)},siblings:function(p){return mn((p.parentNode||{}).firstChild,p)},children:function(p){return mn(p.firstChild)},contents:function(p){return p.contentDocument||L.merge([],p.childNodes)}},function(p,w){L.fn[p]=function(T,D){var H=L.map(this,w,T);return p.slice(-5)!=="Until"&&(D=T),D&&typeof D=="string"&&(H=L.filter(D,H)),this.length>1&&(va[p]||L.uniqueSort(H),Do.test(p)&&H.reverse()),this.pushStack(H)}});var Dn=/[^\x20\t\r\n\f]+/g;function ya(p){var w={};return L.each(p.match(Dn)||[],function(T,D){w[D]=!0}),w}L.Callbacks=function(p){p=typeof p=="string"?ya(p):L.extend({},p);var w,T,D,H,U=[],q=[],me=-1,_e=function(){for(H=p.once,D=w=!0;q.length;me=-1)for(T=q.shift();++me<U.length;)U[me].apply(T[0],T[1])===!1&&p.stopOnFalse&&(me=U.length,T=!1);p.memory||(T=!1),w=!1,H&&(T?U=[]:U="")},Ce={add:function(){return U&&(T&&!w&&(me=U.length-1,q.push(T)),function ze(Ke){L.each(Ke,function(Re,$e){L.isFunction($e)?(!p.unique||!Ce.has($e))&&U.push($e):$e&&$e.length&&L.type($e)!=="string"&&ze($e)})}(arguments),T&&!w&&_e()),this},remove:function(){return L.each(arguments,function(ze,Ke){for(var Re;(Re=L.inArray(Ke,U,Re))>-1;)U.splice(Re,1),Re<=me&&me--}),this},has:function(ze){return ze?L.inArray(ze,U)>-1:U.length>0},empty:function(){return U&&(U=[]),this},disable:function(){return H=q=[],U=T="",this},disabled:function(){return!U},lock:function(){return H=q=[],!T&&!w&&(U=T=""),this},locked:function(){return!!H},fireWith:function(ze,Ke){return H||(Ke=Ke||[],Ke=[ze,Ke.slice?Ke.slice():Ke],q.push(Ke),w||_e()),this},fire:function(){return Ce.fireWith(this,arguments),this},fired:function(){return!!D}};return Ce};function Xs(p){return p}function vr(p){throw p}function xa(p,w,T){var D;try{p&&L.isFunction(D=p.promise)?D.call(p).done(w).fail(T):p&&L.isFunction(D=p.then)?D.call(p,w,T):w.call(void 0,p)}catch(H){T.call(void 0,H)}}L.extend({Deferred:function(p){var w=[["notify","progress",L.Callbacks("memory"),L.Callbacks("memory"),2],["resolve","done",L.Callbacks("once memory"),L.Callbacks("once memory"),0,"resolved"],["reject","fail",L.Callbacks("once memory"),L.Callbacks("once memory"),1,"rejected"]],T="pending",D={state:function(){return T},always:function(){return H.done(arguments).fail(arguments),this},catch:function(U){return D.then(null,U)},pipe:function(){var U=arguments;return L.Deferred(function(q){L.each(w,function(me,_e){var Ce=L.isFunction(U[_e[4]])&&U[_e[4]];H[_e[1]](function(){var ze=Ce&&Ce.apply(this,arguments);ze&&L.isFunction(ze.promise)?ze.promise().progress(q.notify).done(q.resolve).fail(q.reject):q[_e[0]+"With"](this,Ce?[ze]:arguments)})}),U=null}).promise()},then:function(U,q,me){var _e=0;function Ce(ze,Ke,Re,$e){return function(){var Pt=this,g=arguments,b=function(){var G,k;if(!(ze<_e)){if(G=Re.apply(Pt,g),G===Ke.promise())throw new TypeError("Thenable self-resolution");k=G&&(typeof G=="object"||typeof G=="function")&&G.then,L.isFunction(k)?$e?k.call(G,Ce(_e,Ke,Xs,$e),Ce(_e,Ke,vr,$e)):(_e++,k.call(G,Ce(_e,Ke,Xs,$e),Ce(_e,Ke,vr,$e),Ce(_e,Ke,Xs,Ke.notifyWith))):(Re!==Xs&&(Pt=void 0,g=[G]),($e||Ke.resolveWith)(Pt,g))}},C=$e?b:function(){try{b()}catch(G){L.Deferred.exceptionHook&&L.Deferred.exceptionHook(G,C.stackTrace),ze+1>=_e&&(Re!==vr&&(Pt=void 0,g=[G]),Ke.rejectWith(Pt,g))}};ze?C():(L.Deferred.getStackHook&&(C.stackTrace=L.Deferred.getStackHook()),z.setTimeout(C))}}return L.Deferred(function(ze){w[0][3].add(Ce(0,ze,L.isFunction(me)?me:Xs,ze.notifyWith)),w[1][3].add(Ce(0,ze,L.isFunction(U)?U:Xs)),w[2][3].add(Ce(0,ze,L.isFunction(q)?q:vr))}).promise()},promise:function(U){return U!=null?L.extend(U,D):D}},H={};return L.each(w,function(U,q){var me=q[2],_e=q[5];D[q[1]]=me.add,_e&&me.add(function(){T=_e},w[3-U][2].disable,w[0][2].lock),me.add(q[3].fire),H[q[0]]=function(){return H[q[0]+"With"](this===H?void 0:this,arguments),this},H[q[0]+"With"]=me.fireWith}),D.promise(H),p&&p.call(H,H),H},when:function(p){var w=arguments.length,T=w,D=Array(T),H=pi.call(arguments),U=L.Deferred(),q=function(me){return function(_e){D[me]=this,H[me]=arguments.length>1?pi.call(arguments):_e,--w||U.resolveWith(D,H)}};if(w<=1&&(xa(p,U.done(q(T)).resolve,U.reject),U.state()==="pending"||L.isFunction(H[T]&&H[T].then)))return U.then();for(;T--;)xa(H[T],q(T),U.reject);return U.promise()}});var cc=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;L.Deferred.exceptionHook=function(p,w){z.console&&z.console.warn&&p&&cc.test(p.name)&&z.console.warn("jQuery.Deferred exception: "+p.message,p.stack,w)},L.readyException=function(p){z.setTimeout(function(){throw p})};var Lo=L.Deferred();L.fn.ready=function(p){return Lo.then(p).catch(function(w){L.readyException(w)}),this},L.extend({isReady:!1,readyWait:1,holdReady:function(p){p?L.readyWait++:L.ready(!0)},ready:function(p){(p===!0?--L.readyWait:L.isReady)||(L.isReady=!0,!(p!==!0&&--L.readyWait>0)&&Lo.resolveWith(st,[L]))}}),L.ready.then=Lo.then;function fs(){st.removeEventListener("DOMContentLoaded",fs),z.removeEventListener("load",fs),L.ready()}st.readyState==="complete"||st.readyState!=="loading"&&!st.documentElement.doScroll?z.setTimeout(L.ready):(st.addEventListener("DOMContentLoaded",fs),z.addEventListener("load",fs));var kn=function(p,w,T,D,H,U,q){var me=0,_e=p.length,Ce=T==null;if(L.type(T)==="object"){H=!0;for(me in T)kn(p,w,me,T[me],!0,U,q)}else if(D!==void 0&&(H=!0,L.isFunction(D)||(q=!0),Ce&&(q?(w.call(p,D),w=null):(Ce=w,w=function(ze,Ke,Re){return Ce.call(L(ze),Re)})),w))for(;me<_e;me++)w(p[me],T,q?D:D.call(p[me],me,w(p[me],T)));return H?p:Ce?w.call(p):_e?w(p[0],T):U},Ro=function(p){return p.nodeType===1||p.nodeType===9||!+p.nodeType};function Ls(){this.expando=L.expando+Ls.uid++}Ls.uid=1,Ls.prototype={cache:function(p){var w=p[this.expando];return w||(w={},Ro(p)&&(p.nodeType?p[this.expando]=w:Object.defineProperty(p,this.expando,{value:w,configurable:!0}))),w},set:function(p,w,T){var D,H=this.cache(p);if(typeof w=="string")H[L.camelCase(w)]=T;else for(D in w)H[L.camelCase(D)]=w[D];return H},get:function(p,w){return w===void 0?this.cache(p):p[this.expando]&&p[this.expando][L.camelCase(w)]},access:function(p,w,T){return w===void 0||w&&typeof w=="string"&&T===void 0?this.get(p,w):(this.set(p,w,T),T!==void 0?T:w)},remove:function(p,w){var T,D=p[this.expando];if(D!==void 0){if(w!==void 0)for(L.isArray(w)?w=w.map(L.camelCase):(w=L.camelCase(w),w=w in D?[w]:w.match(Dn)||[]),T=w.length;T--;)delete D[w[T]];(w===void 0||L.isEmptyObject(D))&&(p.nodeType?p[this.expando]=void 0:delete p[this.expando])}},hasData:function(p){var w=p[this.expando];return w!==void 0&&!L.isEmptyObject(w)}};var Bt=new Ls,gn=new Ls,Jn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ys=/[A-Z]/g;function uc(p){return p==="true"?!0:p==="false"?!1:p==="null"?null:p===+p+""?+p:Jn.test(p)?JSON.parse(p):p}function ps(p,w,T){var D;if(T===void 0&&p.nodeType===1)if(D="data-"+w.replace(Ys,"-$&").toLowerCase(),T=p.getAttribute(D),typeof T=="string"){try{T=uc(T)}catch{}gn.set(p,w,T)}else T=void 0;return T}L.extend({hasData:function(p){return gn.hasData(p)||Bt.hasData(p)},data:function(p,w,T){return gn.access(p,w,T)},removeData:function(p,w){gn.remove(p,w)},_data:function(p,w,T){return Bt.access(p,w,T)},_removeData:function(p,w){Bt.remove(p,w)}}),L.fn.extend({data:function(p,w){var T,D,H,U=this[0],q=U&&U.attributes;if(p===void 0){if(this.length&&(H=gn.get(U),U.nodeType===1&&!Bt.get(U,"hasDataAttrs"))){for(T=q.length;T--;)q[T]&&(D=q[T].name,D.indexOf("data-")===0&&(D=L.camelCase(D.slice(5)),ps(U,D,H[D])));Bt.set(U,"hasDataAttrs",!0)}return H}return typeof p=="object"?this.each(function(){gn.set(this,p)}):kn(this,function(me){var _e;if(U&&me===void 0)return _e=gn.get(U,p),_e!==void 0||(_e=ps(U,p),_e!==void 0)?_e:void 0;this.each(function(){gn.set(this,p,me)})},null,w,arguments.length>1,null,!0)},removeData:function(p){return this.each(function(){gn.remove(this,p)})}}),L.extend({queue:function(p,w,T){var D;if(p)return w=(w||"fx")+"queue",D=Bt.get(p,w),T&&(!D||L.isArray(T)?D=Bt.access(p,w,L.makeArray(T)):D.push(T)),D||[]},dequeue:function(p,w){w=w||"fx";var T=L.queue(p,w),D=T.length,H=T.shift(),U=L._queueHooks(p,w),q=function(){L.dequeue(p,w)};H==="inprogress"&&(H=T.shift(),D--),H&&(w==="fx"&&T.unshift("inprogress"),delete U.stop,H.call(p,q,U)),!D&&U&&U.empty.fire()},_queueHooks:function(p,w){var T=w+"queueHooks";return Bt.get(p,T)||Bt.access(p,T,{empty:L.Callbacks("once memory").add(function(){Bt.remove(p,[w+"queue",T])})})}}),L.fn.extend({queue:function(p,w){var T=2;return typeof p!="string"&&(w=p,p="fx",T--),arguments.length<T?L.queue(this[0],p):w===void 0?this:this.each(function(){var D=L.queue(this,p,w);L._queueHooks(this,p),p==="fx"&&D[0]!=="inprogress"&&L.dequeue(this,p)})},dequeue:function(p){return this.each(function(){L.dequeue(this,p)})},clearQueue:function(p){return this.queue(p||"fx",[])},promise:function(p,w){var T,D=1,H=L.Deferred(),U=this,q=this.length,me=function(){--D||H.resolveWith(U,[U])};for(typeof p!="string"&&(w=p,p=void 0),p=p||"fx";q--;)T=Bt.get(U[q],p+"queueHooks"),T&&T.empty&&(D++,T.empty.add(me));return me(),H.promise(w)}});var yr=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Qe=new RegExp("^(?:([+-])=|)("+yr+")([a-z%]*)$","i"),Zs=["Top","Right","Bottom","Left"],Io=function(p,w){return p=w||p,p.style.display==="none"||p.style.display===""&&L.contains(p.ownerDocument,p)&&L.css(p,"display")==="none"},rl=function(p,w,T,D){var H,U,q={};for(U in w)q[U]=p.style[U],p.style[U]=w[U];H=T.apply(p,D||[]);for(U in w)p.style[U]=q[U];return H};function pt(p,w,T,D){var H,U=1,q=20,me=D?function(){return D.cur()}:function(){return L.css(p,w,"")},_e=me(),Ce=T&&T[3]||(L.cssNumber[w]?"":"px"),ze=(L.cssNumber[w]||Ce!=="px"&&+_e)&&Qe.exec(L.css(p,w));if(ze&&ze[3]!==Ce){Ce=Ce||ze[3],T=T||[],ze=+_e||1;do U=U||".5",ze=ze/U,L.style(p,w,ze+Ce);while(U!==(U=me()/_e)&&U!==1&&--q)}return T&&(ze=+ze||+_e||0,H=T[1]?ze+(T[1]+1)*T[2]:+T[2],D&&(D.unit=Ce,D.start=ze,D.end=H)),H}var ki={};function Wn(p){var w,T=p.ownerDocument,D=p.nodeName,H=ki[D];return H||(w=T.body.appendChild(T.createElement(D)),H=L.css(w,"display"),w.parentNode.removeChild(w),H==="none"&&(H="block"),ki[D]=H,H)}function Yt(p,w){for(var T,D,H=[],U=0,q=p.length;U<q;U++)D=p[U],D.style&&(T=D.style.display,w?(T==="none"&&(H[U]=Bt.get(D,"display")||null,H[U]||(D.style.display="")),D.style.display===""&&Io(D)&&(H[U]=Wn(D))):T!=="none"&&(H[U]="none",Bt.set(D,"display",T)));for(U=0;U<q;U++)H[U]!=null&&(p[U].style.display=H[U]);return p}L.fn.extend({show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(p){return typeof p=="boolean"?p?this.show():this.hide():this.each(function(){Io(this)?L(this).show():L(this).hide()})}});var xr=/^(?:checkbox|radio)$/i,xi=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ji=/^$|\/(?:java|ecma)script/i,vi={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};vi.optgroup=vi.option,vi.tbody=vi.tfoot=vi.colgroup=vi.caption=vi.thead,vi.th=vi.td;function li(p,w){var T;return typeof p.getElementsByTagName<"u"?T=p.getElementsByTagName(w||"*"):typeof p.querySelectorAll<"u"?T=p.querySelectorAll(w||"*"):T=[],w===void 0||w&&L.nodeName(p,w)?L.merge([p],T):T}function Kn(p,w){for(var T=0,D=p.length;T<D;T++)Bt.set(p[T],"globalEval",!w||Bt.get(w[T],"globalEval"))}var ei=/<|&#?\w+;/;function Yr(p,w,T,D,H){for(var U,q,me,_e,Ce,ze,Ke=w.createDocumentFragment(),Re=[],$e=0,Pt=p.length;$e<Pt;$e++)if(U=p[$e],U||U===0)if(L.type(U)==="object")L.merge(Re,U.nodeType?[U]:U);else if(!ei.test(U))Re.push(w.createTextNode(U));else{for(q=q||Ke.appendChild(w.createElement("div")),me=(xi.exec(U)||["",""])[1].toLowerCase(),_e=vi[me]||vi._default,q.innerHTML=_e[1]+L.htmlPrefilter(U)+_e[2],ze=_e[0];ze--;)q=q.lastChild;L.merge(Re,q.childNodes),q=Ke.firstChild,q.textContent=""}for(Ke.textContent="",$e=0;U=Re[$e++];){if(D&&L.inArray(U,D)>-1){H&&H.push(U);continue}if(Ce=L.contains(U.ownerDocument,U),q=li(Ke.appendChild(U),"script"),Ce&&Kn(q),T)for(ze=0;U=q[ze++];)ji.test(U.type||"")&&T.push(U)}return Ke}(function(){var p=st.createDocumentFragment(),w=p.appendChild(st.createElement("div")),T=st.createElement("input");T.setAttribute("type","radio"),T.setAttribute("checked","checked"),T.setAttribute("name","t"),w.appendChild(T),Kt.checkClone=w.cloneNode(!0).cloneNode(!0).lastChild.checked,w.innerHTML="<textarea>x</textarea>",Kt.noCloneChecked=!!w.cloneNode(!0).lastChild.defaultValue})();var Zr=st.documentElement,Pn=/^key/,Jr=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,et=/^([^.]*)(?:\.(.+)|)/;function sn(){return!0}function Qn(){return!1}function Rs(){try{return st.activeElement}catch{}}function wr(p,w,T,D,H,U){var q,me;if(typeof w=="object"){typeof T!="string"&&(D=D||T,T=void 0);for(me in w)wr(p,me,T,D,w[me],U);return p}if(D==null&&H==null?(H=T,D=T=void 0):H==null&&(typeof T=="string"?(H=D,D=void 0):(H=D,D=T,T=void 0)),H===!1)H=Qn;else if(!H)return p;return U===1&&(q=H,H=function(_e){return L().off(_e),q.apply(this,arguments)},H.guid=q.guid||(q.guid=L.guid++)),p.each(function(){L.event.add(this,w,H,D,T)})}L.event={global:{},add:function(p,w,T,D,H){var U,q,me,_e,Ce,ze,Ke,Re,$e,Pt,g,b=Bt.get(p);if(b)for(T.handler&&(U=T,T=U.handler,H=U.selector),H&&L.find.matchesSelector(Zr,H),T.guid||(T.guid=L.guid++),(_e=b.events)||(_e=b.events={}),(q=b.handle)||(q=b.handle=function(C){return typeof L<"u"&&L.event.triggered!==C.type?L.event.dispatch.apply(p,arguments):void 0}),w=(w||"").match(Dn)||[""],Ce=w.length;Ce--;)me=et.exec(w[Ce])||[],$e=g=me[1],Pt=(me[2]||"").split(".").sort(),$e&&(Ke=L.event.special[$e]||{},$e=(H?Ke.delegateType:Ke.bindType)||$e,Ke=L.event.special[$e]||{},ze=L.extend({type:$e,origType:g,data:D,handler:T,guid:T.guid,selector:H,needsContext:H&&L.expr.match.needsContext.test(H),namespace:Pt.join(".")},U),(Re=_e[$e])||(Re=_e[$e]=[],Re.delegateCount=0,(!Ke.setup||Ke.setup.call(p,D,Pt,q)===!1)&&p.addEventListener&&p.addEventListener($e,q)),Ke.add&&(Ke.add.call(p,ze),ze.handler.guid||(ze.handler.guid=T.guid)),H?Re.splice(Re.delegateCount++,0,ze):Re.push(ze),L.event.global[$e]=!0)},remove:function(p,w,T,D,H){var U,q,me,_e,Ce,ze,Ke,Re,$e,Pt,g,b=Bt.hasData(p)&&Bt.get(p);if(!(!b||!(_e=b.events))){for(w=(w||"").match(Dn)||[""],Ce=w.length;Ce--;){if(me=et.exec(w[Ce])||[],$e=g=me[1],Pt=(me[2]||"").split(".").sort(),!$e){for($e in _e)L.event.remove(p,$e+w[Ce],T,D,!0);continue}for(Ke=L.event.special[$e]||{},$e=(D?Ke.delegateType:Ke.bindType)||$e,Re=_e[$e]||[],me=me[2]&&new RegExp("(^|\\.)"+Pt.join("\\.(?:.*\\.|)")+"(\\.|$)"),q=U=Re.length;U--;)ze=Re[U],(H||g===ze.origType)&&(!T||T.guid===ze.guid)&&(!me||me.test(ze.namespace))&&(!D||D===ze.selector||D==="**"&&ze.selector)&&(Re.splice(U,1),ze.selector&&Re.delegateCount--,Ke.remove&&Ke.remove.call(p,ze));q&&!Re.length&&((!Ke.teardown||Ke.teardown.call(p,Pt,b.handle)===!1)&&L.removeEvent(p,$e,b.handle),delete _e[$e])}L.isEmptyObject(_e)&&Bt.remove(p,"handle events")}},dispatch:function(p){var w=L.event.fix(p),T,D,H,U,q,me,_e=new Array(arguments.length),Ce=(Bt.get(this,"events")||{})[w.type]||[],ze=L.event.special[w.type]||{};for(_e[0]=w,T=1;T<arguments.length;T++)_e[T]=arguments[T];if(w.delegateTarget=this,!(ze.preDispatch&&ze.preDispatch.call(this,w)===!1)){for(me=L.event.handlers.call(this,w,Ce),T=0;(U=me[T++])&&!w.isPropagationStopped();)for(w.currentTarget=U.elem,D=0;(q=U.handlers[D++])&&!w.isImmediatePropagationStopped();)(!w.rnamespace||w.rnamespace.test(q.namespace))&&(w.handleObj=q,w.data=q.data,H=((L.event.special[q.origType]||{}).handle||q.handler).apply(U.elem,_e),H!==void 0&&(w.result=H)===!1&&(w.preventDefault(),w.stopPropagation()));return ze.postDispatch&&ze.postDispatch.call(this,w),w.result}},handlers:function(p,w){var T,D,H,U,q,me=[],_e=w.delegateCount,Ce=p.target;if(_e&&Ce.nodeType&&!(p.type==="click"&&p.button>=1)){for(;Ce!==this;Ce=Ce.parentNode||this)if(Ce.nodeType===1&&!(p.type==="click"&&Ce.disabled===!0)){for(U=[],q={},T=0;T<_e;T++)D=w[T],H=D.selector+" ",q[H]===void 0&&(q[H]=D.needsContext?L(H,this).index(Ce)>-1:L.find(H,this,null,[Ce]).length),q[H]&&U.push(D);U.length&&me.push({elem:Ce,handlers:U})}}return Ce=this,_e<w.length&&me.push({elem:Ce,handlers:w.slice(_e)}),me},addProp:function(p,w){Object.defineProperty(L.Event.prototype,p,{enumerable:!0,configurable:!0,get:L.isFunction(w)?function(){if(this.originalEvent)return w(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[p]},set:function(T){Object.defineProperty(this,p,{enumerable:!0,configurable:!0,writable:!0,value:T})}})},fix:function(p){return p[L.expando]?p:new L.Event(p)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Rs()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Rs()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&L.nodeName(this,"input"))return this.click(),!1},_default:function(p){return L.nodeName(p.target,"a")}},beforeunload:{postDispatch:function(p){p.result!==void 0&&p.originalEvent&&(p.originalEvent.returnValue=p.result)}}}},L.removeEvent=function(p,w,T){p.removeEventListener&&p.removeEventListener(w,T)},L.Event=function(p,w){if(!(this instanceof L.Event))return new L.Event(p,w);p&&p.type?(this.originalEvent=p,this.type=p.type,this.isDefaultPrevented=p.defaultPrevented||p.defaultPrevented===void 0&&p.returnValue===!1?sn:Qn,this.target=p.target&&p.target.nodeType===3?p.target.parentNode:p.target,this.currentTarget=p.currentTarget,this.relatedTarget=p.relatedTarget):this.type=p,w&&L.extend(this,w),this.timeStamp=p&&p.timeStamp||L.now(),this[L.expando]=!0},L.Event.prototype={constructor:L.Event,isDefaultPrevented:Qn,isPropagationStopped:Qn,isImmediatePropagationStopped:Qn,isSimulated:!1,preventDefault:function(){var p=this.originalEvent;this.isDefaultPrevented=sn,p&&!this.isSimulated&&p.preventDefault()},stopPropagation:function(){var p=this.originalEvent;this.isPropagationStopped=sn,p&&!this.isSimulated&&p.stopPropagation()},stopImmediatePropagation:function(){var p=this.originalEvent;this.isImmediatePropagationStopped=sn,p&&!this.isSimulated&&p.stopImmediatePropagation(),this.stopPropagation()}},L.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(p){var w=p.button;return p.which==null&&Pn.test(p.type)?p.charCode!=null?p.charCode:p.keyCode:!p.which&&w!==void 0&&Jr.test(p.type)?w&1?1:w&2?3:w&4?2:0:p.which}},L.event.addProp),L.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(p,w){L.event.special[p]={delegateType:w,bindType:w,handle:function(T){var D,H=this,U=T.relatedTarget,q=T.handleObj;return(!U||U!==H&&!L.contains(H,U))&&(T.type=q.origType,D=q.handler.apply(this,arguments),T.type=w),D}}}),L.fn.extend({on:function(p,w,T,D){return wr(this,p,w,T,D)},one:function(p,w,T,D){return wr(this,p,w,T,D,1)},off:function(p,w,T){var D,H;if(p&&p.preventDefault&&p.handleObj)return D=p.handleObj,L(p.delegateTarget).off(D.namespace?D.origType+"."+D.namespace:D.origType,D.selector,D.handler),this;if(typeof p=="object"){for(H in p)this.off(H,w,p[H]);return this}return(w===!1||typeof w=="function")&&(T=w,w=void 0),T===!1&&(T=Qn),this.each(function(){L.event.remove(this,p,T,w)})}});var ms=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,al=/<script|<style|<link/i,Ot=/checked\s*(?:[^=]|=\s*.checked.)/i,Kr=/^true\/(.*)/,zi=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function es(p,w){return L.nodeName(p,"table")&&L.nodeName(w.nodeType!==11?w:w.firstChild,"tr")&&p.getElementsByTagName("tbody")[0]||p}function vn(p){return p.type=(p.getAttribute("type")!==null)+"/"+p.type,p}function br(p){var w=Kr.exec(p.type);return w?p.type=w[1]:p.removeAttribute("type"),p}function wa(p,w){var T,D,H,U,q,me,_e,Ce;if(w.nodeType===1){if(Bt.hasData(p)&&(U=Bt.access(p),q=Bt.set(w,U),Ce=U.events,Ce)){delete q.handle,q.events={};for(H in Ce)for(T=0,D=Ce[H].length;T<D;T++)L.event.add(w,H,Ce[H][T])}gn.hasData(p)&&(me=gn.access(p),_e=L.extend({},me),gn.set(w,_e))}}function ba(p,w){var T=w.nodeName.toLowerCase();T==="input"&&xr.test(p.type)?w.checked=p.checked:(T==="input"||T==="textarea")&&(w.defaultValue=p.defaultValue)}function Is(p,w,T,D){w=Ni.apply([],w);var H,U,q,me,_e,Ce,ze=0,Ke=p.length,Re=Ke-1,$e=w[0],Pt=L.isFunction($e);if(Pt||Ke>1&&typeof $e=="string"&&!Kt.checkClone&&Ot.test($e))return p.each(function(g){var b=p.eq(g);Pt&&(w[0]=$e.call(this,g,b.html())),Is(b,w,T,D)});if(Ke&&(H=Yr(w,p[0].ownerDocument,!1,p,D),U=H.firstChild,H.childNodes.length===1&&(H=U),U||D)){for(q=L.map(li(H,"script"),vn),me=q.length;ze<Ke;ze++)_e=H,ze!==Re&&(_e=L.clone(_e,!0,!0),me&&L.merge(q,li(_e,"script"))),T.call(p[ze],_e,ze);if(me)for(Ce=q[q.length-1].ownerDocument,L.map(q,br),ze=0;ze<me;ze++)_e=q[ze],ji.test(_e.type||"")&&!Bt.access(_e,"globalEval")&&L.contains(Ce,_e)&&(_e.src?L._evalUrl&&L._evalUrl(_e.src):qt(_e.textContent.replace(zi,""),Ce))}return p}function Js(p,w,T){for(var D,H=w?L.filter(w,p):p,U=0;(D=H[U])!=null;U++)!T&&D.nodeType===1&&L.cleanData(li(D)),D.parentNode&&(T&&L.contains(D.ownerDocument,D)&&Kn(li(D,"script")),D.parentNode.removeChild(D));return p}L.extend({htmlPrefilter:function(p){return p.replace(ms,"<$1></$2>")},clone:function(p,w,T){var D,H,U,q,me=p.cloneNode(!0),_e=L.contains(p.ownerDocument,p);if(!Kt.noCloneChecked&&(p.nodeType===1||p.nodeType===11)&&!L.isXMLDoc(p))for(q=li(me),U=li(p),D=0,H=U.length;D<H;D++)ba(U[D],q[D]);if(w)if(T)for(U=U||li(p),q=q||li(me),D=0,H=U.length;D<H;D++)wa(U[D],q[D]);else wa(p,me);return q=li(me,"script"),q.length>0&&Kn(q,!_e&&li(p,"script")),me},cleanData:function(p){for(var w,T,D,H=L.event.special,U=0;(T=p[U])!==void 0;U++)if(Ro(T)){if(w=T[Bt.expando]){if(w.events)for(D in w.events)H[D]?L.event.remove(T,D):L.removeEvent(T,D,w.handle);T[Bt.expando]=void 0}T[gn.expando]&&(T[gn.expando]=void 0)}}}),L.fn.extend({detach:function(p){return Js(this,p,!0)},remove:function(p){return Js(this,p)},text:function(p){return kn(this,function(w){return w===void 0?L.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=w)})},null,p,arguments.length)},append:function(){return Is(this,arguments,function(p){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var w=es(this,p);w.appendChild(p)}})},prepend:function(){return Is(this,arguments,function(p){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var w=es(this,p);w.insertBefore(p,w.firstChild)}})},before:function(){return Is(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this)})},after:function(){return Is(this,arguments,function(p){this.parentNode&&this.parentNode.insertBefore(p,this.nextSibling)})},empty:function(){for(var p,w=0;(p=this[w])!=null;w++)p.nodeType===1&&(L.cleanData(li(p,!1)),p.textContent="");return this},clone:function(p,w){return p=p??!1,w=w??p,this.map(function(){return L.clone(this,p,w)})},html:function(p){return kn(this,function(w){var T=this[0]||{},D=0,H=this.length;if(w===void 0&&T.nodeType===1)return T.innerHTML;if(typeof w=="string"&&!al.test(w)&&!vi[(xi.exec(w)||["",""])[1].toLowerCase()]){w=L.htmlPrefilter(w);try{for(;D<H;D++)T=this[D]||{},T.nodeType===1&&(L.cleanData(li(T,!1)),T.innerHTML=w);T=0}catch{}}T&&this.empty().append(w)},null,p,arguments.length)},replaceWith:function(){var p=[];return Is(this,arguments,function(w){var T=this.parentNode;L.inArray(this,p)<0&&(L.cleanData(li(this)),T&&T.replaceChild(w,this))},p)}}),L.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(p,w){L.fn[p]=function(T){for(var D,H=[],U=L(T),q=U.length-1,me=0;me<=q;me++)D=me===q?this:this.clone(!0),L(U[me])[w](D),An.apply(H,D.get());return this.pushStack(H)}});var Fo=/^margin/,Yi=new RegExp("^("+yr+")(?!px)[a-z%]+$","i"),jt=function(p){var w=p.ownerDocument.defaultView;return(!w||!w.opener)&&(w=z),w.getComputedStyle(p)};(function(){function p(){if(q){q.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",q.innerHTML="",Zr.appendChild(U);var me=z.getComputedStyle(q);w=me.top!=="1%",H=me.marginLeft==="2px",T=me.width==="4px",q.style.marginRight="50%",D=me.marginRight==="4px",Zr.removeChild(U),q=null}}var w,T,D,H,U=st.createElement("div"),q=st.createElement("div");q.style&&(q.style.backgroundClip="content-box",q.cloneNode(!0).style.backgroundClip="",Kt.clearCloneStyle=q.style.backgroundClip==="content-box",U.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",U.appendChild(q),L.extend(Kt,{pixelPosition:function(){return p(),w},boxSizingReliable:function(){return p(),T},pixelMarginRight:function(){return p(),D},reliableMarginLeft:function(){return p(),H}}))})();function Zi(p,w,T){var D,H,U,q,me=p.style;return T=T||jt(p),T&&(q=T.getPropertyValue(w)||T[w],q===""&&!L.contains(p.ownerDocument,p)&&(q=L.style(p,w)),!Kt.pixelMarginRight()&&Yi.test(q)&&Fo.test(w)&&(D=me.width,H=me.minWidth,U=me.maxWidth,me.minWidth=me.maxWidth=me.width=q,q=T.width,me.width=D,me.minWidth=H,me.maxWidth=U)),q!==void 0?q+"":q}function Ks(p,w){return{get:function(){if(p()){delete this.get;return}return(this.get=w).apply(this,arguments)}}}var Qr=/^(none|table(?!-c[ea]).+)/,Qs={position:"absolute",visibility:"hidden",display:"block"},Fs={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","Moz","ms"],eo=st.createElement("div").style;function Ma(p){if(p in eo)return p;for(var w=p[0].toUpperCase()+p.slice(1),T=_a.length;T--;)if(p=_a[T]+w,p in eo)return p}function ll(p,w,T){var D=Qe.exec(w);return D?Math.max(0,D[2]-(T||0))+(D[3]||"px"):w}function Ea(p,w,T,D,H){var U,q=0;for(T===(D?"border":"content")?U=4:U=w==="width"?1:0;U<4;U+=2)T==="margin"&&(q+=L.css(p,T+Zs[U],!0,H)),D?(T==="content"&&(q-=L.css(p,"padding"+Zs[U],!0,H)),T!=="margin"&&(q-=L.css(p,"border"+Zs[U]+"Width",!0,H))):(q+=L.css(p,"padding"+Zs[U],!0,H),T!=="padding"&&(q+=L.css(p,"border"+Zs[U]+"Width",!0,H)));return q}function Bo(p,w,T){var D,H=!0,U=jt(p),q=L.css(p,"boxSizing",!1,U)==="border-box";if(p.getClientRects().length&&(D=p.getBoundingClientRect()[w]),D<=0||D==null){if(D=Zi(p,w,U),(D<0||D==null)&&(D=p.style[w]),Yi.test(D))return D;H=q&&(Kt.boxSizingReliable()||D===p.style[w]),D=parseFloat(D)||0}return D+Ea(p,w,T||(q?"border":"content"),H,U)+"px"}L.extend({cssHooks:{opacity:{get:function(p,w){if(w){var T=Zi(p,"opacity");return T===""?"1":T}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(p,w,T,D){if(!(!p||p.nodeType===3||p.nodeType===8||!p.style)){var H,U,q,me=L.camelCase(w),_e=p.style;if(w=L.cssProps[me]||(L.cssProps[me]=Ma(me)||me),q=L.cssHooks[w]||L.cssHooks[me],T!==void 0){if(U=typeof T,U==="string"&&(H=Qe.exec(T))&&H[1]&&(T=pt(p,w,H),U="number"),T==null||T!==T)return;U==="number"&&(T+=H&&H[3]||(L.cssNumber[me]?"":"px")),!Kt.clearCloneStyle&&T===""&&w.indexOf("background")===0&&(_e[w]="inherit"),(!q||!("set"in q)||(T=q.set(p,T,D))!==void 0)&&(_e[w]=T)}else return q&&"get"in q&&(H=q.get(p,!1,D))!==void 0?H:_e[w]}},css:function(p,w,T,D){var H,U,q,me=L.camelCase(w);return w=L.cssProps[me]||(L.cssProps[me]=Ma(me)||me),q=L.cssHooks[w]||L.cssHooks[me],q&&"get"in q&&(H=q.get(p,!0,T)),H===void 0&&(H=Zi(p,w,D)),H==="normal"&&w in Fs&&(H=Fs[w]),T===""||T?(U=parseFloat(H),T===!0||isFinite(U)?U||0:H):H}}),L.each(["height","width"],function(p,w){L.cssHooks[w]={get:function(T,D,H){if(D)return Qr.test(L.css(T,"display"))&&(!T.getClientRects().length||!T.getBoundingClientRect().width)?rl(T,Qs,function(){return Bo(T,w,H)}):Bo(T,w,H)},set:function(T,D,H){var U,q=H&&jt(T),me=H&&Ea(T,w,H,L.css(T,"boxSizing",!1,q)==="border-box",q);return me&&(U=Qe.exec(D))&&(U[3]||"px")!=="px"&&(T.style[w]=D,D=L.css(T,w)),ll(T,D,me)}}}),L.cssHooks.marginLeft=Ks(Kt.reliableMarginLeft,function(p,w){if(w)return(parseFloat(Zi(p,"marginLeft"))||p.getBoundingClientRect().left-rl(p,{marginLeft:0},function(){return p.getBoundingClientRect().left}))+"px"}),L.each({margin:"",padding:"",border:"Width"},function(p,w){L.cssHooks[p+w]={expand:function(T){for(var D=0,H={},U=typeof T=="string"?T.split(" "):[T];D<4;D++)H[p+Zs[D]+w]=U[D]||U[D-2]||U[0];return H}},Fo.test(p)||(L.cssHooks[p+w].set=ll)}),L.fn.extend({css:function(p,w){return kn(this,function(T,D,H){var U,q,me={},_e=0;if(L.isArray(D)){for(U=jt(T),q=D.length;_e<q;_e++)me[D[_e]]=L.css(T,D[_e],!1,U);return me}return H!==void 0?L.style(T,D,H):L.css(T,D)},p,w,arguments.length>1)}});function Ji(p,w,T,D,H){return new Ji.prototype.init(p,w,T,D,H)}L.Tween=Ji,Ji.prototype={constructor:Ji,init:function(p,w,T,D,H,U){this.elem=p,this.prop=T,this.easing=H||L.easing._default,this.options=w,this.start=this.now=this.cur(),this.end=D,this.unit=U||(L.cssNumber[T]?"":"px")},cur:function(){var p=Ji.propHooks[this.prop];return p&&p.get?p.get(this):Ji.propHooks._default.get(this)},run:function(p){var w,T=Ji.propHooks[this.prop];return this.options.duration?this.pos=w=L.easing[this.easing](p,this.options.duration*p,0,1,this.options.duration):this.pos=w=p,this.now=(this.end-this.start)*w+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),T&&T.set?T.set(this):Ji.propHooks._default.set(this),this}},Ji.prototype.init.prototype=Ji.prototype,Ji.propHooks={_default:{get:function(p){var w;return p.elem.nodeType!==1||p.elem[p.prop]!=null&&p.elem.style[p.prop]==null?p.elem[p.prop]:(w=L.css(p.elem,p.prop,""),!w||w==="auto"?0:w)},set:function(p){L.fx.step[p.prop]?L.fx.step[p.prop](p):p.elem.nodeType===1&&(p.elem.style[L.cssProps[p.prop]]!=null||L.cssHooks[p.prop])?L.style(p.elem,p.prop,p.now+p.unit):p.elem[p.prop]=p.now}}},Ji.propHooks.scrollTop=Ji.propHooks.scrollLeft={set:function(p){p.elem.nodeType&&p.elem.parentNode&&(p.elem[p.prop]=p.now)}},L.easing={linear:function(p){return p},swing:function(p){return .5-Math.cos(p*Math.PI)/2},_default:"swing"},L.fx=Ji.prototype.init,L.fx.step={};var Bs,$n,Sa=/^(?:toggle|show|hide)$/,No=/queueHooks$/;function _r(){$n&&(z.requestAnimationFrame(_r),L.fx.tick())}function Ns(){return z.setTimeout(function(){Bs=void 0}),Bs=L.now()}function er(p,w){var T,D=0,H={height:p};for(w=w?1:0;D<4;D+=2-w)T=Zs[D],H["margin"+T]=H["padding"+T]=p;return w&&(H.opacity=H.width=p),H}function Ta(p,w,T){for(var D,H=(Ln.tweeners[w]||[]).concat(Ln.tweeners["*"]),U=0,q=H.length;U<q;U++)if(D=H[U].call(T,w,p))return D}function Oo(p,w,T){var D,H,U,q,me,_e,Ce,ze,Ke="width"in w||"height"in w,Re=this,$e={},Pt=p.style,g=p.nodeType&&Io(p),b=Bt.get(p,"fxshow");T.queue||(q=L._queueHooks(p,"fx"),q.unqueued==null&&(q.unqueued=0,me=q.empty.fire,q.empty.fire=function(){q.unqueued||me()}),q.unqueued++,Re.always(function(){Re.always(function(){q.unqueued--,L.queue(p,"fx").length||q.empty.fire()})}));for(D in w)if(H=w[D],Sa.test(H)){if(delete w[D],U=U||H==="toggle",H===(g?"hide":"show"))if(H==="show"&&b&&b[D]!==void 0)g=!0;else continue;$e[D]=b&&b[D]||L.style(p,D)}if(_e=!L.isEmptyObject(w),!(!_e&&L.isEmptyObject($e))){Ke&&p.nodeType===1&&(T.overflow=[Pt.overflow,Pt.overflowX,Pt.overflowY],Ce=b&&b.display,Ce==null&&(Ce=Bt.get(p,"display")),ze=L.css(p,"display"),ze==="none"&&(Ce?ze=Ce:(Yt([p],!0),Ce=p.style.display||Ce,ze=L.css(p,"display"),Yt([p]))),(ze==="inline"||ze==="inline-block"&&Ce!=null)&&L.css(p,"float")==="none"&&(_e||(Re.done(function(){Pt.display=Ce}),Ce==null&&(ze=Pt.display,Ce=ze==="none"?"":ze)),Pt.display="inline-block")),T.overflow&&(Pt.overflow="hidden",Re.always(function(){Pt.overflow=T.overflow[0],Pt.overflowX=T.overflow[1],Pt.overflowY=T.overflow[2]})),_e=!1;for(D in $e)_e||(b?"hidden"in b&&(g=b.hidden):b=Bt.access(p,"fxshow",{display:Ce}),U&&(b.hidden=!g),g&&Yt([p],!0),Re.done(function(){g||Yt([p]),Bt.remove(p,"fxshow");for(D in $e)L.style(p,D,$e[D])})),_e=Ta(g?b[D]:0,D,Re),D in b||(b[D]=_e.start,g&&(_e.end=_e.start,_e.start=0))}}function cl(p,w){var T,D,H,U,q;for(T in p)if(D=L.camelCase(T),H=w[D],U=p[T],L.isArray(U)&&(H=U[1],U=p[T]=U[0]),T!==D&&(p[D]=U,delete p[T]),q=L.cssHooks[D],q&&"expand"in q){U=q.expand(U),delete p[D];for(T in U)T in p||(p[T]=U[T],w[T]=H)}else w[D]=H}function Ln(p,w,T){var D,H,U=0,q=Ln.prefilters.length,me=L.Deferred().always(function(){delete _e.elem}),_e=function(){if(H)return!1;for(var Ke=Bs||Ns(),Re=Math.max(0,Ce.startTime+Ce.duration-Ke),$e=Re/Ce.duration||0,Pt=1-$e,g=0,b=Ce.tweens.length;g<b;g++)Ce.tweens[g].run(Pt);return me.notifyWith(p,[Ce,Pt,Re]),Pt<1&&b?Re:(me.resolveWith(p,[Ce]),!1)},Ce=me.promise({elem:p,props:L.extend({},w),opts:L.extend(!0,{specialEasing:{},easing:L.easing._default},T),originalProperties:w,originalOptions:T,startTime:Bs||Ns(),duration:T.duration,tweens:[],createTween:function(Ke,Re){var $e=L.Tween(p,Ce.opts,Ke,Re,Ce.opts.specialEasing[Ke]||Ce.opts.easing);return Ce.tweens.push($e),$e},stop:function(Ke){var Re=0,$e=Ke?Ce.tweens.length:0;if(H)return this;for(H=!0;Re<$e;Re++)Ce.tweens[Re].run(1);return Ke?(me.notifyWith(p,[Ce,1,0]),me.resolveWith(p,[Ce,Ke])):me.rejectWith(p,[Ce,Ke]),this}}),ze=Ce.props;for(cl(ze,Ce.opts.specialEasing);U<q;U++)if(D=Ln.prefilters[U].call(Ce,p,ze,Ce.opts),D)return L.isFunction(D.stop)&&(L._queueHooks(Ce.elem,Ce.opts.queue).stop=L.proxy(D.stop,D)),D;return L.map(ze,Ta,Ce),L.isFunction(Ce.opts.start)&&Ce.opts.start.call(p,Ce),L.fx.timer(L.extend(_e,{elem:p,anim:Ce,queue:Ce.opts.queue})),Ce.progress(Ce.opts.progress).done(Ce.opts.done,Ce.opts.complete).fail(Ce.opts.fail).always(Ce.opts.always)}L.Animation=L.extend(Ln,{tweeners:{"*":[function(p,w){var T=this.createTween(p,w);return pt(T.elem,p,Qe.exec(w),T),T}]},tweener:function(p,w){L.isFunction(p)?(w=p,p=["*"]):p=p.match(Dn);for(var T,D=0,H=p.length;D<H;D++)T=p[D],Ln.tweeners[T]=Ln.tweeners[T]||[],Ln.tweeners[T].unshift(w)},prefilters:[Oo],prefilter:function(p,w){w?Ln.prefilters.unshift(p):Ln.prefilters.push(p)}}),L.speed=function(p,w,T){var D=p&&typeof p=="object"?L.extend({},p):{complete:T||!T&&w||L.isFunction(p)&&p,duration:p,easing:T&&w||w&&!L.isFunction(w)&&w};return L.fx.off||st.hidden?D.duration=0:typeof D.duration!="number"&&(D.duration in L.fx.speeds?D.duration=L.fx.speeds[D.duration]:D.duration=L.fx.speeds._default),(D.queue==null||D.queue===!0)&&(D.queue="fx"),D.old=D.complete,D.complete=function(){L.isFunction(D.old)&&D.old.call(this),D.queue&&L.dequeue(this,D.queue)},D},L.fn.extend({fadeTo:function(p,w,T,D){return this.filter(Io).css("opacity",0).show().end().animate({opacity:w},p,T,D)},animate:function(p,w,T,D){var H=L.isEmptyObject(p),U=L.speed(w,T,D),q=function(){var me=Ln(this,L.extend({},p),U);(H||Bt.get(this,"finish"))&&me.stop(!0)};return q.finish=q,H||U.queue===!1?this.each(q):this.queue(U.queue,q)},stop:function(p,w,T){var D=function(H){var U=H.stop;delete H.stop,U(T)};return typeof p!="string"&&(T=w,w=p,p=void 0),w&&p!==!1&&this.queue(p||"fx",[]),this.each(function(){var H=!0,U=p!=null&&p+"queueHooks",q=L.timers,me=Bt.get(this);if(U)me[U]&&me[U].stop&&D(me[U]);else for(U in me)me[U]&&me[U].stop&&No.test(U)&&D(me[U]);for(U=q.length;U--;)q[U].elem===this&&(p==null||q[U].queue===p)&&(q[U].anim.stop(T),H=!1,q.splice(U,1));(H||!T)&&L.dequeue(this,p)})},finish:function(p){return p!==!1&&(p=p||"fx"),this.each(function(){var w,T=Bt.get(this),D=T[p+"queue"],H=T[p+"queueHooks"],U=L.timers,q=D?D.length:0;for(T.finish=!0,L.queue(this,p,[]),H&&H.stop&&H.stop.call(this,!0),w=U.length;w--;)U[w].elem===this&&U[w].queue===p&&(U[w].anim.stop(!0),U.splice(w,1));for(w=0;w<q;w++)D[w]&&D[w].finish&&D[w].finish.call(this);delete T.finish})}}),L.each(["toggle","show","hide"],function(p,w){var T=L.fn[w];L.fn[w]=function(D,H,U){return D==null||typeof D=="boolean"?T.apply(this,arguments):this.animate(er(w,!0),D,H,U)}}),L.each({slideDown:er("show"),slideUp:er("hide"),slideToggle:er("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(p,w){L.fn[p]=function(T,D,H){return this.animate(w,T,D,H)}}),L.timers=[],L.fx.tick=function(){var p,w=0,T=L.timers;for(Bs=L.now();w<T.length;w++)p=T[w],!p()&&T[w]===p&&T.splice(w--,1);T.length||L.fx.stop(),Bs=void 0},L.fx.timer=function(p){L.timers.push(p),p()?L.fx.start():L.timers.pop()},L.fx.interval=13,L.fx.start=function(){$n||($n=z.requestAnimationFrame?z.requestAnimationFrame(_r):z.setInterval(L.fx.tick,L.fx.interval))},L.fx.stop=function(){z.cancelAnimationFrame?z.cancelAnimationFrame($n):z.clearInterval($n),$n=null},L.fx.speeds={slow:600,fast:200,_default:400},L.fn.delay=function(p,w){return p=L.fx&&L.fx.speeds[p]||p,w=w||"fx",this.queue(w,function(T,D){var H=z.setTimeout(T,p);D.stop=function(){z.clearTimeout(H)}})},function(){var p=st.createElement("input"),w=st.createElement("select"),T=w.appendChild(st.createElement("option"));p.type="checkbox",Kt.checkOn=p.value!=="",Kt.optSelected=T.selected,p=st.createElement("input"),p.value="t",p.type="radio",Kt.radioValue=p.value==="t"}();var ul,to=L.expr.attrHandle;L.fn.extend({attr:function(p,w){return kn(this,L.attr,p,w,arguments.length>1)},removeAttr:function(p){return this.each(function(){L.removeAttr(this,p)})}}),L.extend({attr:function(p,w,T){var D,H,U=p.nodeType;if(!(U===3||U===8||U===2)){if(typeof p.getAttribute>"u")return L.prop(p,w,T);if((U!==1||!L.isXMLDoc(p))&&(H=L.attrHooks[w.toLowerCase()]||(L.expr.match.bool.test(w)?ul:void 0)),T!==void 0){if(T===null){L.removeAttr(p,w);return}return H&&"set"in H&&(D=H.set(p,T,w))!==void 0?D:(p.setAttribute(w,T+""),T)}return H&&"get"in H&&(D=H.get(p,w))!==null?D:(D=L.find.attr(p,w),D??void 0)}},attrHooks:{type:{set:function(p,w){if(!Kt.radioValue&&w==="radio"&&L.nodeName(p,"input")){var T=p.value;return p.setAttribute("type",w),T&&(p.value=T),w}}}},removeAttr:function(p,w){var T,D=0,H=w&&w.match(Dn);if(H&&p.nodeType===1)for(;T=H[D++];)p.removeAttribute(T)}}),ul={set:function(p,w,T){return w===!1?L.removeAttr(p,T):p.setAttribute(T,T),T}},L.each(L.expr.match.bool.source.match(/\w+/g),function(p,w){var T=to[w]||L.find.attr;to[w]=function(D,H,U){var q,me,_e=H.toLowerCase();return U||(me=to[_e],to[_e]=q,q=T(D,H,U)!=null?_e:null,to[_e]=me),q}});var hc=/^(?:input|select|textarea|button)$/i,dc=/^(?:a|area)$/i;L.fn.extend({prop:function(p,w){return kn(this,L.prop,p,w,arguments.length>1)},removeProp:function(p){return this.each(function(){delete this[L.propFix[p]||p]})}}),L.extend({prop:function(p,w,T){var D,H,U=p.nodeType;if(!(U===3||U===8||U===2))return(U!==1||!L.isXMLDoc(p))&&(w=L.propFix[w]||w,H=L.propHooks[w]),T!==void 0?H&&"set"in H&&(D=H.set(p,T,w))!==void 0?D:p[w]=T:H&&"get"in H&&(D=H.get(p,w))!==null?D:p[w]},propHooks:{tabIndex:{get:function(p){var w=L.find.attr(p,"tabindex");return w?parseInt(w,10):hc.test(p.nodeName)||dc.test(p.nodeName)&&p.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Kt.optSelected||(L.propHooks.selected={get:function(p){var w=p.parentNode;return w&&w.parentNode&&w.parentNode.selectedIndex,null},set:function(p){var w=p.parentNode;w&&(w.selectedIndex,w.parentNode&&w.parentNode.selectedIndex)}}),L.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){L.propFix[this.toLowerCase()]=this});function tr(p){var w=p.match(Dn)||[];return w.join(" ")}function ir(p){return p.getAttribute&&p.getAttribute("class")||""}L.fn.extend({addClass:function(p){var w,T,D,H,U,q,me,_e=0;if(L.isFunction(p))return this.each(function(Ce){L(this).addClass(p.call(this,Ce,ir(this)))});if(typeof p=="string"&&p){for(w=p.match(Dn)||[];T=this[_e++];)if(H=ir(T),D=T.nodeType===1&&" "+tr(H)+" ",D){for(q=0;U=w[q++];)D.indexOf(" "+U+" ")<0&&(D+=U+" ");me=tr(D),H!==me&&T.setAttribute("class",me)}}return this},removeClass:function(p){var w,T,D,H,U,q,me,_e=0;if(L.isFunction(p))return this.each(function(Ce){L(this).removeClass(p.call(this,Ce,ir(this)))});if(!arguments.length)return this.attr("class","");if(typeof p=="string"&&p){for(w=p.match(Dn)||[];T=this[_e++];)if(H=ir(T),D=T.nodeType===1&&" "+tr(H)+" ",D){for(q=0;U=w[q++];)for(;D.indexOf(" "+U+" ")>-1;)D=D.replace(" "+U+" "," ");me=tr(D),H!==me&&T.setAttribute("class",me)}}return this},toggleClass:function(p,w){var T=typeof p;return typeof w=="boolean"&&T==="string"?w?this.addClass(p):this.removeClass(p):L.isFunction(p)?this.each(function(D){L(this).toggleClass(p.call(this,D,ir(this),w),w)}):this.each(function(){var D,H,U,q;if(T==="string")for(H=0,U=L(this),q=p.match(Dn)||[];D=q[H++];)U.hasClass(D)?U.removeClass(D):U.addClass(D);else(p===void 0||T==="boolean")&&(D=ir(this),D&&Bt.set(this,"__className__",D),this.setAttribute&&this.setAttribute("class",D||p===!1?"":Bt.get(this,"__className__")||""))})},hasClass:function(p){var w,T,D=0;for(w=" "+p+" ";T=this[D++];)if(T.nodeType===1&&(" "+tr(ir(T))+" ").indexOf(w)>-1)return!0;return!1}});var un=/\r/g;L.fn.extend({val:function(p){var w,T,D,H=this[0];return arguments.length?(D=L.isFunction(p),this.each(function(U){var q;this.nodeType===1&&(D?q=p.call(this,U,L(this).val()):q=p,q==null?q="":typeof q=="number"?q+="":L.isArray(q)&&(q=L.map(q,function(me){return me==null?"":me+""})),w=L.valHooks[this.type]||L.valHooks[this.nodeName.toLowerCase()],(!w||!("set"in w)||w.set(this,q,"value")===void 0)&&(this.value=q))})):H?(w=L.valHooks[H.type]||L.valHooks[H.nodeName.toLowerCase()],w&&"get"in w&&(T=w.get(H,"value"))!==void 0?T:(T=H.value,typeof T=="string"?T.replace(un,""):T??"")):void 0}}),L.extend({valHooks:{option:{get:function(p){var w=L.find.attr(p,"value");return w??tr(L.text(p))}},select:{get:function(p){var w,T,D,H=p.options,U=p.selectedIndex,q=p.type==="select-one",me=q?null:[],_e=q?U+1:H.length;for(U<0?D=_e:D=q?U:0;D<_e;D++)if(T=H[D],(T.selected||D===U)&&!T.disabled&&(!T.parentNode.disabled||!L.nodeName(T.parentNode,"optgroup"))){if(w=L(T).val(),q)return w;me.push(w)}return me},set:function(p,w){for(var T,D,H=p.options,U=L.makeArray(w),q=H.length;q--;)D=H[q],(D.selected=L.inArray(L.valHooks.option.get(D),U)>-1)&&(T=!0);return T||(p.selectedIndex=-1),U}}}}),L.each(["radio","checkbox"],function(){L.valHooks[this]={set:function(p,w){if(L.isArray(w))return p.checked=L.inArray(L(p).val(),w)>-1}},Kt.checkOn||(L.valHooks[this].get=function(p){return p.getAttribute("value")===null?"on":p.value})});var Mr=/^(?:focusinfocus|focusoutblur)$/;L.extend(L.event,{trigger:function(p,w,T,D){var H,U,q,me,_e,Ce,ze,Ke=[T||st],Re=Nn.call(p,"type")?p.type:p,$e=Nn.call(p,"namespace")?p.namespace.split("."):[];if(U=q=T=T||st,!(T.nodeType===3||T.nodeType===8)&&!Mr.test(Re+L.event.triggered)&&(Re.indexOf(".")>-1&&($e=Re.split("."),Re=$e.shift(),$e.sort()),_e=Re.indexOf(":")<0&&"on"+Re,p=p[L.expando]?p:new L.Event(Re,typeof p=="object"&&p),p.isTrigger=D?2:3,p.namespace=$e.join("."),p.rnamespace=p.namespace?new RegExp("(^|\\.)"+$e.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p.result=void 0,p.target||(p.target=T),w=w==null?[p]:L.makeArray(w,[p]),ze=L.event.special[Re]||{},!(!D&&ze.trigger&&ze.trigger.apply(T,w)===!1))){if(!D&&!ze.noBubble&&!L.isWindow(T)){for(me=ze.delegateType||Re,Mr.test(me+Re)||(U=U.parentNode);U;U=U.parentNode)Ke.push(U),q=U;q===(T.ownerDocument||st)&&Ke.push(q.defaultView||q.parentWindow||z)}for(H=0;(U=Ke[H++])&&!p.isPropagationStopped();)p.type=H>1?me:ze.bindType||Re,Ce=(Bt.get(U,"events")||{})[p.type]&&Bt.get(U,"handle"),Ce&&Ce.apply(U,w),Ce=_e&&U[_e],Ce&&Ce.apply&&Ro(U)&&(p.result=Ce.apply(U,w),p.result===!1&&p.preventDefault());return p.type=Re,!D&&!p.isDefaultPrevented()&&(!ze._default||ze._default.apply(Ke.pop(),w)===!1)&&Ro(T)&&_e&&L.isFunction(T[Re])&&!L.isWindow(T)&&(q=T[_e],q&&(T[_e]=null),L.event.triggered=Re,T[Re](),L.event.triggered=void 0,q&&(T[_e]=q)),p.result}},simulate:function(p,w,T){var D=L.extend(new L.Event,T,{type:p,isSimulated:!0});L.event.trigger(D,null,w)}}),L.fn.extend({trigger:function(p,w){return this.each(function(){L.event.trigger(p,w,this)})},triggerHandler:function(p,w){var T=this[0];if(T)return L.event.trigger(p,w,T,!0)}}),L.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(p,w){L.fn[w]=function(T,D){return arguments.length>0?this.on(w,null,T,D):this.trigger(w)}}),L.fn.extend({hover:function(p,w){return this.mouseenter(p).mouseleave(w||p)}}),Kt.focusin="onfocusin"in z,Kt.focusin||L.each({focus:"focusin",blur:"focusout"},function(p,w){var T=function(D){L.event.simulate(w,D.target,L.event.fix(D))};L.event.special[w]={setup:function(){var D=this.ownerDocument||this,H=Bt.access(D,w);H||D.addEventListener(p,T,!0),Bt.access(D,w,(H||0)+1)},teardown:function(){var D=this.ownerDocument||this,H=Bt.access(D,w)-1;H?Bt.access(D,w,H):(D.removeEventListener(p,T,!0),Bt.remove(D,w))}}});var gs=z.location,Er=L.now(),nr=/\?/;L.parseXML=function(p){var w;if(!p||typeof p!="string")return null;try{w=new z.DOMParser().parseFromString(p,"text/xml")}catch{w=void 0}return(!w||w.getElementsByTagName("parsererror").length)&&L.error("Invalid XML: "+p),w};var Sr=/\[\]$/,sr=/\r?\n/g,ko=/^(?:submit|button|image|reset|file)$/i,fc=/^(?:input|select|textarea|keygen)/i;function ts(p,w,T,D){var H;if(L.isArray(w))L.each(w,function(U,q){T||Sr.test(p)?D(p,q):ts(p+"["+(typeof q=="object"&&q!=null?U:"")+"]",q,T,D)});else if(!T&&L.type(w)==="object")for(H in w)ts(p+"["+H+"]",w[H],T,D);else D(p,w)}L.param=function(p,w){var T,D=[],H=function(U,q){var me=L.isFunction(q)?q():q;D[D.length]=encodeURIComponent(U)+"="+encodeURIComponent(me??"")};if(L.isArray(p)||p.jquery&&!L.isPlainObject(p))L.each(p,function(){H(this.name,this.value)});else for(T in p)ts(T,p[T],w,H);return D.join("&")},L.fn.extend({serialize:function(){return L.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var p=L.prop(this,"elements");return p?L.makeArray(p):this}).filter(function(){var p=this.type;return this.name&&!L(this).is(":disabled")&&fc.test(this.nodeName)&&!ko.test(p)&&(this.checked||!xr.test(p))}).map(function(p,w){var T=L(this).val();return T==null?null:L.isArray(T)?L.map(T,function(D){return{name:w.name,value:D.replace(sr,`\r
`)}}):{name:w.name,value:T.replace(sr,`\r
`)}}).get()}});var pc=/%20/g,mc=/#.*$/,gc=/([?&])_=[^&]*/,vc=/^(.*?):[ \t]*([^\r\n]*)$/mg,yc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,xc=/^(?:GET|HEAD)$/,wc=/^\/\//,vs={},Aa={},hl="*/".concat("*"),Ca=st.createElement("a");Ca.href=gs.href;function dl(p){return function(w,T){typeof w!="string"&&(T=w,w="*");var D,H=0,U=w.toLowerCase().match(Dn)||[];if(L.isFunction(T))for(;D=U[H++];)D[0]==="+"?(D=D.slice(1)||"*",(p[D]=p[D]||[]).unshift(T)):(p[D]=p[D]||[]).push(T)}}function fl(p,w,T,D){var H={},U=p===Aa;function q(me){var _e;return H[me]=!0,L.each(p[me]||[],function(Ce,ze){var Ke=ze(w,T,D);if(typeof Ke=="string"&&!U&&!H[Ke])return w.dataTypes.unshift(Ke),q(Ke),!1;if(U)return!(_e=Ke)}),_e}return q(w.dataTypes[0])||!H["*"]&&q("*")}function zo(p,w){var T,D,H=L.ajaxSettings.flatOptions||{};for(T in w)w[T]!==void 0&&((H[T]?p:D||(D={}))[T]=w[T]);return D&&L.extend(!0,p,D),p}function bc(p,w,T){for(var D,H,U,q,me=p.contents,_e=p.dataTypes;_e[0]==="*";)_e.shift(),D===void 0&&(D=p.mimeType||w.getResponseHeader("Content-Type"));if(D){for(H in me)if(me[H]&&me[H].test(D)){_e.unshift(H);break}}if(_e[0]in T)U=_e[0];else{for(H in T){if(!_e[0]||p.converters[H+" "+_e[0]]){U=H;break}q||(q=H)}U=U||q}if(U)return U!==_e[0]&&_e.unshift(U),T[U]}function io(p,w,T,D){var H,U,q,me,_e,Ce={},ze=p.dataTypes.slice();if(ze[1])for(q in p.converters)Ce[q.toLowerCase()]=p.converters[q];for(U=ze.shift();U;)if(p.responseFields[U]&&(T[p.responseFields[U]]=w),!_e&&D&&p.dataFilter&&(w=p.dataFilter(w,p.dataType)),_e=U,U=ze.shift(),U){if(U==="*")U=_e;else if(_e!=="*"&&_e!==U){if(q=Ce[_e+" "+U]||Ce["* "+U],!q){for(H in Ce)if(me=H.split(" "),me[1]===U&&(q=Ce[_e+" "+me[0]]||Ce["* "+me[0]],q)){q===!0?q=Ce[H]:Ce[H]!==!0&&(U=me[0],ze.unshift(me[1]));break}}if(q!==!0)if(q&&p.throws)w=q(w);else try{w=q(w)}catch(Ke){return{state:"parsererror",error:q?Ke:"No conversion from "+_e+" to "+U}}}}return{state:"success",data:w}}L.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gs.href,type:"GET",isLocal:yc.test(gs.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":hl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":L.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(p,w){return w?zo(zo(p,L.ajaxSettings),w):zo(L.ajaxSettings,p)},ajaxPrefilter:dl(vs),ajaxTransport:dl(Aa),ajax:function(p,w){typeof p=="object"&&(w=p,p=void 0),w=w||{};var T,D,H,U,q,me,_e,Ce,ze,Ke,Re=L.ajaxSetup({},w),$e=Re.context||Re,Pt=Re.context&&($e.nodeType||$e.jquery)?L($e):L.event,g=L.Deferred(),b=L.Callbacks("once memory"),C=Re.statusCode||{},G={},k={},Z="canceled",j={readyState:0,getResponseHeader:function(re){var ue;if(_e){if(!U)for(U={};ue=vc.exec(H);)U[ue[1].toLowerCase()]=ue[2];ue=U[re.toLowerCase()]}return ue??null},getAllResponseHeaders:function(){return _e?H:null},setRequestHeader:function(re,ue){return _e==null&&(re=k[re.toLowerCase()]=k[re.toLowerCase()]||re,G[re]=ue),this},overrideMimeType:function(re){return _e==null&&(Re.mimeType=re),this},statusCode:function(re){var ue;if(re)if(_e)j.always(re[j.status]);else for(ue in re)C[ue]=[C[ue],re[ue]];return this},abort:function(re){var ue=re||Z;return T&&T.abort(ue),ee(0,ue),this}};if(g.promise(j),Re.url=((p||Re.url||gs.href)+"").replace(wc,gs.protocol+"//"),Re.type=w.method||w.type||Re.method||Re.type,Re.dataTypes=(Re.dataType||"*").toLowerCase().match(Dn)||[""],Re.crossDomain==null){me=st.createElement("a");try{me.href=Re.url,me.href=me.href,Re.crossDomain=Ca.protocol+"//"+Ca.host!=me.protocol+"//"+me.host}catch{Re.crossDomain=!0}}if(Re.data&&Re.processData&&typeof Re.data!="string"&&(Re.data=L.param(Re.data,Re.traditional)),fl(vs,Re,w,j),_e)return j;Ce=L.event&&Re.global,Ce&&L.active++===0&&L.event.trigger("ajaxStart"),Re.type=Re.type.toUpperCase(),Re.hasContent=!xc.test(Re.type),D=Re.url.replace(mc,""),Re.hasContent?Re.data&&Re.processData&&(Re.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(Re.data=Re.data.replace(pc,"+")):(Ke=Re.url.slice(D.length),Re.data&&(D+=(nr.test(D)?"&":"?")+Re.data,delete Re.data),Re.cache===!1&&(D=D.replace(gc,"$1"),Ke=(nr.test(D)?"&":"?")+"_="+Er+++Ke),Re.url=D+Ke),Re.ifModified&&(L.lastModified[D]&&j.setRequestHeader("If-Modified-Since",L.lastModified[D]),L.etag[D]&&j.setRequestHeader("If-None-Match",L.etag[D])),(Re.data&&Re.hasContent&&Re.contentType!==!1||w.contentType)&&j.setRequestHeader("Content-Type",Re.contentType),j.setRequestHeader("Accept",Re.dataTypes[0]&&Re.accepts[Re.dataTypes[0]]?Re.accepts[Re.dataTypes[0]]+(Re.dataTypes[0]!=="*"?", "+hl+"; q=0.01":""):Re.accepts["*"]);for(ze in Re.headers)j.setRequestHeader(ze,Re.headers[ze]);if(Re.beforeSend&&(Re.beforeSend.call($e,j,Re)===!1||_e))return j.abort();if(Z="abort",b.add(Re.complete),j.done(Re.success),j.fail(Re.error),T=fl(Aa,Re,w,j),!T)ee(-1,"No Transport");else{if(j.readyState=1,Ce&&Pt.trigger("ajaxSend",[j,Re]),_e)return j;Re.async&&Re.timeout>0&&(q=z.setTimeout(function(){j.abort("timeout")},Re.timeout));try{_e=!1,T.send(G,ee)}catch(re){if(_e)throw re;ee(-1,re)}}function ee(re,ue,Pe,De){var Ge,ht,Xe,dt,Ft,yt=ue;_e||(_e=!0,q&&z.clearTimeout(q),T=void 0,H=De||"",j.readyState=re>0?4:0,Ge=re>=200&&re<300||re===304,Pe&&(dt=bc(Re,j,Pe)),dt=io(Re,dt,j,Ge),Ge?(Re.ifModified&&(Ft=j.getResponseHeader("Last-Modified"),Ft&&(L.lastModified[D]=Ft),Ft=j.getResponseHeader("etag"),Ft&&(L.etag[D]=Ft)),re===204||Re.type==="HEAD"?yt="nocontent":re===304?yt="notmodified":(yt=dt.state,ht=dt.data,Xe=dt.error,Ge=!Xe)):(Xe=yt,(re||!yt)&&(yt="error",re<0&&(re=0))),j.status=re,j.statusText=(ue||yt)+"",Ge?g.resolveWith($e,[ht,yt,j]):g.rejectWith($e,[j,yt,Xe]),j.statusCode(C),C=void 0,Ce&&Pt.trigger(Ge?"ajaxSuccess":"ajaxError",[j,Re,Ge?ht:Xe]),b.fireWith($e,[j,yt]),Ce&&(Pt.trigger("ajaxComplete",[j,Re]),--L.active||L.event.trigger("ajaxStop")))}return j},getJSON:function(p,w,T){return L.get(p,w,T,"json")},getScript:function(p,w){return L.get(p,void 0,w,"script")}}),L.each(["get","post"],function(p,w){L[w]=function(T,D,H,U){return L.isFunction(D)&&(U=U||H,H=D,D=void 0),L.ajax(L.extend({url:T,type:w,dataType:U,data:D,success:H},L.isPlainObject(T)&&T))}}),L._evalUrl=function(p){return L.ajax({url:p,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},L.fn.extend({wrapAll:function(p){var w;return this[0]&&(L.isFunction(p)&&(p=p.call(this[0])),w=L(p,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&w.insertBefore(this[0]),w.map(function(){for(var T=this;T.firstElementChild;)T=T.firstElementChild;return T}).append(this)),this},wrapInner:function(p){return L.isFunction(p)?this.each(function(w){L(this).wrapInner(p.call(this,w))}):this.each(function(){var w=L(this),T=w.contents();T.length?T.wrapAll(p):w.append(p)})},wrap:function(p){var w=L.isFunction(p);return this.each(function(T){L(this).wrapAll(w?p.call(this,T):p)})},unwrap:function(p){return this.parent(p).not("body").each(function(){L(this).replaceWith(this.childNodes)}),this}}),L.expr.pseudos.hidden=function(p){return!L.expr.pseudos.visible(p)},L.expr.pseudos.visible=function(p){return!!(p.offsetWidth||p.offsetHeight||p.getClientRects().length)},L.ajaxSettings.xhr=function(){try{return new z.XMLHttpRequest}catch{}};var Tr={0:200,1223:204},rr=L.ajaxSettings.xhr();Kt.cors=!!rr&&"withCredentials"in rr,Kt.ajax=rr=!!rr,L.ajaxTransport(function(p){var w,T;if(Kt.cors||rr&&!p.crossDomain)return{send:function(D,H){var U,q=p.xhr();if(q.open(p.type,p.url,p.async,p.username,p.password),p.xhrFields)for(U in p.xhrFields)q[U]=p.xhrFields[U];p.mimeType&&q.overrideMimeType&&q.overrideMimeType(p.mimeType),!p.crossDomain&&!D["X-Requested-With"]&&(D["X-Requested-With"]="XMLHttpRequest");for(U in D)q.setRequestHeader(U,D[U]);w=function(me){return function(){w&&(w=T=q.onload=q.onerror=q.onabort=q.onreadystatechange=null,me==="abort"?q.abort():me==="error"?typeof q.status!="number"?H(0,"error"):H(q.status,q.statusText):H(Tr[q.status]||q.status,q.statusText,(q.responseType||"text")!=="text"||typeof q.responseText!="string"?{binary:q.response}:{text:q.responseText},q.getAllResponseHeaders()))}},q.onload=w(),T=q.onerror=w("error"),q.onabort!==void 0?q.onabort=T:q.onreadystatechange=function(){q.readyState===4&&z.setTimeout(function(){w&&T()})},w=w("abort");try{q.send(p.hasContent&&p.data||null)}catch(me){if(w)throw me}},abort:function(){w&&w()}}}),L.ajaxPrefilter(function(p){p.crossDomain&&(p.contents.script=!1)}),L.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(p){return L.globalEval(p),p}}}),L.ajaxPrefilter("script",function(p){p.cache===void 0&&(p.cache=!1),p.crossDomain&&(p.type="GET")}),L.ajaxTransport("script",function(p){if(p.crossDomain){var w,T;return{send:function(D,H){w=L("<script>").prop({charset:p.scriptCharset,src:p.url}).on("load error",T=function(U){w.remove(),T=null,U&&H(U.type==="error"?404:200,U.type)}),st.head.appendChild(w[0])},abort:function(){T&&T()}}}});var or=[],Os=/(=)\?(?=&|$)|\?\?/;L.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var p=or.pop()||L.expando+"_"+Er++;return this[p]=!0,p}}),L.ajaxPrefilter("json jsonp",function(p,w,T){var D,H,U,q=p.jsonp!==!1&&(Os.test(p.url)?"url":typeof p.data=="string"&&(p.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Os.test(p.data)&&"data");if(q||p.dataTypes[0]==="jsonp")return D=p.jsonpCallback=L.isFunction(p.jsonpCallback)?p.jsonpCallback():p.jsonpCallback,q?p[q]=p[q].replace(Os,"$1"+D):p.jsonp!==!1&&(p.url+=(nr.test(p.url)?"&":"?")+p.jsonp+"="+D),p.converters["script json"]=function(){return U||L.error(D+" was not called"),U[0]},p.dataTypes[0]="json",H=z[D],z[D]=function(){U=arguments},T.always(function(){H===void 0?L(z).removeProp(D):z[D]=H,p[D]&&(p.jsonpCallback=w.jsonpCallback,or.push(D)),U&&L.isFunction(H)&&H(U[0]),U=H=void 0}),"script"}),Kt.createHTMLDocument=function(){var p=st.implementation.createHTMLDocument("").body;return p.innerHTML="<form></form><form></form>",p.childNodes.length===2}(),L.parseHTML=function(p,w,T){if(typeof p!="string")return[];typeof w=="boolean"&&(T=w,w=!1);var D,H,U;return w||(Kt.createHTMLDocument?(w=st.implementation.createHTMLDocument(""),D=w.createElement("base"),D.href=st.location.href,w.head.appendChild(D)):w=st),H=nn.exec(p),U=!T&&[],H?[w.createElement(H[1])]:(H=Yr([p],w,U),U&&U.length&&L(U).remove(),L.merge([],H.childNodes))},L.fn.load=function(p,w,T){var D,H,U,q=this,me=p.indexOf(" ");return me>-1&&(D=tr(p.slice(me)),p=p.slice(0,me)),L.isFunction(w)?(T=w,w=void 0):w&&typeof w=="object"&&(H="POST"),q.length>0&&L.ajax({url:p,type:H||"GET",dataType:"html",data:w}).done(function(_e){U=arguments,q.html(D?L("<div>").append(L.parseHTML(_e)).find(D):_e)}).always(T&&function(_e,Ce){q.each(function(){T.apply(this,U||[_e.responseText,Ce,_e])})}),this},L.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(p,w){L.fn[w]=function(T){return this.on(w,T)}}),L.expr.pseudos.animated=function(p){return L.grep(L.timers,function(w){return p===w.elem}).length};function no(p){return L.isWindow(p)?p:p.nodeType===9&&p.defaultView}L.offset={setOffset:function(p,w,T){var D,H,U,q,me,_e,Ce,ze=L.css(p,"position"),Ke=L(p),Re={};ze==="static"&&(p.style.position="relative"),me=Ke.offset(),U=L.css(p,"top"),_e=L.css(p,"left"),Ce=(ze==="absolute"||ze==="fixed")&&(U+_e).indexOf("auto")>-1,Ce?(D=Ke.position(),q=D.top,H=D.left):(q=parseFloat(U)||0,H=parseFloat(_e)||0),L.isFunction(w)&&(w=w.call(p,T,L.extend({},me))),w.top!=null&&(Re.top=w.top-me.top+q),w.left!=null&&(Re.left=w.left-me.left+H),"using"in w?w.using.call(p,Re):Ke.css(Re)}},L.fn.extend({offset:function(p){if(arguments.length)return p===void 0?this:this.each(function(q){L.offset.setOffset(this,p,q)});var w,T,D,H,U=this[0];if(U)return U.getClientRects().length?(D=U.getBoundingClientRect(),D.width||D.height?(H=U.ownerDocument,T=no(H),w=H.documentElement,{top:D.top+T.pageYOffset-w.clientTop,left:D.left+T.pageXOffset-w.clientLeft}):D):{top:0,left:0}},position:function(){if(this[0]){var p,w,T=this[0],D={top:0,left:0};return L.css(T,"position")==="fixed"?w=T.getBoundingClientRect():(p=this.offsetParent(),w=this.offset(),L.nodeName(p[0],"html")||(D=p.offset()),D={top:D.top+L.css(p[0],"borderTopWidth",!0),left:D.left+L.css(p[0],"borderLeftWidth",!0)}),{top:w.top-D.top-L.css(T,"marginTop",!0),left:w.left-D.left-L.css(T,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var p=this.offsetParent;p&&L.css(p,"position")==="static";)p=p.offsetParent;return p||Zr})}}),L.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(p,w){var T=w==="pageYOffset";L.fn[p]=function(D){return kn(this,function(H,U,q){var me=no(H);if(q===void 0)return me?me[w]:H[U];me?me.scrollTo(T?me.pageXOffset:q,T?q:me.pageYOffset):H[U]=q},p,D,arguments.length)}}),L.each(["top","left"],function(p,w){L.cssHooks[w]=Ks(Kt.pixelPosition,function(T,D){if(D)return D=Zi(T,w),Yi.test(D)?L(T).position()[w]+"px":D})}),L.each({Height:"height",Width:"width"},function(p,w){L.each({padding:"inner"+p,content:w,"":"outer"+p},function(T,D){L.fn[D]=function(H,U){var q=arguments.length&&(T||typeof H!="boolean"),me=T||(H===!0||U===!0?"margin":"border");return kn(this,function(_e,Ce,ze){var Ke;return L.isWindow(_e)?D.indexOf("outer")===0?_e["inner"+p]:_e.document.documentElement["client"+p]:_e.nodeType===9?(Ke=_e.documentElement,Math.max(_e.body["scroll"+p],Ke["scroll"+p],_e.body["offset"+p],Ke["offset"+p],Ke["client"+p])):ze===void 0?L.css(_e,Ce,me):L.style(_e,Ce,ze,me)},w,q?H:void 0,q)}})}),L.fn.extend({bind:function(p,w,T){return this.on(p,null,w,T)},unbind:function(p,w){return this.off(p,null,w)},delegate:function(p,w,T,D){return this.on(w,p,T,D)},undelegate:function(p,w,T){return arguments.length===1?this.off(p,"**"):this.off(w,p||"**",T)}}),L.parseJSON=JSON.parse,typeof define=="function"&&define.amd&&define("jquery",[],function(){return L});var Da=z.jQuery,pl=z.$;return L.noConflict=function(p){return z.$===L&&(z.$=pl),p&&z.jQuery===L&&(z.jQuery=Da),L},Ne||(z.jQuery=z.$=L),L}),function(z,Ne){typeof exports=="object"&&typeof module<"u"?Ne(exports):typeof define=="function"&&define.amd?define(["exports"],Ne):(z=z||self,Ne(z.Potree={}))}(this,function(z){"use strict";class Ne{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){let s=this._listeners[e];if(s!==void 0){let r=s.indexOf(t);r!==-1&&s.splice(r,1)}}removeEventListeners(e){this._listeners[e]!==void 0&&delete this._listeners[e]}dispatchEvent(e){let n=this._listeners[e.type];if(n!==void 0){e.target=this;for(let s of n.slice(0))s.call(this,e)}}}class Ve extends Ne{constructor(e={}){super(),this.icon=e.icon||"",this.tooltip=e.tooltip,e.onclick!==void 0&&(this.onclick=e.onclick)}onclick(e){}pairWith(e){}setIcon(e){let t=this.icon;e!==t&&(this.icon=e,this.dispatchEvent({type:"icon_changed",action:this,icon:e,oldIcon:t}))}}const st="124",Et={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},pi={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Ni=0,An=1,fn=2,As=3,Cs=0,Nn=1,$r=2,Ds=3,Kt=0,qt=1,Xi=2,L=1,qr=2,cn=0,Ps=1,Ht=2,Vt=3,pn=4,Cn=5,mn=100,On=101,nn=102,hs=103,ds=104,Xr=200,ga=201,sl=202,Do=203,va=204,Po=205,Dn=206,ya=207,Xs=208,vr=209,xa=210,cc=0,Lo=1,fs=2,kn=3,Ro=4,Ls=5,Bt=6,gn=7,Jn=0,Ys=1,uc=2,ps=0,yr=1,Qe=2,Zs=3,Io=4,rl=5,pt=300,ki=301,Wn=302,Yt=303,xr=304,xi=306,ji=307,vi=1e3,li=1001,Kn=1002,ei=1003,Yr=1004,Zr=1004,Pn=1005,Jr=1005,et=1006,sn=1007,Qn=1007,Rs=1008,wr=1008,ms=1009,al=1010,Ot=1011,Kr=1012,zi=1013,es=1014,vn=1015,br=1016,wa=1017,ba=1018,Is=1019,Js=1020,Fo=1021,Yi=1022,jt=1023,Zi=1024,Ks=1025,Qr=jt,Qs=1026,Fs=1027,_a=1028,eo=1029,Ma=1030,ll=1031,Ea=1032,Bo=1033,Ji=33776,Bs=33777,$n=33778,Sa=33779,No=35840,_r=35841,Ns=35842,er=35843,Ta=36196,Oo=37492,cl=37496,Ln=37808,ul=37809,to=37810,hc=37811,dc=37812,tr=37813,ir=37814,un=37815,Mr=37816,gs=37817,Er=37818,nr=37819,Sr=37820,sr=37821,ko=36492,fc=37840,ts=37841,pc=37842,mc=37843,gc=37844,vc=37845,yc=37846,xc=37847,wc=37848,vs=37849,Aa=37850,hl=37851,Ca=37852,dl=37853,fl=2200,zo=2201,bc=2202,io=2300,Tr=2301,rr=2302,or=2400,Os=2401,no=2402,Da=2500,pl=2501,p=0,w=1,T=2,D=3e3,H=3001,U=3007,q=3002,me=3003,_e=3004,Ce=3005,ze=3006,Ke=3200,Re=3201,$e=0,Pt=1,g=0,b=7680,C=7681,G=7682,k=7683,Z=34055,j=34056,ee=5386,re=512,ue=513,Pe=514,De=515,Ge=516,ht=517,Xe=518,dt=519,Ft=35044,yt=35048,wi=35040,Gt=35045,Ui=35049,zt=35041,Mi=35046,ks=35050,ys=35042,ar="100",is="300 es";function Rn(){}Object.assign(Rn.prototype,{addEventListener:function(i,e){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[i]===void 0&&(t[i]=[]),t[i].indexOf(e)===-1&&t[i].push(e)},hasEventListener:function(i,e){if(this._listeners===void 0)return!1;const t=this._listeners;return t[i]!==void 0&&t[i].indexOf(e)!==-1},removeEventListener:function(i,e){if(this._listeners===void 0)return;const n=this._listeners[i];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}},dispatchEvent:function(i){if(this._listeners===void 0)return;const t=this._listeners[i.type];if(t!==void 0){i.target=this;const n=t.slice(0);for(let s=0,r=n.length;s<r;s++)n[s].call(this,i)}}});const di=[];for(let i=0;i<256;i++)di[i]=(i<16?"0":"")+i.toString(16);let ml=1234567;const rt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(di[i&255]+di[i>>8&255]+di[i>>16&255]+di[i>>24&255]+"-"+di[e&255]+di[e>>8&255]+"-"+di[e>>16&15|64]+di[e>>24&255]+"-"+di[t&63|128]+di[t>>8&255]+"-"+di[t>>16&255]+di[t>>24&255]+di[n&255]+di[n>>8&255]+di[n>>16&255]+di[n>>24&255]).toUpperCase()},clamp:function(i,e,t){return Math.max(e,Math.min(t,i))},euclideanModulo:function(i,e){return(i%e+e)%e},mapLinear:function(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)},lerp:function(i,e,t){return(1-t)*i+t*e},smoothstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))},smootherstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(ml=i%2147483647),ml=ml*16807%2147483647,(ml-1)/2147483646},degToRad:function(i){return i*rt.DEG2RAD},radToDeg:function(i){return i*rt.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)===0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,t,n,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+n)/2),u=o((e+n)/2),h=r((e-n)/2),d=o((e-n)/2),f=r((n-e)/2),m=o((n-e)/2);switch(s){case"XYX":i.set(a*u,l*h,l*d,a*c);break;case"YZY":i.set(l*d,a*u,l*h,a*c);break;case"ZXZ":i.set(l*h,l*d,a*u,a*c);break;case"XZX":i.set(a*u,l*m,l*f,a*c);break;case"YXY":i.set(l*f,a*u,l*m,a*c);break;case"ZYZ":i.set(l*m,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}};class Se{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*s+e.x,this.y=r*s+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class rn{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,r,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return new this.constructor().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],f=n[5],m=n[8],v=s[0],_=s[3],y=s[6],x=s[1],R=s[4],I=s[7],B=s[2],N=s[5],J=s[8];return r[0]=o*v+a*x+l*B,r[3]=o*_+a*R+l*N,r[6]=o*y+a*I+l*J,r[1]=c*v+u*x+h*B,r[4]=c*_+u*R+h*N,r[7]=c*y+u*I+h*J,r[2]=d*v+f*x+m*B,r[5]=d*_+f*R+m*N,r[8]=d*y+f*I+m*J,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*r*u+n*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*r,f=c*r-o*l,m=t*h+n*d+s*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return e[0]=h*v,e[1]=(s*c-u*n)*v,e[2]=(a*n-s*o)*v,e[3]=d*v,e[4]=(u*t-s*l)*v,e[5]=(s*r-a*t)*v,e[6]=f*v,e[7]=(n*l-c*t)*v,e[8]=(o*t-n*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),s=this.elements,r=s[0],o=s[3],a=s[6],l=s[1],c=s[4],u=s[7];return s[0]=t*r+n*l,s[3]=t*o+n*c,s[6]=t*a+n*u,s[1]=-n*r+t*l,s[4]=-n*o+t*c,s[7]=-n*a+t*u,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}let Uo;const Go={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let e;if(i instanceof HTMLCanvasElement)e=i;else{Uo===void 0&&(Uo=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Uo.width=i.width,Uo.height=i.height;const t=Uo.getContext("2d");i instanceof ImageData?t.putImageData(i,0,0):t.drawImage(i,0,0,i.width,i.height),e=Uo}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let Pa=0;function oi(i=oi.DEFAULT_IMAGE,e=oi.DEFAULT_MAPPING,t=li,n=li,s=et,r=Rs,o=jt,a=ms,l=1,c=D){Object.defineProperty(this,"id",{value:Pa++}),this.uuid=rt.generateUUID(),this.name="",this.image=i,this.mipmaps=[],this.mapping=e,this.wrapS=t,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Se(0,0),this.repeat=new Se(1,1),this.center=new Se(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}oi.DEFAULT_IMAGE=void 0,oi.DEFAULT_MAPPING=pt,oi.prototype=Object.assign(Object.create(Rn.prototype),{constructor:oi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.name=i.name,this.image=i.image,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this},toJSON:function(i){const e=i===void 0||typeof i=="string";if(!e&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const t={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const n=this.image;if(n.uuid===void 0&&(n.uuid=rt.generateUUID()),!e&&i.images[n.uuid]===void 0){let s;if(Array.isArray(n)){s=[];for(let r=0,o=n.length;r<o;r++)n[r].isDataTexture?s.push(La(n[r].image)):s.push(La(n[r]))}else s=La(n);i.images[n.uuid]={uuid:n.uuid,url:s}}t.image=n.uuid}return e||(i.textures[this.uuid]=t),t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(i){if(this.mapping!==pt)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case vi:i.x=i.x-Math.floor(i.x);break;case li:i.x=i.x<0?0:1;break;case Kn:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x);break}if(i.y<0||i.y>1)switch(this.wrapT){case vi:i.y=i.y-Math.floor(i.y);break;case li:i.y=i.y<0?0:1;break;case Kn:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y);break}return this.flipY&&(i.y=1-i.y),i}}),Object.defineProperty(oi.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});function La(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Go.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class _t{constructor(e=0,t=0,n=0,s=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],m=l[9],v=l[2],_=l[6],y=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(m-_)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(m+_)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(c+1)/2,I=(f+1)/2,B=(y+1)/2,N=(u+d)/4,J=(h+v)/4,ne=(m+_)/4;return R>I&&R>B?R<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(R),s=N/n,r=J/n):I>B?I<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(I),n=N/s,r=ne/s):B<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(B),n=J/r,s=ne/r),this.set(n,s,r,t),this}let x=Math.sqrt((_-m)*(_-m)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(_-m)/x,this.y=(h-v)/x,this.z=(d-u)/x,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function bi(i,e,t){this.width=i,this.height=e,this.scissor=new _t(0,0,i,e),this.scissorTest=!1,this.viewport=new _t(0,0,i,e),t=t||{},this.texture=new oi(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.image={},this.texture.image.width=i,this.texture.image.height=e,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:et,this.depthBuffer=t.depthBuffer!==void 0?t.depthBuffer:!0,this.stencilBuffer=t.stencilBuffer!==void 0?t.stencilBuffer:!1,this.depthTexture=t.depthTexture!==void 0?t.depthTexture:null}bi.prototype=Object.assign(Object.create(Rn.prototype),{constructor:bi,isWebGLRenderTarget:!0,setSize:function(i,e){(this.width!==i||this.height!==e)&&(this.width=i,this.height=e,this.texture.image.width=i,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,i,e),this.scissor.set(0,0,i,e)},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.width=i.width,this.height=i.height,this.viewport.copy(i.viewport),this.texture=i.texture.clone(),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function _c(i,e,t){bi.call(this,i,e,t),this.samples=4}_c.prototype=Object.assign(Object.create(bi.prototype),{constructor:_c,isWebGLMultisampleRenderTarget:!0,copy:function(i){return bi.prototype.copy.call(this,i),this.samples=i.samples,this}});class Ei{constructor(e=0,t=0,n=0,s=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=s}static slerp(e,t,n,s){return n.copy(e).slerp(t,s)}static slerpFlat(e,t,n,s,r,o,a){let l=n[s+0],c=n[s+1],u=n[s+2],h=n[s+3];const d=r[o+0],f=r[o+1],m=r[o+2],v=r[o+3];if(h!==v||l!==d||c!==f||u!==m){let _=1-a;const y=l*d+c*f+u*m+h*v,x=y>=0?1:-1,R=1-y*y;if(R>Number.EPSILON){const B=Math.sqrt(R),N=Math.atan2(B,y*x);_=Math.sin(_*N)/B,a=Math.sin(a*N)/B}const I=a*x;if(l=l*_+d*I,c=c*_+f*I,u=u*_+m*I,h=h*_+v*I,_===1-a){const B=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=B,c*=B,u*=B,h*=B}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,s,r,o){const a=n[s],l=n[s+1],c=n[s+2],u=n[s+3],h=r[o],d=r[o+1],f=r[o+2],m=r[o+3];return e[t]=a*m+u*h+l*f-c*d,e[t+1]=l*m+u*d+c*h-a*f,e[t+2]=c*m+u*f+a*d-l*h,e[t+3]=u*m-a*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(s/2),h=a(r/2),d=l(n/2),f=l(s/2),m=l(r/2);switch(o){case"XYZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"YXZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"ZXY":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"ZYX":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"YZX":this._x=d*u*h+c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h-d*f*m;break;case"XZY":this._x=d*u*h-c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(o-s)*f}else if(n>a&&n>h){const f=2*Math.sqrt(1+n-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(r+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-n-h);this._w=(r-c)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-n-a);this._w=(o-s)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<1e-6?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(rt.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+s*c-r*l,this._y=s*u+o*l+r*a-n*c,this._z=r*u+o*c+n*l-s*a,this._w=o*u-n*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*s+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=s*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class S{constructor(e=0,t=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_i.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_i.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*n,u=l*n+a*t-r*s,h=l*s+r*n-o*t,d=-r*t-o*n-a*s;return this.x=c*l+d*-r+u*-a-h*-o,this.y=u*l+d*-o+h*-r-c*-a,this.z=h*l+d*-a+c*-o-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-n*l,this.z=n*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Mc.copy(this).projectOnVector(e),this.sub(Mc)}reflect(e){return this.sub(Mc.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(rt.clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Mc=new S,_i=new Ei;class Wt{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=e!==void 0?e:new S(1/0,1/0,1/0),this.max=t!==void 0?t:new S(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],h=e[l+1],d=e[l+2];u<t&&(t=u),h<n&&(n=h),d<s&&(s=d),u>r&&(r=u),h>o&&(o=h),d>a&&(a=d)}return this.min.set(t,n,s),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),h=e.getY(l),d=e.getZ(l);u<t&&(t=u),h<n&&(n=h),d<s&&(s=d),u>r&&(r=u),h>o&&(o=h),d>a&&(a=d)}return this.min.set(t,n,s),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=so.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new S),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new S),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),gl.copy(t.boundingBox),gl.applyMatrix4(e.matrixWorld),this.union(gl));const n=e.children;for(let s=0,r=n.length;s<r;s++)this.expandByObject(n[s]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new S),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,so),so.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Cr),oo.subVectors(this.max,Cr),Ho.subVectors(e.a,Cr),Vo.subVectors(e.b,Cr),ro.subVectors(e.c,Cr),zn.subVectors(Vo,Ho),zs.subVectors(ro,Vo),Ar.subVectors(Ho,ro);let t=[0,-zn.z,zn.y,0,-zs.z,zs.y,0,-Ar.z,Ar.y,zn.z,0,-zn.x,zs.z,0,-zs.x,Ar.z,0,-Ar.x,-zn.y,zn.x,0,-zs.y,zs.x,0,-Ar.y,Ar.x,0];return!qn(t,Ho,Vo,ro,oo)||(t=[1,0,0,0,1,0,0,0,1],!qn(t,Ho,Vo,ro,oo))?!1:(jo.crossVectors(zn,zs),t=[jo.x,jo.y,jo.z],qn(t,Ho,Vo,ro,oo))}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new S),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return so.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(so).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(on[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),on[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),on[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),on[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),on[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),on[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),on[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),on[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(on),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function qn(i,e,t,n,s){for(let r=0,o=i.length-3;r<=o;r+=3){ao.fromArray(i,r);const a=s.x*Math.abs(ao.x)+s.y*Math.abs(ao.y)+s.z*Math.abs(ao.z),l=e.dot(ao),c=t.dot(ao),u=n.dot(ao);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const on=[new S,new S,new S,new S,new S,new S,new S,new S],so=new S,gl=new Wt,Ho=new S,Vo=new S,ro=new S,zn=new S,zs=new S,Ar=new S,Cr=new S,oo=new S,jo=new S,ao=new S,vl=new Wt;class fi{constructor(e,t){this.center=e!==void 0?e:new S,this.radius=t!==void 0?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):vl.setFromPoints(e).getCenter(n);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new S),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Wt),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const xs=new S,Ec=new S,te=new S,de=new S,be=new S,Oe=new S,Te=new S;class We{constructor(e,t){this.origin=e!==void 0?e:new S,this.direction=t!==void 0?t:new S(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return new this.constructor().copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new S),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xs)),this}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new S),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=xs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(xs.copy(this.direction).multiplyScalar(t).add(this.origin),xs.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Ec.copy(e).add(t).multiplyScalar(.5),te.copy(t).sub(e).normalize(),de.copy(this.origin).sub(Ec);const r=e.distanceTo(t)*.5,o=-this.direction.dot(te),a=de.dot(this.direction),l=-de.dot(te),c=de.lengthSq(),u=Math.abs(1-o*o);let h,d,f,m;if(u>0)if(h=o*l-a,d=o*a-l,m=r*u,h>=0)if(d>=-m)if(d<=m){const v=1/u;h*=v,d*=v,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=r,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d=-r,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d<=-m?(h=Math.max(0,-(-o*r+a)),d=h>0?-r:Math.min(Math.max(-r,-l),r),f=-h*h+d*(d+2*l)+c):d<=m?(h=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+c):(h=Math.max(0,-(o*r+a)),d=h>0?r:Math.min(Math.max(-r,-l),r),f=-h*h+d*(d+2*l)+c);else d=o>0?-r:r,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),s&&s.copy(te).multiplyScalar(d).add(Ec),f}intersectSphere(e,t){xs.subVectors(e.center,this.origin);const n=xs.dot(this.direction),s=xs.dot(xs)-n*n,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=n-o,l=n+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),u>=0?(r=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(r=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||r>s||((r>n||n!==n)&&(n=r),(o<s||s!==s)&&(s=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>s)||((a>n||n!==n)&&(n=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,xs)!==null}intersectTriangle(e,t,n,s,r){be.subVectors(t,e),Oe.subVectors(n,e),Te.crossVectors(be,Oe);let o=this.direction.dot(Te),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;de.subVectors(this.origin,e);const l=a*this.direction.dot(Oe.crossVectors(de,Oe));if(l<0)return null;const c=a*this.direction.dot(be.cross(de));if(c<0||l+c>o)return null;const u=-a*de.dot(Te);return u<0?null:this.at(u/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class xe{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,r,o,a,l,c,u,h,d,f,m,v,_){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=s,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=h,y[14]=d,y[3]=f,y[7]=m,y[11]=v,y[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xe().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/ct.setFromMatrixColumn(e,0).length(),r=1/ct.setFromMatrixColumn(e,1).length(),o=1/ct.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,s=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),h=Math.sin(r);if(e.order==="XYZ"){const d=o*u,f=o*h,m=a*u,v=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+m*c,t[5]=d-v*c,t[9]=-a*l,t[2]=v-d*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,m=c*u,v=c*h;t[0]=d+v*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-m,t[6]=v+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,m=c*u,v=c*h;t[0]=d-v*a,t[4]=-o*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*u,t[9]=v-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*u,f=o*h,m=a*u,v=a*h;t[0]=l*u,t[4]=m*c-f,t[8]=d*c+v,t[1]=l*h,t[5]=v*c+d,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,m=a*l,v=a*c;t[0]=l*u,t[4]=v-d*h,t[8]=m*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*h+m,t[10]=d-v*h}else if(e.order==="XZY"){const d=o*l,f=o*c,m=a*l,v=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+v,t[5]=o*u,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*u,t[10]=v*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(It,e,Ct)}lookAt(e,t,n){const s=this.elements;return Zt.subVectors(e,t),Zt.lengthSq()===0&&(Zt.z=1),Zt.normalize(),Tt.crossVectors(n,Zt),Tt.lengthSq()===0&&(Math.abs(n.z)===1?Zt.x+=1e-4:Zt.z+=1e-4,Zt.normalize(),Tt.crossVectors(n,Zt)),Tt.normalize(),Xt.crossVectors(Zt,Tt),s[0]=Tt.x,s[4]=Xt.x,s[8]=Zt.x,s[1]=Tt.y,s[5]=Xt.y,s[9]=Zt.y,s[2]=Tt.z,s[6]=Xt.z,s[10]=Zt.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],f=n[13],m=n[2],v=n[6],_=n[10],y=n[14],x=n[3],R=n[7],I=n[11],B=n[15],N=s[0],J=s[4],ne=s[8],se=s[12],E=s[1],M=s[5],A=s[9],F=s[13],P=s[2],O=s[6],V=s[10],W=s[14],fe=s[3],ve=s[7],pe=s[11],Me=s[15];return r[0]=o*N+a*E+l*P+c*fe,r[4]=o*J+a*M+l*O+c*ve,r[8]=o*ne+a*A+l*V+c*pe,r[12]=o*se+a*F+l*W+c*Me,r[1]=u*N+h*E+d*P+f*fe,r[5]=u*J+h*M+d*O+f*ve,r[9]=u*ne+h*A+d*V+f*pe,r[13]=u*se+h*F+d*W+f*Me,r[2]=m*N+v*E+_*P+y*fe,r[6]=m*J+v*M+_*O+y*ve,r[10]=m*ne+v*A+_*V+y*pe,r[14]=m*se+v*F+_*W+y*Me,r[3]=x*N+R*E+I*P+B*fe,r[7]=x*J+R*M+I*O+B*ve,r[11]=x*ne+R*A+I*V+B*pe,r[15]=x*se+R*F+I*W+B*Me,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],m=e[3],v=e[7],_=e[11],y=e[15];return m*(+r*l*h-s*c*h-r*a*d+n*c*d+s*a*f-n*l*f)+v*(+t*l*f-t*c*d+r*o*d-s*o*f+s*c*u-r*l*u)+_*(+t*c*h-t*a*f-r*o*h+n*o*f+r*a*u-n*c*u)+y*(-s*a*u-t*l*h+t*a*d+s*o*h-n*o*d+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],m=e[12],v=e[13],_=e[14],y=e[15],x=h*_*c-v*d*c+v*l*f-a*_*f-h*l*y+a*d*y,R=m*d*c-u*_*c-m*l*f+o*_*f+u*l*y-o*d*y,I=u*v*c-m*h*c+m*a*f-o*v*f-u*a*y+o*h*y,B=m*h*l-u*v*l-m*a*d+o*v*d+u*a*_-o*h*_,N=t*x+n*R+s*I+r*B;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const J=1/N;return e[0]=x*J,e[1]=(v*d*r-h*_*r-v*s*f+n*_*f+h*s*y-n*d*y)*J,e[2]=(a*_*r-v*l*r+v*s*c-n*_*c-a*s*y+n*l*y)*J,e[3]=(h*l*r-a*d*r-h*s*c+n*d*c+a*s*f-n*l*f)*J,e[4]=R*J,e[5]=(u*_*r-m*d*r+m*s*f-t*_*f-u*s*y+t*d*y)*J,e[6]=(m*l*r-o*_*r-m*s*c+t*_*c+o*s*y-t*l*y)*J,e[7]=(o*d*r-u*l*r+u*s*c-t*d*c-o*s*f+t*l*f)*J,e[8]=I*J,e[9]=(m*h*r-u*v*r-m*n*f+t*v*f+u*n*y-t*h*y)*J,e[10]=(o*v*r-m*a*r+m*n*c-t*v*c-o*n*y+t*a*y)*J,e[11]=(u*a*r-o*h*r-u*n*c+t*h*c+o*n*f-t*a*f)*J,e[12]=B*J,e[13]=(u*v*s-m*h*s+m*n*d-t*v*d-u*n*_+t*h*_)*J,e[14]=(m*a*s-o*v*s-m*n*l+t*v*l+o*n*_-t*a*_)*J,e[15]=(o*h*s-u*a*s+u*n*l-t*h*l-o*n*d+t*a*d)*J,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,o=e.x,a=e.y,l=e.z,c=r*o,u=r*a;return this.set(c*o+n,c*a-s*l,c*l+s*a,0,c*a+s*l,u*a+n,u*l-s*o,0,c*l-s*a,u*l+s*o,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,u=o+o,h=a+a,d=r*c,f=r*u,m=r*h,v=o*u,_=o*h,y=a*h,x=l*c,R=l*u,I=l*h,B=n.x,N=n.y,J=n.z;return s[0]=(1-(v+y))*B,s[1]=(f+I)*B,s[2]=(m-R)*B,s[3]=0,s[4]=(f-I)*N,s[5]=(1-(d+y))*N,s[6]=(_+x)*N,s[7]=0,s[8]=(m+R)*J,s[9]=(_-x)*J,s[10]=(1-(d+v))*J,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=ct.set(s[0],s[1],s[2]).length();const o=ct.set(s[4],s[5],s[6]).length(),a=ct.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],ut.copy(this);const c=1/r,u=1/o,h=1/a;return ut.elements[0]*=c,ut.elements[1]*=c,ut.elements[2]*=c,ut.elements[4]*=u,ut.elements[5]*=u,ut.elements[6]*=u,ut.elements[8]*=h,ut.elements[9]*=h,ut.elements[10]*=h,t.setFromRotationMatrix(ut),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,s,r,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,l=2*r/(t-e),c=2*r/(n-s),u=(t+e)/(t-e),h=(n+s)/(n-s),d=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,s,r,o){const a=this.elements,l=1/(t-e),c=1/(n-s),u=1/(o-r),h=(t+e)*l,d=(n+s)*c,f=(o+r)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ct=new S,ut=new xe,It=new S(0,0,0),Ct=new S(1,1,1),Tt=new S,Xt=new S,Zt=new S;class Mt{constructor(e=0,t=0,n=0,s=Mt.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._order=s||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const s=rt.clamp,r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],u=r[5],h=r[9],d=r[2],f=r[6],m=r[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(s(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-s(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(s(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-s(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(s(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-s(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n!==!1&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Wi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Wi,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return hn.setFromEuler(this),this.setFromQuaternion(hn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new S(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Mt.DefaultOrder="XYZ",Mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Wi=new xe,hn=new Ei;class Un{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let Ai=0;const Wo=new S,Us=new Ei,Gi=new xe,xu=new S,Sc=new S,o0=new S,a0=new Ei,Rf=new S(1,0,0),If=new S(0,1,0),Ff=new S(0,0,1),l0={type:"added"},Bf={type:"removed"};function qe(){Object.defineProperty(this,"id",{value:Ai++}),this.uuid=rt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qe.DefaultUp.clone();const i=new S,e=new Mt,t=new Ei,n=new S(1,1,1);function s(){t.setFromEuler(e,!1)}function r(){e.setFromQuaternion(t,void 0,!1)}e._onChange(s),t._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:t},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new xe},normalMatrix:{value:new rn}}),this.matrix=new xe,this.matrixWorld=new xe,this.matrixAutoUpdate=qe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Un,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}qe.DefaultUp=new S(0,1,0),qe.DefaultMatrixAutoUpdate=!0,qe.prototype=Object.assign(Object.create(Rn.prototype),{constructor:qe,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,e){this.quaternion.setFromAxisAngle(i,e)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,e){return Us.setFromAxisAngle(i,e),this.quaternion.multiply(Us),this},rotateOnWorldAxis:function(i,e){return Us.setFromAxisAngle(i,e),this.quaternion.premultiply(Us),this},rotateX:function(i){return this.rotateOnAxis(Rf,i)},rotateY:function(i){return this.rotateOnAxis(If,i)},rotateZ:function(i){return this.rotateOnAxis(Ff,i)},translateOnAxis:function(i,e){return Wo.copy(i).applyQuaternion(this.quaternion),this.position.add(Wo.multiplyScalar(e)),this},translateX:function(i){return this.translateOnAxis(Rf,i)},translateY:function(i){return this.translateOnAxis(If,i)},translateZ:function(i){return this.translateOnAxis(Ff,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Gi.copy(this.matrixWorld).invert())},lookAt:function(i,e,t){i.isVector3?xu.copy(i):xu.set(i,e,t);const n=this.parent;this.updateWorldMatrix(!0,!1),Sc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gi.lookAt(Sc,xu,this.up):Gi.lookAt(xu,Sc,this.up),this.quaternion.setFromRotationMatrix(Gi),n&&(Gi.extractRotation(n.matrixWorld),Us.setFromRotationMatrix(Gi),this.quaternion.premultiply(Us.invert()))},add:function(i){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(l0)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(i);return e!==-1&&(i.parent=null,this.children.splice(e,1),i.dispatchEvent(Bf)),this},clear:function(){for(let i=0;i<this.children.length;i++){const e=this.children[i];e.parent=null,e.dispatchEvent(Bf)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Gi.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Gi.multiply(i.parent.matrixWorld)),i.applyMatrix4(Gi),i.updateWorldMatrix(!1,!1),this.add(i),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,e){if(this[i]===e)return this;for(let t=0,n=this.children.length;t<n;t++){const r=this.children[t].getObjectByProperty(i,e);if(r!==void 0)return r}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new S),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new Ei),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sc,i,o0),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new S),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sc,a0,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new S),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(i){i(this);const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].traverse(i)},traverseVisible:function(i){if(this.visible===!1)return;i(this);const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].traverseVisible(i)},traverseAncestors:function(i){const e=this.parent;e!==null&&(i(e),e.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateMatrixWorld(i)},updateWorldMatrix:function(i,e){const t=this.parent;if(i===!0&&t!==null&&t.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].updateWorldMatrix(!1,!0)}},toJSON:function(i){const e=i===void 0||typeof i=="string",t={};e&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON());function s(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(i)),a.uuid}if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(i.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const a=o.shapes;if(Array.isArray(a))for(let l=0,c=a.length;l<c;l++){const u=a[l];s(i.shapes,u)}else s(i.shapes,a)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(i.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let a=0,l=this.material.length;a<l;a++)o.push(s(i.materials,this.material[a]));n.material=o}else n.material=s(i.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(i).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const a=this.animations[o];n.animations.push(s(i.animations,a))}}if(e){const o=r(i.geometries),a=r(i.materials),l=r(i.textures),c=r(i.images),u=r(i.shapes),h=r(i.skeletons),d=r(i.animations);o.length>0&&(t.geometries=o),a.length>0&&(t.materials=a),l.length>0&&(t.textures=l),c.length>0&&(t.images=c),u.length>0&&(t.shapes=u),h.length>0&&(t.skeletons=h),d.length>0&&(t.animations=d)}return t.object=n,t;function r(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,e=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),e===!0)for(let t=0;t<i.children.length;t++){const n=i.children[t];this.add(n.clone())}return this}});const Vh=new S,c0=new S,u0=new rn;class yi{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=e!==void 0?e:new S(1,0,0),this.constant=t!==void 0?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=Vh.subVectors(n,t).cross(c0.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}clone(){return new this.constructor().copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new S),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new S);const n=e.delta(Vh),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;const r=-(e.start.dot(this.normal)+this.constant)/s;if(!(r<0||r>1))return t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new S),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||u0.getNormalMatrix(e),s=this.coplanarPoint(Vh).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const lr=new S,lo=new S,jh=new S,co=new S,yl=new S,xl=new S,Nf=new S,Wh=new S,$h=new S,qh=new S;class Gn{constructor(e,t,n){this.a=e!==void 0?e:new S,this.b=t!==void 0?t:new S,this.c=n!==void 0?n:new S}static getNormal(e,t,n,s){s===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),s=new S),s.subVectors(n,t),lr.subVectors(e,t),s.cross(lr);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){lr.subVectors(s,t),lo.subVectors(n,t),jh.subVectors(e,t);const o=lr.dot(lr),a=lr.dot(lo),l=lr.dot(jh),c=lo.dot(lo),u=lo.dot(jh),h=o*c-a*a;if(r===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new S),h===0)return r.set(-2,-1,-1);const d=1/h,f=(c*l-a*u)*d,m=(o*u-a*l)*d;return r.set(1-f-m,m,f)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,co),co.x>=0&&co.y>=0&&co.x+co.y<=1}static getUV(e,t,n,s,r,o,a,l){return this.getBarycoord(e,t,n,s,co),l.set(0,0),l.addScaledVector(r,co.x),l.addScaledVector(o,co.y),l.addScaledVector(a,co.z),l}static isFrontFacing(e,t,n,s){return lr.subVectors(n,t),lo.subVectors(e,t),lr.cross(lo).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return lr.subVectors(this.c,this.b),lo.subVectors(this.a,this.b),lr.cross(lo).length()*.5}getMidpoint(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new S),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Gn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new yi),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Gn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,r){return Gn.getUV(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Gn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Gn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new S);const n=this.a,s=this.b,r=this.c;let o,a;yl.subVectors(s,n),xl.subVectors(r,n),Wh.subVectors(e,n);const l=yl.dot(Wh),c=xl.dot(Wh);if(l<=0&&c<=0)return t.copy(n);$h.subVectors(e,s);const u=yl.dot($h),h=xl.dot($h);if(u>=0&&h<=u)return t.copy(s);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(yl,o);qh.subVectors(e,r);const f=yl.dot(qh),m=xl.dot(qh);if(m>=0&&f<=m)return t.copy(r);const v=f*c-l*m;if(v<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(xl,a);const _=u*m-f*h;if(_<=0&&h-u>=0&&f-m>=0)return Nf.subVectors(r,s),a=(h-u)/(h-u+(f-m)),t.copy(s).addScaledVector(Nf,a);const y=1/(_+v+d);return o=v*y,a=d*y,t.copy(n).addScaledVector(yl,o).addScaledVector(xl,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Of={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cr={h:0,s:0,l:0},wu={h:0,s:0,l:0};function Xh(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function Yh(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Zh(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class Ee{constructor(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=rt.euclideanModulo(e,1),t=rt.clamp(t,0,1),n=rt.clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,r=2*n-s;this.r=Xh(r,s,e+1/3),this.g=Xh(r,s,e),this.b=Xh(r,s,e-1/3)}return this}setStyle(e){function t(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let s;const r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(s=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,t(s[4]),this;if(s=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,t(s[4]),this;break;case"hsl":case"hsla":if(s=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const a=parseFloat(s[1])/360,l=parseInt(s[2],10)/100,c=parseInt(s[3],10)/100;return t(s[4]),this.setHSL(a,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],r=s.length;if(r===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Of[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Yh(e.r),this.g=Yh(e.g),this.b=Yh(e.b),this}copyLinearToSRGB(e){return this.r=Zh(e.r),this.g=Zh(e.g),this.b=Zh(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,s=this.b,r=Math.max(t,n,s),o=Math.min(t,n,s);let a,l;const c=(o+r)/2;if(o===r)a=0,l=0;else{const u=r-o;switch(l=c<=.5?u/(r+o):u/(2-r-o),r){case t:a=(n-s)/u+(n<s?6:0);break;case n:a=(s-t)/u+2;break;case s:a=(t-n)/u+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(cr),cr.h+=e,cr.s+=t,cr.l+=n,this.setHSL(cr.h,cr.s,cr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpHSL(e,t){this.getHSL(cr),e.getHSL(wu);const n=rt.lerp(cr.h,wu.h,t),s=rt.lerp(cr.s,wu.s,t),r=rt.lerp(cr.l,wu.l,t);return this.setHSL(n,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ee.NAMES=Of,Ee.prototype.r=1,Ee.prototype.g=1,Ee.prototype.b=1;class bu{constructor(e,t,n,s,r,o=0){this.a=e,this.b=t,this.c=n,this.normal=s&&s.isVector3?s:new S,this.vertexNormals=Array.isArray(s)?s:[],this.color=r&&r.isColor?r:new Ee,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=o}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let h0=0;function Nt(){Object.defineProperty(this,"id",{value:h0++}),this.uuid=rt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=Ps,this.side=Kt,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=va,this.blendDst=Po,this.blendEquation=mn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=kn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=b,this.stencilZFail=b,this.stencilZPass=b,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Nt.prototype=Object.assign(Object.create(Rn.prototype),{constructor:Nt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(const e in i){const t=i[e];if(t===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===L;continue}const n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(t):n&&n.isVector3&&t&&t.isVector3?n.copy(t):this[e]=t}},toJSON:function(i){const e=i===void 0||typeof i=="string";e&&(i={textures:{},images:{}});const t={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.color&&this.color.isColor&&(t.color=this.color.getHex()),this.roughness!==void 0&&(t.roughness=this.roughness),this.metalness!==void 0&&(t.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(t.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(t.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(t.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(t.specular=this.specular.getHex()),this.shininess!==void 0&&(t.shininess=this.shininess),this.clearcoat!==void 0&&(t.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(t.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(t.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(t.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(t.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,t.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(t.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(t.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(t.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(t.lightMap=this.lightMap.toJSON(i).uuid),this.aoMap&&this.aoMap.isTexture&&(t.aoMap=this.aoMap.toJSON(i).uuid,t.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(t.bumpMap=this.bumpMap.toJSON(i).uuid,t.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(t.normalMap=this.normalMap.toJSON(i).uuid,t.normalMapType=this.normalMapType,t.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(t.displacementMap=this.displacementMap.toJSON(i).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(t.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(t.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(t.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(t.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(t.envMap=this.envMap.toJSON(i).uuid,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,this.combine!==void 0&&(t.combine=this.combine),this.envMapIntensity!==void 0&&(t.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(t.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(t.size=this.size),this.sizeAttenuation!==void 0&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==Ps&&(t.blending=this.blending),this.flatShading===!0&&(t.flatShading=this.flatShading),this.side!==Kt&&(t.side=this.side),this.vertexColors&&(t.vertexColors=!0),this.opacity<1&&(t.opacity=this.opacity),this.transparent===!0&&(t.transparent=this.transparent),t.depthFunc=this.depthFunc,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.stencilWrite=this.stencilWrite,t.stencilWriteMask=this.stencilWriteMask,t.stencilFunc=this.stencilFunc,t.stencilRef=this.stencilRef,t.stencilFuncMask=this.stencilFuncMask,t.stencilFail=this.stencilFail,t.stencilZFail=this.stencilZFail,t.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(t.rotation=this.rotation),this.polygonOffset===!0&&(t.polygonOffset=!0),this.polygonOffsetFactor!==0&&(t.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(t.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(t.linewidth=this.linewidth),this.dashSize!==void 0&&(t.dashSize=this.dashSize),this.gapSize!==void 0&&(t.gapSize=this.gapSize),this.scale!==void 0&&(t.scale=this.scale),this.dithering===!0&&(t.dithering=!0),this.alphaTest>0&&(t.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(t.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(t.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(t.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(t.morphTargets=!0),this.morphNormals===!0&&(t.morphNormals=!0),this.skinning===!0&&(t.skinning=!0),this.visible===!1&&(t.visible=!1),this.toneMapped===!1&&(t.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(t.userData=this.userData);function n(s){const r=[];for(const o in s){const a=s[o];delete a.metadata,r.push(a)}return r}if(e){const s=n(i.textures),r=n(i.images);s.length>0&&(t.textures=s),r.length>0&&(t.images=r)}return t},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.flatShading=i.flatShading,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const e=i.clippingPlanes;let t=null;if(e!==null){const n=e.length;t=new Array(n);for(let s=0;s!==n;++s)t[s]=e[s].clone()}return this.clippingPlanes=t,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Nt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});function Ut(i){Nt.call(this),this.type="MeshBasicMaterial",this.color=new Ee(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(i)}Ut.prototype=Object.create(Nt.prototype),Ut.prototype.constructor=Ut,Ut.prototype.isMeshBasicMaterial=!0,Ut.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this};const Ci=new S,_u=new Se;function tt(i,e,t){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=i,this.itemSize=e,this.count=i!==void 0?i.length/e:0,this.normalized=t===!0,this.usage=Ft,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(tt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(tt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,e,t){i*=this.itemSize,t*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[i+n]=e.array[t+n];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){const e=this.array;let t=0;for(let n=0,s=i.length;n<s;n++){let r=i[n];r===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Ee),e[t++]=r.r,e[t++]=r.g,e[t++]=r.b}return this},copyVector2sArray:function(i){const e=this.array;let t=0;for(let n=0,s=i.length;n<s;n++){let r=i[n];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Se),e[t++]=r.x,e[t++]=r.y}return this},copyVector3sArray:function(i){const e=this.array;let t=0;for(let n=0,s=i.length;n<s;n++){let r=i[n];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new S),e[t++]=r.x,e[t++]=r.y,e[t++]=r.z}return this},copyVector4sArray:function(i){const e=this.array;let t=0;for(let n=0,s=i.length;n<s;n++){let r=i[n];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new _t),e[t++]=r.x,e[t++]=r.y,e[t++]=r.z,e[t++]=r.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(let e=0,t=this.count;e<t;e++)_u.fromBufferAttribute(this,e),_u.applyMatrix3(i),this.setXY(e,_u.x,_u.y);else if(this.itemSize===3)for(let e=0,t=this.count;e<t;e++)Ci.fromBufferAttribute(this,e),Ci.applyMatrix3(i),this.setXYZ(e,Ci.x,Ci.y,Ci.z);return this},applyMatrix4:function(i){for(let e=0,t=this.count;e<t;e++)Ci.x=this.getX(e),Ci.y=this.getY(e),Ci.z=this.getZ(e),Ci.applyMatrix4(i),this.setXYZ(e,Ci.x,Ci.y,Ci.z);return this},applyNormalMatrix:function(i){for(let e=0,t=this.count;e<t;e++)Ci.x=this.getX(e),Ci.y=this.getY(e),Ci.z=this.getZ(e),Ci.applyNormalMatrix(i),this.setXYZ(e,Ci.x,Ci.y,Ci.z);return this},transformDirection:function(i){for(let e=0,t=this.count;e<t;e++)Ci.x=this.getX(e),Ci.y=this.getY(e),Ci.z=this.getZ(e),Ci.transformDirection(i),this.setXYZ(e,Ci.x,Ci.y,Ci.z);return this},set:function(i,e=0){return this.array.set(i,e),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,e){return this.array[i*this.itemSize]=e,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,e){return this.array[i*this.itemSize+1]=e,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,e){return this.array[i*this.itemSize+2]=e,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,e){return this.array[i*this.itemSize+3]=e,this},setXY:function(i,e,t){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=t,this},setXYZ:function(i,e,t,n){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=t,this.array[i+2]=n,this},setXYZW:function(i,e,t,n,s){return i*=this.itemSize,this.array[i+0]=e,this.array[i+1]=t,this.array[i+2]=n,this.array[i+3]=s,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Mu(i,e,t){tt.call(this,new Int8Array(i),e,t)}Mu.prototype=Object.create(tt.prototype),Mu.prototype.constructor=Mu;function Eu(i,e,t){tt.call(this,new Uint8Array(i),e,t)}Eu.prototype=Object.create(tt.prototype),Eu.prototype.constructor=Eu;function Su(i,e,t){tt.call(this,new Uint8ClampedArray(i),e,t)}Su.prototype=Object.create(tt.prototype),Su.prototype.constructor=Su;function Tu(i,e,t){tt.call(this,new Int16Array(i),e,t)}Tu.prototype=Object.create(tt.prototype),Tu.prototype.constructor=Tu;function Ra(i,e,t){tt.call(this,new Uint16Array(i),e,t)}Ra.prototype=Object.create(tt.prototype),Ra.prototype.constructor=Ra;function Au(i,e,t){tt.call(this,new Int32Array(i),e,t)}Au.prototype=Object.create(tt.prototype),Au.prototype.constructor=Au;function wl(i,e,t){tt.call(this,new Uint32Array(i),e,t)}wl.prototype=Object.create(tt.prototype),wl.prototype.constructor=wl;function Cu(i,e,t){tt.call(this,new Uint16Array(i),e,t)}Cu.prototype=Object.create(tt.prototype),Cu.prototype.constructor=Cu,Cu.prototype.isFloat16BufferAttribute=!0;function ft(i,e,t){tt.call(this,new Float32Array(i),e,t)}ft.prototype=Object.create(tt.prototype),ft.prototype.constructor=ft;function Du(i,e,t){tt.call(this,new Float64Array(i),e,t)}Du.prototype=Object.create(tt.prototype),Du.prototype.constructor=Du;class d0{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,s,r;const o=e.faces;for(s=0;s<o.length;s++){const a=o[s];a.materialIndex!==r&&(r=a.materialIndex,n!==void 0&&(n.count=s*3-n.start,t.push(n)),n={start:s*3,materialIndex:r})}n!==void 0&&(n.count=s*3-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,s=e.faceVertexUvs,r=s[0]&&s[0].length>0,o=s[1]&&s[1].length>0,a=e.morphTargets,l=a.length;let c;if(l>0){c=[];for(let y=0;y<l;y++)c[y]={name:a[y].name,data:[]};this.morphTargets.position=c}const u=e.morphNormals,h=u.length;let d;if(h>0){d=[];for(let y=0;y<h;y++)d[y]={name:u[y].name,data:[]};this.morphTargets.normal=d}const f=e.skinIndices,m=e.skinWeights,v=f.length===n.length,_=m.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let y=0;y<t.length;y++){const x=t[y];this.vertices.push(n[x.a],n[x.b],n[x.c]);const R=x.vertexNormals;if(R.length===3)this.normals.push(R[0],R[1],R[2]);else{const B=x.normal;this.normals.push(B,B,B)}const I=x.vertexColors;if(I.length===3)this.colors.push(I[0],I[1],I[2]);else{const B=x.color;this.colors.push(B,B,B)}if(r===!0){const B=s[0][y];B!==void 0?this.uvs.push(B[0],B[1],B[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new Se,new Se,new Se))}if(o===!0){const B=s[1][y];B!==void 0?this.uvs2.push(B[0],B[1],B[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new Se,new Se,new Se))}for(let B=0;B<l;B++){const N=a[B].vertices;c[B].data.push(N[x.a],N[x.b],N[x.c])}for(let B=0;B<h;B++){const N=u[B].vertexNormals[y];d[B].data.push(N.a,N.b,N.c)}v&&this.skinIndices.push(f[x.a],f[x.b],f[x.c]),_&&this.skinWeights.push(m[x.a],m[x.b],m[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}}function kf(i){if(i.length===0)return-1/0;let e=i[0];for(let t=1,n=i.length;t<n;++t)i[t]>e&&(e=i[t]);return e}const f0={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Tc(i,e){return new f0[i](e)}let p0=1;const Dr=new xe,Jh=new qe,bl=new S,ws=new Wt,Ac=new Wt,yn=new S;function wt(){Object.defineProperty(this,"id",{value:p0+=2}),this.uuid=rt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}wt.prototype=Object.assign(Object.create(Rn.prototype),{constructor:wt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(kf(i)>65535?wl:Ra)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,e){return this.attributes[i]=e,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,e,t=0){this.groups.push({start:i,count:e,materialIndex:t})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,e){this.drawRange.start=i,this.drawRange.count=e},applyMatrix4:function(i){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(i),e.needsUpdate=!0);const t=this.attributes.normal;if(t!==void 0){const s=new rn().getNormalMatrix(i);t.applyNormalMatrix(s),t.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(i),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return Dr.makeRotationX(i),this.applyMatrix4(Dr),this},rotateY:function(i){return Dr.makeRotationY(i),this.applyMatrix4(Dr),this},rotateZ:function(i){return Dr.makeRotationZ(i),this.applyMatrix4(Dr),this},translate:function(i,e,t){return Dr.makeTranslation(i,e,t),this.applyMatrix4(Dr),this},scale:function(i,e,t){return Dr.makeScale(i,e,t),this.applyMatrix4(Dr),this},lookAt:function(i){return Jh.lookAt(i),Jh.updateMatrix(),this.applyMatrix4(Jh.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(bl).negate(),this.translate(bl.x,bl.y,bl.z),this},setFromObject:function(i){const e=i.geometry;if(i.isPoints||i.isLine){const t=new ft(e.vertices.length*3,3),n=new ft(e.colors.length*3,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const s=new ft(e.lineDistances.length,1);this.setAttribute("lineDistance",s.copyArray(e.lineDistances))}e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone())}else i.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(i){const e=[];for(let t=0,n=i.length;t<n;t++){const s=i[t];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ft(e,3)),this},updateFromObject:function(i){let e=i.geometry;if(i.isMesh){let t=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(t=void 0,e.elementsNeedUpdate=!1),t===void 0)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(e.verticesNeedUpdate===!0){const t=this.attributes.position;t!==void 0&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(e.normalsNeedUpdate===!0){const t=this.attributes.normal;t!==void 0&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(e.colorsNeedUpdate===!0){const t=this.attributes.color;t!==void 0&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;t!==void 0&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;t!==void 0&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(i.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(i){return i.__directGeometry=new d0().fromGeometry(i),this.fromDirectGeometry(i.__directGeometry)},fromDirectGeometry:function(i){const e=new Float32Array(i.vertices.length*3);if(this.setAttribute("position",new tt(e,3).copyVector3sArray(i.vertices)),i.normals.length>0){const t=new Float32Array(i.normals.length*3);this.setAttribute("normal",new tt(t,3).copyVector3sArray(i.normals))}if(i.colors.length>0){const t=new Float32Array(i.colors.length*3);this.setAttribute("color",new tt(t,3).copyColorsArray(i.colors))}if(i.uvs.length>0){const t=new Float32Array(i.uvs.length*2);this.setAttribute("uv",new tt(t,2).copyVector2sArray(i.uvs))}if(i.uvs2.length>0){const t=new Float32Array(i.uvs2.length*2);this.setAttribute("uv2",new tt(t,2).copyVector2sArray(i.uvs2))}this.groups=i.groups;for(const t in i.morphTargets){const n=[],s=i.morphTargets[t];for(let r=0,o=s.length;r<o;r++){const a=s[r],l=new ft(a.data.length*3,3);l.name=a.name,n.push(l.copyVector3sArray(a.data))}this.morphAttributes[t]=n}if(i.skinIndices.length>0){const t=new ft(i.skinIndices.length*4,4);this.setAttribute("skinIndex",t.copyVector4sArray(i.skinIndices))}if(i.skinWeights.length>0){const t=new ft(i.skinWeights.length*4,4);this.setAttribute("skinWeight",t.copyVector4sArray(i.skinWeights))}return i.boundingSphere!==null&&(this.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(this.boundingBox=i.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Wt);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),e)for(let t=0,n=e.length;t<n;t++){const s=e[t];ws.setFromBufferAttribute(s),this.morphTargetsRelative?(yn.addVectors(this.boundingBox.min,ws.min),this.boundingBox.expandByPoint(yn),yn.addVectors(this.boundingBox.max,ws.max),this.boundingBox.expandByPoint(yn)):(this.boundingBox.expandByPoint(ws.min),this.boundingBox.expandByPoint(ws.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new fi);const i=this.attributes.position,e=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new S,1/0);return}if(i){const t=this.boundingSphere.center;if(ws.setFromBufferAttribute(i),e)for(let s=0,r=e.length;s<r;s++){const o=e[s];Ac.setFromBufferAttribute(o),this.morphTargetsRelative?(yn.addVectors(ws.min,Ac.min),ws.expandByPoint(yn),yn.addVectors(ws.max,Ac.max),ws.expandByPoint(yn)):(ws.expandByPoint(Ac.min),ws.expandByPoint(Ac.max))}ws.getCenter(t);let n=0;for(let s=0,r=i.count;s<r;s++)yn.fromBufferAttribute(i,s),n=Math.max(n,t.distanceToSquared(yn));if(e)for(let s=0,r=e.length;s<r;s++){const o=e[s],a=this.morphTargetsRelative;for(let l=0,c=o.count;l<c;l++)yn.fromBufferAttribute(o,l),a&&(bl.fromBufferAttribute(i,l),yn.add(bl)),n=Math.max(n,t.distanceToSquared(yn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const i=this.index,e=this.getAttribute("position");if(e!==void 0){let t=this.getAttribute("normal");if(t===void 0)t=new tt(new Float32Array(e.count*3),3),this.setAttribute("normal",t);else for(let h=0,d=t.count;h<d;h++)t.setXYZ(h,0,0,0);const n=new S,s=new S,r=new S,o=new S,a=new S,l=new S,c=new S,u=new S;if(i)for(let h=0,d=i.count;h<d;h+=3){const f=i.getX(h+0),m=i.getX(h+1),v=i.getX(h+2);n.fromBufferAttribute(e,f),s.fromBufferAttribute(e,m),r.fromBufferAttribute(e,v),c.subVectors(r,s),u.subVectors(n,s),c.cross(u),o.fromBufferAttribute(t,f),a.fromBufferAttribute(t,m),l.fromBufferAttribute(t,v),o.add(c),a.add(c),l.add(c),t.setXYZ(f,o.x,o.y,o.z),t.setXYZ(m,a.x,a.y,a.z),t.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,d=e.count;h<d;h+=3)n.fromBufferAttribute(e,h+0),s.fromBufferAttribute(e,h+1),r.fromBufferAttribute(e,h+2),c.subVectors(r,s),u.subVectors(n,s),c.cross(u),t.setXYZ(h+0,c.x,c.y,c.z),t.setXYZ(h+1,c.x,c.y,c.z),t.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),t.needsUpdate=!0}},merge:function(i,e){if(!(i&&i.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const t=this.attributes;for(const n in t){if(i.attributes[n]===void 0)continue;const r=t[n].array,o=i.attributes[n],a=o.array,l=o.itemSize*e,c=Math.min(a.length,r.length-l);for(let u=0,h=l;u<c;u++,h++)r[h]=a[u]}return this},normalizeNormals:function(){const i=this.attributes.normal;for(let e=0,t=i.count;e<t;e++)yn.fromBufferAttribute(i,e),yn.normalize(),i.setXYZ(e,yn.x,yn.y,yn.z)},toNonIndexed:function(){function i(o,a){const l=o.array,c=o.itemSize,u=o.normalized,h=new l.constructor(a.length*c);let d=0,f=0;for(let m=0,v=a.length;m<v;m++){d=a[m]*c;for(let _=0;_<c;_++)h[f++]=l[d++]}return new tt(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new wt,t=this.index.array,n=this.attributes;for(const o in n){const a=n[o],l=i(a,t);e.setAttribute(o,l)}const s=this.morphAttributes;for(const o in s){const a=[],l=s[o];for(let c=0,u=l.length;c<u;c++){const h=l[c],d=i(h,t);a.push(d)}e.morphAttributes[o]=a}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let o=0,a=r.length;o<a;o++){const l=r[o];e.addGroup(l.start,l.count,l.materialIndex)}return e},toJSON:function(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const l in a)a[l]!==void 0&&(i[l]=a[l]);return i}i.data={attributes:{}};const e=this.index;e!==null&&(i.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const t=this.attributes;for(const a in t){const l=t[a],c=l.toJSON(i.data);l.name!==""&&(c.name=l.name),i.data.attributes[a]=c}const n={};let s=!1;for(const a in this.morphAttributes){const l=this.morphAttributes[a],c=[];for(let u=0,h=l.length;u<h;u++){const d=l[u],f=d.toJSON(i.data);d.name!==""&&(f.name=d.name),c.push(f)}c.length>0&&(n[a]=c,s=!0)}s&&(i.data.morphAttributes=n,i.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(i.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return o!==null&&(i.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),i},clone:function(){return new wt().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=i.name;const t=i.index;t!==null&&this.setIndex(t.clone(e));const n=i.attributes;for(const l in n){const c=n[l];this.setAttribute(l,c.clone(e))}const s=i.morphAttributes;for(const l in s){const c=[],u=s[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=i.morphTargetsRelative;const r=i.groups;for(let l=0,c=r.length;l<c;l++){const u=r[l];this.addGroup(u.start,u.count,u.materialIndex)}const o=i.boundingBox;o!==null&&(this.boundingBox=o.clone());const a=i.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const zf=new xe,Ia=new We,Kh=new fi,$o=new S,qo=new S,Xo=new S,Qh=new S,ed=new S,td=new S,Pu=new S,Lu=new S,Ru=new S,_l=new Se,Ml=new Se,El=new Se,Cc=new S,Iu=new S;function ot(i=new wt,e=new Ut){qe.call(this),this.type="Mesh",this.geometry=i,this.material=e,this.updateMorphTargets()}ot.prototype=Object.assign(Object.create(qe.prototype),{constructor:ot,isMesh:!0,copy:function(i){return qe.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=n.length;s<r;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,e){const t=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(t.boundingSphere===null&&t.computeBoundingSphere(),Kh.copy(t.boundingSphere),Kh.applyMatrix4(s),i.ray.intersectsSphere(Kh)===!1)||(zf.copy(s).invert(),Ia.copy(i.ray).applyMatrix4(zf),t.boundingBox!==null&&Ia.intersectsBox(t.boundingBox)===!1))return;let r;if(t.isBufferGeometry){const o=t.index,a=t.attributes.position,l=t.morphAttributes.position,c=t.morphTargetsRelative,u=t.attributes.uv,h=t.attributes.uv2,d=t.groups,f=t.drawRange;if(o!==null)if(Array.isArray(n))for(let m=0,v=d.length;m<v;m++){const _=d[m],y=n[_.materialIndex],x=Math.max(_.start,f.start),R=Math.min(_.start+_.count,f.start+f.count);for(let I=x,B=R;I<B;I+=3){const N=o.getX(I),J=o.getX(I+1),ne=o.getX(I+2);r=Fu(this,y,i,Ia,a,l,c,u,h,N,J,ne),r&&(r.faceIndex=Math.floor(I/3),r.face.materialIndex=_.materialIndex,e.push(r))}}else{const m=Math.max(0,f.start),v=Math.min(o.count,f.start+f.count);for(let _=m,y=v;_<y;_+=3){const x=o.getX(_),R=o.getX(_+1),I=o.getX(_+2);r=Fu(this,n,i,Ia,a,l,c,u,h,x,R,I),r&&(r.faceIndex=Math.floor(_/3),e.push(r))}}else if(a!==void 0)if(Array.isArray(n))for(let m=0,v=d.length;m<v;m++){const _=d[m],y=n[_.materialIndex],x=Math.max(_.start,f.start),R=Math.min(_.start+_.count,f.start+f.count);for(let I=x,B=R;I<B;I+=3){const N=I,J=I+1,ne=I+2;r=Fu(this,y,i,Ia,a,l,c,u,h,N,J,ne),r&&(r.faceIndex=Math.floor(I/3),r.face.materialIndex=_.materialIndex,e.push(r))}}else{const m=Math.max(0,f.start),v=Math.min(a.count,f.start+f.count);for(let _=m,y=v;_<y;_+=3){const x=_,R=_+1,I=_+2;r=Fu(this,n,i,Ia,a,l,c,u,h,x,R,I),r&&(r.faceIndex=Math.floor(_/3),e.push(r))}}}else if(t.isGeometry){const o=Array.isArray(n),a=t.vertices,l=t.faces;let c;const u=t.faceVertexUvs[0];u.length>0&&(c=u);for(let h=0,d=l.length;h<d;h++){const f=l[h],m=o?n[f.materialIndex]:n;if(m===void 0)continue;const v=a[f.a],_=a[f.b],y=a[f.c];if(r=Uf(this,m,i,Ia,v,_,y,Cc),r){if(c&&c[h]){const x=c[h];_l.copy(x[0]),Ml.copy(x[1]),El.copy(x[2]),r.uv=Gn.getUV(Cc,v,_,y,_l,Ml,El,new Se)}r.face=f,r.faceIndex=h,e.push(r)}}}}});function Uf(i,e,t,n,s,r,o,a){let l;if(e.side===qt?l=n.intersectTriangle(o,r,s,!0,a):l=n.intersectTriangle(s,r,o,e.side!==Xi,a),l===null)return null;Iu.copy(a),Iu.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(Iu);return c<t.near||c>t.far?null:{distance:c,point:Iu.clone(),object:i}}function Fu(i,e,t,n,s,r,o,a,l,c,u,h){$o.fromBufferAttribute(s,c),qo.fromBufferAttribute(s,u),Xo.fromBufferAttribute(s,h);const d=i.morphTargetInfluences;if(e.morphTargets&&r&&d){Pu.set(0,0,0),Lu.set(0,0,0),Ru.set(0,0,0);for(let m=0,v=r.length;m<v;m++){const _=d[m],y=r[m];_!==0&&(Qh.fromBufferAttribute(y,c),ed.fromBufferAttribute(y,u),td.fromBufferAttribute(y,h),o?(Pu.addScaledVector(Qh,_),Lu.addScaledVector(ed,_),Ru.addScaledVector(td,_)):(Pu.addScaledVector(Qh.sub($o),_),Lu.addScaledVector(ed.sub(qo),_),Ru.addScaledVector(td.sub(Xo),_)))}$o.add(Pu),qo.add(Lu),Xo.add(Ru)}i.isSkinnedMesh&&(i.boneTransform(c,$o),i.boneTransform(u,qo),i.boneTransform(h,Xo));const f=Uf(i,e,t,n,$o,qo,Xo,Cc);if(f){a&&(_l.fromBufferAttribute(a,c),Ml.fromBufferAttribute(a,u),El.fromBufferAttribute(a,h),f.uv=Gn.getUV(Cc,$o,qo,Xo,_l,Ml,El,new Se)),l&&(_l.fromBufferAttribute(l,c),Ml.fromBufferAttribute(l,u),El.fromBufferAttribute(l,h),f.uv2=Gn.getUV(Cc,$o,qo,Xo,_l,Ml,El,new Se));const m=new bu(c,u,h);Gn.getNormal($o,qo,Xo,m.normal),f.face=m}return f}class Bu extends wt{constructor(e=1,t=1,n=1,s=1,r=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,n,t,e,o,r,0),m("z","y","x",1,-1,n,t,-e,o,r,1),m("x","z","y",1,1,e,n,t,s,o,2),m("x","z","y",1,-1,e,n,-t,s,o,3),m("x","y","z",1,-1,e,t,n,s,r,4),m("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new ft(c,3)),this.setAttribute("normal",new ft(u,3)),this.setAttribute("uv",new ft(h,2));function m(v,_,y,x,R,I,B,N,J,ne,se){const E=I/J,M=B/ne,A=I/2,F=B/2,P=N/2,O=J+1,V=ne+1;let W=0,fe=0;const ve=new S;for(let pe=0;pe<V;pe++){const Me=pe*M-F;for(let Fe=0;Fe<O;Fe++){const at=Fe*E-A;ve[v]=at*x,ve[_]=Me*R,ve[y]=P,c.push(ve.x,ve.y,ve.z),ve[v]=0,ve[_]=0,ve[y]=N>0?1:-1,u.push(ve.x,ve.y,ve.z),h.push(Fe/J),h.push(1-pe/ne),W+=1}}for(let pe=0;pe<ne;pe++)for(let Me=0;Me<J;Me++){const Fe=d+Me+O*pe,at=d+Me+O*(pe+1),bt=d+(Me+1)+O*(pe+1),Ie=d+(Me+1)+O*pe;l.push(Fe,at,Ie),l.push(at,bt,Ie),fe+=6}a.addGroup(f,fe,se),f+=fe,d+=W}}}function Sl(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture)?e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function Hn(i){const e={};for(let t=0;t<i.length;t++){const n=Sl(i[t]);for(const s in n)e[s]=n[s]}return e}const id={clone:Sl,merge:Hn};var m0=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,g0=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function In(i){Nt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=m0,this.fragmentShader=g0,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&(i.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(i))}In.prototype=Object.create(Nt.prototype),In.prototype.constructor=In,In.prototype.isShaderMaterial=!0,In.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=Sl(i.uniforms),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.lights=i.lights,this.clipping=i.clipping,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this},In.prototype.toJSON=function(i){const e=Nt.prototype.toJSON.call(this,i);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(i).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const t={};for(const n in this.extensions)this.extensions[n]===!0&&(t[n]=!0);return Object.keys(t).length>0&&(e.extensions=t),e};function bs(){qe.call(this),this.type="Camera",this.matrixWorldInverse=new xe,this.projectionMatrix=new xe,this.projectionMatrixInverse=new xe}bs.prototype=Object.assign(Object.create(qe.prototype),{constructor:bs,isCamera:!0,copy:function(i,e){return qe.prototype.copy.call(this,i,e),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new S),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return i.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(i){qe.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,e){qe.prototype.updateWorldMatrix.call(this,i,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function mi(i=50,e=1,t=.1,n=2e3){bs.call(this),this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=t,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}mi.prototype=Object.assign(Object.create(bs.prototype),{constructor:mi,isPerspectiveCamera:!0,copy:function(i,e){return bs.prototype.copy.call(this,i,e),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){const e=.5*this.getFilmHeight()/i;this.fov=rt.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const i=Math.tan(rt.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return rt.RAD2DEG*2*Math.atan(Math.tan(rt.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,e,t,n,s,r){this.aspect=i/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=e,this.view.offsetX=t,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=this.near;let e=i*Math.tan(rt.DEG2RAD*.5*this.fov)/this.zoom,t=2*e,n=this.aspect*t,s=-.5*n;const r=this.view;if(this.view!==null&&this.view.enabled){const a=r.fullWidth,l=r.fullHeight;s+=r.offsetX*n/a,e-=r.offsetY*t/l,n*=r.width/a,t*=r.height/l}const o=this.filmOffset;o!==0&&(s+=i*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-t,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const e=qe.prototype.toJSON.call(this,i);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Tl=90,Al=1;function Cl(i,e,t){if(qe.call(this),this.type="CubeCamera",t.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=t;const n=new mi(Tl,Al,i,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new S(1,0,0)),this.add(n);const s=new mi(Tl,Al,i,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new S(-1,0,0)),this.add(s);const r=new mi(Tl,Al,i,e);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new S(0,1,0)),this.add(r);const o=new mi(Tl,Al,i,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new S(0,-1,0)),this.add(o);const a=new mi(Tl,Al,i,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new S(0,0,1)),this.add(a);const l=new mi(Tl,Al,i,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new S(0,0,-1)),this.add(l),this.update=function(c,u){this.parent===null&&this.updateMatrixWorld();const h=c.xr.enabled,d=c.getRenderTarget();c.xr.enabled=!1;const f=t.texture.generateMipmaps;t.texture.generateMipmaps=!1,c.setRenderTarget(t,0),c.render(u,n),c.setRenderTarget(t,1),c.render(u,s),c.setRenderTarget(t,2),c.render(u,r),c.setRenderTarget(t,3),c.render(u,o),c.setRenderTarget(t,4),c.render(u,a),t.texture.generateMipmaps=f,c.setRenderTarget(t,5),c.render(u,l),c.setRenderTarget(d),c.xr.enabled=h}}Cl.prototype=Object.create(qe.prototype),Cl.prototype.constructor=Cl;function uo(i,e,t,n,s,r,o,a,l,c){i=i!==void 0?i:[],e=e!==void 0?e:ki,o=o!==void 0?o:Yi,oi.call(this,i,e,t,n,s,r,o,a,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}uo.prototype=Object.create(oi.prototype),uo.prototype.constructor=uo,uo.prototype.isCubeTexture=!0,Object.defineProperty(uo.prototype,"images",{get:function(){return this.image},set:function(i){this.image=i}});function Yo(i,e,t){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=t),bi.call(this,i,i,e),e=e||{},this.texture=new uo(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}Yo.prototype=Object.create(bi.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isWebGLCubeRenderTarget=!0,Yo.prototype.fromEquirectangularTexture=function(i,e){this.texture.type=e.type,this.texture.format=jt,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const t={uniforms:{tEquirect:{value:null}},vertexShader:`

			varying vec3 vWorldDirection;

			vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

				return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

			}

			void main() {

				vWorldDirection = transformDirection( position, modelMatrix );

				#include <begin_vertex>
				#include <project_vertex>

			}
		`,fragmentShader:`

			uniform sampler2D tEquirect;

			varying vec3 vWorldDirection;

			#include <common>

			void main() {

				vec3 direction = normalize( vWorldDirection );

				vec2 sampleUV = equirectUv( direction );

				gl_FragColor = texture2D( tEquirect, sampleUV );

			}
		`},n=new Bu(5,5,5),s=new In({name:"CubemapFromEquirect",uniforms:Sl(t.uniforms),vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:qt,blending:cn});s.uniforms.tEquirect.value=e;const r=new ot(n,s),o=e.minFilter;return e.minFilter===Rs&&(e.minFilter=et),new Cl(1,10,this).update(i,r),e.minFilter=o,r.geometry.dispose(),r.material.dispose(),this},Yo.prototype.clear=function(i,e,t,n){const s=i.getRenderTarget();for(let r=0;r<6;r++)i.setRenderTarget(this,r),i.clear(e,t,n);i.setRenderTarget(s)};function Gs(i,e,t,n,s,r,o,a,l,c,u,h){oi.call(this,null,r,o,a,l,c,n,s,u,h),this.image={data:i||null,width:e||1,height:t||1},this.magFilter=l!==void 0?l:ei,this.minFilter=c!==void 0?c:ei,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Gs.prototype=Object.create(oi.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isDataTexture=!0;const Dl=new fi,Nu=new S;class Pl{constructor(e,t,n,s,r,o){this.planes=[e!==void 0?e:new yi,t!==void 0?t:new yi,n!==void 0?n:new yi,s!==void 0?s:new yi,r!==void 0?r:new yi,o!==void 0?o:new yi]}set(e,t,n,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}clone(){return new this.constructor().copy(this)}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],r=n[1],o=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],f=n[9],m=n[10],v=n[11],_=n[12],y=n[13],x=n[14],R=n[15];return t[0].setComponents(a-s,h-l,v-d,R-_).normalize(),t[1].setComponents(a+s,h+l,v+d,R+_).normalize(),t[2].setComponents(a+r,h+c,v+f,R+y).normalize(),t[3].setComponents(a-r,h-c,v-f,R-y).normalize(),t[4].setComponents(a-o,h-u,v-m,R-x).normalize(),t[5].setComponents(a+o,h+u,v+m,R+x).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Dl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Dl)}intersectsSprite(e){return Dl.center.set(0,0,0),Dl.radius=.7071067811865476,Dl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Dl)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(Nu.x=s.normal.x>0?e.max.x:e.min.x,Nu.y=s.normal.y>0?e.max.y:e.min.y,Nu.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Nu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}function Gf(){let i=null,e=!1,t=null,n=null;function s(r,o){t(r,o),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function v0(i,e){const t=e.isWebGL2,n=new WeakMap;function s(c,u){const h=c.array,d=c.usage,f=i.createBuffer();i.bindBuffer(u,f),i.bufferData(u,h,d),c.onUploadCallback();let m=5126;return h instanceof Float32Array?m=5126:h instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):h instanceof Uint16Array?c.isFloat16BufferAttribute?t?m=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):m=5123:h instanceof Int16Array?m=5122:h instanceof Uint32Array?m=5125:h instanceof Int32Array?m=5124:h instanceof Int8Array?m=5120:h instanceof Uint8Array&&(m=5121),{buffer:f,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,h){const d=u.array,f=u.updateRange;i.bindBuffer(h,c),f.count===-1?i.bufferSubData(h,0,d):(t?i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);h===void 0?n.set(c,s(c,u)):h.version<c.version&&(r(h.buffer,c,u),h.version=c.version)}return{get:o,remove:a,update:l}}class Ll extends wt{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(n),l=Math.floor(s),c=a+1,u=l+1,h=e/a,d=t/l,f=[],m=[],v=[],_=[];for(let y=0;y<u;y++){const x=y*d-o;for(let R=0;R<c;R++){const I=R*h-r;m.push(I,-x,0),v.push(0,0,1),_.push(R/a),_.push(1-y/l)}}for(let y=0;y<l;y++)for(let x=0;x<a;x++){const R=x+c*y,I=x+c*(y+1),B=x+1+c*(y+1),N=x+1+c*y;f.push(R,I,N),f.push(I,B,N)}this.setIndex(f),this.setAttribute("position",new ft(m,3)),this.setAttribute("normal",new ft(v,3)),this.setAttribute("uv",new ft(_,2))}}var y0=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,x0=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,w0=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,b0=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,_0=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,M0="vec3 transformed = vec3( position );",E0=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,S0=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,T0=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,A0=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,C0=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,D0=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,P0=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,L0=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,R0=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,I0=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,F0=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,B0=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,N0=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,O0=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,k0=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,z0=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,U0=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,G0=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,H0="gl_FragColor = linearToOutputTexel( gl_FragColor );",V0=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,j0=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,W0=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,$0=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,q0=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,X0=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Y0=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,Z0=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,J0=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,K0=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Q0=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,ev=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,tv=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,iv=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,nv=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,sv=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,rv=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,ov=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,av=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lv=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,cv=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,uv=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,hv=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,dv=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,fv=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,pv=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,mv=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gv=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,vv=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,yv=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,xv=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,wv=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,bv=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_v=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Mv=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ev=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,Sv=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,Tv=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,Av=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Cv=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,Dv=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,Pv=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Lv=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,Rv=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Iv=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Fv=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Bv=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Nv=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ov=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,kv=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,zv=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Uv=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Gv=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Hv=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Vv=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,jv=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Wv=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,$v=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,qv=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Xv=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Yv=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Zv=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Jv=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Kv=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,Qv=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,ey=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,ty=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,iy=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,ny=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,sy=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,ry=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,oy=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,ay=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ly=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cy=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,uy=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,hy=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,dy=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fy=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,py=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,my=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,gy=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,vy=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yy=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xy=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wy=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,by=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_y=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,My=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ey=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Sy=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ty=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ay=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cy=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Dy=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Py=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ly=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,Ry=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Iy=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Fy=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,By=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ny=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Oy=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ky=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const ai={alphamap_fragment:y0,alphamap_pars_fragment:x0,alphatest_fragment:w0,aomap_fragment:b0,aomap_pars_fragment:_0,begin_vertex:M0,beginnormal_vertex:E0,bsdfs:S0,bumpmap_pars_fragment:T0,clipping_planes_fragment:A0,clipping_planes_pars_fragment:C0,clipping_planes_pars_vertex:D0,clipping_planes_vertex:P0,color_fragment:L0,color_pars_fragment:R0,color_pars_vertex:I0,color_vertex:F0,common:B0,cube_uv_reflection_fragment:N0,defaultnormal_vertex:O0,displacementmap_pars_vertex:k0,displacementmap_vertex:z0,emissivemap_fragment:U0,emissivemap_pars_fragment:G0,encodings_fragment:H0,encodings_pars_fragment:V0,envmap_fragment:j0,envmap_common_pars_fragment:W0,envmap_pars_fragment:$0,envmap_pars_vertex:q0,envmap_physical_pars_fragment:sv,envmap_vertex:X0,fog_vertex:Y0,fog_pars_vertex:Z0,fog_fragment:J0,fog_pars_fragment:K0,gradientmap_pars_fragment:Q0,lightmap_fragment:ev,lightmap_pars_fragment:tv,lights_lambert_vertex:iv,lights_pars_begin:nv,lights_toon_fragment:rv,lights_toon_pars_fragment:ov,lights_phong_fragment:av,lights_phong_pars_fragment:lv,lights_physical_fragment:cv,lights_physical_pars_fragment:uv,lights_fragment_begin:hv,lights_fragment_maps:dv,lights_fragment_end:fv,logdepthbuf_fragment:pv,logdepthbuf_pars_fragment:mv,logdepthbuf_pars_vertex:gv,logdepthbuf_vertex:vv,map_fragment:yv,map_pars_fragment:xv,map_particle_fragment:wv,map_particle_pars_fragment:bv,metalnessmap_fragment:_v,metalnessmap_pars_fragment:Mv,morphnormal_vertex:Ev,morphtarget_pars_vertex:Sv,morphtarget_vertex:Tv,normal_fragment_begin:Av,normal_fragment_maps:Cv,normalmap_pars_fragment:Dv,clearcoat_normal_fragment_begin:Pv,clearcoat_normal_fragment_maps:Lv,clearcoat_pars_fragment:Rv,packing:Iv,premultiplied_alpha_fragment:Fv,project_vertex:Bv,dithering_fragment:Nv,dithering_pars_fragment:Ov,roughnessmap_fragment:kv,roughnessmap_pars_fragment:zv,shadowmap_pars_fragment:Uv,shadowmap_pars_vertex:Gv,shadowmap_vertex:Hv,shadowmask_pars_fragment:Vv,skinbase_vertex:jv,skinning_pars_vertex:Wv,skinning_vertex:$v,skinnormal_vertex:qv,specularmap_fragment:Xv,specularmap_pars_fragment:Yv,tonemapping_fragment:Zv,tonemapping_pars_fragment:Jv,transmissionmap_fragment:Kv,transmissionmap_pars_fragment:Qv,uv_pars_fragment:ey,uv_pars_vertex:ty,uv_vertex:iy,uv2_pars_fragment:ny,uv2_pars_vertex:sy,uv2_vertex:ry,worldpos_vertex:oy,background_frag:ay,background_vert:ly,cube_frag:cy,cube_vert:uy,depth_frag:hy,depth_vert:dy,distanceRGBA_frag:fy,distanceRGBA_vert:py,equirect_frag:my,equirect_vert:gy,linedashed_frag:vy,linedashed_vert:yy,meshbasic_frag:xy,meshbasic_vert:wy,meshlambert_frag:by,meshlambert_vert:_y,meshmatcap_frag:My,meshmatcap_vert:Ey,meshtoon_frag:Sy,meshtoon_vert:Ty,meshphong_frag:Ay,meshphong_vert:Cy,meshphysical_frag:Dy,meshphysical_vert:Py,normal_frag:Ly,normal_vert:Ry,points_frag:Iy,points_vert:Fy,shadow_frag:By,shadow_vert:Ny,sprite_frag:Oy,sprite_vert:ky},mt={common:{diffuse:{value:new Ee(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new rn},uv2Transform:{value:new rn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Se(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ee(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ee(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rn}},sprite:{diffuse:{value:new Ee(15658734)},opacity:{value:1},center:{value:new Se(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rn}}},ns={basic:{uniforms:Hn([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.fog]),vertexShader:ai.meshbasic_vert,fragmentShader:ai.meshbasic_frag},lambert:{uniforms:Hn([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.fog,mt.lights,{emissive:{value:new Ee(0)}}]),vertexShader:ai.meshlambert_vert,fragmentShader:ai.meshlambert_frag},phong:{uniforms:Hn([mt.common,mt.specularmap,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.fog,mt.lights,{emissive:{value:new Ee(0)},specular:{value:new Ee(1118481)},shininess:{value:30}}]),vertexShader:ai.meshphong_vert,fragmentShader:ai.meshphong_frag},standard:{uniforms:Hn([mt.common,mt.envmap,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.roughnessmap,mt.metalnessmap,mt.fog,mt.lights,{emissive:{value:new Ee(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ai.meshphysical_vert,fragmentShader:ai.meshphysical_frag},toon:{uniforms:Hn([mt.common,mt.aomap,mt.lightmap,mt.emissivemap,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.gradientmap,mt.fog,mt.lights,{emissive:{value:new Ee(0)}}]),vertexShader:ai.meshtoon_vert,fragmentShader:ai.meshtoon_frag},matcap:{uniforms:Hn([mt.common,mt.bumpmap,mt.normalmap,mt.displacementmap,mt.fog,{matcap:{value:null}}]),vertexShader:ai.meshmatcap_vert,fragmentShader:ai.meshmatcap_frag},points:{uniforms:Hn([mt.points,mt.fog]),vertexShader:ai.points_vert,fragmentShader:ai.points_frag},dashed:{uniforms:Hn([mt.common,mt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ai.linedashed_vert,fragmentShader:ai.linedashed_frag},depth:{uniforms:Hn([mt.common,mt.displacementmap]),vertexShader:ai.depth_vert,fragmentShader:ai.depth_frag},normal:{uniforms:Hn([mt.common,mt.bumpmap,mt.normalmap,mt.displacementmap,{opacity:{value:1}}]),vertexShader:ai.normal_vert,fragmentShader:ai.normal_frag},sprite:{uniforms:Hn([mt.sprite,mt.fog]),vertexShader:ai.sprite_vert,fragmentShader:ai.sprite_frag},background:{uniforms:{uvTransform:{value:new rn},t2D:{value:null}},vertexShader:ai.background_vert,fragmentShader:ai.background_frag},cube:{uniforms:Hn([mt.envmap,{opacity:{value:1}}]),vertexShader:ai.cube_vert,fragmentShader:ai.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ai.equirect_vert,fragmentShader:ai.equirect_frag},distanceRGBA:{uniforms:Hn([mt.common,mt.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ai.distanceRGBA_vert,fragmentShader:ai.distanceRGBA_frag},shadow:{uniforms:Hn([mt.lights,mt.fog,{color:{value:new Ee(0)},opacity:{value:1}}]),vertexShader:ai.shadow_vert,fragmentShader:ai.shadow_frag}};ns.physical={uniforms:Hn([ns.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Se(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ee(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ai.meshphysical_vert,fragmentShader:ai.meshphysical_frag};function zy(i,e,t,n,s){const r=new Ee(0);let o=0,a,l,c=null,u=0,h=null;function d(m,v,_,y){let x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=e.get(x));const R=i.xr,I=R.getSession&&R.getSession();I&&I.environmentBlendMode==="additive"&&(x=null),x===null?f(r,o):x&&x.isColor&&(f(x,1),y=!0),(i.autoClear||y)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),x&&(x.isCubeTexture||x.isWebGLCubeRenderTarget||x.mapping===xi)?(l===void 0&&(l=new ot(new Bu(1,1,1),new In({name:"BackgroundCubeMaterial",uniforms:Sl(ns.cube.uniforms),vertexShader:ns.cube.vertexShader,fragmentShader:ns.cube.fragmentShader,side:qt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(B,N,J){this.matrixWorld.copyPosition(J.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),x.isWebGLCubeRenderTarget&&(x=x.texture),l.material.uniforms.envMap.value=x,l.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,(c!==x||u!==x.version||h!==i.toneMapping)&&(l.material.needsUpdate=!0,c=x,u=x.version,h=i.toneMapping),m.unshift(l,l.geometry,l.material,0,0,null)):x&&x.isTexture&&(a===void 0&&(a=new ot(new Ll(2,2),new In({name:"BackgroundMaterial",uniforms:Sl(ns.background.uniforms),vertexShader:ns.background.vertexShader,fragmentShader:ns.background.fragmentShader,side:Kt,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),a.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||u!==x.version||h!==i.toneMapping)&&(a.material.needsUpdate=!0,c=x,u=x.version,h=i.toneMapping),m.unshift(a,a.geometry,a.material,0,0,null))}function f(m,v){t.buffers.color.setClear(m.r,m.g,m.b,v,s)}return{getClearColor:function(){return r},setClearColor:function(m,v=1){r.set(m),o=v,f(r,o)},getClearAlpha:function(){return o},setClearAlpha:function(m){o=m,f(r,o)},render:d}}function Uy(i,e,t,n){const s=i.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,a={},l=v(null);let c=l;function u(F,P,O,V,W){let fe=!1;if(o){const ve=m(V,O,P);c!==ve&&(c=ve,d(c.object)),fe=_(V,W),fe&&y(V,W)}else{const ve=P.wireframe===!0;(c.geometry!==V.id||c.program!==O.id||c.wireframe!==ve)&&(c.geometry=V.id,c.program=O.id,c.wireframe=ve,fe=!0)}F.isInstancedMesh===!0&&(fe=!0),W!==null&&t.update(W,34963),fe&&(J(F,P,O,V),W!==null&&i.bindBuffer(34963,t.get(W).buffer))}function h(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}function d(F){return n.isWebGL2?i.bindVertexArray(F):r.bindVertexArrayOES(F)}function f(F){return n.isWebGL2?i.deleteVertexArray(F):r.deleteVertexArrayOES(F)}function m(F,P,O){const V=O.wireframe===!0;let W=a[F.id];W===void 0&&(W={},a[F.id]=W);let fe=W[P.id];fe===void 0&&(fe={},W[P.id]=fe);let ve=fe[V];return ve===void 0&&(ve=v(h()),fe[V]=ve),ve}function v(F){const P=[],O=[],V=[];for(let W=0;W<s;W++)P[W]=0,O[W]=0,V[W]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:O,attributeDivisors:V,object:F,attributes:{},index:null}}function _(F,P){const O=c.attributes,V=F.attributes;let W=0;for(const fe in V){const ve=O[fe],pe=V[fe];if(ve===void 0||ve.attribute!==pe||ve.data!==pe.data)return!0;W++}return c.attributesNum!==W||c.index!==P}function y(F,P){const O={},V=F.attributes;let W=0;for(const fe in V){const ve=V[fe],pe={};pe.attribute=ve,ve.data&&(pe.data=ve.data),O[fe]=pe,W++}c.attributes=O,c.attributesNum=W,c.index=P}function x(){const F=c.newAttributes;for(let P=0,O=F.length;P<O;P++)F[P]=0}function R(F){I(F,0)}function I(F,P){const O=c.newAttributes,V=c.enabledAttributes,W=c.attributeDivisors;O[F]=1,V[F]===0&&(i.enableVertexAttribArray(F),V[F]=1),W[F]!==P&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](F,P),W[F]=P)}function B(){const F=c.newAttributes,P=c.enabledAttributes;for(let O=0,V=P.length;O<V;O++)P[O]!==F[O]&&(i.disableVertexAttribArray(O),P[O]=0)}function N(F,P,O,V,W,fe){n.isWebGL2===!0&&(O===5124||O===5125)?i.vertexAttribIPointer(F,P,O,W,fe):i.vertexAttribPointer(F,P,O,V,W,fe)}function J(F,P,O,V){if(n.isWebGL2===!1&&(F.isInstancedMesh||V.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const W=V.attributes,fe=O.getAttributes(),ve=P.defaultAttributeValues;for(const pe in fe){const Me=fe[pe];if(Me>=0){const Fe=W[pe];if(Fe!==void 0){const at=Fe.normalized,bt=Fe.itemSize,Ie=t.get(Fe);if(Ie===void 0)continue;const Y=Ie.buffer,X=Ie.type,ce=Ie.bytesPerElement;if(Fe.isInterleavedBufferAttribute){const ie=Fe.data,he=ie.stride,ge=Fe.offset;ie&&ie.isInstancedInterleavedBuffer?(I(Me,ie.meshPerAttribute),V._maxInstanceCount===void 0&&(V._maxInstanceCount=ie.meshPerAttribute*ie.count)):R(Me),i.bindBuffer(34962,Y),N(Me,bt,X,at,he*ce,ge*ce)}else Fe.isInstancedBufferAttribute?(I(Me,Fe.meshPerAttribute),V._maxInstanceCount===void 0&&(V._maxInstanceCount=Fe.meshPerAttribute*Fe.count)):R(Me),i.bindBuffer(34962,Y),N(Me,bt,X,at,0,0)}else if(pe==="instanceMatrix"){const at=t.get(F.instanceMatrix);if(at===void 0)continue;const bt=at.buffer,Ie=at.type;I(Me+0,1),I(Me+1,1),I(Me+2,1),I(Me+3,1),i.bindBuffer(34962,bt),i.vertexAttribPointer(Me+0,4,Ie,!1,64,0),i.vertexAttribPointer(Me+1,4,Ie,!1,64,16),i.vertexAttribPointer(Me+2,4,Ie,!1,64,32),i.vertexAttribPointer(Me+3,4,Ie,!1,64,48)}else if(pe==="instanceColor"){const at=t.get(F.instanceColor);if(at===void 0)continue;const bt=at.buffer,Ie=at.type;I(Me,1),i.bindBuffer(34962,bt),i.vertexAttribPointer(Me,3,Ie,!1,12,0)}else if(ve!==void 0){const at=ve[pe];if(at!==void 0)switch(at.length){case 2:i.vertexAttrib2fv(Me,at);break;case 3:i.vertexAttrib3fv(Me,at);break;case 4:i.vertexAttrib4fv(Me,at);break;default:i.vertexAttrib1fv(Me,at)}}}}B()}function ne(){M();for(const F in a){const P=a[F];for(const O in P){const V=P[O];for(const W in V)f(V[W].object),delete V[W];delete P[O]}delete a[F]}}function se(F){if(a[F.id]===void 0)return;const P=a[F.id];for(const O in P){const V=P[O];for(const W in V)f(V[W].object),delete V[W];delete P[O]}delete a[F.id]}function E(F){for(const P in a){const O=a[P];if(O[F.id]===void 0)continue;const V=O[F.id];for(const W in V)f(V[W].object),delete V[W];delete O[F.id]}}function M(){A(),c!==l&&(c=l,d(c.object))}function A(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:M,resetDefaultState:A,dispose:ne,releaseStatesOfGeometry:se,releaseStatesOfProgram:E,initAttributes:x,enableAttribute:R,disableUnusedAttributes:B}}function Gy(i,e,t,n){const s=n.isWebGL2;let r;function o(c){r=c}function a(c,u){i.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,h){if(h===0)return;let d,f;if(s)d=i,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](r,c,u,h),t.update(u,r,h)}this.setMode=o,this.render=a,this.renderInstances=l}function Hy(i,e,t){let n;function s(){if(n!==void 0)return n;const N=e.get("EXT_texture_filter_anisotropic");return N!==null?n=i.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT):n=0,n}function r(N){if(N==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";N="mediump"}return N==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=t.logarithmicDepthBuffer===!0,u=i.getParameter(34930),h=i.getParameter(35660),d=i.getParameter(3379),f=i.getParameter(34076),m=i.getParameter(34921),v=i.getParameter(36347),_=i.getParameter(36348),y=i.getParameter(36349),x=h>0,R=o||!!e.get("OES_texture_float"),I=x&&R,B=o?i.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:v,maxVaryings:_,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:R,floatVertexTextures:I,maxSamples:B}}function Vy(i){const e=this;let t=null,n=0,s=!1,r=!1;const o=new yi,a=new rn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d,f){const m=h.length!==0||d||n!==0||s;return s=d,t=u(h,f,0),n=h.length,m},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(h,d,f){const m=h.clippingPlanes,v=h.clipIntersection,_=h.clipShadows,y=i.get(h);if(!s||m===null||m.length===0||r&&!_)r?u(null):c();else{const x=r?0:n,R=x*4;let I=y.clippingState||null;l.value=I,I=u(m,d,R,f);for(let B=0;B!==R;++B)I[B]=t[B];y.clippingState=I,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,f,m){const v=h!==null?h.length:0;let _=null;if(v!==0){if(_=l.value,m!==!0||_===null){const y=f+v*4,x=d.matrixWorldInverse;a.getNormalMatrix(x),(_===null||_.length<y)&&(_=new Float32Array(y));for(let R=0,I=f;R!==v;++R,I+=4)o.copy(h[R]).applyMatrix4(x,a),o.normal.toArray(_,I),_[I+3]=o.constant}l.value=_,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,_}}function jy(i){let e=new WeakMap;function t(o,a){return a===Yt?o.mapping=ki:a===xr&&(o.mapping=Wn),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===Yt||a===xr)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=i.getRenderList(),u=i.getRenderTarget(),h=new Yo(l.height/2);return h.fromEquirectangularTexture(i,o),e.set(o,h),i.setRenderTarget(u),i.setRenderList(c),o.addEventListener("dispose",s),t(h.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}function Wy(i){const e={};return{has:function(t){if(e[t]!==void 0)return e[t]!==null;let n;switch(t){case"WEBGL_depth_texture":n=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=i.getExtension(t)}return e[t]=n,n!==null},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function $y(i,e,t,n){const s=new WeakMap,r=new WeakMap;function o(h){const d=h.target,f=s.get(d);f.index!==null&&e.remove(f.index);for(const v in f.attributes)e.remove(f.attributes[v]);d.removeEventListener("dispose",o),s.delete(d);const m=r.get(f);m&&(e.remove(m),r.delete(f)),n.releaseStatesOfGeometry(f),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){let f=s.get(d);return f||(d.addEventListener("dispose",o),d.isBufferGeometry?f=d:d.isGeometry&&(d._bufferGeometry===void 0&&(d._bufferGeometry=new wt().setFromObject(h)),f=d._bufferGeometry),s.set(d,f),t.memory.geometries++,f)}function l(h){const d=h.attributes;for(const m in d)e.update(d[m],34962);const f=h.morphAttributes;for(const m in f){const v=f[m];for(let _=0,y=v.length;_<y;_++)e.update(v[_],34962)}}function c(h){const d=[],f=h.index,m=h.attributes.position;let v=0;if(f!==null){const x=f.array;v=f.version;for(let R=0,I=x.length;R<I;R+=3){const B=x[R+0],N=x[R+1],J=x[R+2];d.push(B,N,N,J,J,B)}}else{const x=m.array;v=m.version;for(let R=0,I=x.length/3-1;R<I;R+=3){const B=R+0,N=R+1,J=R+2;d.push(B,N,N,J,J,B)}}const _=new(kf(d)>65535?wl:Ra)(d,1);_.version=v;const y=r.get(h);y&&e.remove(y),r.set(h,_)}function u(h){const d=r.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return r.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function qy(i,e,t,n){const s=n.isWebGL2;let r;function o(d){r=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,f){i.drawElements(r,f,a,d*l),t.update(f,r,1)}function h(d,f,m){if(m===0)return;let v,_;if(s)v=i,_="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),_="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[_](r,f,a,d*l,m),t.update(f,r,m)}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h}function Xy(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function Yy(i,e){return i[0]-e[0]}function Zy(i,e){return Math.abs(e[1])-Math.abs(i[1])}function Jy(i){const e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];function s(r,o,a,l){const c=r.morphTargetInfluences,u=c===void 0?0:c.length;let h=e[o.id];if(h===void 0){h=[];for(let _=0;_<u;_++)h[_]=[_,0];e[o.id]=h}for(let _=0;_<u;_++){const y=h[_];y[0]=_,y[1]=c[_]}h.sort(Zy);for(let _=0;_<8;_++)_<u&&h[_][1]?(n[_][0]=h[_][0],n[_][1]=h[_][1]):(n[_][0]=Number.MAX_SAFE_INTEGER,n[_][1]=0);n.sort(Yy);const d=a.morphTargets&&o.morphAttributes.position,f=a.morphNormals&&o.morphAttributes.normal;let m=0;for(let _=0;_<8;_++){const y=n[_],x=y[0],R=y[1];x!==Number.MAX_SAFE_INTEGER&&R?(d&&o.getAttribute("morphTarget"+_)!==d[x]&&o.setAttribute("morphTarget"+_,d[x]),f&&o.getAttribute("morphNormal"+_)!==f[x]&&o.setAttribute("morphNormal"+_,f[x]),t[_]=R,m+=R):(d&&o.hasAttribute("morphTarget"+_)===!0&&o.deleteAttribute("morphTarget"+_),f&&o.hasAttribute("morphNormal"+_)===!0&&o.deleteAttribute("morphNormal"+_),t[_]=0)}const v=o.morphTargetsRelative?1:1-m;l.getUniforms().setValue(i,"morphTargetBaseInfluence",v),l.getUniforms().setValue(i,"morphTargetInfluences",t)}return{update:s}}function Ky(i,e,t,n){let s=new WeakMap;function r(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);return s.get(h)!==c&&(u.isGeometry&&h.updateFromObject(l),e.update(h),s.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),h}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}function Dc(i=null,e=1,t=1,n=1){oi.call(this,null),this.image={data:i,width:e,height:t,depth:n},this.magFilter=ei,this.minFilter=ei,this.wrapR=li,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Dc.prototype=Object.create(oi.prototype),Dc.prototype.constructor=Dc,Dc.prototype.isDataTexture2DArray=!0;function Pc(i=null,e=1,t=1,n=1){oi.call(this,null),this.image={data:i,width:e,height:t,depth:n},this.magFilter=ei,this.minFilter=ei,this.wrapR=li,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Pc.prototype=Object.create(oi.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isDataTexture3D=!0;const Hf=new oi,Qy=new Dc,ex=new Pc,Vf=new uo,jf=[],Wf=[],$f=new Float32Array(16),qf=new Float32Array(9),Xf=new Float32Array(4);function Rl(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=jf[s];if(r===void 0&&(r=new Float32Array(s),jf[s]=r),e!==0){n.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(r,a)}return r}function Hs(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function _s(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Yf(i,e){let t=Wf[e];t===void 0&&(t=new Int32Array(e),Wf[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function tx(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function ix(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Hs(t,e))return;i.uniform2fv(this.addr,e),_s(t,e)}}function nx(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Hs(t,e))return;i.uniform3fv(this.addr,e),_s(t,e)}}function sx(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Hs(t,e))return;i.uniform4fv(this.addr,e),_s(t,e)}}function rx(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Hs(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),_s(t,e)}else{if(Hs(t,n))return;Xf.set(n),i.uniformMatrix2fv(this.addr,!1,Xf),_s(t,n)}}function ox(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Hs(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),_s(t,e)}else{if(Hs(t,n))return;qf.set(n),i.uniformMatrix3fv(this.addr,!1,qf),_s(t,n)}}function ax(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Hs(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),_s(t,e)}else{if(Hs(t,n))return;$f.set(n),i.uniformMatrix4fv(this.addr,!1,$f),_s(t,n)}}function lx(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.safeSetTexture2D(e||Hf,s)}function cx(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||Qy,s)}function ux(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||ex,s)}function hx(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.safeSetTextureCube(e||Vf,s)}function dx(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function fx(i,e){const t=this.cache;Hs(t,e)||(i.uniform2iv(this.addr,e),_s(t,e))}function px(i,e){const t=this.cache;Hs(t,e)||(i.uniform3iv(this.addr,e),_s(t,e))}function mx(i,e){const t=this.cache;Hs(t,e)||(i.uniform4iv(this.addr,e),_s(t,e))}function gx(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function vx(i){switch(i){case 5126:return tx;case 35664:return ix;case 35665:return nx;case 35666:return sx;case 35674:return rx;case 35675:return ox;case 35676:return ax;case 5124:case 35670:return dx;case 35667:case 35671:return fx;case 35668:case 35672:return px;case 35669:case 35673:return mx;case 5125:return gx;case 35678:case 36198:case 36298:case 36306:case 35682:return lx;case 35679:case 36299:case 36307:return ux;case 35680:case 36300:case 36308:case 36293:return hx;case 36289:case 36303:case 36311:case 36292:return cx}}function yx(i,e){i.uniform1fv(this.addr,e)}function xx(i,e){i.uniform1iv(this.addr,e)}function wx(i,e){i.uniform2iv(this.addr,e)}function bx(i,e){i.uniform3iv(this.addr,e)}function _x(i,e){i.uniform4iv(this.addr,e)}function Mx(i,e){const t=Rl(e,this.size,2);i.uniform2fv(this.addr,t)}function Ex(i,e){const t=Rl(e,this.size,3);i.uniform3fv(this.addr,t)}function Sx(i,e){const t=Rl(e,this.size,4);i.uniform4fv(this.addr,t)}function Tx(i,e){const t=Rl(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function Ax(i,e){const t=Rl(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Cx(i,e){const t=Rl(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Dx(i,e,t){const n=e.length,s=Yf(t,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||Hf,s[r])}function Px(i,e,t){const n=e.length,s=Yf(t,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||Vf,s[r])}function Lx(i){switch(i){case 5126:return yx;case 35664:return Mx;case 35665:return Ex;case 35666:return Sx;case 35674:return Tx;case 35675:return Ax;case 35676:return Cx;case 5124:case 35670:return xx;case 35667:case 35671:return wx;case 35668:case 35672:return bx;case 35669:case 35673:return _x;case 35678:case 36198:case 36298:case 36306:case 35682:return Dx;case 35680:case 36300:case 36308:case 36293:return Px}}function Rx(i,e,t){this.id=i,this.addr=t,this.cache=[],this.setValue=vx(e.type)}function Zf(i,e,t){this.id=i,this.addr=t,this.cache=[],this.size=e.size,this.setValue=Lx(e.type)}Zf.prototype.updateCache=function(i){const e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),_s(e,i)};function Jf(i){this.id=i,this.seq=[],this.map={}}Jf.prototype.setValue=function(i,e,t){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const o=n[s];o.setValue(i,e[o.id],t)}};const nd=/(\w+)(\])?(\[|\.)?/g;function Kf(i,e){i.seq.push(e),i.map[e.id]=e}function Ix(i,e,t){const n=i.name,s=n.length;for(nd.lastIndex=0;;){const r=nd.exec(n),o=nd.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){Kf(t,c===void 0?new Rx(a,i,e):new Zf(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new Jf(a),Kf(t,h)),t=h}}}function Zo(i,e){this.seq=[],this.map={};const t=i.getProgramParameter(e,35718);for(let n=0;n<t;++n){const s=i.getActiveUniform(e,n),r=i.getUniformLocation(e,s.name);Ix(s,r,this)}}Zo.prototype.setValue=function(i,e,t,n){const s=this.map[e];s!==void 0&&s.setValue(i,t,n)},Zo.prototype.setOptional=function(i,e,t){const n=e[t];n!==void 0&&this.setValue(i,t,n)},Zo.upload=function(i,e,t,n){for(let s=0,r=e.length;s!==r;++s){const o=e[s],a=t[o.id];a.needsUpdate!==!1&&o.setValue(i,a.value,n)}},Zo.seqWithValue=function(i,e){const t=[];for(let n=0,s=i.length;n!==s;++n){const r=i[n];r.id in e&&t.push(r)}return t};function Qf(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let Fx=0;function Bx(i){const e=i.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function ep(i){switch(i){case D:return["Linear","( value )"];case H:return["sRGB","( value )"];case q:return["RGBE","( value )"];case _e:return["RGBM","( value, 7.0 )"];case Ce:return["RGBM","( value, 16.0 )"];case ze:return["RGBD","( value, 256.0 )"];case U:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case me:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function tp(i,e,t){const n=i.getShaderParameter(e,35713),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=i.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+s+Bx(r)}function Lc(i,e){const t=ep(e);return"vec4 "+i+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function Nx(i,e){const t=ep(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Ox(i,e){let t;switch(e){case yr:t="Linear";break;case Qe:t="Reinhard";break;case Zs:t="OptimizedCineon";break;case Io:t="ACESFilmic";break;case rl:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function kx(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Rc).join(`
`)}function zx(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Ux(i,e){const t={},n=i.getProgramParameter(e,35721);for(let s=0;s<n;s++){const o=i.getActiveAttrib(e,s).name;t[o]=i.getAttribLocation(e,o)}return t}function Rc(i){return i!==""}function ip(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function np(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Gx=/^[ \t]*#include +<([\w\d./]+)>/gm;function sd(i){return i.replace(Gx,Hx)}function Hx(i,e){const t=ai[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return sd(t)}const Vx=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sp(i){return i.replace(jx,rp).replace(Vx,Wx)}function Wx(i,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),rp(i,e,t,n)}function rp(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function op(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function $x(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Nn?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===$r?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Ds&&(e="SHADOWMAP_TYPE_VSM"),e}function qx(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case ki:case Wn:e="ENVMAP_TYPE_CUBE";break;case xi:case ji:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Xx(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Wn:case ji:e="ENVMAP_MODE_REFRACTION";break}return e}function Yx(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Jn:e="ENVMAP_BLENDING_MULTIPLY";break;case Ys:e="ENVMAP_BLENDING_MIX";break;case uc:e="ENVMAP_BLENDING_ADD";break}return e}function Zx(i,e,t,n){const s=i.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=$x(t),c=qx(t),u=Xx(t),h=Yx(t),d=i.gammaFactor>0?i.gammaFactor:1,f=t.isWebGL2?"":kx(t),m=zx(r),v=s.createProgram();let _,y,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(_=[m].filter(Rc).join(`
`),_.length>0&&(_+=`
`),y=[f,m].filter(Rc).join(`
`),y.length>0&&(y+=`
`)):(_=[op(t),"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Rc).join(`
`),y=[f,op(t),"#define SHADER_NAME "+t.shaderName,m,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ps?"#define TONE_MAPPING":"",t.toneMapping!==ps?ai.tonemapping_pars_fragment:"",t.toneMapping!==ps?Ox("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ai.encodings_pars_fragment,t.map?Lc("mapTexelToLinear",t.mapEncoding):"",t.matcap?Lc("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Lc("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Lc("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?Lc("lightMapTexelToLinear",t.lightMapEncoding):"",Nx("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Rc).join(`
`)),o=sd(o),o=ip(o,t),o=np(o,t),a=sd(a),a=ip(a,t),a=np(a,t),o=sp(o),a=sp(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,_=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,y=["#define varying in",t.glslVersion===is?"":"out highp vec4 pc_fragColor;",t.glslVersion===is?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const R=x+_+o,I=x+y+a,B=Qf(s,35633,R),N=Qf(s,35632,I);if(s.attachShader(v,B),s.attachShader(v,N),t.index0AttributeName!==void 0?s.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),i.debug.checkShaderErrors){const se=s.getProgramInfoLog(v).trim(),E=s.getShaderInfoLog(B).trim(),M=s.getShaderInfoLog(N).trim();let A=!0,F=!0;if(s.getProgramParameter(v,35714)===!1){A=!1;const P=tp(s,B,"vertex"),O=tp(s,N,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(v,35715),"gl.getProgramInfoLog",se,P,O)}else se!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",se):(E===""||M==="")&&(F=!1);F&&(this.diagnostics={runnable:A,programLog:se,vertexShader:{log:E,prefix:_},fragmentShader:{log:M,prefix:y}})}s.deleteShader(B),s.deleteShader(N);let J;this.getUniforms=function(){return J===void 0&&(J=new Zo(s,v)),J};let ne;return this.getAttributes=function(){return ne===void 0&&(ne=Ux(s,v)),ne},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.name=t.shaderName,this.id=Fx++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=B,this.fragmentShader=N,this}function Jx(i,e,t,n,s,r){const o=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,u=n.maxVertexUniforms,h=n.vertexTextures;let d=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(N){const ne=N.skeleton.bones;if(c)return 1024;{const E=Math.floor((u-20)/4),M=Math.min(E,ne.length);return M<ne.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ne.length+" bones. This GPU supports "+M+"."),0):M}}function _(N){let J;return N&&N.isTexture?J=N.encoding:N&&N.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),J=N.texture.encoding):J=D,J}function y(N,J,ne,se,E){const M=se.fog,A=N.isMeshStandardMaterial?se.environment:null,F=e.get(N.envMap||A),P=f[N.type],O=E.isSkinnedMesh?v(E):0;N.precision!==null&&(d=n.getMaxPrecision(N.precision),d!==N.precision&&console.warn("THREE.WebGLProgram.getParameters:",N.precision,"not supported, using",d,"instead."));let V,W;if(P){const pe=ns[P];V=pe.vertexShader,W=pe.fragmentShader}else V=N.vertexShader,W=N.fragmentShader;const fe=i.getRenderTarget();return{isWebGL2:a,shaderID:P,shaderName:N.type,vertexShader:V,fragmentShader:W,defines:N.defines,isRawShaderMaterial:N.isRawShaderMaterial===!0,glslVersion:N.glslVersion,precision:d,instancing:E.isInstancedMesh===!0,instancingColor:E.isInstancedMesh===!0&&E.instanceColor!==null,supportsVertexTextures:h,outputEncoding:fe!==null?_(fe.texture):i.outputEncoding,map:!!N.map,mapEncoding:_(N.map),matcap:!!N.matcap,matcapEncoding:_(N.matcap),envMap:!!F,envMapMode:F&&F.mapping,envMapEncoding:_(F),envMapCubeUV:!!F&&(F.mapping===xi||F.mapping===ji),lightMap:!!N.lightMap,lightMapEncoding:_(N.lightMap),aoMap:!!N.aoMap,emissiveMap:!!N.emissiveMap,emissiveMapEncoding:_(N.emissiveMap),bumpMap:!!N.bumpMap,normalMap:!!N.normalMap,objectSpaceNormalMap:N.normalMapType===Pt,tangentSpaceNormalMap:N.normalMapType===$e,clearcoatMap:!!N.clearcoatMap,clearcoatRoughnessMap:!!N.clearcoatRoughnessMap,clearcoatNormalMap:!!N.clearcoatNormalMap,displacementMap:!!N.displacementMap,roughnessMap:!!N.roughnessMap,metalnessMap:!!N.metalnessMap,specularMap:!!N.specularMap,alphaMap:!!N.alphaMap,gradientMap:!!N.gradientMap,sheen:!!N.sheen,transmissionMap:!!N.transmissionMap,combine:N.combine,vertexTangents:N.normalMap&&N.vertexTangents,vertexColors:N.vertexColors,vertexUvs:!!N.map||!!N.bumpMap||!!N.normalMap||!!N.specularMap||!!N.alphaMap||!!N.emissiveMap||!!N.roughnessMap||!!N.metalnessMap||!!N.clearcoatMap||!!N.clearcoatRoughnessMap||!!N.clearcoatNormalMap||!!N.displacementMap||!!N.transmissionMap,uvsVertexOnly:!(N.map||N.bumpMap||N.normalMap||N.specularMap||N.alphaMap||N.emissiveMap||N.roughnessMap||N.metalnessMap||N.clearcoatNormalMap||N.transmissionMap)&&!!N.displacementMap,fog:!!M,useFog:N.fog,fogExp2:M&&M.isFogExp2,flatShading:N.flatShading,sizeAttenuation:N.sizeAttenuation,logarithmicDepthBuffer:l,skinning:N.skinning&&O>0,maxBones:O,useVertexTexture:c,morphTargets:N.morphTargets,morphNormals:N.morphNormals,maxMorphTargets:i.maxMorphTargets,maxMorphNormals:i.maxMorphNormals,numDirLights:J.directional.length,numPointLights:J.point.length,numSpotLights:J.spot.length,numRectAreaLights:J.rectArea.length,numHemiLights:J.hemi.length,numDirLightShadows:J.directionalShadowMap.length,numPointLightShadows:J.pointShadowMap.length,numSpotLightShadows:J.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:N.dithering,shadowMapEnabled:i.shadowMap.enabled&&ne.length>0,shadowMapType:i.shadowMap.type,toneMapping:N.toneMapped?i.toneMapping:ps,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:N.premultipliedAlpha,alphaTest:N.alphaTest,doubleSided:N.side===Xi,flipSided:N.side===qt,depthPacking:N.depthPacking!==void 0?N.depthPacking:!1,index0AttributeName:N.index0AttributeName,extensionDerivatives:N.extensions&&N.extensions.derivatives,extensionFragDepth:N.extensions&&N.extensions.fragDepth,extensionDrawBuffers:N.extensions&&N.extensions.drawBuffers,extensionShaderTextureLOD:N.extensions&&N.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||t.has("EXT_shader_texture_lod"),customProgramCacheKey:N.customProgramCacheKey()}}function x(N){const J=[];if(N.shaderID?J.push(N.shaderID):(J.push(N.fragmentShader),J.push(N.vertexShader)),N.defines!==void 0)for(const ne in N.defines)J.push(ne),J.push(N.defines[ne]);if(N.isRawShaderMaterial===!1){for(let ne=0;ne<m.length;ne++)J.push(N[m[ne]]);J.push(i.outputEncoding),J.push(i.gammaFactor)}return J.push(N.customProgramCacheKey),J.join()}function R(N){const J=f[N.type];let ne;if(J){const se=ns[J];ne=id.clone(se.uniforms)}else ne=N.uniforms;return ne}function I(N,J){let ne;for(let se=0,E=o.length;se<E;se++){const M=o[se];if(M.cacheKey===J){ne=M,++ne.usedTimes;break}}return ne===void 0&&(ne=new Zx(i,J,N,s),o.push(ne)),ne}function B(N){if(--N.usedTimes===0){const J=o.indexOf(N);o[J]=o[o.length-1],o.pop(),N.destroy()}}return{getParameters:y,getProgramCacheKey:x,getUniforms:R,acquireProgram:I,releaseProgram:B,programs:o}}function Kx(){let i=new WeakMap;function e(r){let o=i.get(r);return o===void 0&&(o={},i.set(r,o)),o}function t(r){i.delete(r)}function n(r,o,a){i.get(r)[o]=a}function s(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:s}}function Qx(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.program!==e.program?i.program.id-e.program.id:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function ew(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function ap(i){const e=[];let t=0;const n=[],s=[],r={id:-1};function o(){t=0,n.length=0,s.length=0}function a(d,f,m,v,_,y){let x=e[t];const R=i.get(m);return x===void 0?(x={id:d.id,object:d,geometry:f,material:m,program:R.program||r,groupOrder:v,renderOrder:d.renderOrder,z:_,group:y},e[t]=x):(x.id=d.id,x.object=d,x.geometry=f,x.material=m,x.program=R.program||r,x.groupOrder=v,x.renderOrder=d.renderOrder,x.z=_,x.group=y),t++,x}function l(d,f,m,v,_,y){const x=a(d,f,m,v,_,y);(m.transparent===!0?s:n).push(x)}function c(d,f,m,v,_,y){const x=a(d,f,m,v,_,y);(m.transparent===!0?s:n).unshift(x)}function u(d,f){n.length>1&&n.sort(d||Qx),s.length>1&&s.sort(f||ew)}function h(){for(let d=t,f=e.length;d<f;d++){const m=e[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.program=null,m.group=null}}return{opaque:n,transparent:s,init:o,push:l,unshift:c,finish:h,sort:u}}function tw(i){let e=new WeakMap;function t(s,r){const o=e.get(s);let a;return o===void 0?(a=new ap(i),e.set(s,new WeakMap),e.get(s).set(r,a)):(a=o.get(r),a===void 0&&(a=new ap(i),o.set(r,a))),a}function n(){e=new WeakMap}return{get:t,dispose:n}}function iw(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new S,color:new Ee};break;case"SpotLight":t={position:new S,direction:new S,color:new Ee,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new S,color:new Ee,distance:0,decay:0};break;case"HemisphereLight":t={direction:new S,skyColor:new Ee,groundColor:new Ee};break;case"RectAreaLight":t={color:new Ee,position:new S,halfWidth:new S,halfHeight:new S};break}return i[e.id]=t,t}}}function nw(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let sw=0;function rw(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function ow(i,e){const t=new iw,n=nw(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)s.probe.push(new S);const r=new S,o=new xe,a=new xe;function l(u){let h=0,d=0,f=0;for(let J=0;J<9;J++)s.probe[J].set(0,0,0);let m=0,v=0,_=0,y=0,x=0,R=0,I=0,B=0;u.sort(rw);for(let J=0,ne=u.length;J<ne;J++){const se=u[J],E=se.color,M=se.intensity,A=se.distance,F=se.shadow&&se.shadow.map?se.shadow.map.texture:null;if(se.isAmbientLight)h+=E.r*M,d+=E.g*M,f+=E.b*M;else if(se.isLightProbe)for(let P=0;P<9;P++)s.probe[P].addScaledVector(se.sh.coefficients[P],M);else if(se.isDirectionalLight){const P=t.get(se);if(P.color.copy(se.color).multiplyScalar(se.intensity),se.castShadow){const O=se.shadow,V=n.get(se);V.shadowBias=O.bias,V.shadowNormalBias=O.normalBias,V.shadowRadius=O.radius,V.shadowMapSize=O.mapSize,s.directionalShadow[m]=V,s.directionalShadowMap[m]=F,s.directionalShadowMatrix[m]=se.shadow.matrix,R++}s.directional[m]=P,m++}else if(se.isSpotLight){const P=t.get(se);if(P.position.setFromMatrixPosition(se.matrixWorld),P.color.copy(E).multiplyScalar(M),P.distance=A,P.coneCos=Math.cos(se.angle),P.penumbraCos=Math.cos(se.angle*(1-se.penumbra)),P.decay=se.decay,se.castShadow){const O=se.shadow,V=n.get(se);V.shadowBias=O.bias,V.shadowNormalBias=O.normalBias,V.shadowRadius=O.radius,V.shadowMapSize=O.mapSize,s.spotShadow[_]=V,s.spotShadowMap[_]=F,s.spotShadowMatrix[_]=se.shadow.matrix,B++}s.spot[_]=P,_++}else if(se.isRectAreaLight){const P=t.get(se);P.color.copy(E).multiplyScalar(M),P.halfWidth.set(se.width*.5,0,0),P.halfHeight.set(0,se.height*.5,0),s.rectArea[y]=P,y++}else if(se.isPointLight){const P=t.get(se);if(P.color.copy(se.color).multiplyScalar(se.intensity),P.distance=se.distance,P.decay=se.decay,se.castShadow){const O=se.shadow,V=n.get(se);V.shadowBias=O.bias,V.shadowNormalBias=O.normalBias,V.shadowRadius=O.radius,V.shadowMapSize=O.mapSize,V.shadowCameraNear=O.camera.near,V.shadowCameraFar=O.camera.far,s.pointShadow[v]=V,s.pointShadowMap[v]=F,s.pointShadowMatrix[v]=se.shadow.matrix,I++}s.point[v]=P,v++}else if(se.isHemisphereLight){const P=t.get(se);P.skyColor.copy(se.color).multiplyScalar(M),P.groundColor.copy(se.groundColor).multiplyScalar(M),s.hemi[x]=P,x++}}y>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=mt.LTC_FLOAT_1,s.rectAreaLTC2=mt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=mt.LTC_HALF_1,s.rectAreaLTC2=mt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=h,s.ambient[1]=d,s.ambient[2]=f;const N=s.hash;(N.directionalLength!==m||N.pointLength!==v||N.spotLength!==_||N.rectAreaLength!==y||N.hemiLength!==x||N.numDirectionalShadows!==R||N.numPointShadows!==I||N.numSpotShadows!==B)&&(s.directional.length=m,s.spot.length=_,s.rectArea.length=y,s.point.length=v,s.hemi.length=x,s.directionalShadow.length=R,s.directionalShadowMap.length=R,s.pointShadow.length=I,s.pointShadowMap.length=I,s.spotShadow.length=B,s.spotShadowMap.length=B,s.directionalShadowMatrix.length=R,s.pointShadowMatrix.length=I,s.spotShadowMatrix.length=B,N.directionalLength=m,N.pointLength=v,N.spotLength=_,N.rectAreaLength=y,N.hemiLength=x,N.numDirectionalShadows=R,N.numPointShadows=I,N.numSpotShadows=B,s.version=sw++)}function c(u,h){let d=0,f=0,m=0,v=0,_=0;const y=h.matrixWorldInverse;for(let x=0,R=u.length;x<R;x++){const I=u[x];if(I.isDirectionalLight){const B=s.directional[d];B.direction.setFromMatrixPosition(I.matrixWorld),r.setFromMatrixPosition(I.target.matrixWorld),B.direction.sub(r),B.direction.transformDirection(y),d++}else if(I.isSpotLight){const B=s.spot[m];B.position.setFromMatrixPosition(I.matrixWorld),B.position.applyMatrix4(y),B.direction.setFromMatrixPosition(I.matrixWorld),r.setFromMatrixPosition(I.target.matrixWorld),B.direction.sub(r),B.direction.transformDirection(y),m++}else if(I.isRectAreaLight){const B=s.rectArea[v];B.position.setFromMatrixPosition(I.matrixWorld),B.position.applyMatrix4(y),a.identity(),o.copy(I.matrixWorld),o.premultiply(y),a.extractRotation(o),B.halfWidth.set(I.width*.5,0,0),B.halfHeight.set(0,I.height*.5,0),B.halfWidth.applyMatrix4(a),B.halfHeight.applyMatrix4(a),v++}else if(I.isPointLight){const B=s.point[f];B.position.setFromMatrixPosition(I.matrixWorld),B.position.applyMatrix4(y),f++}else if(I.isHemisphereLight){const B=s.hemi[_];B.direction.setFromMatrixPosition(I.matrixWorld),B.direction.transformDirection(y),B.direction.normalize(),_++}}}return{setup:l,setupView:c,state:s}}function lp(i,e){const t=new ow(i,e),n=[],s=[];function r(){n.length=0,s.length=0}function o(h){n.push(h)}function a(h){s.push(h)}function l(){t.setup(n)}function c(h){t.setupView(n,h)}return{init:r,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function aw(i,e){let t=new WeakMap;function n(r,o=0){let a;return t.has(r)===!1?(a=new lp(i,e),t.set(r,[]),t.get(r).push(a)):o>=t.get(r).length?(a=new lp(i,e),t.get(r).push(a)):a=t.get(r)[o],a}function s(){t=new WeakMap}return{get:n,dispose:s}}function Fa(i){Nt.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ke,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(i)}Fa.prototype=Object.create(Nt.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isMeshDepthMaterial=!0,Fa.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.depthPacking=i.depthPacking,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this};function Ba(i){Nt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new S,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(i)}Ba.prototype=Object.create(Nt.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isMeshDistanceMaterial=!0,Ba.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this};var lw=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,cw=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function cp(i,e,t){let n=new Pl;const s=new Se,r=new Se,o=new _t,a=[],l=[],c={},u={0:qt,1:Kt,2:Xi},h=new In({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Se},radius:{value:4}},vertexShader:cw,fragmentShader:lw}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const f=new wt;f.setAttribute("position",new tt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new ot(f,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Nn,this.render=function(B,N,J){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||B.length===0)return;const ne=i.getRenderTarget(),se=i.getActiveCubeFace(),E=i.getActiveMipmapLevel(),M=i.state;M.setBlending(cn),M.buffers.color.setClear(1,1,1,1),M.buffers.depth.setTest(!0),M.setScissorTest(!1);for(let A=0,F=B.length;A<F;A++){const P=B[A],O=P.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;s.copy(O.mapSize);const V=O.getFrameExtents();if(s.multiply(V),r.copy(O.mapSize),(s.x>t||s.y>t)&&(s.x>t&&(r.x=Math.floor(t/V.x),s.x=r.x*V.x,O.mapSize.x=r.x),s.y>t&&(r.y=Math.floor(t/V.y),s.y=r.y*V.y,O.mapSize.y=r.y)),O.map===null&&!O.isPointLightShadow&&this.type===Ds){const fe={minFilter:et,magFilter:et,format:jt};O.map=new bi(s.x,s.y,fe),O.map.texture.name=P.name+".shadowMap",O.mapPass=new bi(s.x,s.y,fe),O.camera.updateProjectionMatrix()}if(O.map===null){const fe={minFilter:ei,magFilter:ei,format:jt};O.map=new bi(s.x,s.y,fe),O.map.texture.name=P.name+".shadowMap",O.camera.updateProjectionMatrix()}i.setRenderTarget(O.map),i.clear();const W=O.getViewportCount();for(let fe=0;fe<W;fe++){const ve=O.getViewport(fe);o.set(r.x*ve.x,r.y*ve.y,r.x*ve.z,r.y*ve.w),M.viewport(o),O.updateMatrices(P,fe),n=O.getFrustum(),I(N,J,O.camera,P,this.type)}!O.isPointLightShadow&&this.type===Ds&&_(O,J),O.needsUpdate=!1}v.needsUpdate=!1,i.setRenderTarget(ne,se,E)};function _(B,N){const J=e.update(m);h.uniforms.shadow_pass.value=B.map.texture,h.uniforms.resolution.value=B.mapSize,h.uniforms.radius.value=B.radius,i.setRenderTarget(B.mapPass),i.clear(),i.renderBufferDirect(N,null,J,h,m,null),d.uniforms.shadow_pass.value=B.mapPass.texture,d.uniforms.resolution.value=B.mapSize,d.uniforms.radius.value=B.radius,i.setRenderTarget(B.map),i.clear(),i.renderBufferDirect(N,null,J,d,m,null)}function y(B,N,J){const ne=B<<0|N<<1|J<<2;let se=a[ne];return se===void 0&&(se=new Fa({depthPacking:Re,morphTargets:B,skinning:N}),a[ne]=se),se}function x(B,N,J){const ne=B<<0|N<<1|J<<2;let se=l[ne];return se===void 0&&(se=new Ba({morphTargets:B,skinning:N}),l[ne]=se),se}function R(B,N,J,ne,se,E,M){let A=null,F=y,P=B.customDepthMaterial;if(ne.isPointLight===!0&&(F=x,P=B.customDistanceMaterial),P===void 0){let O=!1;J.morphTargets===!0&&(O=N.morphAttributes&&N.morphAttributes.position&&N.morphAttributes.position.length>0);let V=!1;B.isSkinnedMesh===!0&&(J.skinning===!0?V=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",B));const W=B.isInstancedMesh===!0;A=F(O,V,W)}else A=P;if(i.localClippingEnabled&&J.clipShadows===!0&&J.clippingPlanes.length!==0){const O=A.uuid,V=J.uuid;let W=c[O];W===void 0&&(W={},c[O]=W);let fe=W[V];fe===void 0&&(fe=A.clone(),W[V]=fe),A=fe}return A.visible=J.visible,A.wireframe=J.wireframe,M===Ds?A.side=J.shadowSide!==null?J.shadowSide:J.side:A.side=J.shadowSide!==null?J.shadowSide:u[J.side],A.clipShadows=J.clipShadows,A.clippingPlanes=J.clippingPlanes,A.clipIntersection=J.clipIntersection,A.wireframeLinewidth=J.wireframeLinewidth,A.linewidth=J.linewidth,ne.isPointLight===!0&&A.isMeshDistanceMaterial===!0&&(A.referencePosition.setFromMatrixPosition(ne.matrixWorld),A.nearDistance=se,A.farDistance=E),A}function I(B,N,J,ne,se){if(B.visible===!1)return;if(B.layers.test(N.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&se===Ds)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(J.matrixWorldInverse,B.matrixWorld);const A=e.update(B),F=B.material;if(Array.isArray(F)){const P=A.groups;for(let O=0,V=P.length;O<V;O++){const W=P[O],fe=F[W.materialIndex];if(fe&&fe.visible){const ve=R(B,A,fe,ne,J.near,J.far,se);i.renderBufferDirect(J,null,A,ve,B,W)}}}else if(F.visible){const P=R(B,A,F,ne,J.near,J.far,se);i.renderBufferDirect(J,null,A,P,B,null)}}const M=B.children;for(let A=0,F=M.length;A<F;A++)I(M[A],N,J,ne,se)}}function uw(i,e,t){const n=t.isWebGL2;function s(){let ye=!1;const Je=new _t;let it=null;const lt=new _t(0,0,0,0);return{setMask:function(nt){it!==nt&&!ye&&(i.colorMask(nt,nt,nt,nt),it=nt)},setLocked:function(nt){ye=nt},setClear:function(nt,xt,At,kt,gt){gt===!0&&(nt*=kt,xt*=kt,At*=kt),Je.set(nt,xt,At,kt),lt.equals(Je)===!1&&(i.clearColor(nt,xt,At,kt),lt.copy(Je))},reset:function(){ye=!1,it=null,lt.set(-1,0,0,0)}}}function r(){let ye=!1,Je=null,it=null,lt=null;return{setTest:function(nt){nt?pe(2929):Me(2929)},setMask:function(nt){Je!==nt&&!ye&&(i.depthMask(nt),Je=nt)},setFunc:function(nt){if(it!==nt){if(nt)switch(nt){case cc:i.depthFunc(512);break;case Lo:i.depthFunc(519);break;case fs:i.depthFunc(513);break;case kn:i.depthFunc(515);break;case Ro:i.depthFunc(514);break;case Ls:i.depthFunc(518);break;case Bt:i.depthFunc(516);break;case gn:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);it=nt}},setLocked:function(nt){ye=nt},setClear:function(nt){lt!==nt&&(i.clearDepth(nt),lt=nt)},reset:function(){ye=!1,Je=null,it=null,lt=null}}}function o(){let ye=!1,Je=null,it=null,lt=null,nt=null,xt=null,At=null,kt=null,gt=null;return{setTest:function(Rt){ye||(Rt?pe(2960):Me(2960))},setMask:function(Rt){Je!==Rt&&!ye&&(i.stencilMask(Rt),Je=Rt)},setFunc:function(Rt,ii,En){(it!==Rt||lt!==ii||nt!==En)&&(i.stencilFunc(Rt,ii,En),it=Rt,lt=ii,nt=En)},setOp:function(Rt,ii,En){(xt!==Rt||At!==ii||kt!==En)&&(i.stencilOp(Rt,ii,En),xt=Rt,At=ii,kt=En)},setLocked:function(Rt){ye=Rt},setClear:function(Rt){gt!==Rt&&(i.clearStencil(Rt),gt=Rt)},reset:function(){ye=!1,Je=null,it=null,lt=null,nt=null,xt=null,At=null,kt=null,gt=null}}}const a=new s,l=new r,c=new o;let u={},h=null,d=null,f=null,m=null,v=null,_=null,y=null,x=null,R=null,I=!1,B=null,N=null,J=null,ne=null,se=null;const E=i.getParameter(35661);let M=!1,A=0;const F=i.getParameter(7938);F.indexOf("WebGL")!==-1?(A=parseFloat(/^WebGL (\d)/.exec(F)[1]),M=A>=1):F.indexOf("OpenGL ES")!==-1&&(A=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),M=A>=2);let P=null,O={};const V=new _t,W=new _t;function fe(ye,Je,it){const lt=new Uint8Array(4),nt=i.createTexture();i.bindTexture(ye,nt),i.texParameteri(ye,10241,9728),i.texParameteri(ye,10240,9728);for(let xt=0;xt<it;xt++)i.texImage2D(Je+xt,0,6408,1,1,0,6408,5121,lt);return nt}const ve={};ve[3553]=fe(3553,3553,1),ve[34067]=fe(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),pe(2929),l.setFunc(kn),X(!1),ce(An),pe(2884),Ie(cn);function pe(ye){u[ye]!==!0&&(i.enable(ye),u[ye]=!0)}function Me(ye){u[ye]!==!1&&(i.disable(ye),u[ye]=!1)}function Fe(ye){return h!==ye?(i.useProgram(ye),h=ye,!0):!1}const at={[mn]:32774,[On]:32778,[nn]:32779};if(n)at[hs]=32775,at[ds]=32776;else{const ye=e.get("EXT_blend_minmax");ye!==null&&(at[hs]=ye.MIN_EXT,at[ds]=ye.MAX_EXT)}const bt={[Xr]:0,[ga]:1,[sl]:768,[va]:770,[xa]:776,[Xs]:774,[Dn]:772,[Do]:769,[Po]:771,[vr]:775,[ya]:773};function Ie(ye,Je,it,lt,nt,xt,At,kt){if(ye===cn){d&&(Me(3042),d=!1);return}if(d||(pe(3042),d=!0),ye!==Cn){if(ye!==f||kt!==I){if((m!==mn||y!==mn)&&(i.blendEquation(32774),m=mn,y=mn),kt)switch(ye){case Ps:i.blendFuncSeparate(1,771,1,771);break;case Ht:i.blendFunc(1,1);break;case Vt:i.blendFuncSeparate(0,0,769,771);break;case pn:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye);break}else switch(ye){case Ps:i.blendFuncSeparate(770,771,1,771);break;case Ht:i.blendFunc(770,1);break;case Vt:i.blendFunc(0,769);break;case pn:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye);break}v=null,_=null,x=null,R=null,f=ye,I=kt}return}nt=nt||Je,xt=xt||it,At=At||lt,(Je!==m||nt!==y)&&(i.blendEquationSeparate(at[Je],at[nt]),m=Je,y=nt),(it!==v||lt!==_||xt!==x||At!==R)&&(i.blendFuncSeparate(bt[it],bt[lt],bt[xt],bt[At]),v=it,_=lt,x=xt,R=At),f=ye,I=null}function Y(ye,Je){ye.side===Xi?Me(2884):pe(2884);let it=ye.side===qt;Je&&(it=!it),X(it),ye.blending===Ps&&ye.transparent===!1?Ie(cn):Ie(ye.blending,ye.blendEquation,ye.blendSrc,ye.blendDst,ye.blendEquationAlpha,ye.blendSrcAlpha,ye.blendDstAlpha,ye.premultipliedAlpha),l.setFunc(ye.depthFunc),l.setTest(ye.depthTest),l.setMask(ye.depthWrite),a.setMask(ye.colorWrite);const lt=ye.stencilWrite;c.setTest(lt),lt&&(c.setMask(ye.stencilWriteMask),c.setFunc(ye.stencilFunc,ye.stencilRef,ye.stencilFuncMask),c.setOp(ye.stencilFail,ye.stencilZFail,ye.stencilZPass)),he(ye.polygonOffset,ye.polygonOffsetFactor,ye.polygonOffsetUnits)}function X(ye){B!==ye&&(ye?i.frontFace(2304):i.frontFace(2305),B=ye)}function ce(ye){ye!==Ni?(pe(2884),ye!==N&&(ye===An?i.cullFace(1029):ye===fn?i.cullFace(1028):i.cullFace(1032))):Me(2884),N=ye}function ie(ye){ye!==J&&(M&&i.lineWidth(ye),J=ye)}function he(ye,Je,it){ye?(pe(32823),(ne!==Je||se!==it)&&(i.polygonOffset(Je,it),ne=Je,se=it)):Me(32823)}function ge(ye){ye?pe(3089):Me(3089)}function le(ye){ye===void 0&&(ye=33984+E-1),P!==ye&&(i.activeTexture(ye),P=ye)}function oe(ye,Je){P===null&&le();let it=O[P];it===void 0&&(it={type:void 0,texture:void 0},O[P]=it),(it.type!==ye||it.texture!==Je)&&(i.bindTexture(ye,Je||ve[ye]),it.type=ye,it.texture=Je)}function we(){const ye=O[P];ye!==void 0&&ye.type!==void 0&&(i.bindTexture(ye.type,null),ye.type=void 0,ye.texture=void 0)}function Le(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function Ae(){try{i.texImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function K(){try{i.texImage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function Q(ye){V.equals(ye)===!1&&(i.scissor(ye.x,ye.y,ye.z,ye.w),V.copy(ye))}function Ue(ye){W.equals(ye)===!1&&(i.viewport(ye.x,ye.y,ye.z,ye.w),W.copy(ye))}function Be(){u={},P=null,O={},h=null,d=null,f=null,m=null,v=null,_=null,y=null,x=null,R=null,I=!1,B=null,N=null,J=null,ne=null,se=null,a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:pe,disable:Me,useProgram:Fe,setBlending:Ie,setMaterial:Y,setFlipSided:X,setCullFace:ce,setLineWidth:ie,setPolygonOffset:he,setScissorTest:ge,activeTexture:le,bindTexture:oe,unbindTexture:we,compressedTexImage2D:Le,texImage2D:Ae,texImage3D:K,scissor:Q,viewport:Ue,reset:Be}}function hw(i,e,t,n,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,u=s.maxTextureSize,h=s.maxSamples,d=new WeakMap;let f,m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(K,Q){return m?new OffscreenCanvas(K,Q):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(K,Q,Ue,Be){let ye=1;if((K.width>Be||K.height>Be)&&(ye=Be/Math.max(K.width,K.height)),ye<1||Q===!0)if(typeof HTMLImageElement<"u"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&K instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&K instanceof ImageBitmap){const Je=Q?rt.floorPowerOfTwo:Math.floor,it=Je(ye*K.width),lt=Je(ye*K.height);f===void 0&&(f=v(it,lt));const nt=Ue?v(it,lt):f;return nt.width=it,nt.height=lt,nt.getContext("2d").drawImage(K,0,0,it,lt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+K.width+"x"+K.height+") to ("+it+"x"+lt+")."),nt}else return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+K.width+"x"+K.height+")."),K;return K}function y(K){return rt.isPowerOfTwo(K.width)&&rt.isPowerOfTwo(K.height)}function x(K){return a?!1:K.wrapS!==li||K.wrapT!==li||K.minFilter!==ei&&K.minFilter!==et}function R(K,Q){return K.generateMipmaps&&Q&&K.minFilter!==ei&&K.minFilter!==et}function I(K,Q,Ue,Be){i.generateMipmap(K);const ye=n.get(Q);ye.__maxMipLevel=Math.log(Math.max(Ue,Be))*Math.LOG2E}function B(K,Q,Ue){if(a===!1)return Q;if(K!==null){if(i[K]!==void 0)return i[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let Be=Q;return Q===6403&&(Ue===5126&&(Be=33326),Ue===5131&&(Be=33325),Ue===5121&&(Be=33321)),Q===6407&&(Ue===5126&&(Be=34837),Ue===5131&&(Be=34843),Ue===5121&&(Be=32849)),Q===6408&&(Ue===5126&&(Be=34836),Ue===5131&&(Be=34842),Ue===5121&&(Be=32856)),(Be===33325||Be===33326||Be===34842||Be===34836)&&e.get("EXT_color_buffer_float"),Be}function N(K){return K===ei||K===Yr||K===Pn?9728:9729}function J(K){const Q=K.target;Q.removeEventListener("dispose",J),se(Q),Q.isVideoTexture&&d.delete(Q),o.memory.textures--}function ne(K){const Q=K.target;Q.removeEventListener("dispose",ne),E(Q),o.memory.textures--}function se(K){const Q=n.get(K);Q.__webglInit!==void 0&&(i.deleteTexture(Q.__webglTexture),n.remove(K))}function E(K){const Q=n.get(K),Ue=n.get(K.texture);if(K){if(Ue.__webglTexture!==void 0&&i.deleteTexture(Ue.__webglTexture),K.depthTexture&&K.depthTexture.dispose(),K.isWebGLCubeRenderTarget)for(let Be=0;Be<6;Be++)i.deleteFramebuffer(Q.__webglFramebuffer[Be]),Q.__webglDepthbuffer&&i.deleteRenderbuffer(Q.__webglDepthbuffer[Be]);else i.deleteFramebuffer(Q.__webglFramebuffer),Q.__webglDepthbuffer&&i.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&i.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer&&i.deleteRenderbuffer(Q.__webglColorRenderbuffer),Q.__webglDepthRenderbuffer&&i.deleteRenderbuffer(Q.__webglDepthRenderbuffer);n.remove(K.texture),n.remove(K)}}let M=0;function A(){M=0}function F(){const K=M;return K>=l&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+l),M+=1,K}function P(K,Q){const Ue=n.get(K);if(K.isVideoTexture&&le(K),K.version>0&&Ue.__version!==K.version){const Be=K.image;if(Be===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Be.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Fe(Ue,K,Q);return}}t.activeTexture(33984+Q),t.bindTexture(3553,Ue.__webglTexture)}function O(K,Q){const Ue=n.get(K);if(K.version>0&&Ue.__version!==K.version){Fe(Ue,K,Q);return}t.activeTexture(33984+Q),t.bindTexture(35866,Ue.__webglTexture)}function V(K,Q){const Ue=n.get(K);if(K.version>0&&Ue.__version!==K.version){Fe(Ue,K,Q);return}t.activeTexture(33984+Q),t.bindTexture(32879,Ue.__webglTexture)}function W(K,Q){const Ue=n.get(K);if(K.version>0&&Ue.__version!==K.version){at(Ue,K,Q);return}t.activeTexture(33984+Q),t.bindTexture(34067,Ue.__webglTexture)}const fe={[vi]:10497,[li]:33071,[Kn]:33648},ve={[ei]:9728,[Yr]:9984,[Pn]:9986,[et]:9729,[sn]:9985,[Rs]:9987};function pe(K,Q,Ue){Ue?(i.texParameteri(K,10242,fe[Q.wrapS]),i.texParameteri(K,10243,fe[Q.wrapT]),(K===32879||K===35866)&&i.texParameteri(K,32882,fe[Q.wrapR]),i.texParameteri(K,10240,ve[Q.magFilter]),i.texParameteri(K,10241,ve[Q.minFilter])):(i.texParameteri(K,10242,33071),i.texParameteri(K,10243,33071),(K===32879||K===35866)&&i.texParameteri(K,32882,33071),(Q.wrapS!==li||Q.wrapT!==li)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(K,10240,N(Q.magFilter)),i.texParameteri(K,10241,N(Q.minFilter)),Q.minFilter!==ei&&Q.minFilter!==et&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const Be=e.get("EXT_texture_filter_anisotropic");if(Be){if(Q.type===vn&&e.get("OES_texture_float_linear")===null||Q.type===br&&(a||e.get("OES_texture_half_float_linear"))===null)return;(Q.anisotropy>1||n.get(Q).__currentAnisotropy)&&(i.texParameterf(K,Be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,s.getMaxAnisotropy())),n.get(Q).__currentAnisotropy=Q.anisotropy)}}function Me(K,Q){K.__webglInit===void 0&&(K.__webglInit=!0,Q.addEventListener("dispose",J),K.__webglTexture=i.createTexture(),o.memory.textures++)}function Fe(K,Q,Ue){let Be=3553;Q.isDataTexture2DArray&&(Be=35866),Q.isDataTexture3D&&(Be=32879),Me(K,Q),t.activeTexture(33984+Ue),t.bindTexture(Be,K.__webglTexture),i.pixelStorei(37440,Q.flipY),i.pixelStorei(37441,Q.premultiplyAlpha),i.pixelStorei(3317,Q.unpackAlignment);const ye=x(Q)&&y(Q.image)===!1,Je=_(Q.image,ye,!1,u),it=y(Je)||a,lt=r.convert(Q.format);let nt=r.convert(Q.type),xt=B(Q.internalFormat,lt,nt);pe(Be,Q,it);let At;const kt=Q.mipmaps;if(Q.isDepthTexture)xt=6402,a?Q.type===vn?xt=36012:Q.type===es?xt=33190:Q.type===Js?xt=35056:xt=33189:Q.type===vn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Q.format===Qs&&xt===6402&&Q.type!==Kr&&Q.type!==es&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Q.type=Kr,nt=r.convert(Q.type)),Q.format===Fs&&xt===6402&&(xt=34041,Q.type!==Js&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Q.type=Js,nt=r.convert(Q.type))),t.texImage2D(3553,0,xt,Je.width,Je.height,0,lt,nt,null);else if(Q.isDataTexture)if(kt.length>0&&it){for(let gt=0,Rt=kt.length;gt<Rt;gt++)At=kt[gt],t.texImage2D(3553,gt,xt,At.width,At.height,0,lt,nt,At.data);Q.generateMipmaps=!1,K.__maxMipLevel=kt.length-1}else t.texImage2D(3553,0,xt,Je.width,Je.height,0,lt,nt,Je.data),K.__maxMipLevel=0;else if(Q.isCompressedTexture){for(let gt=0,Rt=kt.length;gt<Rt;gt++)At=kt[gt],Q.format!==jt&&Q.format!==Yi?lt!==null?t.compressedTexImage2D(3553,gt,xt,At.width,At.height,0,At.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,gt,xt,At.width,At.height,0,lt,nt,At.data);K.__maxMipLevel=kt.length-1}else if(Q.isDataTexture2DArray)t.texImage3D(35866,0,xt,Je.width,Je.height,Je.depth,0,lt,nt,Je.data),K.__maxMipLevel=0;else if(Q.isDataTexture3D)t.texImage3D(32879,0,xt,Je.width,Je.height,Je.depth,0,lt,nt,Je.data),K.__maxMipLevel=0;else if(kt.length>0&&it){for(let gt=0,Rt=kt.length;gt<Rt;gt++)At=kt[gt],t.texImage2D(3553,gt,xt,lt,nt,At);Q.generateMipmaps=!1,K.__maxMipLevel=kt.length-1}else t.texImage2D(3553,0,xt,lt,nt,Je),K.__maxMipLevel=0;R(Q,it)&&I(Be,Q,Je.width,Je.height),K.__version=Q.version,Q.onUpdate&&Q.onUpdate(Q)}function at(K,Q,Ue){if(Q.image.length!==6)return;Me(K,Q),t.activeTexture(33984+Ue),t.bindTexture(34067,K.__webglTexture),i.pixelStorei(37440,Q.flipY);const Be=Q&&(Q.isCompressedTexture||Q.image[0].isCompressedTexture),ye=Q.image[0]&&Q.image[0].isDataTexture,Je=[];for(let gt=0;gt<6;gt++)!Be&&!ye?Je[gt]=_(Q.image[gt],!1,!0,c):Je[gt]=ye?Q.image[gt].image:Q.image[gt];const it=Je[0],lt=y(it)||a,nt=r.convert(Q.format),xt=r.convert(Q.type),At=B(Q.internalFormat,nt,xt);pe(34067,Q,lt);let kt;if(Be){for(let gt=0;gt<6;gt++){kt=Je[gt].mipmaps;for(let Rt=0;Rt<kt.length;Rt++){const ii=kt[Rt];Q.format!==jt&&Q.format!==Yi?nt!==null?t.compressedTexImage2D(34069+gt,Rt,At,ii.width,ii.height,0,ii.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+gt,Rt,At,ii.width,ii.height,0,nt,xt,ii.data)}}K.__maxMipLevel=kt.length-1}else{kt=Q.mipmaps;for(let gt=0;gt<6;gt++)if(ye){t.texImage2D(34069+gt,0,At,Je[gt].width,Je[gt].height,0,nt,xt,Je[gt].data);for(let Rt=0;Rt<kt.length;Rt++){const En=kt[Rt].image[gt].image;t.texImage2D(34069+gt,Rt+1,At,En.width,En.height,0,nt,xt,En.data)}}else{t.texImage2D(34069+gt,0,At,nt,xt,Je[gt]);for(let Rt=0;Rt<kt.length;Rt++){const ii=kt[Rt];t.texImage2D(34069+gt,Rt+1,At,nt,xt,ii.image[gt])}}K.__maxMipLevel=kt.length}R(Q,lt)&&I(34067,Q,it.width,it.height),K.__version=Q.version,Q.onUpdate&&Q.onUpdate(Q)}function bt(K,Q,Ue,Be){const ye=r.convert(Q.texture.format),Je=r.convert(Q.texture.type),it=B(Q.texture.internalFormat,ye,Je);t.texImage2D(Be,0,it,Q.width,Q.height,0,ye,Je,null),i.bindFramebuffer(36160,K),i.framebufferTexture2D(36160,Ue,Be,n.get(Q.texture).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ie(K,Q,Ue){if(i.bindRenderbuffer(36161,K),Q.depthBuffer&&!Q.stencilBuffer){let Be=33189;if(Ue){const ye=Q.depthTexture;ye&&ye.isDepthTexture&&(ye.type===vn?Be=36012:ye.type===es&&(Be=33190));const Je=ge(Q);i.renderbufferStorageMultisample(36161,Je,Be,Q.width,Q.height)}else i.renderbufferStorage(36161,Be,Q.width,Q.height);i.framebufferRenderbuffer(36160,36096,36161,K)}else if(Q.depthBuffer&&Q.stencilBuffer){if(Ue){const Be=ge(Q);i.renderbufferStorageMultisample(36161,Be,35056,Q.width,Q.height)}else i.renderbufferStorage(36161,34041,Q.width,Q.height);i.framebufferRenderbuffer(36160,33306,36161,K)}else{const Be=r.convert(Q.texture.format),ye=r.convert(Q.texture.type),Je=B(Q.texture.internalFormat,Be,ye);if(Ue){const it=ge(Q);i.renderbufferStorageMultisample(36161,it,Je,Q.width,Q.height)}else i.renderbufferStorage(36161,Je,Q.width,Q.height)}i.bindRenderbuffer(36161,null)}function Y(K,Q){if(Q&&Q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,K),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(Q.depthTexture).__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),P(Q.depthTexture,0);const Be=n.get(Q.depthTexture).__webglTexture;if(Q.depthTexture.format===Qs)i.framebufferTexture2D(36160,36096,3553,Be,0);else if(Q.depthTexture.format===Fs)i.framebufferTexture2D(36160,33306,3553,Be,0);else throw new Error("Unknown depthTexture format")}function X(K){const Q=n.get(K),Ue=K.isWebGLCubeRenderTarget===!0;if(K.depthTexture){if(Ue)throw new Error("target.depthTexture not supported in Cube render targets");Y(Q.__webglFramebuffer,K)}else if(Ue){Q.__webglDepthbuffer=[];for(let Be=0;Be<6;Be++)i.bindFramebuffer(36160,Q.__webglFramebuffer[Be]),Q.__webglDepthbuffer[Be]=i.createRenderbuffer(),Ie(Q.__webglDepthbuffer[Be],K,!1)}else i.bindFramebuffer(36160,Q.__webglFramebuffer),Q.__webglDepthbuffer=i.createRenderbuffer(),Ie(Q.__webglDepthbuffer,K,!1);i.bindFramebuffer(36160,null)}function ce(K){const Q=n.get(K),Ue=n.get(K.texture);K.addEventListener("dispose",ne),Ue.__webglTexture=i.createTexture(),o.memory.textures++;const Be=K.isWebGLCubeRenderTarget===!0,ye=K.isWebGLMultisampleRenderTarget===!0,Je=y(K)||a;if(a&&K.texture.format===Yi&&(K.texture.type===vn||K.texture.type===br)&&(K.texture.format=jt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Be){Q.__webglFramebuffer=[];for(let it=0;it<6;it++)Q.__webglFramebuffer[it]=i.createFramebuffer()}else if(Q.__webglFramebuffer=i.createFramebuffer(),ye)if(a){Q.__webglMultisampledFramebuffer=i.createFramebuffer(),Q.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,Q.__webglColorRenderbuffer);const it=r.convert(K.texture.format),lt=r.convert(K.texture.type),nt=B(K.texture.internalFormat,it,lt),xt=ge(K);i.renderbufferStorageMultisample(36161,xt,nt,K.width,K.height),i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,Q.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),K.depthBuffer&&(Q.__webglDepthRenderbuffer=i.createRenderbuffer(),Ie(Q.__webglDepthRenderbuffer,K,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Be){t.bindTexture(34067,Ue.__webglTexture),pe(34067,K.texture,Je);for(let it=0;it<6;it++)bt(Q.__webglFramebuffer[it],K,36064,34069+it);R(K.texture,Je)&&I(34067,K.texture,K.width,K.height),t.bindTexture(34067,null)}else t.bindTexture(3553,Ue.__webglTexture),pe(3553,K.texture,Je),bt(Q.__webglFramebuffer,K,36064,3553),R(K.texture,Je)&&I(3553,K.texture,K.width,K.height),t.bindTexture(3553,null);K.depthBuffer&&X(K)}function ie(K){const Q=K.texture,Ue=y(K)||a;if(R(Q,Ue)){const Be=K.isWebGLCubeRenderTarget?34067:3553,ye=n.get(Q).__webglTexture;t.bindTexture(Be,ye),I(Be,Q,K.width,K.height),t.bindTexture(Be,null)}}function he(K){if(K.isWebGLMultisampleRenderTarget)if(a){const Q=n.get(K);i.bindFramebuffer(36008,Q.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Q.__webglFramebuffer);const Ue=K.width,Be=K.height;let ye=16384;K.depthBuffer&&(ye|=256),K.stencilBuffer&&(ye|=1024),i.blitFramebuffer(0,0,Ue,Be,0,0,Ue,Be,ye,9728),i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function ge(K){return a&&K.isWebGLMultisampleRenderTarget?Math.min(h,K.samples):0}function le(K){const Q=o.render.frame;d.get(K)!==Q&&(d.set(K,Q),K.update())}let oe=!1,we=!1;function Le(K,Q){K&&K.isWebGLRenderTarget&&(oe===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),oe=!0),K=K.texture),P(K,Q)}function Ae(K,Q){K&&K.isWebGLCubeRenderTarget&&(we===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),we=!0),K=K.texture),W(K,Q)}this.allocateTextureUnit=F,this.resetTextureUnits=A,this.setTexture2D=P,this.setTexture2DArray=O,this.setTexture3D=V,this.setTextureCube=W,this.setupRenderTarget=ce,this.updateRenderTargetMipmap=ie,this.updateMultisampleRenderTarget=he,this.safeSetTexture2D=Le,this.safeSetTextureCube=Ae}function dw(i,e,t){const n=t.isWebGL2;function s(r){let o;if(r===ms)return 5121;if(r===wa)return 32819;if(r===ba)return 32820;if(r===Is)return 33635;if(r===al)return 5120;if(r===Ot)return 5122;if(r===Kr)return 5123;if(r===zi)return 5124;if(r===es)return 5125;if(r===vn)return 5126;if(r===br)return n?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(r===Fo)return 6406;if(r===Yi)return 6407;if(r===jt)return 6408;if(r===Zi)return 6409;if(r===Ks)return 6410;if(r===Qs)return 6402;if(r===Fs)return 34041;if(r===_a)return 6403;if(r===eo)return 36244;if(r===Ma)return 33319;if(r===ll)return 33320;if(r===Ea)return 36248;if(r===Bo)return 36249;if(r===Ji||r===Bs||r===$n||r===Sa)if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===Ji)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Bs)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===$n)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Sa)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===No||r===_r||r===Ns||r===er)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===No)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===_r)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Ns)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===er)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Ta)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===Oo||r===cl)&&(o=e.get("WEBGL_compressed_texture_etc"),o!==null)){if(r===Oo)return o.COMPRESSED_RGB8_ETC2;if(r===cl)return o.COMPRESSED_RGBA8_ETC2_EAC}if(r===Ln||r===ul||r===to||r===hc||r===dc||r===tr||r===ir||r===un||r===Mr||r===gs||r===Er||r===nr||r===Sr||r===sr||r===fc||r===ts||r===pc||r===mc||r===gc||r===vc||r===yc||r===xc||r===wc||r===vs||r===Aa||r===hl||r===Ca||r===dl)return o=e.get("WEBGL_compressed_texture_astc"),o!==null?r:null;if(r===ko)return o=e.get("EXT_texture_compression_bptc"),o!==null?r:null;if(r===Js)return n?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}function rd(i=[]){mi.call(this),this.cameras=i}rd.prototype=Object.assign(Object.create(mi.prototype),{constructor:rd,isArrayCamera:!0});function xn(){qe.call(this),this.type="Group"}xn.prototype=Object.assign(Object.create(qe.prototype),{constructor:xn,isGroup:!0});function Ic(){this._targetRay=null,this._grip=null,this._hand=null}Object.assign(Ic.prototype,{constructor:Ic,getHandSpace:function(){if(this._hand===null&&(this._hand=new xn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let i=0;i<=window.XRHand.LITTLE_PHALANX_TIP;i++){const e=new xn;e.matrixAutoUpdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new xn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new xn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,e,t){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,l=this._hand;if(i&&e.session.visibilityState!=="visible-blurred")if(l&&i.hand){r=!0;for(let c=0;c<=window.XRHand.LITTLE_PHALANX_TIP;c++)if(i.hand[c]){const u=e.getJointPose(i.hand[c],t),h=l.joints[c];u!==null&&(h.matrix.fromArray(u.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointRadius=u.radius),h.visible=u!==null;const d=l.joints[window.XRHand.INDEX_PHALANX_TIP],f=l.joints[window.XRHand.THUMB_PHALANX_TIP],m=d.position.distanceTo(f.position),v=.02,_=.005;l.inputState.pinching&&m>v+_?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!l.inputState.pinching&&m<=v-_&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}}else o!==null&&(n=e.getPose(i.targetRaySpace,t),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),a!==null&&i.gripSpace&&(s=e.getPose(i.gripSpace,t),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return o!==null&&(o.visible=n!==null),a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),this}});function up(i,e){const t=this;let n=null,s=1,r=null,o="local-floor",a=null;const l=[],c=new Map,u=new mi;u.layers.enable(1),u.viewport=new _t;const h=new mi;h.layers.enable(2),h.viewport=new _t;const d=[u,h],f=new rd;f.layers.enable(1),f.layers.enable(2);let m=null,v=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(M){let A=l[M];return A===void 0&&(A=new Ic,l[M]=A),A.getTargetRaySpace()},this.getControllerGrip=function(M){let A=l[M];return A===void 0&&(A=new Ic,l[M]=A),A.getGripSpace()},this.getHand=function(M){let A=l[M];return A===void 0&&(A=new Ic,l[M]=A),A.getHandSpace()};function _(M){const A=c.get(M.inputSource);A&&A.dispatchEvent({type:M.type,data:M.inputSource})}function y(){c.forEach(function(M,A){M.disconnect(A)}),c.clear(),i.setFramebuffer(null),i.setRenderTarget(i.getRenderTarget()),E.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}function x(M){r=M,E.setContext(n),E.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(M){s=M,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(M){o=M,t.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return r},this.getSession=function(){return n},this.setSession=function(M){if(n=M,n!==null){n.addEventListener("select",_),n.addEventListener("selectstart",_),n.addEventListener("selectend",_),n.addEventListener("squeeze",_),n.addEventListener("squeezestart",_),n.addEventListener("squeezeend",_),n.addEventListener("end",y);const A=e.getContextAttributes();A.xrCompatible!==!0&&e.makeXRCompatible();const F={antialias:A.antialias,alpha:A.alpha,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:s},P=new XRWebGLLayer(n,e,F);n.updateRenderState({baseLayer:P}),n.requestReferenceSpace(o).then(x),n.addEventListener("inputsourceschange",R)}};function R(M){const A=n.inputSources;for(let F=0;F<l.length;F++)c.set(A[F],l[F]);for(let F=0;F<M.removed.length;F++){const P=M.removed[F],O=c.get(P);O&&(O.dispatchEvent({type:"disconnected",data:P}),c.delete(P))}for(let F=0;F<M.added.length;F++){const P=M.added[F],O=c.get(P);O&&O.dispatchEvent({type:"connected",data:P})}}const I=new S,B=new S;function N(M,A,F){I.setFromMatrixPosition(A.matrixWorld),B.setFromMatrixPosition(F.matrixWorld);const P=I.distanceTo(B),O=A.projectionMatrix.elements,V=F.projectionMatrix.elements,W=O[14]/(O[10]-1),fe=O[14]/(O[10]+1),ve=(O[9]+1)/O[5],pe=(O[9]-1)/O[5],Me=(O[8]-1)/O[0],Fe=(V[8]+1)/V[0],at=W*Me,bt=W*Fe,Ie=P/(-Me+Fe),Y=Ie*-Me;A.matrixWorld.decompose(M.position,M.quaternion,M.scale),M.translateX(Y),M.translateZ(Ie),M.matrixWorld.compose(M.position,M.quaternion,M.scale),M.matrixWorldInverse.copy(M.matrixWorld).invert();const X=W+Ie,ce=fe+Ie,ie=at-Y,he=bt+(P-Y),ge=ve*fe/ce*X,le=pe*fe/ce*X;M.projectionMatrix.makePerspective(ie,he,ge,le,X,ce)}function J(M,A){A===null?M.matrixWorld.copy(M.matrix):M.matrixWorld.multiplyMatrices(A.matrixWorld,M.matrix),M.matrixWorldInverse.copy(M.matrixWorld).invert()}this.getCamera=function(M){f.near=h.near=u.near=M.near,f.far=h.far=u.far=M.far,(m!==f.near||v!==f.far)&&(n.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,v=f.far);const A=M.parent,F=f.cameras;J(f,A);for(let O=0;O<F.length;O++)J(F[O],A);M.matrixWorld.copy(f.matrixWorld);const P=M.children;for(let O=0,V=P.length;O<V;O++)P[O].updateMatrixWorld(!0);return F.length===2?N(f,u,h):f.projectionMatrix.copy(u.projectionMatrix),f};let ne=null;function se(M,A){if(a=A.getViewerPose(r),a!==null){const P=a.views,O=n.renderState.baseLayer;i.setFramebuffer(O.framebuffer);let V=!1;P.length!==f.cameras.length&&(f.cameras.length=0,V=!0);for(let W=0;W<P.length;W++){const fe=P[W],ve=O.getViewport(fe),pe=d[W];pe.matrix.fromArray(fe.transform.matrix),pe.projectionMatrix.fromArray(fe.projectionMatrix),pe.viewport.set(ve.x,ve.y,ve.width,ve.height),W===0&&f.matrix.copy(pe.matrix),V===!0&&f.cameras.push(pe)}}const F=n.inputSources;for(let P=0;P<l.length;P++){const O=l[P],V=F[P];O.update(V,A,r)}ne&&ne(M,A)}const E=new Gf;E.setAnimationLoop(se),this.setAnimationLoop=function(M){ne=M},this.dispose=function(){}}Object.assign(up.prototype,Rn.prototype);function fw(i){function e(y,x){y.fogColor.value.copy(x.color),x.isFog?(y.fogNear.value=x.near,y.fogFar.value=x.far):x.isFogExp2&&(y.fogDensity.value=x.density)}function t(y,x,R,I){x.isMeshBasicMaterial?n(y,x):x.isMeshLambertMaterial?(n(y,x),l(y,x)):x.isMeshToonMaterial?(n(y,x),u(y,x)):x.isMeshPhongMaterial?(n(y,x),c(y,x)):x.isMeshStandardMaterial?(n(y,x),x.isMeshPhysicalMaterial?d(y,x):h(y,x)):x.isMeshMatcapMaterial?(n(y,x),f(y,x)):x.isMeshDepthMaterial?(n(y,x),m(y,x)):x.isMeshDistanceMaterial?(n(y,x),v(y,x)):x.isMeshNormalMaterial?(n(y,x),_(y,x)):x.isLineBasicMaterial?(s(y,x),x.isLineDashedMaterial&&r(y,x)):x.isPointsMaterial?o(y,x,R,I):x.isSpriteMaterial?a(y,x):x.isShadowMaterial?(y.color.value.copy(x.color),y.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function n(y,x){y.opacity.value=x.opacity,x.color&&y.diffuse.value.copy(x.color),x.emissive&&y.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(y.map.value=x.map),x.alphaMap&&(y.alphaMap.value=x.alphaMap),x.specularMap&&(y.specularMap.value=x.specularMap);const R=i.get(x).envMap;if(R){y.envMap.value=R,y.flipEnvMap.value=R.isCubeTexture&&R._needsFlipEnvMap?-1:1,y.reflectivity.value=x.reflectivity,y.refractionRatio.value=x.refractionRatio;const N=i.get(R).__maxMipLevel;N!==void 0&&(y.maxMipLevel.value=N)}x.lightMap&&(y.lightMap.value=x.lightMap,y.lightMapIntensity.value=x.lightMapIntensity),x.aoMap&&(y.aoMap.value=x.aoMap,y.aoMapIntensity.value=x.aoMapIntensity);let I;x.map?I=x.map:x.specularMap?I=x.specularMap:x.displacementMap?I=x.displacementMap:x.normalMap?I=x.normalMap:x.bumpMap?I=x.bumpMap:x.roughnessMap?I=x.roughnessMap:x.metalnessMap?I=x.metalnessMap:x.alphaMap?I=x.alphaMap:x.emissiveMap?I=x.emissiveMap:x.clearcoatMap?I=x.clearcoatMap:x.clearcoatNormalMap?I=x.clearcoatNormalMap:x.clearcoatRoughnessMap&&(I=x.clearcoatRoughnessMap),I!==void 0&&(I.isWebGLRenderTarget&&(I=I.texture),I.matrixAutoUpdate===!0&&I.updateMatrix(),y.uvTransform.value.copy(I.matrix));let B;x.aoMap?B=x.aoMap:x.lightMap&&(B=x.lightMap),B!==void 0&&(B.isWebGLRenderTarget&&(B=B.texture),B.matrixAutoUpdate===!0&&B.updateMatrix(),y.uv2Transform.value.copy(B.matrix))}function s(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity}function r(y,x){y.dashSize.value=x.dashSize,y.totalSize.value=x.dashSize+x.gapSize,y.scale.value=x.scale}function o(y,x,R,I){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.size.value=x.size*R,y.scale.value=I*.5,x.map&&(y.map.value=x.map),x.alphaMap&&(y.alphaMap.value=x.alphaMap);let B;x.map?B=x.map:x.alphaMap&&(B=x.alphaMap),B!==void 0&&(B.matrixAutoUpdate===!0&&B.updateMatrix(),y.uvTransform.value.copy(B.matrix))}function a(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.rotation.value=x.rotation,x.map&&(y.map.value=x.map),x.alphaMap&&(y.alphaMap.value=x.alphaMap);let R;x.map?R=x.map:x.alphaMap&&(R=x.alphaMap),R!==void 0&&(R.matrixAutoUpdate===!0&&R.updateMatrix(),y.uvTransform.value.copy(R.matrix))}function l(y,x){x.emissiveMap&&(y.emissiveMap.value=x.emissiveMap)}function c(y,x){y.specular.value.copy(x.specular),y.shininess.value=Math.max(x.shininess,1e-4),x.emissiveMap&&(y.emissiveMap.value=x.emissiveMap),x.bumpMap&&(y.bumpMap.value=x.bumpMap,y.bumpScale.value=x.bumpScale,x.side===qt&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,y.normalScale.value.copy(x.normalScale),x.side===qt&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias)}function u(y,x){x.gradientMap&&(y.gradientMap.value=x.gradientMap),x.emissiveMap&&(y.emissiveMap.value=x.emissiveMap),x.bumpMap&&(y.bumpMap.value=x.bumpMap,y.bumpScale.value=x.bumpScale,x.side===qt&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,y.normalScale.value.copy(x.normalScale),x.side===qt&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias)}function h(y,x){y.roughness.value=x.roughness,y.metalness.value=x.metalness,x.roughnessMap&&(y.roughnessMap.value=x.roughnessMap),x.metalnessMap&&(y.metalnessMap.value=x.metalnessMap),x.emissiveMap&&(y.emissiveMap.value=x.emissiveMap),x.bumpMap&&(y.bumpMap.value=x.bumpMap,y.bumpScale.value=x.bumpScale,x.side===qt&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,y.normalScale.value.copy(x.normalScale),x.side===qt&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias),i.get(x).envMap&&(y.envMapIntensity.value=x.envMapIntensity)}function d(y,x){h(y,x),y.reflectivity.value=x.reflectivity,y.clearcoat.value=x.clearcoat,y.clearcoatRoughness.value=x.clearcoatRoughness,x.sheen&&y.sheen.value.copy(x.sheen),x.clearcoatMap&&(y.clearcoatMap.value=x.clearcoatMap),x.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap),x.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),y.clearcoatNormalMap.value=x.clearcoatNormalMap,x.side===qt&&y.clearcoatNormalScale.value.negate()),y.transmission.value=x.transmission,x.transmissionMap&&(y.transmissionMap.value=x.transmissionMap)}function f(y,x){x.matcap&&(y.matcap.value=x.matcap),x.bumpMap&&(y.bumpMap.value=x.bumpMap,y.bumpScale.value=x.bumpScale,x.side===qt&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,y.normalScale.value.copy(x.normalScale),x.side===qt&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias)}function m(y,x){x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias)}function v(y,x){x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias),y.referencePosition.value.copy(x.referencePosition),y.nearDistance.value=x.nearDistance,y.farDistance.value=x.farDistance}function _(y,x){x.bumpMap&&(y.bumpMap.value=x.bumpMap,y.bumpScale.value=x.bumpScale,x.side===qt&&(y.bumpScale.value*=-1)),x.normalMap&&(y.normalMap.value=x.normalMap,y.normalScale.value.copy(x.normalScale),x.side===qt&&y.normalScale.value.negate()),x.displacementMap&&(y.displacementMap.value=x.displacementMap,y.displacementScale.value=x.displacementScale,y.displacementBias.value=x.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function pw(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}function Il(i){i=i||{};const e=i.canvas!==void 0?i.canvas:pw(),t=i.context!==void 0?i.context:null,n=i.alpha!==void 0?i.alpha:!1,s=i.depth!==void 0?i.depth:!0,r=i.stencil!==void 0?i.stencil:!0,o=i.antialias!==void 0?i.antialias:!1,a=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,l=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,c=i.powerPreference!==void 0?i.powerPreference:"default",u=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let h=null,d=null;const f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=D,this.physicallyCorrectLights=!1,this.toneMapping=ps,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const m=this;let v=!1,_=null,y=0,x=0,R=null,I=null,B=-1,N=null;const J=new _t,ne=new _t;let se=null,E=e.width,M=e.height,A=1,F=null,P=null;const O=new _t(0,0,E,M),V=new _t(0,0,E,M);let W=!1;const fe=new Pl;let ve=!1,pe=!1;const Me=new xe,Fe=new S,at={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function bt(){return R===null?A:1}let Ie=t;function Y(ae,je){for(let ke=0;ke<ae.length;ke++){const Ye=ae[ke],vt=e.getContext(Ye,je);if(vt!==null)return vt}return null}try{const ae={alpha:n,depth:s,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",ii,!1),e.addEventListener("webglcontextrestored",En,!1),Ie===null){const je=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&je.shift(),Ie=Y(je,ae),Ie===null)throw Y(je)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ie.getShaderPrecisionFormat===void 0&&(Ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ae){throw console.error("THREE.WebGLRenderer: "+ae.message),ae}let X,ce,ie,he,ge,le,oe,we,Le,Ae,K,Q,Ue,Be,ye,Je,it,lt,nt,xt,At;function kt(){X=new Wy(Ie),ce=new Hy(Ie,X,i),ce.isWebGL2===!1&&(X.get("WEBGL_depth_texture"),X.get("OES_texture_float"),X.get("OES_texture_half_float"),X.get("OES_texture_half_float_linear"),X.get("OES_standard_derivatives"),X.get("OES_element_index_uint"),X.get("OES_vertex_array_object"),X.get("ANGLE_instanced_arrays")),X.get("OES_texture_float_linear"),xt=new dw(Ie,X,ce),ie=new uw(Ie,X,ce),ie.scissor(ne.copy(V).multiplyScalar(A).floor()),ie.viewport(J.copy(O).multiplyScalar(A).floor()),he=new Xy(Ie),ge=new Kx,le=new hw(Ie,X,ie,ge,ce,xt,he),oe=new jy(m),we=new v0(Ie,ce),At=new Uy(Ie,X,we,ce),Le=new $y(Ie,we,he,At),Ae=new Ky(Ie,Le,we,he),it=new Jy(Ie),ye=new Vy(ge),K=new Jx(m,oe,X,ce,At,ye),Q=new fw(ge),Ue=new tw(ge),Be=new aw(X,ce),Je=new zy(m,oe,ie,Ae,a),lt=new Gy(Ie,X,he,ce),nt=new qy(Ie,X,he,ce),he.programs=K.programs,m.capabilities=ce,m.extensions=X,m.properties=ge,m.renderLists=Ue,m.state=ie,m.info=he}kt();const gt=new up(m,Ie);this.xr=gt;const Rt=new cp(m,Ae,ce.maxTextureSize);this.shadowMap=Rt,this.getContext=function(){return Ie},this.getContextAttributes=function(){return Ie.getContextAttributes()},this.forceContextLoss=function(){const ae=X.get("WEBGL_lose_context");ae&&ae.loseContext()},this.forceContextRestore=function(){const ae=X.get("WEBGL_lose_context");ae&&ae.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(ae){ae!==void 0&&(A=ae,this.setSize(E,M,!1))},this.getSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ae=new Se),ae.set(E,M)},this.setSize=function(ae,je,ke){if(gt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=ae,M=je,e.width=Math.floor(ae*A),e.height=Math.floor(je*A),ke!==!1&&(e.style.width=ae+"px",e.style.height=je+"px"),this.setViewport(0,0,ae,je)},this.getDrawingBufferSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ae=new Se),ae.set(E*A,M*A).floor()},this.setDrawingBufferSize=function(ae,je,ke){E=ae,M=je,A=ke,e.width=Math.floor(ae*ke),e.height=Math.floor(je*ke),this.setViewport(0,0,ae,je)},this.getCurrentViewport=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ae=new _t),ae.copy(J)},this.getViewport=function(ae){return ae.copy(O)},this.setViewport=function(ae,je,ke,Ye){ae.isVector4?O.set(ae.x,ae.y,ae.z,ae.w):O.set(ae,je,ke,Ye),ie.viewport(J.copy(O).multiplyScalar(A).floor())},this.getScissor=function(ae){return ae.copy(V)},this.setScissor=function(ae,je,ke,Ye){ae.isVector4?V.set(ae.x,ae.y,ae.z,ae.w):V.set(ae,je,ke,Ye),ie.scissor(ne.copy(V).multiplyScalar(A).floor())},this.getScissorTest=function(){return W},this.setScissorTest=function(ae){ie.setScissorTest(W=ae)},this.setOpaqueSort=function(ae){F=ae},this.setTransparentSort=function(ae){P=ae},this.getClearColor=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ae=new Ee),ae.copy(Je.getClearColor())},this.setClearColor=function(){Je.setClearColor.apply(Je,arguments)},this.getClearAlpha=function(){return Je.getClearAlpha()},this.setClearAlpha=function(){Je.setClearAlpha.apply(Je,arguments)},this.clear=function(ae,je,ke){let Ye=0;(ae===void 0||ae)&&(Ye|=16384),(je===void 0||je)&&(Ye|=256),(ke===void 0||ke)&&(Ye|=1024),Ie.clear(Ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ii,!1),e.removeEventListener("webglcontextrestored",En,!1),Ue.dispose(),Be.dispose(),ge.dispose(),oe.dispose(),Ae.dispose(),At.dispose(),gt.dispose(),Wr.stop()};function ii(ae){ae.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function En(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1,kt()}function jr(ae){const je=ae.target;je.removeEventListener("dispose",jr),fu(je)}function fu(ae){rc(ae),ge.remove(ae)}function rc(ae){const je=ge.get(ae).program;je!==void 0&&K.releaseProgram(je)}function oc(ae,je){ae.render(function(ke){m.renderBufferImmediate(ke,je)})}this.renderBufferImmediate=function(ae,je){At.initAttributes();const ke=ge.get(ae);ae.hasPositions&&!ke.position&&(ke.position=Ie.createBuffer()),ae.hasNormals&&!ke.normal&&(ke.normal=Ie.createBuffer()),ae.hasUvs&&!ke.uv&&(ke.uv=Ie.createBuffer()),ae.hasColors&&!ke.color&&(ke.color=Ie.createBuffer());const Ye=je.getAttributes();ae.hasPositions&&(Ie.bindBuffer(34962,ke.position),Ie.bufferData(34962,ae.positionArray,35048),At.enableAttribute(Ye.position),Ie.vertexAttribPointer(Ye.position,3,5126,!1,0,0)),ae.hasNormals&&(Ie.bindBuffer(34962,ke.normal),Ie.bufferData(34962,ae.normalArray,35048),At.enableAttribute(Ye.normal),Ie.vertexAttribPointer(Ye.normal,3,5126,!1,0,0)),ae.hasUvs&&(Ie.bindBuffer(34962,ke.uv),Ie.bufferData(34962,ae.uvArray,35048),At.enableAttribute(Ye.uv),Ie.vertexAttribPointer(Ye.uv,2,5126,!1,0,0)),ae.hasColors&&(Ie.bindBuffer(34962,ke.color),Ie.bufferData(34962,ae.colorArray,35048),At.enableAttribute(Ye.color),Ie.vertexAttribPointer(Ye.color,3,5126,!1,0,0)),At.disableUnusedAttributes(),Ie.drawArrays(4,0,ae.count),ae.count=0},this.renderBufferDirect=function(ae,je,ke,Ye,vt,ui){je===null&&(je=at);const ni=vt.isMesh&&vt.matrixWorld.determinant()<0,hi=ac(ae,je,Ye,vt);ie.setMaterial(Ye,ni);let si=ke.index;const ln=ke.attributes.position;if(si===null){if(ln===void 0||ln.count===0)return}else if(si.count===0)return;let tn=1;Ye.wireframe===!0&&(si=Le.getWireframeAttribute(ke),tn=2),(Ye.morphTargets||Ye.morphNormals)&&it.update(vt,ke,Ye,hi),At.setup(vt,Ye,hi,ke,si);let Jt,Di=lt;si!==null&&(Jt=we.get(si),Di=nt,Di.setIndex(Jt));const Co=si!==null?si.count:ln.count,Pi=ke.drawRange.start*tn,nl=ke.drawRange.count*tn,Tn=ui!==null?ui.start*tn:0,Lf=ui!==null?ui.count*tn:1/0,us=Math.max(Pi,Tn),vu=Math.min(Co,Pi+nl,Tn+Lf)-1,lc=Math.max(0,vu-us+1);if(lc!==0){if(vt.isMesh)Ye.wireframe===!0?(ie.setLineWidth(Ye.wireframeLinewidth*bt()),Di.setMode(1)):Di.setMode(4);else if(vt.isLine){let yu=Ye.linewidth;yu===void 0&&(yu=1),ie.setLineWidth(yu*bt()),vt.isLineSegments?Di.setMode(1):vt.isLineLoop?Di.setMode(2):Di.setMode(3)}else vt.isPoints?Di.setMode(0):vt.isSprite&&Di.setMode(4);if(vt.isInstancedMesh)Di.renderInstances(us,lc,vt.count);else if(ke.isInstancedBufferGeometry){const yu=Math.min(ke.instanceCount,ke._maxInstanceCount);Di.renderInstances(us,lc,yu)}else Di.render(us,lc)}},this.compile=function(ae,je){d=Be.get(ae),d.init(),ae.traverseVisible(function(Ye){Ye.isLight&&Ye.layers.test(je.layers)&&(d.pushLight(Ye),Ye.castShadow&&d.pushShadow(Ye))}),d.setupLights();const ke=new WeakMap;ae.traverse(function(Ye){const vt=Ye.material;if(vt)if(Array.isArray(vt))for(let ui=0;ui<vt.length;ui++){const ni=vt[ui];ke.has(ni)===!1&&(Sn(ni,ae,Ye),ke.set(ni))}else ke.has(vt)===!1&&(Sn(vt,ae,Ye),ke.set(vt))})};let pu=null;function Df(ae){gt.isPresenting||pu&&pu(ae)}const Wr=new Gf;Wr.setAnimationLoop(Df),typeof window<"u"&&Wr.setContext(window),this.setAnimationLoop=function(ae){pu=ae,gt.setAnimationLoop(ae),ae===null?Wr.stop():Wr.start()},this.render=function(ae,je){let ke,Ye;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),ke=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Ye=arguments[3]),je!==void 0&&je.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;At.resetDefaultState(),B=-1,N=null,ae.autoUpdate===!0&&ae.updateMatrixWorld(),je.parent===null&&je.updateMatrixWorld(),gt.enabled===!0&&gt.isPresenting===!0&&(je=gt.getCamera(je)),ae.isScene===!0&&ae.onBeforeRender(m,ae,je,ke||R),d=Be.get(ae,f.length),d.init(),f.push(d),Me.multiplyMatrices(je.projectionMatrix,je.matrixWorldInverse),fe.setFromProjectionMatrix(Me),pe=this.localClippingEnabled,ve=ye.init(this.clippingPlanes,pe,je),h=Ue.get(ae,je),h.init(),qs(ae,je,0,m.sortObjects),h.finish(),m.sortObjects===!0&&h.sort(F,P),ve===!0&&ye.beginShadows();const vt=d.state.shadowsArray;Rt.render(vt,ae,je),d.setupLights(),d.setupLightsView(je),ve===!0&&ye.endShadows(),this.info.autoReset===!0&&this.info.reset(),ke!==void 0&&this.setRenderTarget(ke),Je.render(h,ae,je,Ye);const ui=h.opaque,ni=h.transparent;ui.length>0&&ma(ui,ae,je),ni.length>0&&ma(ni,ae,je),ae.isScene===!0&&ae.onAfterRender(m,ae,je),R!==null&&(le.updateRenderTargetMipmap(R),le.updateMultisampleRenderTarget(R)),ie.buffers.depth.setTest(!0),ie.buffers.depth.setMask(!0),ie.buffers.color.setMask(!0),ie.setPolygonOffset(!1),f.pop(),f.length>0?d=f[f.length-1]:d=null,h=null};function qs(ae,je,ke,Ye){if(ae.visible===!1)return;if(ae.layers.test(je.layers)){if(ae.isGroup)ke=ae.renderOrder;else if(ae.isLOD)ae.autoUpdate===!0&&ae.update(je);else if(ae.isLight)d.pushLight(ae),ae.castShadow&&d.pushShadow(ae);else if(ae.isSprite){if(!ae.frustumCulled||fe.intersectsSprite(ae)){Ye&&Fe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(Me);const ni=Ae.update(ae),hi=ae.material;hi.visible&&h.push(ae,ni,hi,ke,Fe.z,null)}}else if(ae.isImmediateRenderObject)Ye&&Fe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(Me),h.push(ae,null,ae.material,ke,Fe.z,null);else if((ae.isMesh||ae.isLine||ae.isPoints)&&(ae.isSkinnedMesh&&ae.skeleton.frame!==he.render.frame&&(ae.skeleton.update(),ae.skeleton.frame=he.render.frame),!ae.frustumCulled||fe.intersectsObject(ae))){Ye&&Fe.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(Me);const ni=Ae.update(ae),hi=ae.material;if(Array.isArray(hi)){const si=ni.groups;for(let ln=0,tn=si.length;ln<tn;ln++){const Jt=si[ln],Di=hi[Jt.materialIndex];Di&&Di.visible&&h.push(ae,ni,Di,ke,Fe.z,Jt)}}else hi.visible&&h.push(ae,ni,hi,ke,Fe.z,null)}}const ui=ae.children;for(let ni=0,hi=ui.length;ni<hi;ni++)qs(ui[ni],je,ke,Ye)}function ma(ae,je,ke){const Ye=je.isScene===!0?je.overrideMaterial:null;for(let vt=0,ui=ae.length;vt<ui;vt++){const ni=ae[vt],hi=ni.object,si=ni.geometry,ln=Ye===null?ni.material:Ye,tn=ni.group;if(ke.isArrayCamera){const Jt=ke.cameras;for(let Di=0,Co=Jt.length;Di<Co;Di++){const Pi=Jt[Di];hi.layers.test(Pi.layers)&&(ie.viewport(J.copy(Pi.viewport)),d.setupLightsView(Pi),mu(hi,je,Pi,si,ln,tn))}}else mu(hi,je,ke,si,ln,tn)}}function mu(ae,je,ke,Ye,vt,ui){if(ae.onBeforeRender(m,je,ke,Ye,vt,ui),ae.modelViewMatrix.multiplyMatrices(ke.matrixWorldInverse,ae.matrixWorld),ae.normalMatrix.getNormalMatrix(ae.modelViewMatrix),ae.isImmediateRenderObject){const ni=ac(ke,je,vt,ae);ie.setMaterial(vt),At.reset(),oc(ae,ni)}else m.renderBufferDirect(ke,je,Ye,vt,ae,ui);ae.onAfterRender(m,je,ke,Ye,vt,ui)}function Sn(ae,je,ke){je.isScene!==!0&&(je=at);const Ye=ge.get(ae),vt=d.state.lights,ui=d.state.shadowsArray,ni=vt.state.version,hi=K.getParameters(ae,vt.state,ui,je,ke),si=K.getProgramCacheKey(hi);let ln=Ye.program,tn=!0;if(ln===void 0)ae.addEventListener("dispose",jr);else if(ln.cacheKey!==si)rc(ae);else if(Ye.lightsStateVersion!==ni)tn=!1;else if(hi.shaderID!==void 0){const Pi=ae.isMeshStandardMaterial?je.environment:null;Ye.envMap=oe.get(ae.envMap||Pi);return}else tn=!1;tn&&(hi.uniforms=K.getUniforms(ae),ae.onBeforeCompile(hi,m),ln=K.acquireProgram(hi,si),Ye.program=ln,Ye.uniforms=hi.uniforms,Ye.outputEncoding=hi.outputEncoding);const Jt=Ye.uniforms;(!ae.isShaderMaterial&&!ae.isRawShaderMaterial||ae.clipping===!0)&&(Ye.numClippingPlanes=ye.numPlanes,Ye.numIntersection=ye.numIntersection,Jt.clippingPlanes=ye.uniform),Ye.environment=ae.isMeshStandardMaterial?je.environment:null,Ye.fog=je.fog,Ye.envMap=oe.get(ae.envMap||Ye.environment),Ye.needsLights=Pf(ae),Ye.lightsStateVersion=ni,Ye.needsLights&&(Jt.ambientLightColor.value=vt.state.ambient,Jt.lightProbe.value=vt.state.probe,Jt.directionalLights.value=vt.state.directional,Jt.directionalLightShadows.value=vt.state.directionalShadow,Jt.spotLights.value=vt.state.spot,Jt.spotLightShadows.value=vt.state.spotShadow,Jt.rectAreaLights.value=vt.state.rectArea,Jt.ltc_1.value=vt.state.rectAreaLTC1,Jt.ltc_2.value=vt.state.rectAreaLTC2,Jt.pointLights.value=vt.state.point,Jt.pointLightShadows.value=vt.state.pointShadow,Jt.hemisphereLights.value=vt.state.hemi,Jt.directionalShadowMap.value=vt.state.directionalShadowMap,Jt.directionalShadowMatrix.value=vt.state.directionalShadowMatrix,Jt.spotShadowMap.value=vt.state.spotShadowMap,Jt.spotShadowMatrix.value=vt.state.spotShadowMatrix,Jt.pointShadowMap.value=vt.state.pointShadowMap,Jt.pointShadowMatrix.value=vt.state.pointShadowMatrix);const Di=Ye.program.getUniforms(),Co=Zo.seqWithValue(Di.seq,Jt);Ye.uniformsList=Co}function ac(ae,je,ke,Ye){je.isScene!==!0&&(je=at),le.resetTextureUnits();const vt=je.fog,ui=ke.isMeshStandardMaterial?je.environment:null,ni=R===null?m.outputEncoding:R.texture.encoding,hi=oe.get(ke.envMap||ui),si=ge.get(ke),ln=d.state.lights;if(ve===!0&&(pe===!0||ae!==N)){const Tn=ae===N&&ke.id===B;ye.setState(ke,ae,Tn)}ke.version===si.__version?(ke.fog&&si.fog!==vt||si.environment!==ui||si.needsLights&&si.lightsStateVersion!==ln.state.version||si.numClippingPlanes!==void 0&&(si.numClippingPlanes!==ye.numPlanes||si.numIntersection!==ye.numIntersection)||si.outputEncoding!==ni||si.envMap!==hi)&&Sn(ke,je,Ye):(Sn(ke,je,Ye),si.__version=ke.version);let tn=!1,Jt=!1,Di=!1;const Co=si.program,Pi=Co.getUniforms(),nl=si.uniforms;if(ie.useProgram(Co.program)&&(tn=!0,Jt=!0,Di=!0),ke.id!==B&&(B=ke.id,Jt=!0),tn||N!==ae){if(Pi.setValue(Ie,"projectionMatrix",ae.projectionMatrix),ce.logarithmicDepthBuffer&&Pi.setValue(Ie,"logDepthBufFC",2/(Math.log(ae.far+1)/Math.LN2)),N!==ae&&(N=ae,Jt=!0,Di=!0),ke.isShaderMaterial||ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshStandardMaterial||ke.envMap){const Tn=Pi.map.cameraPosition;Tn!==void 0&&Tn.setValue(Ie,Fe.setFromMatrixPosition(ae.matrixWorld))}(ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshLambertMaterial||ke.isMeshBasicMaterial||ke.isMeshStandardMaterial||ke.isShaderMaterial)&&Pi.setValue(Ie,"isOrthographic",ae.isOrthographicCamera===!0),(ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshLambertMaterial||ke.isMeshBasicMaterial||ke.isMeshStandardMaterial||ke.isShaderMaterial||ke.isShadowMaterial||ke.skinning)&&Pi.setValue(Ie,"viewMatrix",ae.matrixWorldInverse)}if(ke.skinning){Pi.setOptional(Ie,Ye,"bindMatrix"),Pi.setOptional(Ie,Ye,"bindMatrixInverse");const Tn=Ye.skeleton;if(Tn){const Lf=Tn.bones;if(ce.floatVertexTextures){if(Tn.boneTexture===null){let us=Math.sqrt(Lf.length*4);us=rt.ceilPowerOfTwo(us),us=Math.max(us,4);const vu=new Float32Array(us*us*4);vu.set(Tn.boneMatrices);const lc=new Gs(vu,us,us,jt,vn);Tn.boneMatrices=vu,Tn.boneTexture=lc,Tn.boneTextureSize=us}Pi.setValue(Ie,"boneTexture",Tn.boneTexture,le),Pi.setValue(Ie,"boneTextureSize",Tn.boneTextureSize)}else Pi.setOptional(Ie,Tn,"boneMatrices")}}return(Jt||si.receiveShadow!==Ye.receiveShadow)&&(si.receiveShadow=Ye.receiveShadow,Pi.setValue(Ie,"receiveShadow",Ye.receiveShadow)),Jt&&(Pi.setValue(Ie,"toneMappingExposure",m.toneMappingExposure),si.needsLights&&gu(nl,Di),vt&&ke.fog&&Q.refreshFogUniforms(nl,vt),Q.refreshMaterialUniforms(nl,ke,A,M),Zo.upload(Ie,si.uniformsList,nl,le)),ke.isShaderMaterial&&ke.uniformsNeedUpdate===!0&&(Zo.upload(Ie,si.uniformsList,nl,le),ke.uniformsNeedUpdate=!1),ke.isSpriteMaterial&&Pi.setValue(Ie,"center",Ye.center),Pi.setValue(Ie,"modelViewMatrix",Ye.modelViewMatrix),Pi.setValue(Ie,"normalMatrix",Ye.normalMatrix),Pi.setValue(Ie,"modelMatrix",Ye.matrixWorld),Co}function gu(ae,je){ae.ambientLightColor.needsUpdate=je,ae.lightProbe.needsUpdate=je,ae.directionalLights.needsUpdate=je,ae.directionalLightShadows.needsUpdate=je,ae.pointLights.needsUpdate=je,ae.pointLightShadows.needsUpdate=je,ae.spotLights.needsUpdate=je,ae.spotLightShadows.needsUpdate=je,ae.rectAreaLights.needsUpdate=je,ae.hemisphereLights.needsUpdate=je}function Pf(ae){return ae.isMeshLambertMaterial||ae.isMeshToonMaterial||ae.isMeshPhongMaterial||ae.isMeshStandardMaterial||ae.isShadowMaterial||ae.isShaderMaterial&&ae.lights===!0}this.setFramebuffer=function(ae){_!==ae&&R===null&&Ie.bindFramebuffer(36160,ae),_=ae},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return x},this.getRenderList=function(){return h},this.setRenderList=function(ae){h=ae},this.getRenderTarget=function(){return R},this.setRenderTarget=function(ae,je=0,ke=0){R=ae,y=je,x=ke,ae&&ge.get(ae).__webglFramebuffer===void 0&&le.setupRenderTarget(ae);let Ye=_,vt=!1;if(ae){const ui=ge.get(ae).__webglFramebuffer;ae.isWebGLCubeRenderTarget?(Ye=ui[je],vt=!0):ae.isWebGLMultisampleRenderTarget?Ye=ge.get(ae).__webglMultisampledFramebuffer:Ye=ui,J.copy(ae.viewport),ne.copy(ae.scissor),se=ae.scissorTest}else J.copy(O).multiplyScalar(A).floor(),ne.copy(V).multiplyScalar(A).floor(),se=W;if(I!==Ye&&(Ie.bindFramebuffer(36160,Ye),I=Ye),ie.viewport(J),ie.scissor(ne),ie.setScissorTest(se),vt){const ui=ge.get(ae.texture);Ie.framebufferTexture2D(36160,36064,34069+je,ui.__webglTexture,ke)}},this.readRenderTargetPixels=function(ae,je,ke,Ye,vt,ui,ni){if(!(ae&&ae.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let hi=ge.get(ae).__webglFramebuffer;if(ae.isWebGLCubeRenderTarget&&ni!==void 0&&(hi=hi[ni]),hi){let si=!1;hi!==I&&(Ie.bindFramebuffer(36160,hi),si=!0);try{const ln=ae.texture,tn=ln.format,Jt=ln.type;if(tn!==jt&&xt.convert(tn)!==Ie.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(Jt!==ms&&xt.convert(Jt)!==Ie.getParameter(35738)&&!(Jt===vn&&(ce.isWebGL2||X.get("OES_texture_float")||X.get("WEBGL_color_buffer_float")))&&!(Jt===br&&(ce.isWebGL2?X.get("EXT_color_buffer_float"):X.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ie.checkFramebufferStatus(36160)===36053?je>=0&&je<=ae.width-Ye&&ke>=0&&ke<=ae.height-vt&&Ie.readPixels(je,ke,Ye,vt,xt.convert(tn),xt.convert(Jt),ui):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{si&&Ie.bindFramebuffer(36160,I)}}},this.copyFramebufferToTexture=function(ae,je,ke=0){const Ye=Math.pow(2,-ke),vt=Math.floor(je.image.width*Ye),ui=Math.floor(je.image.height*Ye),ni=xt.convert(je.format);le.setTexture2D(je,0),Ie.copyTexImage2D(3553,ke,ni,ae.x,ae.y,vt,ui,0),ie.unbindTexture()},this.copyTextureToTexture=function(ae,je,ke,Ye=0){const vt=je.image.width,ui=je.image.height,ni=xt.convert(ke.format),hi=xt.convert(ke.type);le.setTexture2D(ke,0),Ie.pixelStorei(37440,ke.flipY),Ie.pixelStorei(37441,ke.premultiplyAlpha),Ie.pixelStorei(3317,ke.unpackAlignment),je.isDataTexture?Ie.texSubImage2D(3553,Ye,ae.x,ae.y,vt,ui,ni,hi,je.image.data):je.isCompressedTexture?Ie.compressedTexSubImage2D(3553,Ye,ae.x,ae.y,je.mipmaps[0].width,je.mipmaps[0].height,ni,je.mipmaps[0].data):Ie.texSubImage2D(3553,Ye,ae.x,ae.y,ni,hi,je.image),Ye===0&&ke.generateMipmaps&&Ie.generateMipmap(3553),ie.unbindTexture()},this.initTexture=function(ae){le.setTexture2D(ae,0),ie.unbindTexture()},this.resetState=function(){ie.reset(),At.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function hp(i){Il.call(this,i)}hp.prototype=Object.assign(Object.create(Il.prototype),{constructor:hp,isWebGL1Renderer:!0});class od{constructor(e,t){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Ee(e),this.density=t!==void 0?t:25e-5}clone(){return new od(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class ad{constructor(e,t,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Ee(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3}clone(){return new ad(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Si extends qe{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}function Ms(i,e){this.array=i,this.stride=e,this.count=i!==void 0?i.length/e:0,this.usage=Ft,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=rt.generateUUID()}Object.defineProperty(Ms.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(Ms.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,e,t){i*=this.stride,t*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[i+n]=e.array[t+n];return this},set:function(i,e=0){return this.array.set(i,e),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=rt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),t=new Ms(e,this.stride);return t.setUsage(this.usage),t},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=rt.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Na=new S;function ss(i,e,t,n){this.name="",this.data=i,this.itemSize=e,this.offset=t,this.normalized=n===!0}Object.defineProperties(ss.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}}),Object.assign(ss.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(let e=0,t=this.data.count;e<t;e++)Na.x=this.getX(e),Na.y=this.getY(e),Na.z=this.getZ(e),Na.applyMatrix4(i),this.setXYZ(e,Na.x,Na.y,Na.z);return this},setX:function(i,e){return this.data.array[i*this.data.stride+this.offset]=e,this},setY:function(i,e){return this.data.array[i*this.data.stride+this.offset+1]=e,this},setZ:function(i,e){return this.data.array[i*this.data.stride+this.offset+2]=e,this},setW:function(i,e){return this.data.array[i*this.data.stride+this.offset+3]=e,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,e,t){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=t,this},setXYZ:function(i,e,t,n){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=t,this.data.array[i+2]=n,this},setXYZW:function(i,e,t,n,s){return i=i*this.data.stride+this.offset,this.data.array[i+0]=e,this.data.array[i+1]=t,this.data.array[i+2]=n,this.data.array[i+3]=s,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return new tt(new this.array.constructor(e),this.itemSize,this.normalized)}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new ss(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});function Jo(i){Nt.call(this),this.type="SpriteMaterial",this.color=new Ee(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(i)}Jo.prototype=Object.create(Nt.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isSpriteMaterial=!0,Jo.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.rotation=i.rotation,this.sizeAttenuation=i.sizeAttenuation,this};let Fl;const Fc=new S,Bl=new S,Nl=new S,Ol=new Se,Bc=new Se,dp=new xe,Ou=new S,Nc=new S,ku=new S,fp=new Se,ld=new Se,pp=new Se;function Oc(i){if(qe.call(this),this.type="Sprite",Fl===void 0){Fl=new wt;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Ms(e,5);Fl.setIndex([0,1,2,0,2,3]),Fl.setAttribute("position",new ss(t,3,0,!1)),Fl.setAttribute("uv",new ss(t,2,3,!1))}this.geometry=Fl,this.material=i!==void 0?i:new Jo,this.center=new Se(.5,.5)}Oc.prototype=Object.assign(Object.create(qe.prototype),{constructor:Oc,isSprite:!0,raycast:function(i,e){i.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Bl.setFromMatrixScale(this.matrixWorld),dp.copy(i.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(i.camera.matrixWorldInverse,this.matrixWorld),Nl.setFromMatrixPosition(this.modelViewMatrix),i.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Bl.multiplyScalar(-Nl.z);const t=this.material.rotation;let n,s;t!==0&&(s=Math.cos(t),n=Math.sin(t));const r=this.center;zu(Ou.set(-.5,-.5,0),Nl,r,Bl,n,s),zu(Nc.set(.5,-.5,0),Nl,r,Bl,n,s),zu(ku.set(.5,.5,0),Nl,r,Bl,n,s),fp.set(0,0),ld.set(1,0),pp.set(1,1);let o=i.ray.intersectTriangle(Ou,Nc,ku,!1,Fc);if(o===null&&(zu(Nc.set(-.5,.5,0),Nl,r,Bl,n,s),ld.set(0,1),o=i.ray.intersectTriangle(Ou,ku,Nc,!1,Fc),o===null))return;const a=i.ray.origin.distanceTo(Fc);a<i.near||a>i.far||e.push({distance:a,point:Fc.clone(),uv:Gn.getUV(Fc,Ou,Nc,ku,fp,ld,pp,new Se),face:null,object:this})},copy:function(i){return qe.prototype.copy.call(this,i),i.center!==void 0&&this.center.copy(i.center),this.material=i.material,this}});function zu(i,e,t,n,s,r){Ol.subVectors(i,t).addScalar(.5).multiply(n),s!==void 0?(Bc.x=r*Ol.x-s*Ol.y,Bc.y=s*Ol.x+r*Ol.y):Bc.copy(Ol),i.copy(e),i.x+=Bc.x,i.y+=Bc.y,i.applyMatrix4(dp)}const Uu=new S,mp=new S;function Gu(){qe.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Gu.prototype=Object.assign(Object.create(qe.prototype),{constructor:Gu,isLOD:!0,copy:function(i){qe.prototype.copy.call(this,i,!1);const e=i.levels;for(let t=0,n=e.length;t<n;t++){const s=e[t];this.addLevel(s.object.clone(),s.distance)}return this.autoUpdate=i.autoUpdate,this},addLevel:function(i,e=0){e=Math.abs(e);const t=this.levels;let n;for(n=0;n<t.length&&!(e<t[n].distance);n++);return t.splice(n,0,{distance:e,object:i}),this.add(i),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(i){const e=this.levels;if(e.length>0){let t,n;for(t=1,n=e.length;t<n&&!(i<e[t].distance);t++);return e[t-1].object}return null},raycast:function(i,e){if(this.levels.length>0){Uu.setFromMatrixPosition(this.matrixWorld);const n=i.ray.origin.distanceTo(Uu);this.getObjectForDistance(n).raycast(i,e)}},update:function(i){const e=this.levels;if(e.length>1){Uu.setFromMatrixPosition(i.matrixWorld),mp.setFromMatrixPosition(this.matrixWorld);const t=Uu.distanceTo(mp)/i.zoom;e[0].object.visible=!0;let n,s;for(n=1,s=e.length;n<s&&t>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)e[n].object.visible=!1}},toJSON:function(i){const e=qe.prototype.toJSON.call(this,i);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const t=this.levels;for(let n=0,s=t.length;n<s;n++){const r=t[n];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}});const gp=new S,vp=new _t,yp=new _t,mw=new S,xp=new xe;function kl(i,e){i&&i.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ot.call(this,i,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xe,this.bindMatrixInverse=new xe}kl.prototype=Object.assign(Object.create(ot.prototype),{constructor:kl,isSkinnedMesh:!0,copy:function(i){return ot.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,e){this.skeleton=i,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const i=new _t,e=this.geometry.attributes.skinWeight;for(let t=0,n=e.count;t<n;t++){i.x=e.getX(t),i.y=e.getY(t),i.z=e.getZ(t),i.w=e.getW(t);const s=1/i.manhattanLength();s!==1/0?i.multiplyScalar(s):i.set(1,0,0,0),e.setXYZW(t,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){ot.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,e){const t=this.skeleton,n=this.geometry;vp.fromBufferAttribute(n.attributes.skinIndex,i),yp.fromBufferAttribute(n.attributes.skinWeight,i),gp.fromBufferAttribute(n.attributes.position,i).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){const r=yp.getComponent(s);if(r!==0){const o=vp.getComponent(s);xp.multiplyMatrices(t.bones[o].matrixWorld,t.boneInverses[o]),e.addScaledVector(mw.copy(gp).applyMatrix4(xp),r)}}return e.applyMatrix4(this.bindMatrixInverse)}});function Oa(){qe.call(this),this.type="Bone"}Oa.prototype=Object.assign(Object.create(qe.prototype),{constructor:Oa,isBone:!0});const wp=new xe,gw=new xe;function zl(i=[],e=[]){this.uuid=rt.generateUUID(),this.bones=i.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(zl.prototype,{init:function(){const i=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(i.length*16),e.length===0)this.calculateInverses();else if(i.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,n=this.bones.length;t<n;t++)this.boneInverses.push(new xe)}},calculateInverses:function(){this.boneInverses.length=0;for(let i=0,e=this.bones.length;i<e;i++){const t=new xe;this.bones[i]&&t.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let i=0,e=this.bones.length;i<e;i++){const t=this.bones[i];t&&t.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,e=this.bones.length;i<e;i++){const t=this.bones[i];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const i=this.bones,e=this.boneInverses,t=this.boneMatrices,n=this.boneTexture;for(let s=0,r=i.length;s<r;s++){const o=i[s]?i[s].matrixWorld:gw;wp.multiplyMatrices(o,e[s]),wp.toArray(t,s*16)}n!==null&&(n.needsUpdate=!0)},clone:function(){return new zl(this.bones,this.boneInverses)},getBoneByName:function(i){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];if(n.name===i)return n}},dispose:function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(i,e){this.uuid=i.uuid;for(let t=0,n=i.bones.length;t<n;t++){const s=i.bones[t];let r=e[s];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),r=new Oa),this.bones.push(r),this.boneInverses.push(new xe().fromArray(i.boneInverses[t]))}return this.init(),this},toJSON:function(){const i={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const e=this.bones,t=this.boneInverses;for(let n=0,s=e.length;n<s;n++){const r=e[n];i.bones.push(r.uuid);const o=t[n];i.boneInverses.push(o.toArray())}return i}});const bp=new xe,_p=new xe,Hu=[],kc=new ot;function cd(i,e,t){ot.call(this,i,e),this.instanceMatrix=new tt(new Float32Array(t*16),16),this.instanceColor=null,this.count=t,this.frustumCulled=!1}cd.prototype=Object.assign(Object.create(ot.prototype),{constructor:cd,isInstancedMesh:!0,copy:function(i){return ot.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),this.count=i.count,this},getColorAt:function(i,e){e.fromArray(this.instanceColor.array,i*3)},getMatrixAt:function(i,e){e.fromArray(this.instanceMatrix.array,i*16)},raycast:function(i,e){const t=this.matrixWorld,n=this.count;if(kc.geometry=this.geometry,kc.material=this.material,kc.material!==void 0)for(let s=0;s<n;s++){this.getMatrixAt(s,bp),_p.multiplyMatrices(t,bp),kc.matrixWorld=_p,kc.raycast(i,Hu);for(let r=0,o=Hu.length;r<o;r++){const a=Hu[r];a.instanceId=s,a.object=this,e.push(a)}Hu.length=0}},setColorAt:function(i,e){this.instanceColor===null&&(this.instanceColor=new tt(new Float32Array(this.count*3),3)),e.toArray(this.instanceColor.array,i*3)},setMatrixAt:function(i,e){e.toArray(this.instanceMatrix.array,i*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});function ri(i){Nt.call(this),this.type="LineBasicMaterial",this.color=new Ee(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(i)}ri.prototype=Object.create(Nt.prototype),ri.prototype.constructor=ri,ri.prototype.isLineBasicMaterial=!0,ri.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.morphTargets=i.morphTargets,this};const Mp=new S,Ep=new S,Sp=new xe,Vu=new We,ju=new fi;function wn(i=new wt,e=new ri){qe.call(this),this.type="Line",this.geometry=i,this.material=e,this.updateMorphTargets()}wn.prototype=Object.assign(Object.create(qe.prototype),{constructor:wn,isLine:!0,copy:function(i){return qe.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,t=[0];for(let n=1,s=e.count;n<s;n++)Mp.fromBufferAttribute(e,n-1),Ep.fromBufferAttribute(e,n),t[n]=t[n-1],t[n]+=Mp.distanceTo(Ep);i.setAttribute("lineDistance",new ft(t,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry){const e=i.vertices,t=i.lineDistances;t[0]=0;for(let n=1,s=e.length;n<s;n++)t[n]=t[n-1],t[n]+=e[n-1].distanceTo(e[n])}return this},raycast:function(i,e){const t=this.geometry,n=this.matrixWorld,s=i.params.Line.threshold;if(t.boundingSphere===null&&t.computeBoundingSphere(),ju.copy(t.boundingSphere),ju.applyMatrix4(n),ju.radius+=s,i.ray.intersectsSphere(ju)===!1)return;Sp.copy(n).invert(),Vu.copy(i.ray).applyMatrix4(Sp);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r,a=new S,l=new S,c=new S,u=new S,h=this.isLineSegments?2:1;if(t.isBufferGeometry){const d=t.index,m=t.attributes.position;if(d!==null){const v=d.array;for(let _=0,y=v.length-1;_<y;_+=h){const x=v[_],R=v[_+1];if(a.fromBufferAttribute(m,x),l.fromBufferAttribute(m,R),Vu.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const B=i.ray.origin.distanceTo(u);B<i.near||B>i.far||e.push({distance:B,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else for(let v=0,_=m.count-1;v<_;v+=h){if(a.fromBufferAttribute(m,v),l.fromBufferAttribute(m,v+1),Vu.distanceSqToSegment(a,l,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const x=i.ray.origin.distanceTo(u);x<i.near||x>i.far||e.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else if(t.isGeometry){const d=t.vertices,f=d.length;for(let m=0;m<f-1;m+=h){if(Vu.distanceSqToSegment(d[m],d[m+1],u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const _=i.ray.origin.distanceTo(u);_<i.near||_>i.far||e.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=n.length;s<r;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Wu=new S,$u=new S;function Hi(i,e){wn.call(this,i,e),this.type="LineSegments"}Hi.prototype=Object.assign(Object.create(wn.prototype),{constructor:Hi,isLineSegments:!0,computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const e=i.attributes.position,t=[];for(let n=0,s=e.count;n<s;n+=2)Wu.fromBufferAttribute(e,n),$u.fromBufferAttribute(e,n+1),t[n]=n===0?0:t[n-1],t[n+1]=t[n]+Wu.distanceTo($u);i.setAttribute("lineDistance",new ft(t,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry){const e=i.vertices,t=i.lineDistances;for(let n=0,s=e.length;n<s;n+=2)Wu.copy(e[n]),$u.copy(e[n+1]),t[n]=n===0?0:t[n-1],t[n+1]=t[n]+Wu.distanceTo($u)}return this}});function qu(i,e){wn.call(this,i,e),this.type="LineLoop"}qu.prototype=Object.assign(Object.create(wn.prototype),{constructor:qu,isLineLoop:!0});function ur(i){Nt.call(this),this.type="PointsMaterial",this.color=new Ee(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(i)}ur.prototype=Object.create(Nt.prototype),ur.prototype.constructor=ur,ur.prototype.isPointsMaterial=!0,ur.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.morphTargets=i.morphTargets,this};const Tp=new xe,ud=new We,Xu=new fi,Yu=new S;function ho(i=new wt,e=new ur){qe.call(this),this.type="Points",this.geometry=i,this.material=e,this.updateMorphTargets()}ho.prototype=Object.assign(Object.create(qe.prototype),{constructor:ho,isPoints:!0,copy:function(i){return qe.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,e){const t=this.geometry,n=this.matrixWorld,s=i.params.Points.threshold;if(t.boundingSphere===null&&t.computeBoundingSphere(),Xu.copy(t.boundingSphere),Xu.applyMatrix4(n),Xu.radius+=s,i.ray.intersectsSphere(Xu)===!1)return;Tp.copy(n).invert(),ud.copy(i.ray).applyMatrix4(Tp);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r;if(t.isBufferGeometry){const a=t.index,c=t.attributes.position;if(a!==null){const u=a.array;for(let h=0,d=u.length;h<d;h++){const f=u[h];Yu.fromBufferAttribute(c,f),hd(Yu,f,o,n,i,e,this)}}else for(let u=0,h=c.count;u<h;u++)Yu.fromBufferAttribute(c,u),hd(Yu,u,o,n,i,e,this)}else{const a=t.vertices;for(let l=0,c=a.length;l<c;l++)hd(a[l],l,o,n,i,e,this)}},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const e=i.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=n.length;s<r;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const e=i.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function hd(i,e,t,n,s,r,o){const a=ud.distanceSqToPoint(i);if(a<t){const l=new S;ud.closestPointToPoint(i,l),l.applyMatrix4(n);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}function Ap(i,e,t,n,s,r,o,a,l){oi.call(this,i,e,t,n,s,r,o,a,l),this.format=o!==void 0?o:Yi,this.minFilter=r!==void 0?r:et,this.magFilter=s!==void 0?s:et,this.generateMipmaps=!1;const c=this;function u(){c.needsUpdate=!0,i.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(u)}Ap.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ap,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const i=this.image;"requestVideoFrameCallback"in i===!1&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function zc(i,e,t,n,s,r,o,a,l,c,u,h){oi.call(this,null,r,o,a,l,c,n,s,u,h),this.image={width:e,height:t},this.mipmaps=i,this.flipY=!1,this.generateMipmaps=!1}zc.prototype=Object.create(oi.prototype),zc.prototype.constructor=zc,zc.prototype.isCompressedTexture=!0;function ka(i,e,t,n,s,r,o,a,l){oi.call(this,i,e,t,n,s,r,o,a,l),this.needsUpdate=!0}ka.prototype=Object.create(oi.prototype),ka.prototype.constructor=ka,ka.prototype.isCanvasTexture=!0;function Ko(i,e,t,n,s,r,o,a,l,c){if(c=c!==void 0?c:Qs,c!==Qs&&c!==Fs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");t===void 0&&c===Qs&&(t=Kr),t===void 0&&c===Fs&&(t=Js),oi.call(this,null,n,s,r,o,a,c,t,l),this.image={width:i,height:e},this.magFilter=o!==void 0?o:ei,this.minFilter=a!==void 0?a:ei,this.flipY=!1,this.generateMipmaps=!1}Ko.prototype=Object.create(oi.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isDepthTexture=!0;let vw=0;const Pr=new xe,dd=new qe,Zu=new S;function ti(){Object.defineProperty(this,"id",{value:vw+=2}),this.uuid=rt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}ti.prototype=Object.assign(Object.create(Rn.prototype),{constructor:ti,isGeometry:!0,applyMatrix4:function(i){const e=new rn().getNormalMatrix(i);for(let t=0,n=this.vertices.length;t<n;t++)this.vertices[t].applyMatrix4(i);for(let t=0,n=this.faces.length;t<n;t++){const s=this.faces[t];s.normal.applyMatrix3(e).normalize();for(let r=0,o=s.vertexNormals.length;r<o;r++)s.vertexNormals[r].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(i){return Pr.makeRotationX(i),this.applyMatrix4(Pr),this},rotateY:function(i){return Pr.makeRotationY(i),this.applyMatrix4(Pr),this},rotateZ:function(i){return Pr.makeRotationZ(i),this.applyMatrix4(Pr),this},translate:function(i,e,t){return Pr.makeTranslation(i,e,t),this.applyMatrix4(Pr),this},scale:function(i,e,t){return Pr.makeScale(i,e,t),this.applyMatrix4(Pr),this},lookAt:function(i){return dd.lookAt(i),dd.updateMatrix(),this.applyMatrix4(dd.matrix),this},fromBufferGeometry:function(i){const e=this,t=i.index!==null?i.index:void 0,n=i.attributes;if(n.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const s=n.position,r=n.normal,o=n.color,a=n.uv,l=n.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<s.count;h++)e.vertices.push(new S().fromBufferAttribute(s,h)),o!==void 0&&e.colors.push(new Ee().fromBufferAttribute(o,h));function c(h,d,f,m){const v=o===void 0?[]:[e.colors[h].clone(),e.colors[d].clone(),e.colors[f].clone()],_=r===void 0?[]:[new S().fromBufferAttribute(r,h),new S().fromBufferAttribute(r,d),new S().fromBufferAttribute(r,f)],y=new bu(h,d,f,_,v,m);e.faces.push(y),a!==void 0&&e.faceVertexUvs[0].push([new Se().fromBufferAttribute(a,h),new Se().fromBufferAttribute(a,d),new Se().fromBufferAttribute(a,f)]),l!==void 0&&e.faceVertexUvs[1].push([new Se().fromBufferAttribute(l,h),new Se().fromBufferAttribute(l,d),new Se().fromBufferAttribute(l,f)])}const u=i.groups;if(u.length>0)for(let h=0;h<u.length;h++){const d=u[h],f=d.start,m=d.count;for(let v=f,_=f+m;v<_;v+=3)t!==void 0?c(t.getX(v),t.getX(v+1),t.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(t!==void 0)for(let h=0;h<t.count;h+=3)c(t.getX(h),t.getX(h+1),t.getX(h+2));else for(let h=0;h<s.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),i.boundingBox!==null&&(this.boundingBox=i.boundingBox.clone()),i.boundingSphere!==null&&(this.boundingSphere=i.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zu).negate(),this.translate(Zu.x,Zu.y,Zu.z),this},normalize:function(){this.computeBoundingSphere();const i=this.boundingSphere.center,e=this.boundingSphere.radius,t=e===0?1:1/e,n=new xe;return n.set(t,0,0,-t*i.x,0,t,0,-t*i.y,0,0,t,-t*i.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){const i=new S,e=new S;for(let t=0,n=this.faces.length;t<n;t++){const s=this.faces[t],r=this.vertices[s.a],o=this.vertices[s.b],a=this.vertices[s.c];i.subVectors(a,o),e.subVectors(r,o),i.cross(e),i.normalize(),s.normal.copy(i)}},computeVertexNormals:function(i=!0){const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new S;if(i){const t=new S,n=new S;for(let s=0,r=this.faces.length;s<r;s++){const o=this.faces[s],a=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c];t.subVectors(c,l),n.subVectors(a,l),t.cross(n),e[o.a].add(t),e[o.b].add(t),e[o.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const s=this.faces[t];e[s.a].add(s.normal),e[s.b].add(s.normal),e[s.c].add(s.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const s=this.faces[t],r=s.vertexNormals;r.length===3?(r[0].copy(e[s.a]),r[1].copy(e[s.b]),r[2].copy(e[s.c])):(r[0]=e[s.a].clone(),r[1]=e[s.b].clone(),r[2]=e[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let i=0,e=this.faces.length;i<e;i++){const t=this.faces[i],n=t.vertexNormals;n.length===3?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,t=this.faces.length;e<t;e++){const n=this.faces[e];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(let s=0,r=n.vertexNormals.length;s<r;s++)n.__originalVertexNormals[s]?n.__originalVertexNormals[s].copy(n.vertexNormals[s]):n.__originalVertexNormals[s]=n.vertexNormals[s].clone()}const i=new ti;i.faces=this.faces;for(let e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const s=this.morphNormals[e].faceNormals,r=this.morphNormals[e].vertexNormals;for(let o=0,a=this.faces.length;o<a;o++){const l=new S,c={a:new S,b:new S,c:new S};s.push(l),r.push(c)}}const n=this.morphNormals[e];i.vertices=this.morphTargets[e].vertices,i.computeFaceNormals(),i.computeVertexNormals();for(let s=0,r=this.faces.length;s<r;s++){const o=this.faces[s],a=n.faceNormals[s],l=n.vertexNormals[s];a.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const n=this.faces[e];n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals}},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Wt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new fi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(i,e,t=0){if(!(i&&i.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",i);return}let n;const s=this.vertices.length,r=this.vertices,o=i.vertices,a=this.faces,l=i.faces,c=this.colors,u=i.colors;e!==void 0&&(n=new rn().getNormalMatrix(e));for(let h=0,d=o.length;h<d;h++){const m=o[h].clone();e!==void 0&&m.applyMatrix4(e),r.push(m)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){const f=l[h];let m,v;const _=f.vertexNormals,y=f.vertexColors,x=new bu(f.a+s,f.b+s,f.c+s);x.normal.copy(f.normal),n!==void 0&&x.normal.applyMatrix3(n).normalize();for(let R=0,I=_.length;R<I;R++)m=_[R].clone(),n!==void 0&&m.applyMatrix3(n).normalize(),x.vertexNormals.push(m);x.color.copy(f.color);for(let R=0,I=y.length;R<I;R++)v=y[R],x.vertexColors.push(v.clone());x.materialIndex=f.materialIndex+t,a.push(x)}for(let h=0,d=i.faceVertexUvs.length;h<d;h++){const f=i.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=f.length;m<v;m++){const _=f[m],y=[];for(let x=0,R=_.length;x<R;x++)y.push(_[x].clone());this.faceVertexUvs[h].push(y)}}},mergeMesh:function(i){if(!(i&&i.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",i);return}i.matrixAutoUpdate&&i.updateMatrix(),this.merge(i.geometry,i.matrix)},mergeVertices:function(i=4){const e={},t=[],n=[],s=Math.pow(10,i);for(let a=0,l=this.vertices.length;a<l;a++){const c=this.vertices[a],u=Math.round(c.x*s)+"_"+Math.round(c.y*s)+"_"+Math.round(c.z*s);e[u]===void 0?(e[u]=a,t.push(this.vertices[a]),n[a]=t.length-1):n[a]=n[e[u]]}const r=[];for(let a=0,l=this.faces.length;a<l;a++){const c=this.faces[a];c.a=n[c.a],c.b=n[c.b],c.c=n[c.c];const u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){r.push(a);break}}for(let a=r.length-1;a>=0;a--){const l=r[a];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}const o=this.vertices.length-t.length;return this.vertices=t,o},setFromPoints:function(i){this.vertices=[];for(let e=0,t=i.length;e<t;e++){const n=i[e];this.vertices.push(new S(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const i=this.faces,e=i.length;for(let a=0;a<e;a++)i[a]._id=a;function t(a,l){return a.materialIndex-l.materialIndex}i.sort(t);const n=this.faceVertexUvs[0],s=this.faceVertexUvs[1];let r,o;n&&n.length===e&&(r=[]),s&&s.length===e&&(o=[]);for(let a=0;a<e;a++){const l=i[a]._id;r&&r.push(n[l]),o&&o.push(s[l])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.parameters!==void 0){const f=this.parameters;for(const m in f)f[m]!==void 0&&(i[m]=f[m]);return i}const e=[];for(let f=0;f<this.vertices.length;f++){const m=this.vertices[f];e.push(m.x,m.y,m.z)}const t=[],n=[],s={},r=[],o={},a=[],l={};for(let f=0;f<this.faces.length;f++){const m=this.faces[f],v=!0,_=!1,y=this.faceVertexUvs[0][f]!==void 0,x=m.normal.length()>0,R=m.vertexNormals.length>0,I=m.color.r!==1||m.color.g!==1||m.color.b!==1,B=m.vertexColors.length>0;let N=0;if(N=c(N,0,0),N=c(N,1,v),N=c(N,2,_),N=c(N,3,y),N=c(N,4,x),N=c(N,5,R),N=c(N,6,I),N=c(N,7,B),t.push(N),t.push(m.a,m.b,m.c),t.push(m.materialIndex),y){const J=this.faceVertexUvs[0][f];t.push(d(J[0]),d(J[1]),d(J[2]))}if(x&&t.push(u(m.normal)),R){const J=m.vertexNormals;t.push(u(J[0]),u(J[1]),u(J[2]))}if(I&&t.push(h(m.color)),B){const J=m.vertexColors;t.push(h(J[0]),h(J[1]),h(J[2]))}}function c(f,m,v){return v?f|1<<m:f&~(1<<m)}function u(f){const m=f.x.toString()+f.y.toString()+f.z.toString();return s[m]!==void 0||(s[m]=n.length/3,n.push(f.x,f.y,f.z)),s[m]}function h(f){const m=f.r.toString()+f.g.toString()+f.b.toString();return o[m]!==void 0||(o[m]=r.length,r.push(f.getHex())),o[m]}function d(f){const m=f.x.toString()+f.y.toString();return l[m]!==void 0||(l[m]=a.length/2,a.push(f.x,f.y)),l[m]}return i.data={},i.data.vertices=e,i.data.normals=n,r.length>0&&(i.data.colors=r),a.length>0&&(i.data.uvs=[a]),i.data.faces=t,i},clone:function(){return new ti().copy(this)},copy:function(i){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=i.name;const e=i.vertices;for(let h=0,d=e.length;h<d;h++)this.vertices.push(e[h].clone());const t=i.colors;for(let h=0,d=t.length;h<d;h++)this.colors.push(t[h].clone());const n=i.faces;for(let h=0,d=n.length;h<d;h++)this.faces.push(n[h].clone());for(let h=0,d=i.faceVertexUvs.length;h<d;h++){const f=i.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=f.length;m<v;m++){const _=f[m],y=[];for(let x=0,R=_.length;x<R;x++){const I=_[x];y.push(I.clone())}this.faceVertexUvs[h].push(y)}}const s=i.morphTargets;for(let h=0,d=s.length;h<d;h++){const f={};if(f.name=s[h].name,s[h].vertices!==void 0){f.vertices=[];for(let m=0,v=s[h].vertices.length;m<v;m++)f.vertices.push(s[h].vertices[m].clone())}if(s[h].normals!==void 0){f.normals=[];for(let m=0,v=s[h].normals.length;m<v;m++)f.normals.push(s[h].normals[m].clone())}this.morphTargets.push(f)}const r=i.morphNormals;for(let h=0,d=r.length;h<d;h++){const f={};if(r[h].vertexNormals!==void 0){f.vertexNormals=[];for(let m=0,v=r[h].vertexNormals.length;m<v;m++){const _=r[h].vertexNormals[m],y={};y.a=_.a.clone(),y.b=_.b.clone(),y.c=_.c.clone(),f.vertexNormals.push(y)}}if(r[h].faceNormals!==void 0){f.faceNormals=[];for(let m=0,v=r[h].faceNormals.length;m<v;m++)f.faceNormals.push(r[h].faceNormals[m].clone())}this.morphNormals.push(f)}const o=i.skinWeights;for(let h=0,d=o.length;h<d;h++)this.skinWeights.push(o[h].clone());const a=i.skinIndices;for(let h=0,d=a.length;h<d;h++)this.skinIndices.push(a[h].clone());const l=i.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);const c=i.boundingBox;c!==null&&(this.boundingBox=c.clone());const u=i.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=i.elementsNeedUpdate,this.verticesNeedUpdate=i.verticesNeedUpdate,this.uvsNeedUpdate=i.uvsNeedUpdate,this.normalsNeedUpdate=i.normalsNeedUpdate,this.colorsNeedUpdate=i.colorsNeedUpdate,this.lineDistancesNeedUpdate=i.lineDistancesNeedUpdate,this.groupsNeedUpdate=i.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Ul extends ti{constructor(e,t,n,s,r,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new Bu(e,t,n,s,r,o)),this.mergeVertices()}}class Cp extends wt{constructor(e=1,t=8,n=0,s=Math.PI*2){super(),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new S,u=new Se;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const f=n+h/t*s;c.x=e*Math.cos(f),c.y=e*Math.sin(f),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[d]/e+1)/2,u.y=(o[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)r.push(h,h+1,0);this.setIndex(r),this.setAttribute("position",new ft(o,3)),this.setAttribute("normal",new ft(a,3)),this.setAttribute("uv",new ft(l,2))}}class yw extends ti{constructor(e,t,n,s){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},this.fromBufferGeometry(new Cp(e,t,n,s)),this.mergeVertices()}}class Ju extends wt{constructor(e=1,t=1,n=1,s=8,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const u=[],h=[],d=[],f=[];let m=0;const v=[],_=n/2;let y=0;x(),o===!1&&(e>0&&R(!0),t>0&&R(!1)),this.setIndex(u),this.setAttribute("position",new ft(h,3)),this.setAttribute("normal",new ft(d,3)),this.setAttribute("uv",new ft(f,2));function x(){const I=new S,B=new S;let N=0;const J=(t-e)/n;for(let ne=0;ne<=r;ne++){const se=[],E=ne/r,M=E*(t-e)+e;for(let A=0;A<=s;A++){const F=A/s,P=F*l+a,O=Math.sin(P),V=Math.cos(P);B.x=M*O,B.y=-E*n+_,B.z=M*V,h.push(B.x,B.y,B.z),I.set(O,J,V).normalize(),d.push(I.x,I.y,I.z),f.push(F,1-E),se.push(m++)}v.push(se)}for(let ne=0;ne<s;ne++)for(let se=0;se<r;se++){const E=v[se][ne],M=v[se+1][ne],A=v[se+1][ne+1],F=v[se][ne+1];u.push(E,M,F),u.push(M,A,F),N+=6}c.addGroup(y,N,0),y+=N}function R(I){const B=m,N=new Se,J=new S;let ne=0;const se=I===!0?e:t,E=I===!0?1:-1;for(let A=1;A<=s;A++)h.push(0,_*E,0),d.push(0,E,0),f.push(.5,.5),m++;const M=m;for(let A=0;A<=s;A++){const P=A/s*l+a,O=Math.cos(P),V=Math.sin(P);J.x=se*V,J.y=_*E,J.z=se*O,h.push(J.x,J.y,J.z),d.push(0,E,0),N.x=O*.5+.5,N.y=V*.5*E+.5,f.push(N.x,N.y),m++}for(let A=0;A<s;A++){const F=B+A,P=M+A;I===!0?u.push(P,P+1,F):u.push(P+1,P,F),ne+=3}c.addGroup(y,ne,I===!0?1:2),y+=ne}}}class Ku extends ti{constructor(e,t,n,s,r,o,a,l){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l},this.fromBufferGeometry(new Ju(e,t,n,s,r,o,a,l)),this.mergeVertices()}}class xw extends Ku{constructor(e,t,n,s,r,o,a){super(0,e,t,n,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}}class ww extends Ju{constructor(e=1,t=1,n=8,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,n,s,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}}class Gl extends wt{constructor(e,t,n=1,s=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const r=[],o=[];a(s),c(n),u(),this.setAttribute("position",new ft(r,3)),this.setAttribute("normal",new ft(r.slice(),3)),this.setAttribute("uv",new ft(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(x){const R=new S,I=new S,B=new S;for(let N=0;N<t.length;N+=3)f(t[N+0],R),f(t[N+1],I),f(t[N+2],B),l(R,I,B,x)}function l(x,R,I,B){const N=B+1,J=[];for(let ne=0;ne<=N;ne++){J[ne]=[];const se=x.clone().lerp(I,ne/N),E=R.clone().lerp(I,ne/N),M=N-ne;for(let A=0;A<=M;A++)A===0&&ne===N?J[ne][A]=se:J[ne][A]=se.clone().lerp(E,A/M)}for(let ne=0;ne<N;ne++)for(let se=0;se<2*(N-ne)-1;se++){const E=Math.floor(se/2);se%2===0?(d(J[ne][E+1]),d(J[ne+1][E]),d(J[ne][E])):(d(J[ne][E+1]),d(J[ne+1][E+1]),d(J[ne+1][E]))}}function c(x){const R=new S;for(let I=0;I<r.length;I+=3)R.x=r[I+0],R.y=r[I+1],R.z=r[I+2],R.normalize().multiplyScalar(x),r[I+0]=R.x,r[I+1]=R.y,r[I+2]=R.z}function u(){const x=new S;for(let R=0;R<r.length;R+=3){x.x=r[R+0],x.y=r[R+1],x.z=r[R+2];const I=_(x)/2/Math.PI+.5,B=y(x)/Math.PI+.5;o.push(I,1-B)}m(),h()}function h(){for(let x=0;x<o.length;x+=6){const R=o[x+0],I=o[x+2],B=o[x+4],N=Math.max(R,I,B),J=Math.min(R,I,B);N>.9&&J<.1&&(R<.2&&(o[x+0]+=1),I<.2&&(o[x+2]+=1),B<.2&&(o[x+4]+=1))}}function d(x){r.push(x.x,x.y,x.z)}function f(x,R){const I=x*3;R.x=e[I+0],R.y=e[I+1],R.z=e[I+2]}function m(){const x=new S,R=new S,I=new S,B=new S,N=new Se,J=new Se,ne=new Se;for(let se=0,E=0;se<r.length;se+=9,E+=6){x.set(r[se+0],r[se+1],r[se+2]),R.set(r[se+3],r[se+4],r[se+5]),I.set(r[se+6],r[se+7],r[se+8]),N.set(o[E+0],o[E+1]),J.set(o[E+2],o[E+3]),ne.set(o[E+4],o[E+5]),B.copy(x).add(R).add(I).divideScalar(3);const M=_(B);v(N,E+0,x,M),v(J,E+2,R,M),v(ne,E+4,I,M)}}function v(x,R,I,B){B<0&&x.x===1&&(o[R]=x.x-1),I.x===0&&I.z===0&&(o[R]=B/2/Math.PI+.5)}function _(x){return Math.atan2(x.z,-x.x)}function y(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}}class Dp extends Gl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class bw extends ti{constructor(e,t){super(),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Dp(e,t)),this.mergeVertices()}}const Qu=new S,eh=new S,fd=new S,th=new Gn;class Pp extends wt{constructor(e,t){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1,e.isGeometry&&(e=new wt().fromGeometry(e));const s=Math.pow(10,4),r=Math.cos(rt.DEG2RAD*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:v,b:_,c:y}=th;if(v.fromBufferAttribute(a,c[0]),_.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),th.getNormal(fd),h[0]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,h[1]=`${Math.round(_.x*s)},${Math.round(_.y*s)},${Math.round(_.z*s)}`,h[2]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const R=(x+1)%3,I=h[x],B=h[R],N=th[u[x]],J=th[u[R]],ne=`${I}_${B}`,se=`${B}_${I}`;se in d&&d[se]?(fd.dot(d[se].normal)<=r&&(f.push(N.x,N.y,N.z),f.push(J.x,J.y,J.z)),d[se]=null):ne in d||(d[ne]={index0:c[x],index1:c[R],normal:fd.clone()})}}for(const m in d)if(d[m]){const{index0:v,index1:_}=d[m];Qu.fromBufferAttribute(a,v),eh.fromBufferAttribute(a,_),f.push(Qu.x,Qu.y,Qu.z),f.push(eh.x,eh.y,eh.z)}this.setAttribute("position",new ft(f,3))}}const _w={triangulate:function(i,e,t){t=t||2;const n=e&&e.length,s=n?e[0]*t:i.length;let r=Lp(i,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,u,h,d,f;if(n&&(r=Aw(i,e,r,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(let m=t;m<s;m+=t)h=i[m],d=i[m+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-a,u-l),f=f!==0?1/f:0}return Uc(r,o,t,a,l,f),o}};function Lp(i,e,t,n,s){let r,o;if(s===kw(i,e,t,n)>0)for(r=e;r<t;r+=n)o=Fp(r,i[r],i[r+1],o);else for(r=t-n;r>=e;r-=n)o=Fp(r,i[r],i[r+1],o);return o&&ih(o,o.next)&&(Hc(o),o=o.next),o}function Qo(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(ih(t,t.next)||Vi(t.prev,t,t.next)===0)){if(Hc(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Uc(i,e,t,n,s,r,o){if(!i)return;!o&&r&&Rw(i,n,s,r);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,r?Ew(i,n,s,r):Mw(i)){e.push(l.i/t),e.push(i.i/t),e.push(c.i/t),Hc(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=Sw(Qo(i),e,t),Uc(i,e,t,n,s,r,2)):o===2&&Tw(i,e,t,n,s,r):Uc(Qo(i),e,t,n,s,r,1);break}}}function Mw(i){const e=i.prev,t=i,n=i.next;if(Vi(e,t,n)>=0)return!1;let s=i.next.next;for(;s!==i.prev;){if(Hl(e.x,e.y,t.x,t.y,n.x,n.y,s.x,s.y)&&Vi(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Ew(i,e,t,n){const s=i.prev,r=i,o=i.next;if(Vi(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,u=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,h=pd(a,l,e,t,n),d=pd(c,u,e,t,n);let f=i.prevZ,m=i.nextZ;for(;f&&f.z>=h&&m&&m.z<=d;){if(f!==i.prev&&f!==i.next&&Hl(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&Vi(f.prev,f,f.next)>=0||(f=f.prevZ,m!==i.prev&&m!==i.next&&Hl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&Vi(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;f&&f.z>=h;){if(f!==i.prev&&f!==i.next&&Hl(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&Vi(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=d;){if(m!==i.prev&&m!==i.next&&Hl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&Vi(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Sw(i,e,t){let n=i;do{const s=n.prev,r=n.next.next;!ih(s,r)&&Rp(s,n,n.next,r)&&Gc(s,r)&&Gc(r,s)&&(e.push(s.i/t),e.push(n.i/t),e.push(r.i/t),Hc(n),Hc(n.next),n=i=r),n=n.next}while(n!==i);return Qo(n)}function Tw(i,e,t,n,s,r){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Bw(o,a)){let l=Ip(o,a);o=Qo(o,o.next),l=Qo(l,l.next),Uc(o,e,t,n,s,r),Uc(l,e,t,n,s,r);return}a=a.next}o=o.next}while(o!==i)}function Aw(i,e,t,n){const s=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*n,l=r<o-1?e[r+1]*n:i.length,c=Lp(i,a,l,n,!1),c===c.next&&(c.steiner=!0),s.push(Fw(c));for(s.sort(Cw),r=0;r<s.length;r++)Dw(s[r],t),t=Qo(t,t.next);return t}function Cw(i,e){return i.x-e.x}function Dw(i,e){if(e=Pw(i,e),e){const t=Ip(e,i);Qo(e,e.next),Qo(t,t.next)}}function Pw(i,e){let t=e;const n=i.x,s=i.y;let r=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const d=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=n&&d>r){if(r=d,d===n){if(s===t.y)return t;if(s===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===r)return o;const a=o,l=o.x,c=o.y;let u=1/0,h;t=o;do n>=t.x&&t.x>=l&&n!==t.x&&Hl(s<c?n:r,s,l,c,s<c?r:n,s,t.x,t.y)&&(h=Math.abs(s-t.y)/(n-t.x),Gc(t,i)&&(h<u||h===u&&(t.x>o.x||t.x===o.x&&Lw(o,t)))&&(o=t,u=h)),t=t.next;while(t!==a);return o}function Lw(i,e){return Vi(i.prev,i,e.prev)<0&&Vi(e.next,i,i.next)<0}function Rw(i,e,t,n){let s=i;do s.z===null&&(s.z=pd(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,Iw(s)}function Iw(i){let e,t,n,s,r,o,a,l,c=1;do{for(t=i,i=null,r=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(s=t,t=t.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;t=n}r.nextZ=null,c*=2}while(o>1);return i}function pd(i,e,t,n,s){return i=32767*(i-t)*s,e=32767*(e-n)*s,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function Fw(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Hl(i,e,t,n,s,r,o,a){return(s-o)*(e-a)-(i-o)*(r-a)>=0&&(i-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(r-a)-(s-o)*(n-a)>=0}function Bw(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!Nw(i,e)&&(Gc(i,e)&&Gc(e,i)&&Ow(i,e)&&(Vi(i.prev,i,e.prev)||Vi(i,e.prev,e))||ih(i,e)&&Vi(i.prev,i,i.next)>0&&Vi(e.prev,e,e.next)>0)}function Vi(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function ih(i,e){return i.x===e.x&&i.y===e.y}function Rp(i,e,t,n){const s=sh(Vi(i,e,t)),r=sh(Vi(i,e,n)),o=sh(Vi(t,n,i)),a=sh(Vi(t,n,e));return!!(s!==r&&o!==a||s===0&&nh(i,t,e)||r===0&&nh(i,n,e)||o===0&&nh(t,i,n)||a===0&&nh(t,e,n))}function nh(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function sh(i){return i>0?1:i<0?-1:0}function Nw(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&Rp(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Gc(i,e){return Vi(i.prev,i,i.next)<0?Vi(i,e,i.next)>=0&&Vi(i,i.prev,e)>=0:Vi(i,e,i.prev)<0||Vi(i,i.next,e)<0}function Ow(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,r=(i.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function Ip(i,e){const t=new md(i.i,i.x,i.y),n=new md(e.i,e.x,e.y),s=i.next,r=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function Fp(i,e,t,n){const s=new md(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Hc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function md(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kw(i,e,t,n){let s=0;for(let r=e,o=t-n;r<t;r+=n)s+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return s}const ea={area:function(i){const e=i.length;let t=0;for(let n=e-1,s=0;s<e;n=s++)t+=i[n].x*i[s].y-i[s].x*i[n].y;return t*.5},isClockWise:function(i){return ea.area(i)<0},triangulateShape:function(i,e){const t=[],n=[],s=[];Bp(i),Np(t,i);let r=i.length;e.forEach(Bp);for(let a=0;a<e.length;a++)n.push(r),r+=e[a].length,Np(t,e[a]);const o=_w.triangulate(t,n);for(let a=0;a<o.length;a+=3)s.push(o.slice(a,a+3));return s}};function Bp(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function Np(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class rh extends wt{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new ft(s,3)),this.setAttribute("uv",new ft(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1;let h=t.depth!==void 0?t.depth:100,d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,m=t.bevelSize!==void 0?t.bevelSize:f-2,v=t.bevelOffset!==void 0?t.bevelOffset:0,_=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:zw;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=t.amount);let R,I=!1,B,N,J,ne;y&&(R=y.getSpacedPoints(u),I=!0,d=!1,B=y.computeFrenetFrames(u,!1),N=new S,J=new S,ne=new S),d||(_=0,f=0,m=0,v=0);const se=a.extractPoints(c);let E=se.shape;const M=se.holes;if(!ea.isClockWise(E)){E=E.reverse();for(let le=0,oe=M.length;le<oe;le++){const we=M[le];ea.isClockWise(we)&&(M[le]=we.reverse())}}const F=ea.triangulateShape(E,M),P=E;for(let le=0,oe=M.length;le<oe;le++){const we=M[le];E=E.concat(we)}function O(le,oe,we){return oe||console.error("THREE.ExtrudeGeometry: vec does not exist"),oe.clone().multiplyScalar(we).add(le)}const V=E.length,W=F.length;function fe(le,oe,we){let Le,Ae,K;const Q=le.x-oe.x,Ue=le.y-oe.y,Be=we.x-le.x,ye=we.y-le.y,Je=Q*Q+Ue*Ue,it=Q*ye-Ue*Be;if(Math.abs(it)>Number.EPSILON){const lt=Math.sqrt(Je),nt=Math.sqrt(Be*Be+ye*ye),xt=oe.x-Ue/lt,At=oe.y+Q/lt,kt=we.x-ye/nt,gt=we.y+Be/nt,Rt=((kt-xt)*ye-(gt-At)*Be)/(Q*ye-Ue*Be);Le=xt+Q*Rt-le.x,Ae=At+Ue*Rt-le.y;const ii=Le*Le+Ae*Ae;if(ii<=2)return new Se(Le,Ae);K=Math.sqrt(ii/2)}else{let lt=!1;Q>Number.EPSILON?Be>Number.EPSILON&&(lt=!0):Q<-Number.EPSILON?Be<-Number.EPSILON&&(lt=!0):Math.sign(Ue)===Math.sign(ye)&&(lt=!0),lt?(Le=-Ue,Ae=Q,K=Math.sqrt(Je)):(Le=Q,Ae=Ue,K=Math.sqrt(Je/2))}return new Se(Le/K,Ae/K)}const ve=[];for(let le=0,oe=P.length,we=oe-1,Le=le+1;le<oe;le++,we++,Le++)we===oe&&(we=0),Le===oe&&(Le=0),ve[le]=fe(P[le],P[we],P[Le]);const pe=[];let Me,Fe=ve.concat();for(let le=0,oe=M.length;le<oe;le++){const we=M[le];Me=[];for(let Le=0,Ae=we.length,K=Ae-1,Q=Le+1;Le<Ae;Le++,K++,Q++)K===Ae&&(K=0),Q===Ae&&(Q=0),Me[Le]=fe(we[Le],we[K],we[Q]);pe.push(Me),Fe=Fe.concat(Me)}for(let le=0;le<_;le++){const oe=le/_,we=f*Math.cos(oe*Math.PI/2),Le=m*Math.sin(oe*Math.PI/2)+v;for(let Ae=0,K=P.length;Ae<K;Ae++){const Q=O(P[Ae],ve[Ae],Le);X(Q.x,Q.y,-we)}for(let Ae=0,K=M.length;Ae<K;Ae++){const Q=M[Ae];Me=pe[Ae];for(let Ue=0,Be=Q.length;Ue<Be;Ue++){const ye=O(Q[Ue],Me[Ue],Le);X(ye.x,ye.y,-we)}}}const at=m+v;for(let le=0;le<V;le++){const oe=d?O(E[le],Fe[le],at):E[le];I?(J.copy(B.normals[0]).multiplyScalar(oe.x),N.copy(B.binormals[0]).multiplyScalar(oe.y),ne.copy(R[0]).add(J).add(N),X(ne.x,ne.y,ne.z)):X(oe.x,oe.y,0)}for(let le=1;le<=u;le++)for(let oe=0;oe<V;oe++){const we=d?O(E[oe],Fe[oe],at):E[oe];I?(J.copy(B.normals[le]).multiplyScalar(we.x),N.copy(B.binormals[le]).multiplyScalar(we.y),ne.copy(R[le]).add(J).add(N),X(ne.x,ne.y,ne.z)):X(we.x,we.y,h/u*le)}for(let le=_-1;le>=0;le--){const oe=le/_,we=f*Math.cos(oe*Math.PI/2),Le=m*Math.sin(oe*Math.PI/2)+v;for(let Ae=0,K=P.length;Ae<K;Ae++){const Q=O(P[Ae],ve[Ae],Le);X(Q.x,Q.y,h+we)}for(let Ae=0,K=M.length;Ae<K;Ae++){const Q=M[Ae];Me=pe[Ae];for(let Ue=0,Be=Q.length;Ue<Be;Ue++){const ye=O(Q[Ue],Me[Ue],Le);I?X(ye.x,ye.y+R[u-1].y,R[u-1].x+we):X(ye.x,ye.y,h+we)}}}bt(),Ie();function bt(){const le=s.length/3;if(d){let oe=0,we=V*oe;for(let Le=0;Le<W;Le++){const Ae=F[Le];ce(Ae[2]+we,Ae[1]+we,Ae[0]+we)}oe=u+_*2,we=V*oe;for(let Le=0;Le<W;Le++){const Ae=F[Le];ce(Ae[0]+we,Ae[1]+we,Ae[2]+we)}}else{for(let oe=0;oe<W;oe++){const we=F[oe];ce(we[2],we[1],we[0])}for(let oe=0;oe<W;oe++){const we=F[oe];ce(we[0]+V*u,we[1]+V*u,we[2]+V*u)}}n.addGroup(le,s.length/3-le,0)}function Ie(){const le=s.length/3;let oe=0;Y(P,oe),oe+=P.length;for(let we=0,Le=M.length;we<Le;we++){const Ae=M[we];Y(Ae,oe),oe+=Ae.length}n.addGroup(le,s.length/3-le,1)}function Y(le,oe){let we=le.length;for(;--we>=0;){const Le=we;let Ae=we-1;Ae<0&&(Ae=le.length-1);for(let K=0,Q=u+_*2;K<Q;K++){const Ue=V*K,Be=V*(K+1),ye=oe+Le+Ue,Je=oe+Ae+Ue,it=oe+Ae+Be,lt=oe+Le+Be;ie(ye,Je,it,lt)}}}function X(le,oe,we){l.push(le),l.push(oe),l.push(we)}function ce(le,oe,we){he(le),he(oe),he(we);const Le=s.length/3,Ae=x.generateTopUV(n,s,Le-3,Le-2,Le-1);ge(Ae[0]),ge(Ae[1]),ge(Ae[2])}function ie(le,oe,we,Le){he(le),he(oe),he(Le),he(oe),he(we),he(Le);const Ae=s.length/3,K=x.generateSideWallUV(n,s,Ae-6,Ae-3,Ae-2,Ae-1);ge(K[0]),ge(K[1]),ge(K[3]),ge(K[1]),ge(K[2]),ge(K[3])}function he(le){s.push(l[le*3+0]),s.push(l[le*3+1]),s.push(l[le*3+2])}function ge(le){r.push(le.x),r.push(le.y)}}}toJSON(){const e=wt.prototype.toJSON.call(this),t=this.parameters.shapes,n=this.parameters.options;return Uw(t,n,e)}}const zw={generateTopUV:function(i,e,t,n,s){const r=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[s*3],u=e[s*3+1];return[new Se(r,o),new Se(a,l),new Se(c,u)]},generateSideWallUV:function(i,e,t,n,s,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],d=e[s*3],f=e[s*3+1],m=e[s*3+2],v=e[r*3],_=e[r*3+1],y=e[r*3+2];return Math.abs(a-u)<.01?[new Se(o,1-l),new Se(c,1-h),new Se(d,1-m),new Se(v,1-y)]:[new Se(a,1-l),new Se(u,1-h),new Se(f,1-m),new Se(_,1-y)]}};function Uw(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Op extends ti{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new rh(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return Gw(t,n,e)}}function Gw(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class kp extends Gl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class Hw extends ti{constructor(e,t){super(),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new kp(e,t)),this.mergeVertices()}}class zp extends wt{constructor(e,t=12,n=0,s=Math.PI*2){super(),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=rt.clamp(s,0,Math.PI*2);const r=[],o=[],a=[],l=1/t,c=new S,u=new Se;for(let h=0;h<=t;h++){const d=n+h*l*s,f=Math.sin(d),m=Math.cos(d);for(let v=0;v<=e.length-1;v++)c.x=e[v].x*f,c.y=e[v].y,c.z=e[v].x*m,o.push(c.x,c.y,c.z),u.x=h/t,u.y=v/(e.length-1),a.push(u.x,u.y)}for(let h=0;h<t;h++)for(let d=0;d<e.length-1;d++){const f=d+h*e.length,m=f,v=f+e.length,_=f+e.length+1,y=f+1;r.push(m,v,y),r.push(v,_,y)}if(this.setIndex(r),this.setAttribute("position",new ft(o,3)),this.setAttribute("uv",new ft(a,2)),this.computeVertexNormals(),s===Math.PI*2){const h=this.attributes.normal.array,d=new S,f=new S,m=new S,v=t*e.length*3;for(let _=0,y=0;_<e.length;_++,y+=3)d.x=h[y+0],d.y=h[y+1],d.z=h[y+2],f.x=h[v+y+0],f.y=h[v+y+1],f.z=h[v+y+2],m.addVectors(d,f).normalize(),h[y+0]=h[v+y+0]=m.x,h[y+1]=h[v+y+1]=m.y,h[y+2]=h[v+y+2]=m.z}}}class Vw extends ti{constructor(e,t,n,s){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},this.fromBufferGeometry(new zp(e,t,n,s)),this.mergeVertices()}}class gd extends Gl{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class jw extends ti{constructor(e,t){super(),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new gd(e,t)),this.mergeVertices()}}function Vc(i,e,t){wt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:i,slices:e,stacks:t};const n=[],s=[],r=[],o=[],a=1e-5,l=new S,c=new S,u=new S,h=new S,d=new S;i.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const f=e+1;for(let m=0;m<=t;m++){const v=m/t;for(let _=0;_<=e;_++){const y=_/e;i(y,v,c),s.push(c.x,c.y,c.z),y-a>=0?(i(y-a,v,u),h.subVectors(c,u)):(i(y+a,v,u),h.subVectors(u,c)),v-a>=0?(i(y,v-a,u),d.subVectors(c,u)):(i(y,v+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),r.push(l.x,l.y,l.z),o.push(y,v)}}for(let m=0;m<t;m++)for(let v=0;v<e;v++){const _=m*f+v,y=m*f+v+1,x=(m+1)*f+v+1,R=(m+1)*f+v;n.push(_,y,R),n.push(y,x,R)}this.setIndex(n),this.setAttribute("position",new ft(s,3)),this.setAttribute("normal",new ft(r,3)),this.setAttribute("uv",new ft(o,2))}Vc.prototype=Object.create(wt.prototype),Vc.prototype.constructor=Vc;function oh(i,e,t){ti.call(this),this.type="ParametricGeometry",this.parameters={func:i,slices:e,stacks:t},this.fromBufferGeometry(new Vc(i,e,t)),this.mergeVertices()}oh.prototype=Object.create(ti.prototype),oh.prototype.constructor=oh;class jc extends ti{constructor(e,t,n,s){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s},this.fromBufferGeometry(new Ll(e,t,n,s)),this.mergeVertices()}}class Ww extends ti{constructor(e,t,n,s){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s},this.fromBufferGeometry(new Gl(e,t,n,s)),this.mergeVertices()}}class Up extends wt{constructor(e=.5,t=1,n=8,s=1,r=0,o=Math.PI*2){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:r,thetaLength:o},n=Math.max(3,n),s=Math.max(1,s);const a=[],l=[],c=[],u=[];let h=e;const d=(t-e)/s,f=new S,m=new Se;for(let v=0;v<=s;v++){for(let _=0;_<=n;_++){const y=r+_/n*o;f.x=h*Math.cos(y),f.y=h*Math.sin(y),l.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/t+1)/2,m.y=(f.y/t+1)/2,u.push(m.x,m.y)}h+=d}for(let v=0;v<s;v++){const _=v*(n+1);for(let y=0;y<n;y++){const x=y+_,R=x,I=x+n+1,B=x+n+2,N=x+1;a.push(R,I,N),a.push(I,B,N)}}this.setIndex(a),this.setAttribute("position",new ft(l,3)),this.setAttribute("normal",new ft(c,3)),this.setAttribute("uv",new ft(u,2))}}class $w extends ti{constructor(e,t,n,s,r,o){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Up(e,t,n,s,r,o)),this.mergeVertices()}}class Gp extends wt{constructor(e,t=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new ft(s,3)),this.setAttribute("normal",new ft(r,3)),this.setAttribute("uv",new ft(o,2));function c(u){const h=s.length/3,d=u.extractPoints(t);let f=d.shape;const m=d.holes;ea.isClockWise(f)===!1&&(f=f.reverse());for(let _=0,y=m.length;_<y;_++){const x=m[_];ea.isClockWise(x)===!0&&(m[_]=x.reverse())}const v=ea.triangulateShape(f,m);for(let _=0,y=m.length;_<y;_++){const x=m[_];f=f.concat(x)}for(let _=0,y=f.length;_<y;_++){const x=f[_];s.push(x.x,x.y,0),r.push(0,0,1),o.push(x.x,x.y)}for(let _=0,y=v.length;_<y;_++){const x=v[_],R=x[0]+h,I=x[1]+h,B=x[2]+h;n.push(R,I,B),l+=3}}}toJSON(){const e=wt.prototype.toJSON.call(this),t=this.parameters.shapes;return qw(t,e)}}function qw(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class Hp extends ti{constructor(e,t){super(),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Gp(e,t)),this.mergeVertices()}toJSON(){const e=ti.prototype.toJSON.call(this),t=this.parameters.shapes;return Xw(t,e)}}function Xw(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class ah extends wt{constructor(e=1,t=8,n=6,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new S,d=new S,f=[],m=[],v=[],_=[];for(let y=0;y<=n;y++){const x=[],R=y/n;let I=0;y==0&&o==0?I=.5/t:y==n&&l==Math.PI&&(I=-.5/t);for(let B=0;B<=t;B++){const N=B/t;h.x=-e*Math.cos(s+N*r)*Math.sin(o+R*a),h.y=e*Math.cos(o+R*a),h.z=e*Math.sin(s+N*r)*Math.sin(o+R*a),m.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),_.push(N+I,1-R),x.push(c++)}u.push(x)}for(let y=0;y<n;y++)for(let x=0;x<t;x++){const R=u[y][x+1],I=u[y][x],B=u[y+1][x],N=u[y+1][x+1];(y!==0||o>0)&&f.push(R,I,N),(y!==n-1||l<Math.PI)&&f.push(I,B,N)}this.setIndex(f),this.setAttribute("position",new ft(m,3)),this.setAttribute("normal",new ft(v,3)),this.setAttribute("uv",new ft(_,2))}}class Li extends ti{constructor(e,t,n,s,r,o,a){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new ah(e,t,n,s,r,o,a)),this.mergeVertices()}}class Vp extends Gl{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class Yw extends ti{constructor(e,t){super(),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Vp(e,t)),this.mergeVertices()}}class jp extends rh{constructor(e,t={}){const n=t.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new wt;const s=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(s,t),this.type="TextBufferGeometry"}}class Zw extends ti{constructor(e,t){super(),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new jp(e,t)),this.mergeVertices()}}class Wp extends wt{constructor(e=1,t=.4,n=8,s=6,r=Math.PI*2){super(),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},n=Math.floor(n),s=Math.floor(s);const o=[],a=[],l=[],c=[],u=new S,h=new S,d=new S;for(let f=0;f<=n;f++)for(let m=0;m<=s;m++){const v=m/s*r,_=f/n*Math.PI*2;h.x=(e+t*Math.cos(_))*Math.cos(v),h.y=(e+t*Math.cos(_))*Math.sin(v),h.z=t*Math.sin(_),a.push(h.x,h.y,h.z),u.x=e*Math.cos(v),u.y=e*Math.sin(v),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(m/s),c.push(f/n)}for(let f=1;f<=n;f++)for(let m=1;m<=s;m++){const v=(s+1)*f+m-1,_=(s+1)*(f-1)+m-1,y=(s+1)*(f-1)+m,x=(s+1)*f+m;o.push(v,_,x),o.push(_,y,x)}this.setIndex(o),this.setAttribute("position",new ft(a,3)),this.setAttribute("normal",new ft(l,3)),this.setAttribute("uv",new ft(c,2))}}class lh extends ti{constructor(e,t,n,s,r){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},this.fromBufferGeometry(new Wp(e,t,n,s,r)),this.mergeVertices()}}class $p extends wt{constructor(e=1,t=.4,n=64,s=8,r=2,o=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:r,q:o},n=Math.floor(n),s=Math.floor(s);const a=[],l=[],c=[],u=[],h=new S,d=new S,f=new S,m=new S,v=new S,_=new S,y=new S;for(let R=0;R<=n;++R){const I=R/n*r*Math.PI*2;x(I,r,o,e,f),x(I+.01,r,o,e,m),_.subVectors(m,f),y.addVectors(m,f),v.crossVectors(_,y),y.crossVectors(v,_),v.normalize(),y.normalize();for(let B=0;B<=s;++B){const N=B/s*Math.PI*2,J=-t*Math.cos(N),ne=t*Math.sin(N);h.x=f.x+(J*y.x+ne*v.x),h.y=f.y+(J*y.y+ne*v.y),h.z=f.z+(J*y.z+ne*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(R/n),u.push(B/s)}}for(let R=1;R<=n;R++)for(let I=1;I<=s;I++){const B=(s+1)*(R-1)+(I-1),N=(s+1)*R+(I-1),J=(s+1)*R+I,ne=(s+1)*(R-1)+I;a.push(B,N,ne),a.push(N,J,ne)}this.setIndex(a),this.setAttribute("position",new ft(l,3)),this.setAttribute("normal",new ft(c,3)),this.setAttribute("uv",new ft(u,2));function x(R,I,B,N,J){const ne=Math.cos(R),se=Math.sin(R),E=B/I*R,M=Math.cos(E);J.x=N*(2+M)*.5*ne,J.y=N*(2+M)*se*.5,J.z=N*Math.sin(E)*.5}}}class Jw extends ti{constructor(e,t,n,s,r,o,a){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:r,q:o},a!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new $p(e,t,n,s,r,o)),this.mergeVertices()}}class qp extends wt{constructor(e,t=64,n=1,s=8,r=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new S,l=new S,c=new Se;let u=new S;const h=[],d=[],f=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new ft(h,3)),this.setAttribute("normal",new ft(d,3)),this.setAttribute("uv",new ft(f,2));function v(){for(let R=0;R<t;R++)_(R);_(r===!1?t:0),x(),y()}function _(R){u=e.getPointAt(R/t,u);const I=o.normals[R],B=o.binormals[R];for(let N=0;N<=s;N++){const J=N/s*Math.PI*2,ne=Math.sin(J),se=-Math.cos(J);l.x=se*I.x+ne*B.x,l.y=se*I.y+ne*B.y,l.z=se*I.z+ne*B.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,h.push(a.x,a.y,a.z)}}function y(){for(let R=1;R<=t;R++)for(let I=1;I<=s;I++){const B=(s+1)*(R-1)+(I-1),N=(s+1)*R+(I-1),J=(s+1)*R+I,ne=(s+1)*(R-1)+I;m.push(B,N,ne),m.push(N,J,ne)}}function x(){for(let R=0;R<=t;R++)for(let I=0;I<=s;I++)c.x=R/t,c.y=I/s,f.push(c.x,c.y)}}toJSON(){const e=wt.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class Kw extends ti{constructor(e,t,n,s,r,o){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:r},o!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");const a=new qp(e,t,n,s,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}}class vd extends wt{constructor(e){super(),this.type="WireframeGeometry";const t=[],n=[0,0],s={},r=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let a=0,l=o.length;a<l;a++){const c=o[a];for(let u=0;u<3;u++){const h=c[r[u]],d=c[r[(u+1)%3]];n[0]=Math.min(h,d),n[1]=Math.max(h,d);const f=n[0]+","+n[1];s[f]===void 0&&(s[f]={index1:n[0],index2:n[1]})}}for(const a in s){const l=s[a];let c=e.vertices[l.index1];t.push(c.x,c.y,c.z),c=e.vertices[l.index2],t.push(c.x,c.y,c.z)}}else if(e&&e.isBufferGeometry){const o=new S;if(e.index!==null){const a=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let u=0,h=c.length;u<h;++u){const d=c[u],f=d.start,m=d.count;for(let v=f,_=f+m;v<_;v+=3)for(let y=0;y<3;y++){const x=l.getX(v+y),R=l.getX(v+(y+1)%3);n[0]=Math.min(x,R),n[1]=Math.max(x,R);const I=n[0]+","+n[1];s[I]===void 0&&(s[I]={index1:n[0],index2:n[1]})}}for(const u in s){const h=s[u];o.fromBufferAttribute(a,h.index1),t.push(o.x,o.y,o.z),o.fromBufferAttribute(a,h.index2),t.push(o.x,o.y,o.z)}}else{const a=e.attributes.position;for(let l=0,c=a.count/3;l<c;l++)for(let u=0;u<3;u++){const h=3*l+u;o.fromBufferAttribute(a,h),t.push(o.x,o.y,o.z);const d=3*l+(u+1)%3;o.fromBufferAttribute(a,d),t.push(o.x,o.y,o.z)}}}this.setAttribute("position",new ft(t,3))}}var Xn=Object.freeze({__proto__:null,BoxGeometry:Ul,BoxBufferGeometry:Bu,CircleGeometry:yw,CircleBufferGeometry:Cp,ConeGeometry:xw,ConeBufferGeometry:ww,CylinderGeometry:Ku,CylinderBufferGeometry:Ju,DodecahedronGeometry:bw,DodecahedronBufferGeometry:Dp,EdgesGeometry:Pp,ExtrudeGeometry:Op,ExtrudeBufferGeometry:rh,IcosahedronGeometry:Hw,IcosahedronBufferGeometry:kp,LatheGeometry:Vw,LatheBufferGeometry:zp,OctahedronGeometry:jw,OctahedronBufferGeometry:gd,ParametricGeometry:oh,ParametricBufferGeometry:Vc,PlaneGeometry:jc,PlaneBufferGeometry:Ll,PolyhedronGeometry:Ww,PolyhedronBufferGeometry:Gl,RingGeometry:$w,RingBufferGeometry:Up,ShapeGeometry:Hp,ShapeBufferGeometry:Gp,SphereGeometry:Li,SphereBufferGeometry:ah,TetrahedronGeometry:Yw,TetrahedronBufferGeometry:Vp,TextGeometry:Zw,TextBufferGeometry:jp,TorusGeometry:lh,TorusBufferGeometry:Wp,TorusKnotGeometry:Jw,TorusKnotBufferGeometry:$p,TubeGeometry:Kw,TubeBufferGeometry:qp,WireframeGeometry:vd});function Vl(i){Nt.call(this),this.type="ShadowMaterial",this.color=new Ee(0),this.transparent=!0,this.setValues(i)}Vl.prototype=Object.create(Nt.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isShadowMaterial=!0,Vl.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this};function Vs(i){In.call(this,i),this.type="RawShaderMaterial"}Vs.prototype=Object.create(In.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isRawShaderMaterial=!0;function rs(i){Nt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ee(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(i)}rs.prototype=Object.create(Nt.prototype),rs.prototype.constructor=rs,rs.prototype.isMeshStandardMaterial=!0,rs.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.vertexTangents=i.vertexTangents,this};function fo(i){rs.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Se(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=rt.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(i)}fo.prototype=Object.create(rs.prototype),fo.prototype.constructor=fo,fo.prototype.isMeshPhysicalMaterial=!0,fo.prototype.copy=function(i){return rs.prototype.copy.call(this,i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.reflectivity=i.reflectivity,i.sheen?this.sheen=(this.sheen||new Ee).copy(i.sheen):this.sheen=null,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this};function Lr(i){Nt.call(this),this.type="MeshPhongMaterial",this.color=new Ee(16777215),this.specular=new Ee(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}Lr.prototype=Object.create(Nt.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isMeshPhongMaterial=!0,Lr.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.specular.copy(i.specular),this.shininess=i.shininess,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function jl(i){Nt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ee(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}jl.prototype=Object.create(Nt.prototype),jl.prototype.constructor=jl,jl.prototype.isMeshToonMaterial=!0,jl.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.gradientMap=i.gradientMap,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function Ki(i){Nt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}Ki.prototype=Object.create(Nt.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isMeshNormalMaterial=!0,Ki.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function po(i){Nt.call(this),this.type="MeshLambertMaterial",this.color=new Ee(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}po.prototype=Object.create(Nt.prototype),po.prototype.constructor=po,po.prototype.isMeshLambertMaterial=!0,po.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function Wl(i){Nt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ee(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$e,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}Wl.prototype=Object.create(Nt.prototype),Wl.prototype.constructor=Wl,Wl.prototype.isMeshMatcapMaterial=!0,Wl.prototype.copy=function(i){return Nt.prototype.copy.call(this,i),this.defines={MATCAP:""},this.color.copy(i.color),this.matcap=i.matcap,this.map=i.map,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function $l(i){ri.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(i)}$l.prototype=Object.create(ri.prototype),$l.prototype.constructor=$l,$l.prototype.isLineDashedMaterial=!0,$l.prototype.copy=function(i){return ri.prototype.copy.call(this,i),this.scale=i.scale,this.dashSize=i.dashSize,this.gapSize=i.gapSize,this};var Qw=Object.freeze({__proto__:null,ShadowMaterial:Vl,SpriteMaterial:Jo,RawShaderMaterial:Vs,ShaderMaterial:In,PointsMaterial:ur,MeshPhysicalMaterial:fo,MeshStandardMaterial:rs,MeshPhongMaterial:Lr,MeshToonMaterial:jl,MeshNormalMaterial:Ki,MeshLambertMaterial:po,MeshDepthMaterial:Fa,MeshDistanceMaterial:Ba,MeshBasicMaterial:Ut,MeshMatcapMaterial:Wl,LineDashedMaterial:$l,LineBasicMaterial:ri,Material:Nt});const Oi={arraySlice:function(i,e,t){return Oi.isTypedArray(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)},convertArray:function(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(s,r){return i[s]-i[r]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n},sortedArray:function(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,o=0;o!==n;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=i[a+l]}return s},flattenJSON:function(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=i[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=i[s++];while(r!==void 0)},subclip:function(i,e,t,n,s=30){const r=i.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const m=c.times[f]*s;if(!(m<t||m>=n)){h.push(c.times[f]);for(let v=0;v<u;++v)d.push(c.values[f*u+v])}}h.length!==0&&(c.times=Oi.convertArray(h,c.times.constructor),c.values=Oi.convertArray(d,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(i,e=0,t=i,n=30){n<=0&&(n=30);const s=t.tracks.length,r=e/n;for(let o=0;o<s;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const m=a.times.length-1;let v;if(r<=a.times[0]){const y=u,x=h-u;v=Oi.arraySlice(a.values,y,x)}else if(r>=a.times[m]){const y=m*h+u,x=y+h-u;v=Oi.arraySlice(a.values,y,x)}else{const y=a.createInterpolant(),x=u,R=h-u;y.evaluate(r),v=Oi.arraySlice(y.resultBuffer,x,R)}l==="quaternion"&&new Ei().fromArray(v).normalize().conjugate().toArray(v);const _=c.times.length;for(let y=0;y<_;++y){const x=y*f+d;if(l==="quaternion")Ei.multiplyQuaternionsFlat(c.values,x,v,0,c.values,x);else{const R=f-d*2;for(let I=0;I<R;++I)c.values[x+I]-=v[I]}}}return i.blendMode=pl,i}};function os(i,e,t,n){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(t),this.sampleValues=e,this.valueSize=t}Object.assign(os.prototype,{evaluate:function(i){const e=this.parameterPositions;let t=this._cachedIndex,n=e[t],s=e[t-1];e:{t:{let r;i:{n:if(!(i<n)){for(let o=t+2;;){if(n===void 0){if(i<s)break n;return t=e.length,this._cachedIndex=t,this.afterEnd_(t-1,i,s)}if(t===o)break;if(s=n,n=e[++t],i<n)break t}r=e.length;break i}if(!(i>=s)){const o=e[1];i<o&&(t=2,s=o);for(let a=t-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,n);if(t===a)break;if(n=s,s=e[--t-1],i>=s)break t}r=t,t=0;break i}break e}for(;t<r;){const o=t+r>>>1;i<e[o]?r=o:t=o+1}if(n=e[t],s=e[t-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,n);if(n===void 0)return t=e.length,this._cachedIndex=t,this.afterEnd_(t-1,s,i)}this._cachedIndex=t,this.intervalChanged_(t,s,n)}return this.interpolate_(t,s,i,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){const e=this.resultBuffer,t=this.sampleValues,n=this.valueSize,s=i*n;for(let r=0;r!==n;++r)e[r]=t[s+r];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(os.prototype,{beforeStart_:os.prototype.copySampleValue_,afterEnd_:os.prototype.copySampleValue_});function yd(i,e,t,n){os.call(this,i,e,t,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}yd.prototype=Object.assign(Object.create(os.prototype),{constructor:yd,DefaultSettings_:{endingStart:or,endingEnd:or},intervalChanged_:function(i,e,t){const n=this.parameterPositions;let s=i-2,r=i+1,o=n[s],a=n[r];if(o===void 0)switch(this.getSettings_().endingStart){case Os:s=i,o=2*e-t;break;case no:s=n.length-2,o=e+n[s]-n[s+1];break;default:s=i,o=t}if(a===void 0)switch(this.getSettings_().endingEnd){case Os:r=i,a=2*t-e;break;case no:r=1,a=t+n[1]-n[0];break;default:r=i-1,a=e}const l=(t-e)*.5,c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-t),this._offsetPrev=s*c,this._offsetNext=r*c},interpolate_:function(i,e,t,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=i*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(t-e)/(n-e),m=f*f,v=m*f,_=-h*v+2*h*m-h*f,y=(1+h)*v+(-1.5-2*h)*m+(-.5+h)*f+1,x=(-1-d)*v+(1.5+d)*m+.5*f,R=d*v-d*m;for(let I=0;I!==o;++I)s[I]=_*r[c+I]+y*r[l+I]+x*r[a+I]+R*r[u+I];return s}});function ch(i,e,t,n){os.call(this,i,e,t,n)}ch.prototype=Object.assign(Object.create(os.prototype),{constructor:ch,interpolate_:function(i,e,t,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=i*o,l=a-o,c=(t-e)/(n-e),u=1-c;for(let h=0;h!==o;++h)s[h]=r[l+h]*u+r[a+h]*c;return s}});function xd(i,e,t,n){os.call(this,i,e,t,n)}xd.prototype=Object.assign(Object.create(os.prototype),{constructor:xd,interpolate_:function(i){return this.copySampleValue_(i-1)}});function Vn(i,e,t,n){if(i===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=Oi.convertArray(e,this.TimeBufferType),this.values=Oi.convertArray(t,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}Object.assign(Vn,{toJSON:function(i){const e=i.constructor;let t;if(e.toJSON!==void 0)t=e.toJSON(i);else{t={name:i.name,times:Oi.convertArray(i.times,Array),values:Oi.convertArray(i.values,Array)};const n=i.getInterpolation();n!==i.DefaultInterpolation&&(t.interpolation=n)}return t.type=i.ValueTypeName,t}}),Object.assign(Vn.prototype,{constructor:Vn,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Tr,InterpolantFactoryMethodDiscrete:function(i){return new xd(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodLinear:function(i){return new ch(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:function(i){return new yd(this.times,this.values,this.getValueSize(),i)},setInterpolation:function(i){let e;switch(i){case io:e=this.InterpolantFactoryMethodDiscrete;break;case Tr:e=this.InterpolantFactoryMethodLinear;break;case rr:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(i!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(t);return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return io;case this.InterpolantFactoryMethodLinear:return Tr;case this.InterpolantFactoryMethodSmooth:return rr}},getValueSize:function(){return this.values.length/this.times.length},shift:function(i){if(i!==0){const e=this.times;for(let t=0,n=e.length;t!==n;++t)e[t]+=i}return this},scale:function(i){if(i!==1){const e=this.times;for(let t=0,n=e.length;t!==n;++t)e[t]*=i}return this},trim:function(i,e){const t=this.times,n=t.length;let s=0,r=n-1;for(;s!==n&&t[s]<i;)++s;for(;r!==-1&&t[r]>e;)--r;if(++r,s!==0||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const o=this.getValueSize();this.times=Oi.arraySlice(t,s,r),this.values=Oi.arraySlice(this.values,s*o,r*o)}return this},validate:function(){let i=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);const t=this.times,n=this.values,s=t.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let r=null;for(let o=0;o!==s;o++){const a=t[o];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),i=!1;break}if(r!==null&&r>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,r),i=!1;break}r=a}if(n!==void 0&&Oi.isTypedArray(n))for(let o=0,a=n.length;o!==a;++o){const l=n[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),i=!1;break}}return i},optimize:function(){const i=Oi.arraySlice(this.times),e=Oi.arraySlice(this.values),t=this.getValueSize(),n=this.getInterpolation()===rr,s=i.length-1;let r=1;for(let o=1;o<s;++o){let a=!1;const l=i[o],c=i[o+1];if(l!==c&&(o!==1||l!==l[0]))if(n)a=!0;else{const u=o*t,h=u-t,d=u+t;for(let f=0;f!==t;++f){const m=e[u+f];if(m!==e[h+f]||m!==e[d+f]){a=!0;break}}}if(a){if(o!==r){i[r]=i[o];const u=o*t,h=r*t;for(let d=0;d!==t;++d)e[h+d]=e[u+d]}++r}}if(s>0){i[r]=i[s];for(let o=s*t,a=r*t,l=0;l!==t;++l)e[a+l]=e[o+l];++r}return r!==i.length?(this.times=Oi.arraySlice(i,0,r),this.values=Oi.arraySlice(e,0,r*t)):(this.times=i,this.values=e),this},clone:function(){const i=Oi.arraySlice(this.times,0),e=Oi.arraySlice(this.values,0),t=this.constructor,n=new t(this.name,i,e);return n.createInterpolant=this.createInterpolant,n}});function wd(i,e,t){Vn.call(this,i,e,t)}wd.prototype=Object.assign(Object.create(Vn.prototype),{constructor:wd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:io,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function bd(i,e,t,n){Vn.call(this,i,e,t,n)}bd.prototype=Object.assign(Object.create(Vn.prototype),{constructor:bd,ValueTypeName:"color"});function za(i,e,t,n){Vn.call(this,i,e,t,n)}za.prototype=Object.assign(Object.create(Vn.prototype),{constructor:za,ValueTypeName:"number"});function _d(i,e,t,n){os.call(this,i,e,t,n)}_d.prototype=Object.assign(Object.create(os.prototype),{constructor:_d,interpolate_:function(i,e,t,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(t-e)/(n-e);let l=i*o;for(let c=l+o;l!==c;l+=4)Ei.slerpFlat(s,0,r,l-o,r,l,a);return s}});function ql(i,e,t,n){Vn.call(this,i,e,t,n)}ql.prototype=Object.assign(Object.create(Vn.prototype),{constructor:ql,ValueTypeName:"quaternion",DefaultInterpolation:Tr,InterpolantFactoryMethodLinear:function(i){return new _d(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:void 0});function Md(i,e,t,n){Vn.call(this,i,e,t,n)}Md.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Md,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:io,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Ua(i,e,t,n){Vn.call(this,i,e,t,n)}Ua.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Ua,ValueTypeName:"vector"});function as(i,e=-1,t,n=Da){this.name=i,this.tracks=t,this.duration=e,this.blendMode=n,this.uuid=rt.generateUUID(),this.duration<0&&this.resetDuration()}function eb(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return za;case"vector":case"vector2":case"vector3":case"vector4":return Ua;case"color":return bd;case"quaternion":return ql;case"bool":case"boolean":return wd;case"string":return Md}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function tb(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=eb(i.type);if(i.times===void 0){const t=[],n=[];Oi.flattenJSON(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}Object.assign(as,{parse:function(i){const e=[],t=i.tracks,n=1/(i.fps||1);for(let r=0,o=t.length;r!==o;++r)e.push(tb(t[r]).scale(n));const s=new as(i.name,i.duration,e,i.blendMode);return s.uuid=i.uuid,s},toJSON:function(i){const e=[],t=i.tracks,n={name:i.name,duration:i.duration,tracks:e,uuid:i.uuid,blendMode:i.blendMode};for(let s=0,r=t.length;s!==r;++s)e.push(Vn.toJSON(t[s]));return n},CreateFromMorphTargetSequence:function(i,e,t,n){const s=e.length,r=[];for(let o=0;o<s;o++){let a=[],l=[];a.push((o+s-1)%s,o,(o+1)%s),l.push(0,1,0);const c=Oi.getKeyframeOrder(a);a=Oi.sortedArray(a,1,c),l=Oi.sortedArray(l,1,c),!n&&a[0]===0&&(a.push(s),l.push(l[0])),r.push(new za(".morphTargetInfluences["+e[o].name+"]",a,l).scale(1/t))}return new as(i,-1,r)},findByName:function(i,e){let t=i;if(!Array.isArray(i)){const n=i;t=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<t.length;n++)if(t[n].name===e)return t[n];return null},CreateClipsFromMorphTargetSequences:function(i,e,t){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,a=i.length;o<a;o++){const l=i[o],c=l.name.match(s);if(c&&c.length>1){const u=c[1];let h=n[u];h||(n[u]=h=[]),h.push(l)}}const r=[];for(const o in n)r.push(as.CreateFromMorphTargetSequence(o,n[o],e,t));return r},parseAnimation:function(i,e){if(!i)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const t=function(u,h,d,f,m){if(d.length!==0){const v=[],_=[];Oi.flattenJSON(d,v,_,f),v.length!==0&&m.push(new u(h,v,_))}},n=[],s=i.name||"default",r=i.fps||30,o=i.blendMode;let a=i.length||-1;const l=i.hierarchy||[];for(let u=0;u<l.length;u++){const h=l[u].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const d={};let f;for(f=0;f<h.length;f++)if(h[f].morphTargets)for(let m=0;m<h[f].morphTargets.length;m++)d[h[f].morphTargets[m]]=-1;for(const m in d){const v=[],_=[];for(let y=0;y!==h[f].morphTargets.length;++y){const x=h[f];v.push(x.time),_.push(x.morphTarget===m?1:0)}n.push(new za(".morphTargetInfluence["+m+"]",v,_))}a=d.length*(r||1)}else{const d=".bones["+e[u].name+"]";t(Ua,d+".position",h,"pos",n),t(ql,d+".quaternion",h,"rot",n),t(Ua,d+".scale",h,"scl",n)}}return n.length===0?null:new as(s,a,n,o)}}),Object.assign(as.prototype,{resetDuration:function(){const i=this.tracks;let e=0;for(let t=0,n=i.length;t!==n;++t){const s=this.tracks[t];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this},trim:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){let i=!0;for(let e=0;e<this.tracks.length;e++)i=i&&this.tracks[e].validate();return i},optimize:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){const i=[];for(let e=0;e<this.tracks.length;e++)i.push(this.tracks[e].clone());return new as(this.name,this.duration,i,this.blendMode)},toJSON:function(){return as.toJSON(this)}});const Xl={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function Xp(i,e,t){const n=this;let s=!1,r=0,o=0,a;const l=[];this.onStart=void 0,this.onLoad=i,this.onProgress=e,this.onError=t,this.itemStart=function(c){o++,s===!1&&n.onStart!==void 0&&n.onStart(c,r,o),s=!0},this.itemEnd=function(c){r++,n.onProgress!==void 0&&n.onProgress(c,r,o),r===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(c){n.onError!==void 0&&n.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){const u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){const d=l[u],f=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return f}return null}}const ib=new Xp;function gi(i){this.manager=i!==void 0?i:ib,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(gi.prototype,{load:function(){},loadAsync:function(i,e){const t=this;return new Promise(function(n,s){t.load(i,n,e,s)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});const hr={};function ls(i){gi.call(this,i)}ls.prototype=Object.assign(Object.create(gi.prototype),{constructor:ls,load:function(i,e,t,n){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const s=this,r=Xl.get(i);if(r!==void 0)return s.manager.itemStart(i),setTimeout(function(){e&&e(r),s.manager.itemEnd(i)},0),r;if(hr[i]!==void 0){hr[i].push({onLoad:e,onProgress:t,onError:n});return}const o=/^data:(.*?)(;base64)?,(.*)$/,a=i.match(o);let l;if(a){const c=a[1],u=!!a[2];let h=a[3];h=decodeURIComponent(h),u&&(h=atob(h));try{let d;const f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":const m=new Uint8Array(h.length);for(let _=0;_<h.length;_++)m[_]=h.charCodeAt(_);f==="blob"?d=new Blob([m.buffer],{type:c}):d=m.buffer;break;case"document":d=new DOMParser().parseFromString(h,c);break;case"json":d=JSON.parse(h);break;default:d=h;break}setTimeout(function(){e&&e(d),s.manager.itemEnd(i)},0)}catch(d){setTimeout(function(){n&&n(d),s.manager.itemError(i),s.manager.itemEnd(i)},0)}}else{hr[i]=[],hr[i].push({onLoad:e,onProgress:t,onError:n}),l=new XMLHttpRequest,l.open("GET",i,!0),l.addEventListener("load",function(c){const u=this.response,h=hr[i];if(delete hr[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Xl.add(i,u);for(let d=0,f=h.length;d<f;d++){const m=h[d];m.onLoad&&m.onLoad(u)}s.manager.itemEnd(i)}else{for(let d=0,f=h.length;d<f;d++){const m=h[d];m.onError&&m.onError(c)}s.manager.itemError(i),s.manager.itemEnd(i)}},!1),l.addEventListener("progress",function(c){const u=hr[i];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onProgress&&f.onProgress(c)}},!1),l.addEventListener("error",function(c){const u=hr[i];delete hr[i];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}s.manager.itemError(i),s.manager.itemEnd(i)},!1),l.addEventListener("abort",function(c){const u=hr[i];delete hr[i];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}s.manager.itemError(i),s.manager.itemEnd(i)},!1),this.responseType!==void 0&&(l.responseType=this.responseType),this.withCredentials!==void 0&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const c in this.requestHeader)l.setRequestHeader(c,this.requestHeader[c]);l.send(null)}return s.manager.itemStart(i),l},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});function Yp(i){gi.call(this,i)}Yp.prototype=Object.assign(Object.create(gi.prototype),{constructor:Yp,load:function(i,e,t,n){const s=this,r=new ls(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(i,function(o){try{e(s.parse(JSON.parse(o)))}catch(a){n?n(a):console.error(a),s.manager.itemError(i)}},t,n)},parse:function(i){const e=[];for(let t=0;t<i.length;t++){const n=as.parse(i[t]);e.push(n)}return e}});function Zp(i){gi.call(this,i)}Zp.prototype=Object.assign(Object.create(gi.prototype),{constructor:Zp,load:function(i,e,t,n){const s=this,r=[],o=new zc,a=new ls(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let l=0;function c(u){a.load(i[u],function(h){const d=s.parse(h,!0);r[u]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},l+=1,l===6&&(d.mipmapCount===1&&(o.minFilter=et),o.image=r,o.format=d.format,o.needsUpdate=!0,e&&e(o))},t,n)}if(Array.isArray(i))for(let u=0,h=i.length;u<h;++u)c(u);else a.load(i,function(u){const h=s.parse(u,!0);if(h.isCubemap){const d=h.mipmaps.length/h.mipmapCount;for(let f=0;f<d;f++){r[f]={mipmaps:[]};for(let m=0;m<h.mipmapCount;m++)r[f].mipmaps.push(h.mipmaps[f*h.mipmapCount+m]),r[f].format=h.format,r[f].width=h.width,r[f].height=h.height}o.image=r}else o.image.width=h.width,o.image.height=h.height,o.mipmaps=h.mipmaps;h.mipmapCount===1&&(o.minFilter=et),o.format=h.format,o.needsUpdate=!0,e&&e(o)},t,n);return o}});function Wc(i){gi.call(this,i)}Wc.prototype=Object.assign(Object.create(gi.prototype),{constructor:Wc,load:function(i,e,t,n){this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const s=this,r=Xl.get(i);if(r!==void 0)return s.manager.itemStart(i),setTimeout(function(){e&&e(r),s.manager.itemEnd(i)},0),r;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Xl.add(i,this),e&&e(this),s.manager.itemEnd(i)}function l(c){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),n&&n(c),s.manager.itemError(i),s.manager.itemEnd(i)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),i.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(i),o.src=i,o}});function Ed(i){gi.call(this,i)}Ed.prototype=Object.assign(Object.create(gi.prototype),{constructor:Ed,load:function(i,e,t,n){const s=new uo,r=new Wc(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let o=0;function a(l){r.load(i[l],function(c){s.images[l]=c,o++,o===6&&(s.needsUpdate=!0,e&&e(s))},void 0,n)}for(let l=0;l<i.length;++l)a(l);return s}});function Sd(i){gi.call(this,i)}Sd.prototype=Object.assign(Object.create(gi.prototype),{constructor:Sd,load:function(i,e,t,n){const s=this,r=new Gs,o=new ls(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(i,function(a){const l=s.parse(a);l&&(l.image!==void 0?r.image=l.image:l.data!==void 0&&(r.image.width=l.width,r.image.height=l.height,r.image.data=l.data),r.wrapS=l.wrapS!==void 0?l.wrapS:li,r.wrapT=l.wrapT!==void 0?l.wrapT:li,r.magFilter=l.magFilter!==void 0?l.magFilter:et,r.minFilter=l.minFilter!==void 0?l.minFilter:et,r.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.format!==void 0&&(r.format=l.format),l.type!==void 0&&(r.type=l.type),l.mipmaps!==void 0&&(r.mipmaps=l.mipmaps,r.minFilter=Rs),l.mipmapCount===1&&(r.minFilter=et),r.needsUpdate=!0,e&&e(r,l))},t,n),r}});function jn(i){gi.call(this,i)}jn.prototype=Object.assign(Object.create(gi.prototype),{constructor:jn,load:function(i,e,t,n){const s=new oi,r=new Wc(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(i,function(o){s.image=o;const a=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;s.format=a?Yi:jt,s.needsUpdate=!0,e!==void 0&&e(s)},t,n),s}});function Dt(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Dt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,e){const t=this.getUtoTmapping(i);return this.getPoint(t,e)},getPoints:function(i=5){const e=[];for(let t=0;t<=i;t++)e.push(this.getPoint(t/i));return e},getSpacedPoints:function(i=5){const e=[];for(let t=0;t<=i;t++)e.push(this.getPointAt(t/i));return e},getLength:function(){const i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let t,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=i;r++)t=this.getPoint(r/i),s+=t.distanceTo(n),e.push(s),n=t;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,e){const t=this.getLengths();let n=0;const s=t.length;let r;e?r=e:r=i*t[s-1];let o=0,a=s-1,l;for(;o<=a;)if(n=Math.floor(o+(a-o)/2),l=t[n]-r,l<0)o=n+1;else if(l>0)a=n-1;else{a=n;break}if(n=a,t[n]===r)return n/(s-1);const c=t[n],h=t[n+1]-c,d=(r-c)/h;return(n+d)/(s-1)},getTangent:function(i,e){let n=i-1e-4,s=i+1e-4;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=e||(r.isVector2?new Se:new S);return a.copy(o).sub(r).normalize(),a},getTangentAt:function(i,e){const t=this.getUtoTmapping(i);return this.getTangent(t,e)},computeFrenetFrames:function(i,e){const t=new S,n=[],s=[],r=[],o=new S,a=new xe;for(let d=0;d<=i;d++){const f=d/i;n[d]=this.getTangentAt(f,new S),n[d].normalize()}s[0]=new S,r[0]=new S;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),u=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,t.set(1,0,0)),u<=l&&(l=u,t.set(0,1,0)),h<=l&&t.set(0,0,1),o.crossVectors(n[0],t).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let d=1;d<=i;d++){if(s[d]=s[d-1].clone(),r[d]=r[d-1].clone(),o.crossVectors(n[d-1],n[d]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(rt.clamp(n[d-1].dot(n[d]),-1,1));s[d].applyMatrix4(a.makeRotationAxis(o,f))}r[d].crossVectors(n[d],s[d])}if(e===!0){let d=Math.acos(rt.clamp(s[0].dot(s[i]),-1,1));d/=i,n[0].dot(o.crossVectors(s[0],s[i]))>0&&(d=-d);for(let f=1;f<=i;f++)s[f].applyMatrix4(a.makeRotationAxis(n[f],d*f)),r[f].crossVectors(n[f],s[f])}return{tangents:n,normals:s,binormals:r}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});function js(i,e,t,n,s,r,o,a){Dt.call(this),this.type="EllipseCurve",this.aX=i||0,this.aY=e||0,this.xRadius=t||1,this.yRadius=n||1,this.aStartAngle=s||0,this.aEndAngle=r||2*Math.PI,this.aClockwise=o||!1,this.aRotation=a||0}js.prototype=Object.create(Dt.prototype),js.prototype.constructor=js,js.prototype.isEllipseCurve=!0,js.prototype.getPoint=function(i,e){const t=e||new Se,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(r?s=0:s=n),this.aClockwise===!0&&!r&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+i*s;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return t.set(a,l)},js.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this},js.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.aX=this.aX,i.aY=this.aY,i.xRadius=this.xRadius,i.yRadius=this.yRadius,i.aStartAngle=this.aStartAngle,i.aEndAngle=this.aEndAngle,i.aClockwise=this.aClockwise,i.aRotation=this.aRotation,i},js.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this};function $c(i,e,t,n,s,r){js.call(this,i,e,t,t,n,s,r),this.type="ArcCurve"}$c.prototype=Object.create(js.prototype),$c.prototype.constructor=$c,$c.prototype.isArcCurve=!0;function Td(){let i=0,e=0,t=0,n=0;function s(r,o,a,l){i=r,e=a,t=-3*r+3*o-2*a-l,n=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){s(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,u,h){let d=(o-r)/c-(a-r)/(c+u)+(a-o)/u,f=(a-o)/u-(l-o)/(u+h)+(l-a)/h;d*=u,f*=u,s(o,a,d,f)},calc:function(r){const o=r*r,a=o*r;return i+e*r+t*o+n*a}}}const uh=new S,Ad=new Td,Cd=new Td,Dd=new Td;function bn(i=[],e=!1,t="centripetal",n=.5){Dt.call(this),this.type="CatmullRomCurve3",this.points=i,this.closed=e,this.curveType=t,this.tension=n}bn.prototype=Object.create(Dt.prototype),bn.prototype.constructor=bn,bn.prototype.isCatmullRomCurve3=!0,bn.prototype.getPoint=function(i,e=new S){const t=e,n=this.points,s=n.length,r=(s-(this.closed?0:1))*i;let o=Math.floor(r),a=r-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:a===0&&o===s-1&&(o=s-2,a=1);let l,c;this.closed||o>0?l=n[(o-1)%s]:(uh.subVectors(n[0],n[1]).add(n[0]),l=uh);const u=n[o%s],h=n[(o+1)%s];if(this.closed||o+2<s?c=n[(o+2)%s]:(uh.subVectors(n[s-1],n[s-2]).add(n[s-1]),c=uh),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let f=Math.pow(l.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(c),d);m<1e-4&&(m=1),f<1e-4&&(f=m),v<1e-4&&(v=m),Ad.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,f,m,v),Cd.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,f,m,v),Dd.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,f,m,v)}else this.curveType==="catmullrom"&&(Ad.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),Cd.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),Dd.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return t.set(Ad.calc(a),Cd.calc(a),Dd.calc(a)),t},bn.prototype.copy=function(i){Dt.prototype.copy.call(this,i),this.points=[];for(let e=0,t=i.points.length;e<t;e++){const n=i.points[e];this.points.push(n.clone())}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this},bn.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);i.points=[];for(let e=0,t=this.points.length;e<t;e++){const n=this.points[e];i.points.push(n.toArray())}return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i},bn.prototype.fromJSON=function(i){Dt.prototype.fromJSON.call(this,i),this.points=[];for(let e=0,t=i.points.length;e<t;e++){const n=i.points[e];this.points.push(new S().fromArray(n))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this};function Jp(i,e,t,n,s){const r=(n-e)*.5,o=(s-t)*.5,a=i*i,l=i*a;return(2*t-2*n+r+o)*l+(-3*t+3*n-2*r-o)*a+r*i+t}function nb(i,e){const t=1-i;return t*t*e}function sb(i,e){return 2*(1-i)*i*e}function rb(i,e){return i*i*e}function qc(i,e,t,n){return nb(i,e)+sb(i,t)+rb(i,n)}function ob(i,e){const t=1-i;return t*t*t*e}function ab(i,e){const t=1-i;return 3*t*t*i*e}function lb(i,e){return 3*(1-i)*i*i*e}function cb(i,e){return i*i*i*e}function Xc(i,e,t,n,s){return ob(i,e)+ab(i,t)+lb(i,n)+cb(i,s)}function Rr(i=new Se,e=new Se,t=new Se,n=new Se){Dt.call(this),this.type="CubicBezierCurve",this.v0=i,this.v1=e,this.v2=t,this.v3=n}Rr.prototype=Object.create(Dt.prototype),Rr.prototype.constructor=Rr,Rr.prototype.isCubicBezierCurve=!0,Rr.prototype.getPoint=function(i,e=new Se){const t=e,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return t.set(Xc(i,n.x,s.x,r.x,o.x),Xc(i,n.y,s.y,r.y,o.y)),t},Rr.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},Rr.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},Rr.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this};function mo(i=new S,e=new S,t=new S,n=new S){Dt.call(this),this.type="CubicBezierCurve3",this.v0=i,this.v1=e,this.v2=t,this.v3=n}mo.prototype=Object.create(Dt.prototype),mo.prototype.constructor=mo,mo.prototype.isCubicBezierCurve3=!0,mo.prototype.getPoint=function(i,e=new S){const t=e,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return t.set(Xc(i,n.x,s.x,r.x,o.x),Xc(i,n.y,s.y,r.y,o.y),Xc(i,n.z,s.z,r.z,o.z)),t},mo.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},mo.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},mo.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this};function Es(i=new Se,e=new Se){Dt.call(this),this.type="LineCurve",this.v1=i,this.v2=e}Es.prototype=Object.create(Dt.prototype),Es.prototype.constructor=Es,Es.prototype.isLineCurve=!0,Es.prototype.getPoint=function(i,e=new Se){const t=e;return i===1?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(i).add(this.v1)),t},Es.prototype.getPointAt=function(i,e){return this.getPoint(i,e)},Es.prototype.getTangent=function(i,e){const t=e||new Se;return t.copy(this.v2).sub(this.v1).normalize(),t},Es.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Es.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Es.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Ir(i=new S,e=new S){Dt.call(this),this.type="LineCurve3",this.v1=i,this.v2=e}Ir.prototype=Object.create(Dt.prototype),Ir.prototype.constructor=Ir,Ir.prototype.isLineCurve3=!0,Ir.prototype.getPoint=function(i,e=new S){const t=e;return i===1?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(i).add(this.v1)),t},Ir.prototype.getPointAt=function(i,e){return this.getPoint(i,e)},Ir.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Ir.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Ir.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Fr(i=new Se,e=new Se,t=new Se){Dt.call(this),this.type="QuadraticBezierCurve",this.v0=i,this.v1=e,this.v2=t}Fr.prototype=Object.create(Dt.prototype),Fr.prototype.constructor=Fr,Fr.prototype.isQuadraticBezierCurve=!0,Fr.prototype.getPoint=function(i,e=new Se){const t=e,n=this.v0,s=this.v1,r=this.v2;return t.set(qc(i,n.x,s.x,r.x),qc(i,n.y,s.y,r.y)),t},Fr.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Fr.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Fr.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function go(i=new S,e=new S,t=new S){Dt.call(this),this.type="QuadraticBezierCurve3",this.v0=i,this.v1=e,this.v2=t}go.prototype=Object.create(Dt.prototype),go.prototype.constructor=go,go.prototype.isQuadraticBezierCurve3=!0,go.prototype.getPoint=function(i,e=new S){const t=e,n=this.v0,s=this.v1,r=this.v2;return t.set(qc(i,n.x,s.x,r.x),qc(i,n.y,s.y,r.y),qc(i,n.z,s.z,r.z)),t},go.prototype.copy=function(i){return Dt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},go.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},go.prototype.fromJSON=function(i){return Dt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Br(i=[]){Dt.call(this),this.type="SplineCurve",this.points=i}Br.prototype=Object.create(Dt.prototype),Br.prototype.constructor=Br,Br.prototype.isSplineCurve=!0,Br.prototype.getPoint=function(i,e=new Se){const t=e,n=this.points,s=(n.length-1)*i,r=Math.floor(s),o=s-r,a=n[r===0?r:r-1],l=n[r],c=n[r>n.length-2?n.length-1:r+1],u=n[r>n.length-3?n.length-1:r+2];return t.set(Jp(o,a.x,l.x,c.x,u.x),Jp(o,a.y,l.y,c.y,u.y)),t},Br.prototype.copy=function(i){Dt.prototype.copy.call(this,i),this.points=[];for(let e=0,t=i.points.length;e<t;e++){const n=i.points[e];this.points.push(n.clone())}return this},Br.prototype.toJSON=function(){const i=Dt.prototype.toJSON.call(this);i.points=[];for(let e=0,t=this.points.length;e<t;e++){const n=this.points[e];i.points.push(n.toArray())}return i},Br.prototype.fromJSON=function(i){Dt.prototype.fromJSON.call(this,i),this.points=[];for(let e=0,t=i.points.length;e<t;e++){const n=i.points[e];this.points.push(new Se().fromArray(n))}return this};var Pd=Object.freeze({__proto__:null,ArcCurve:$c,CatmullRomCurve3:bn,CubicBezierCurve:Rr,CubicBezierCurve3:mo,EllipseCurve:js,LineCurve:Es,LineCurve3:Ir,QuadraticBezierCurve:Fr,QuadraticBezierCurve3:go,SplineCurve:Br});function ta(){Dt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}ta.prototype=Object.assign(Object.create(Dt.prototype),{constructor:ta,add:function(i){this.curves.push(i)},closePath:function(){const i=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);i.equals(e)||this.curves.push(new Es(e,i))},getPoint:function(i){const e=i*this.getLength(),t=this.getCurveLengths();let n=0;for(;n<t.length;){if(t[n]>=e){const s=t[n]-e,r=this.curves[n],o=r.getLength(),a=o===0?0:1-s/o;return r.getPointAt(a)}n++}return null},getLength:function(){const i=this.getCurveLengths();return i[i.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let e=0;for(let t=0,n=this.curves.length;t<n;t++)e+=this.curves[t].getLength(),i.push(e);return this.cacheLengths=i,i},getSpacedPoints:function(i=40){const e=[];for(let t=0;t<=i;t++)e.push(this.getPoint(t/i));return this.autoClose&&e.push(e[0]),e},getPoints:function(i=12){const e=[];let t;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],o=r&&r.isEllipseCurve?i*2:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?i*r.points.length:i,a=r.getPoints(o);for(let l=0;l<a.length;l++){const c=a[l];t&&t.equals(c)||(e.push(c),t=c)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(i){Dt.prototype.copy.call(this,i),this.curves=[];for(let e=0,t=i.curves.length;e<t;e++){const n=i.curves[e];this.curves.push(n.clone())}return this.autoClose=i.autoClose,this},toJSON:function(){const i=Dt.prototype.toJSON.call(this);i.autoClose=this.autoClose,i.curves=[];for(let e=0,t=this.curves.length;e<t;e++){const n=this.curves[e];i.curves.push(n.toJSON())}return i},fromJSON:function(i){Dt.prototype.fromJSON.call(this,i),this.autoClose=i.autoClose,this.curves=[];for(let e=0,t=i.curves.length;e<t;e++){const n=i.curves[e];this.curves.push(new Pd[n.type]().fromJSON(n))}return this}});function Nr(i){ta.call(this),this.type="Path",this.currentPoint=new Se,i&&this.setFromPoints(i)}Nr.prototype=Object.assign(Object.create(ta.prototype),{constructor:Nr,setFromPoints:function(i){this.moveTo(i[0].x,i[0].y);for(let e=1,t=i.length;e<t;e++)this.lineTo(i[e].x,i[e].y);return this},moveTo:function(i,e){return this.currentPoint.set(i,e),this},lineTo:function(i,e){const t=new Es(this.currentPoint.clone(),new Se(i,e));return this.curves.push(t),this.currentPoint.set(i,e),this},quadraticCurveTo:function(i,e,t,n){const s=new Fr(this.currentPoint.clone(),new Se(i,e),new Se(t,n));return this.curves.push(s),this.currentPoint.set(t,n),this},bezierCurveTo:function(i,e,t,n,s,r){const o=new Rr(this.currentPoint.clone(),new Se(i,e),new Se(t,n),new Se(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this},splineThru:function(i){const e=[this.currentPoint.clone()].concat(i),t=new Br(e);return this.curves.push(t),this.currentPoint.copy(i[i.length-1]),this},arc:function(i,e,t,n,s,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(i+o,e+a,t,n,s,r),this},absarc:function(i,e,t,n,s,r){return this.absellipse(i,e,t,t,n,s,r),this},ellipse:function(i,e,t,n,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(i+l,e+c,t,n,s,r,o,a),this},absellipse:function(i,e,t,n,s,r,o,a){const l=new js(i,e,t,n,s,r,o,a);if(this.curves.length>0){const u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(i){return ta.prototype.copy.call(this,i),this.currentPoint.copy(i.currentPoint),this},toJSON:function(){const i=ta.prototype.toJSON.call(this);return i.currentPoint=this.currentPoint.toArray(),i},fromJSON:function(i){return ta.prototype.fromJSON.call(this,i),this.currentPoint.fromArray(i.currentPoint),this}});function Ga(i){Nr.call(this,i),this.uuid=rt.generateUUID(),this.type="Shape",this.holes=[]}Ga.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ga,getPointsHoles:function(i){const e=[];for(let t=0,n=this.holes.length;t<n;t++)e[t]=this.holes[t].getPoints(i);return e},extractPoints:function(i){return{shape:this.getPoints(i),holes:this.getPointsHoles(i)}},copy:function(i){Nr.prototype.copy.call(this,i),this.holes=[];for(let e=0,t=i.holes.length;e<t;e++){const n=i.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){const i=Nr.prototype.toJSON.call(this);i.uuid=this.uuid,i.holes=[];for(let e=0,t=this.holes.length;e<t;e++){const n=this.holes[e];i.holes.push(n.toJSON())}return i},fromJSON:function(i){Nr.prototype.fromJSON.call(this,i),this.uuid=i.uuid,this.holes=[];for(let e=0,t=i.holes.length;e<t;e++){const n=i.holes[e];this.holes.push(new Nr().fromJSON(n))}return this}});function Ri(i,e=1){qe.call(this),this.type="Light",this.color=new Ee(i),this.intensity=e}Ri.prototype=Object.assign(Object.create(qe.prototype),{constructor:Ri,isLight:!0,copy:function(i){return qe.prototype.copy.call(this,i),this.color.copy(i.color),this.intensity=i.intensity,this},toJSON:function(i){const e=qe.prototype.toJSON.call(this,i);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}});function hh(i,e,t){Ri.call(this,i,t),this.type="HemisphereLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.groundColor=new Ee(e)}hh.prototype=Object.assign(Object.create(Ri.prototype),{constructor:hh,isHemisphereLight:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.groundColor.copy(i.groundColor),this}});function vo(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Se(512,512),this.map=null,this.mapPass=null,this.matrix=new xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Pl,this._frameExtents=new Se(1,1),this._viewportCount=1,this._viewports=[new _t(0,0,1,1)]}Object.assign(vo.prototype,{_projScreenMatrix:new xe,_lightPositionWorld:new S,_lookTarget:new S,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(i){const e=this.camera,t=this.matrix,n=this._projScreenMatrix,s=this._lookTarget,r=this._lightPositionWorld;r.setFromMatrixPosition(i.matrixWorld),e.position.copy(r),s.setFromMatrixPosition(i.target.matrixWorld),e.lookAt(s),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.matrixWorldInverse)},getViewport:function(i){return this._viewports[i]},getFrameExtents:function(){return this._frameExtents},copy:function(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i={};return this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}});function Ld(){vo.call(this,new mi(50,1,.5,500)),this.focus=1}Ld.prototype=Object.assign(Object.create(vo.prototype),{constructor:Ld,isSpotLightShadow:!0,updateMatrices:function(i){const e=this.camera,t=rt.RAD2DEG*2*i.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=i.distance||e.far;(t!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=t,e.aspect=n,e.far=s,e.updateProjectionMatrix()),vo.prototype.updateMatrices.call(this,i)}});function Yc(i,e,t,n,s,r){Ri.call(this,i,e),this.type="SpotLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.target=new qe,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(o){this.intensity=o/Math.PI}}),this.distance=t!==void 0?t:0,this.angle=n!==void 0?n:Math.PI/3,this.penumbra=s!==void 0?s:0,this.decay=r!==void 0?r:1,this.shadow=new Ld}Yc.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Yc,isSpotLight:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}});function Rd(){vo.call(this,new mi(90,1,.5,500)),this._frameExtents=new Se(4,2),this._viewportCount=6,this._viewports=[new _t(2,1,1,1),new _t(0,1,1,1),new _t(3,1,1,1),new _t(1,1,1,1),new _t(3,0,1,1),new _t(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}Rd.prototype=Object.assign(Object.create(vo.prototype),{constructor:Rd,isPointLightShadow:!0,updateMatrices:function(i,e=0){const t=this.camera,n=this.matrix,s=this._lightPositionWorld,r=this._lookTarget,o=this._projScreenMatrix;s.setFromMatrixPosition(i.matrixWorld),t.position.copy(s),r.copy(t.position),r.add(this._cubeDirections[e]),t.up.copy(this._cubeUps[e]),t.lookAt(r),t.updateMatrixWorld(),n.makeTranslation(-s.x,-s.y,-s.z),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}});function yo(i,e,t,n){Ri.call(this,i,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(s){this.intensity=s/(4*Math.PI)}}),this.distance=t!==void 0?t:0,this.decay=n!==void 0?n:1,this.shadow=new Rd}yo.prototype=Object.assign(Object.create(Ri.prototype),{constructor:yo,isPointLight:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}});function Fn(i=-1,e=1,t=1,n=-1,s=.1,r=2e3){bs.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=e,this.top=t,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}Fn.prototype=Object.assign(Object.create(bs.prototype),{constructor:Fn,isOrthographicCamera:!0,copy:function(i,e){return bs.prototype.copy.call(this,i,e),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:Object.assign({},i.view),this},setViewOffset:function(i,e,t,n,s,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=e,this.view.offsetX=t,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),t=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=t-i,r=t+i,o=n+e,a=n-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,r=s+l*this.view.width,o-=c*this.view.offsetY,a=o-c*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const e=qe.prototype.toJSON.call(this,i);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}});function Id(){vo.call(this,new Fn(-5,5,5,-5,.5,500))}Id.prototype=Object.assign(Object.create(vo.prototype),{constructor:Id,isDirectionalLightShadow:!0,updateMatrices:function(i){vo.prototype.updateMatrices.call(this,i)}});function xo(i,e){Ri.call(this,i,e),this.type="DirectionalLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.target=new qe,this.shadow=new Id}xo.prototype=Object.assign(Object.create(Ri.prototype),{constructor:xo,isDirectionalLight:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}});function Zc(i,e){Ri.call(this,i,e),this.type="AmbientLight"}Zc.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Zc,isAmbientLight:!0});function Fd(i,e,t,n){Ri.call(this,i,e),this.type="RectAreaLight",this.width=t!==void 0?t:10,this.height=n!==void 0?n:10}Fd.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Fd,isRectAreaLight:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.width=i.width,this.height=i.height,this},toJSON:function(i){const e=Ri.prototype.toJSON.call(this,i);return e.object.width=this.width,e.object.height=this.height,e}});class ub{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new S)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const n=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-s*s)}}function dr(i,e){Ri.call(this,void 0,e),this.type="LightProbe",this.sh=i!==void 0?i:new ub}dr.prototype=Object.assign(Object.create(Ri.prototype),{constructor:dr,isLightProbe:!0,copy:function(i){return Ri.prototype.copy.call(this,i),this.sh.copy(i.sh),this},fromJSON:function(i){return this.intensity=i.intensity,this.sh.fromArray(i.sh),this},toJSON:function(i){const e=Ri.prototype.toJSON.call(this,i);return e.object.sh=this.sh.toArray(),e}});function Bd(i){gi.call(this,i),this.textures={}}Bd.prototype=Object.assign(Object.create(gi.prototype),{constructor:Bd,load:function(i,e,t,n){const s=this,r=new ls(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(i,function(o){try{e(s.parse(JSON.parse(o)))}catch(a){n?n(a):console.error(a),s.manager.itemError(i)}},t,n)},parse:function(i){const e=this.textures;function t(s){return e[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),e[s]}const n=new Qw[i.type];if(i.uuid!==void 0&&(n.uuid=i.uuid),i.name!==void 0&&(n.name=i.name),i.color!==void 0&&n.color!==void 0&&n.color.setHex(i.color),i.roughness!==void 0&&(n.roughness=i.roughness),i.metalness!==void 0&&(n.metalness=i.metalness),i.sheen!==void 0&&(n.sheen=new Ee().setHex(i.sheen)),i.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(i.emissive),i.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(i.specular),i.shininess!==void 0&&(n.shininess=i.shininess),i.clearcoat!==void 0&&(n.clearcoat=i.clearcoat),i.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=i.clearcoatRoughness),i.fog!==void 0&&(n.fog=i.fog),i.flatShading!==void 0&&(n.flatShading=i.flatShading),i.blending!==void 0&&(n.blending=i.blending),i.combine!==void 0&&(n.combine=i.combine),i.side!==void 0&&(n.side=i.side),i.opacity!==void 0&&(n.opacity=i.opacity),i.transparent!==void 0&&(n.transparent=i.transparent),i.alphaTest!==void 0&&(n.alphaTest=i.alphaTest),i.depthTest!==void 0&&(n.depthTest=i.depthTest),i.depthWrite!==void 0&&(n.depthWrite=i.depthWrite),i.colorWrite!==void 0&&(n.colorWrite=i.colorWrite),i.stencilWrite!==void 0&&(n.stencilWrite=i.stencilWrite),i.stencilWriteMask!==void 0&&(n.stencilWriteMask=i.stencilWriteMask),i.stencilFunc!==void 0&&(n.stencilFunc=i.stencilFunc),i.stencilRef!==void 0&&(n.stencilRef=i.stencilRef),i.stencilFuncMask!==void 0&&(n.stencilFuncMask=i.stencilFuncMask),i.stencilFail!==void 0&&(n.stencilFail=i.stencilFail),i.stencilZFail!==void 0&&(n.stencilZFail=i.stencilZFail),i.stencilZPass!==void 0&&(n.stencilZPass=i.stencilZPass),i.wireframe!==void 0&&(n.wireframe=i.wireframe),i.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=i.wireframeLinewidth),i.wireframeLinecap!==void 0&&(n.wireframeLinecap=i.wireframeLinecap),i.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=i.wireframeLinejoin),i.rotation!==void 0&&(n.rotation=i.rotation),i.linewidth!==1&&(n.linewidth=i.linewidth),i.dashSize!==void 0&&(n.dashSize=i.dashSize),i.gapSize!==void 0&&(n.gapSize=i.gapSize),i.scale!==void 0&&(n.scale=i.scale),i.polygonOffset!==void 0&&(n.polygonOffset=i.polygonOffset),i.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=i.polygonOffsetFactor),i.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=i.polygonOffsetUnits),i.skinning!==void 0&&(n.skinning=i.skinning),i.morphTargets!==void 0&&(n.morphTargets=i.morphTargets),i.morphNormals!==void 0&&(n.morphNormals=i.morphNormals),i.dithering!==void 0&&(n.dithering=i.dithering),i.vertexTangents!==void 0&&(n.vertexTangents=i.vertexTangents),i.visible!==void 0&&(n.visible=i.visible),i.toneMapped!==void 0&&(n.toneMapped=i.toneMapped),i.userData!==void 0&&(n.userData=i.userData),i.vertexColors!==void 0&&(typeof i.vertexColors=="number"?n.vertexColors=i.vertexColors>0:n.vertexColors=i.vertexColors),i.uniforms!==void 0)for(const s in i.uniforms){const r=i.uniforms[s];switch(n.uniforms[s]={},r.type){case"t":n.uniforms[s].value=t(r.value);break;case"c":n.uniforms[s].value=new Ee().setHex(r.value);break;case"v2":n.uniforms[s].value=new Se().fromArray(r.value);break;case"v3":n.uniforms[s].value=new S().fromArray(r.value);break;case"v4":n.uniforms[s].value=new _t().fromArray(r.value);break;case"m3":n.uniforms[s].value=new rn().fromArray(r.value);break;case"m4":n.uniforms[s].value=new xe().fromArray(r.value);break;default:n.uniforms[s].value=r.value}}if(i.defines!==void 0&&(n.defines=i.defines),i.vertexShader!==void 0&&(n.vertexShader=i.vertexShader),i.fragmentShader!==void 0&&(n.fragmentShader=i.fragmentShader),i.extensions!==void 0)for(const s in i.extensions)n.extensions[s]=i.extensions[s];if(i.shading!==void 0&&(n.flatShading=i.shading===1),i.size!==void 0&&(n.size=i.size),i.sizeAttenuation!==void 0&&(n.sizeAttenuation=i.sizeAttenuation),i.map!==void 0&&(n.map=t(i.map)),i.matcap!==void 0&&(n.matcap=t(i.matcap)),i.alphaMap!==void 0&&(n.alphaMap=t(i.alphaMap)),i.bumpMap!==void 0&&(n.bumpMap=t(i.bumpMap)),i.bumpScale!==void 0&&(n.bumpScale=i.bumpScale),i.normalMap!==void 0&&(n.normalMap=t(i.normalMap)),i.normalMapType!==void 0&&(n.normalMapType=i.normalMapType),i.normalScale!==void 0){let s=i.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new Se().fromArray(s)}return i.displacementMap!==void 0&&(n.displacementMap=t(i.displacementMap)),i.displacementScale!==void 0&&(n.displacementScale=i.displacementScale),i.displacementBias!==void 0&&(n.displacementBias=i.displacementBias),i.roughnessMap!==void 0&&(n.roughnessMap=t(i.roughnessMap)),i.metalnessMap!==void 0&&(n.metalnessMap=t(i.metalnessMap)),i.emissiveMap!==void 0&&(n.emissiveMap=t(i.emissiveMap)),i.emissiveIntensity!==void 0&&(n.emissiveIntensity=i.emissiveIntensity),i.specularMap!==void 0&&(n.specularMap=t(i.specularMap)),i.envMap!==void 0&&(n.envMap=t(i.envMap)),i.envMapIntensity!==void 0&&(n.envMapIntensity=i.envMapIntensity),i.reflectivity!==void 0&&(n.reflectivity=i.reflectivity),i.refractionRatio!==void 0&&(n.refractionRatio=i.refractionRatio),i.lightMap!==void 0&&(n.lightMap=t(i.lightMap)),i.lightMapIntensity!==void 0&&(n.lightMapIntensity=i.lightMapIntensity),i.aoMap!==void 0&&(n.aoMap=t(i.aoMap)),i.aoMapIntensity!==void 0&&(n.aoMapIntensity=i.aoMapIntensity),i.gradientMap!==void 0&&(n.gradientMap=t(i.gradientMap)),i.clearcoatMap!==void 0&&(n.clearcoatMap=t(i.clearcoatMap)),i.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=t(i.clearcoatRoughnessMap)),i.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=t(i.clearcoatNormalMap)),i.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Se().fromArray(i.clearcoatNormalScale)),i.transmission!==void 0&&(n.transmission=i.transmission),i.transmissionMap!==void 0&&(n.transmissionMap=t(i.transmissionMap)),n},setTextures:function(i){return this.textures=i,this}});const Or={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}},extractUrlBase:function(i){const e=i.lastIndexOf("/");return e===-1?"./":i.substr(0,e+1)}};function Yl(){wt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}Yl.prototype=Object.assign(Object.create(wt.prototype),{constructor:Yl,isInstancedBufferGeometry:!0,copy:function(i){return wt.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i=wt.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}});function Nd(i,e,t,n){typeof t=="number"&&(n=t,t=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),tt.call(this,i,e,t),this.meshPerAttribute=n||1}Nd.prototype=Object.assign(Object.create(tt.prototype),{constructor:Nd,isInstancedBufferAttribute:!0,copy:function(i){return tt.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){const i=tt.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});function Od(i){gi.call(this,i)}Od.prototype=Object.assign(Object.create(gi.prototype),{constructor:Od,load:function(i,e,t,n){const s=this,r=new ls(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(i,function(o){try{e(s.parse(JSON.parse(o)))}catch(a){n?n(a):console.error(a),s.manager.itemError(i)}},t,n)},parse:function(i){const e={},t={};function n(d,f){if(e[f]!==void 0)return e[f];const v=d.interleavedBuffers[f],_=s(d,v.buffer),y=Tc(v.type,_),x=new Ms(y,v.stride);return x.uuid=v.uuid,e[f]=x,x}function s(d,f){if(t[f]!==void 0)return t[f];const v=d.arrayBuffers[f],_=new Uint32Array(v).buffer;return t[f]=_,_}const r=i.isInstancedBufferGeometry?new Yl:new wt,o=i.data.index;if(o!==void 0){const d=Tc(o.type,o.array);r.setIndex(new tt(d,1))}const a=i.data.attributes;for(const d in a){const f=a[d];let m;if(f.isInterleavedBufferAttribute){const v=n(i.data,f.data);m=new ss(v,f.itemSize,f.offset,f.normalized)}else{const v=Tc(f.type,f.array),_=f.isInstancedBufferAttribute?Nd:tt;m=new _(v,f.itemSize,f.normalized)}f.name!==void 0&&(m.name=f.name),r.setAttribute(d,m)}const l=i.data.morphAttributes;if(l)for(const d in l){const f=l[d],m=[];for(let v=0,_=f.length;v<_;v++){const y=f[v];let x;if(y.isInterleavedBufferAttribute){const R=n(i.data,y.data);x=new ss(R,y.itemSize,y.offset,y.normalized)}else{const R=Tc(y.type,y.array);x=new tt(R,y.itemSize,y.normalized)}y.name!==void 0&&(x.name=y.name),m.push(x)}r.morphAttributes[d]=m}i.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const u=i.data.groups||i.data.drawcalls||i.data.offsets;if(u!==void 0)for(let d=0,f=u.length;d!==f;++d){const m=u[d];r.addGroup(m.start,m.count,m.materialIndex)}const h=i.data.boundingSphere;if(h!==void 0){const d=new S;h.center!==void 0&&d.fromArray(h.center),r.boundingSphere=new fi(d,h.radius)}return i.name&&(r.name=i.name),i.userData&&(r.userData=i.userData),r}});class SM extends gi{constructor(e){super(e)}load(e,t,n,s){const r=this,o=this.path===""?Or.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new ls(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){s!==void 0&&s(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,s)}parse(e,t){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let h=!1;for(const d in o)if(o[d]instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}parseShapes(e){const t={};if(e!==void 0)for(let n=0,s=e.length;n<s;n++){const r=new Ga().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new zl().fromJSON(e[r],s);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};let s;if(e!==void 0){const r=new Od;for(let o=0,a=e.length;o<a;o++){let l;const c=e[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":l=new Xn[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new Xn[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new Xn[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new Xn[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new Xn[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new Xn[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new Xn[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new Xn[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new Xn[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new Xn[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"TubeGeometry":case"TubeBufferGeometry":l=new Xn[c.type](new Pd[c.path.type]().fromJSON(c.path),c.tubularSegments,c.radius,c.radialSegments,c.closed);break;case"LatheGeometry":case"LatheBufferGeometry":l=new Xn[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new Xn[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(let h=0,d=c.shapes.length;h<d;h++){const f=t[c.shapes[h]];s.push(f)}l=new Xn[c.type](s,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":s=[];for(let h=0,d=c.shapes.length;h<d;h++){const f=t[c.shapes[h]];s.push(f)}const u=c.options.extrudePath;u!==void 0&&(c.options.extrudePath=new Pd[u.type]().fromJSON(u)),l=new Xn[c.type](s,c.options);break;case"BufferGeometry":case"InstancedBufferGeometry":l=r.parse(c);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),l.isBufferGeometry===!0&&c.userData!==void 0&&(l.userData=c.userData),n[c.uuid]=l}}return n}parseMaterials(e,t){const n={},s={};if(e!==void 0){const r=new Bd;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];if(l.type==="MultiMaterial"){const c=[];for(let u=0;u<l.materials.length;u++){const h=l.materials[u];n[h.uuid]===void 0&&(n[h.uuid]=r.parse(h)),c.push(n[h.uuid])}s[l.uuid]=c}else n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),s[l.uuid]=n[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const s=e[n],r=as.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const n=this,s={};let r;function o(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(u)}else return l.data?{data:Tc(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Xp(t);r=new Wc(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){s[h.uuid]=[];for(let f=0,m=d.length;f<m;f++){const v=d[f],_=a(v);_!==null&&(_ instanceof HTMLImageElement?s[h.uuid].push(_):s[h.uuid].push(new Gs(_.data,_.width,_.height)))}}else{const f=a(h.url);f!==null&&(s[h.uuid]=f)}}}return s}parseTextures(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const s={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let l;const c=t[a.image];Array.isArray(c)?(l=new uo(c),c.length===6&&(l.needsUpdate=!0)):(c&&c.data?l=new Gs(c.data,c.width,c.height):l=new oi(c),c&&(l.needsUpdate=!0)),l.uuid=a.uuid,a.name!==void 0&&(l.name=a.name),a.mapping!==void 0&&(l.mapping=n(a.mapping,hb)),a.offset!==void 0&&l.offset.fromArray(a.offset),a.repeat!==void 0&&l.repeat.fromArray(a.repeat),a.center!==void 0&&l.center.fromArray(a.center),a.rotation!==void 0&&(l.rotation=a.rotation),a.wrap!==void 0&&(l.wrapS=n(a.wrap[0],Kp),l.wrapT=n(a.wrap[1],Kp)),a.format!==void 0&&(l.format=a.format),a.type!==void 0&&(l.type=a.type),a.encoding!==void 0&&(l.encoding=a.encoding),a.minFilter!==void 0&&(l.minFilter=n(a.minFilter,Qp)),a.magFilter!==void 0&&(l.magFilter=n(a.magFilter,Qp)),a.anisotropy!==void 0&&(l.anisotropy=a.anisotropy),a.flipY!==void 0&&(l.flipY=a.flipY),a.premultiplyAlpha!==void 0&&(l.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(l.unpackAlignment=a.unpackAlignment),s[a.uuid]=l}return s}parseObject(e,t,n,s){let r;function o(u){return t[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",u),t[u]}function a(u){if(u!==void 0){if(Array.isArray(u)){const h=[];for(let d=0,f=u.length;d<f;d++){const m=u[d];n[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),h.push(n[m])}return h}return n[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",u),n[u]}}let l,c;switch(e.type){case"Scene":r=new Si,e.background!==void 0&&Number.isInteger(e.background)&&(r.background=new Ee(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?r.fog=new ad(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(r.fog=new od(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new mi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(r.focus=e.focus),e.zoom!==void 0&&(r.zoom=e.zoom),e.filmGauge!==void 0&&(r.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(r.filmOffset=e.filmOffset),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Fn(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(r.zoom=e.zoom),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Zc(e.color,e.intensity);break;case"DirectionalLight":r=new xo(e.color,e.intensity);break;case"PointLight":r=new yo(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Fd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Yc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new hh(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=new dr().fromJSON(e);break;case"SkinnedMesh":l=o(e.geometry),c=a(e.material),r=new kl(l,c),e.bindMode!==void 0&&(r.bindMode=e.bindMode),e.bindMatrix!==void 0&&r.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(r.skeleton=e.skeleton);break;case"Mesh":l=o(e.geometry),c=a(e.material),r=new ot(l,c);break;case"InstancedMesh":l=o(e.geometry),c=a(e.material);const u=e.count,h=e.instanceMatrix;r=new cd(l,c,u),r.instanceMatrix=new tt(new Float32Array(h.array),16);break;case"LOD":r=new Gu;break;case"Line":r=new wn(o(e.geometry),a(e.material));break;case"LineLoop":r=new qu(o(e.geometry),a(e.material));break;case"LineSegments":r=new Hi(o(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new ho(o(e.geometry),a(e.material));break;case"Sprite":r=new Oc(a(e.material));break;case"Group":r=new xn;break;case"Bone":r=new Oa;break;default:r=new qe}if(r.uuid=e.uuid,e.name!==void 0&&(r.name=e.name),e.matrix!==void 0?(r.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(e.position!==void 0&&r.position.fromArray(e.position),e.rotation!==void 0&&r.rotation.fromArray(e.rotation),e.quaternion!==void 0&&r.quaternion.fromArray(e.quaternion),e.scale!==void 0&&r.scale.fromArray(e.scale)),e.castShadow!==void 0&&(r.castShadow=e.castShadow),e.receiveShadow!==void 0&&(r.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(r.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(r.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(r.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(r.visible=e.visible),e.frustumCulled!==void 0&&(r.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(r.renderOrder=e.renderOrder),e.userData!==void 0&&(r.userData=e.userData),e.layers!==void 0&&(r.layers.mask=e.layers),e.children!==void 0){const u=e.children;for(let h=0;h<u.length;h++)r.add(this.parseObject(u[h],t,n,s))}if(e.animations!==void 0){const u=e.animations;for(let h=0;h<u.length;h++){const d=u[h];r.animations.push(s[d])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(r.autoUpdate=e.autoUpdate);const u=e.levels;for(let h=0;h<u.length;h++){const d=u[h],f=r.getObjectByProperty("uuid",d.object);f!==void 0&&r.addLevel(f,d.distance)}}return r}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const s=t[n.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(s,n.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const hb={UVMapping:pt,CubeReflectionMapping:ki,CubeRefractionMapping:Wn,EquirectangularReflectionMapping:Yt,EquirectangularRefractionMapping:xr,CubeUVReflectionMapping:xi,CubeUVRefractionMapping:ji},Kp={RepeatWrapping:vi,ClampToEdgeWrapping:li,MirroredRepeatWrapping:Kn},Qp={NearestFilter:ei,NearestMipmapNearestFilter:Yr,NearestMipmapLinearFilter:Pn,LinearFilter:et,LinearMipmapNearestFilter:sn,LinearMipmapLinearFilter:Rs};function kd(i){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),gi.call(this,i),this.options={premultiplyAlpha:"none"}}kd.prototype=Object.assign(Object.create(gi.prototype),{constructor:kd,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(i,e,t,n){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const s=this,r=Xl.get(i);if(r!==void 0)return s.manager.itemStart(i),setTimeout(function(){e&&e(r),s.manager.itemEnd(i)},0),r;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",fetch(i,o).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,s.options)}).then(function(a){Xl.add(i,a),e&&e(a),s.manager.itemEnd(i)}).catch(function(a){n&&n(a),s.manager.itemError(i),s.manager.itemEnd(i)}),s.manager.itemStart(i)}});function em(){this.type="ShapePath",this.color=new Ee,this.subPaths=[],this.currentPath=null}Object.assign(em.prototype,{moveTo:function(i,e){return this.currentPath=new Nr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(i,e),this},lineTo:function(i,e){return this.currentPath.lineTo(i,e),this},quadraticCurveTo:function(i,e,t,n){return this.currentPath.quadraticCurveTo(i,e,t,n),this},bezierCurveTo:function(i,e,t,n,s,r){return this.currentPath.bezierCurveTo(i,e,t,n,s,r),this},splineThru:function(i){return this.currentPath.splineThru(i),this},toShapes:function(i,e){function t(y){const x=[];for(let R=0,I=y.length;R<I;R++){const B=y[R],N=new Ga;N.curves=B.curves,x.push(N)}return x}function n(y,x){const R=x.length;let I=!1;for(let B=R-1,N=0;N<R;B=N++){let J=x[B],ne=x[N],se=ne.x-J.x,E=ne.y-J.y;if(Math.abs(E)>Number.EPSILON){if(E<0&&(J=x[N],se=-se,ne=x[B],E=-E),y.y<J.y||y.y>ne.y)continue;if(y.y===J.y){if(y.x===J.x)return!0}else{const M=E*(y.x-J.x)-se*(y.y-J.y);if(M===0)return!0;if(M<0)continue;I=!I}}else{if(y.y!==J.y)continue;if(ne.x<=y.x&&y.x<=J.x||J.x<=y.x&&y.x<=ne.x)return!0}}return I}const s=ea.isClockWise,r=this.subPaths;if(r.length===0)return[];if(e===!0)return t(r);let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Ga,l.curves=a.curves,c.push(l),c;let u=!s(r[0].getPoints());u=i?!u:u;const h=[],d=[];let f=[],m=0,v;d[m]=void 0,f[m]=[];for(let y=0,x=r.length;y<x;y++)a=r[y],v=a.getPoints(),o=s(v),o=i?!o:o,o?(!u&&d[m]&&m++,d[m]={s:new Ga,p:v},d[m].s.curves=a.curves,u&&m++,f[m]=[]):f[m].push({h:a,p:v[0]});if(!d[0])return t(r);if(d.length>1){let y=!1;const x=[];for(let R=0,I=d.length;R<I;R++)h[R]=[];for(let R=0,I=d.length;R<I;R++){const B=f[R];for(let N=0;N<B.length;N++){const J=B[N];let ne=!0;for(let se=0;se<d.length;se++)n(J.p,d[se].p)&&(R!==se&&x.push({froms:R,tos:se,hole:N}),ne?(ne=!1,h[se].push(J)):y=!0);ne&&h[R].push(J)}}x.length>0&&(y||(f=h))}let _;for(let y=0,x=d.length;y<x;y++){l=d[y].s,c.push(l),_=f[y];for(let R=0,I=_.length;R<I;R++)l.holes.push(_[R].h)}return c}});function tm(i){this.type="Font",this.data=i}Object.assign(tm.prototype,{isFont:!0,generateShapes:function(i,e=100){const t=[],n=db(i,e,this.data);for(let s=0,r=n.length;s<r;s++)Array.prototype.push.apply(t,n[s].toShapes());return t}});function db(i,e,t){const n=Array.from?Array.from(i):String(i).split(""),s=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,o=[];let a=0,l=0;for(let c=0;c<n.length;c++){const u=n[c];if(u===`
`)a=0,l-=r;else{const h=fb(u,s,a,l,t);a+=h.offsetX,o.push(h.path)}}return o}function fb(i,e,t,n,s){const r=s.glyphs[i]||s.glyphs["?"];if(!r){console.error('THREE.Font: character "'+i+'" does not exists in font family '+s.familyName+".");return}const o=new em;let a,l,c,u,h,d,f,m;if(r.o){const v=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let _=0,y=v.length;_<y;)switch(v[_++]){case"m":a=v[_++]*e+t,l=v[_++]*e+n,o.moveTo(a,l);break;case"l":a=v[_++]*e+t,l=v[_++]*e+n,o.lineTo(a,l);break;case"q":c=v[_++]*e+t,u=v[_++]*e+n,h=v[_++]*e+t,d=v[_++]*e+n,o.quadraticCurveTo(h,d,c,u);break;case"b":c=v[_++]*e+t,u=v[_++]*e+n,h=v[_++]*e+t,d=v[_++]*e+n,f=v[_++]*e+t,m=v[_++]*e+n,o.bezierCurveTo(h,d,f,m,c,u);break}}return{offsetX:r.ha*e,path:o}}function im(i){gi.call(this,i)}im.prototype=Object.assign(Object.create(gi.prototype),{constructor:im,load:function(i,e,t,n){const s=this,r=new ls(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(s.withCredentials),r.load(i,function(o){let a;try{a=JSON.parse(o)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),a=JSON.parse(o.substring(65,o.length-2))}const l=s.parse(a);e&&e(l)},t,n)},parse:function(i){return new tm(i)}});let dh;const nm={getContext:function(){return dh===void 0&&(dh=new(window.AudioContext||window.webkitAudioContext)),dh},setContext:function(i){dh=i}};function zd(i){gi.call(this,i)}zd.prototype=Object.assign(Object.create(gi.prototype),{constructor:zd,load:function(i,e,t,n){const s=this,r=new ls(s.manager);r.setResponseType("arraybuffer"),r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(i,function(o){try{const a=o.slice(0);nm.getContext().decodeAudioData(a,function(c){e(c)})}catch(a){n?n(a):console.error(a),s.manager.itemError(i)}},t,n)}});function sm(i,e,t){dr.call(this,void 0,t);const n=new Ee().set(i),s=new Ee().set(e),r=new S(n.r,n.g,n.b),o=new S(s.r,s.g,s.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(r).sub(o).multiplyScalar(l)}sm.prototype=Object.assign(Object.create(dr.prototype),{constructor:sm,isHemisphereLightProbe:!0,copy:function(i){return dr.prototype.copy.call(this,i),this},toJSON:function(i){return dr.prototype.toJSON.call(this,i)}});function rm(i,e){dr.call(this,void 0,e);const t=new Ee().set(i);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}rm.prototype=Object.assign(Object.create(dr.prototype),{constructor:rm,isAmbientLightProbe:!0,copy:function(i){return dr.prototype.copy.call(this,i),this},toJSON:function(i){return dr.prototype.toJSON.call(this,i)}});const om=new xe,am=new xe;function pb(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new mi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new mi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(pb.prototype,{update:function(i){const e=this._cache;if(e.focus!==i.focus||e.fov!==i.fov||e.aspect!==i.aspect*this.aspect||e.near!==i.near||e.far!==i.far||e.zoom!==i.zoom||e.eyeSep!==this.eyeSep){e.focus=i.focus,e.fov=i.fov,e.aspect=i.aspect*this.aspect,e.near=i.near,e.far=i.far,e.zoom=i.zoom,e.eyeSep=this.eyeSep;const n=i.projectionMatrix.clone(),s=e.eyeSep/2,r=s*e.near/e.focus,o=e.near*Math.tan(rt.DEG2RAD*e.fov*.5)/e.zoom;let a,l;am.elements[12]=-s,om.elements[12]=s,a=-o*e.aspect+r,l=o*e.aspect+r,n.elements[0]=2*e.near/(l-a),n.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(n),a=-o*e.aspect-r,l=o*e.aspect-r,n.elements[0]=2*e.near/(l-a),n.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(am),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(om)}});class lm{constructor(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=cm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=cm();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function cm(){return(typeof performance>"u"?Date:performance).now()}const Ha=new S,um=new Ei,mb=new S,Va=new S;class TM extends qe{constructor(){super(),this.type="AudioListener",this.context=nm.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new lm}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ha,um,mb),Va.set(0,0,-1).applyQuaternion(um),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ha.x,s),t.positionY.linearRampToValueAtTime(Ha.y,s),t.positionZ.linearRampToValueAtTime(Ha.z,s),t.forwardX.linearRampToValueAtTime(Va.x,s),t.forwardY.linearRampToValueAtTime(Va.y,s),t.forwardZ.linearRampToValueAtTime(Va.z,s),t.upX.linearRampToValueAtTime(n.x,s),t.upY.linearRampToValueAtTime(n.y,s),t.upZ.linearRampToValueAtTime(n.z,s)}else t.setPosition(Ha.x,Ha.y,Ha.z),t.setOrientation(Va.x,Va.y,Va.z,n.x,n.y,n.z)}}class hm extends qe{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const ja=new S,dm=new Ei,gb=new S,Wa=new S;class AM extends hm{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ja,dm,gb),Wa.set(0,0,1).applyQuaternion(dm);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ja.x,n),t.positionY.linearRampToValueAtTime(ja.y,n),t.positionZ.linearRampToValueAtTime(ja.z,n),t.orientationX.linearRampToValueAtTime(Wa.x,n),t.orientationY.linearRampToValueAtTime(Wa.y,n),t.orientationZ.linearRampToValueAtTime(Wa.z,n)}else t.setPosition(ja.x,ja.y,ja.z),t.setOrientation(Wa.x,Wa.y,Wa.z)}}class vb{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}function fm(i,e,t){this.binding=i,this.valueSize=t;let n,s,r;switch(e){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(t*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(t*5);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(t*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(fm.prototype,{accumulate:function(i,e){const t=this.buffer,n=this.valueSize,s=i*n+n;let r=this.cumulativeWeight;if(r===0){for(let o=0;o!==n;++o)t[s+o]=t[o];r=e}else{r+=e;const o=e/r;this._mixBufferRegion(t,s,0,o,n)}this.cumulativeWeight=r},accumulateAdditive:function(i){const e=this.buffer,t=this.valueSize,n=t*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,i,t),this.cumulativeWeightAdditive+=i},apply:function(i){const e=this.valueSize,t=this.buffer,n=i*e+e,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const a=e*this._origIndex;this._mixBufferRegion(t,n,a,1-s,e)}r>0&&this._mixBufferRegionAdditive(t,n,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(t[a]!==t[a+e]){o.setValue(t,n);break}},saveOriginalState:function(){const i=this.binding,e=this.buffer,t=this.valueSize,n=t*this._origIndex;i.getValue(e,n);for(let s=t,r=n;s!==r;++s)e[s]=e[n+s%t];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const i=this.valueSize*3;this.binding.setValue(this.buffer,i)},_setAdditiveIdentityNumeric:function(){const i=this._addIndex*this.valueSize,e=i+this.valueSize;for(let t=i;t<e;t++)this.buffer[t]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const i=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let t=0;t<this.valueSize;t++)this.buffer[e+t]=this.buffer[i+t]},_select:function(i,e,t,n,s){if(n>=.5)for(let r=0;r!==s;++r)i[e+r]=i[t+r]},_slerp:function(i,e,t,n){Ei.slerpFlat(i,e,i,e,i,t,n)},_slerpAdditive:function(i,e,t,n,s){const r=this._workIndex*s;Ei.multiplyQuaternionsFlat(i,r,i,e,i,t),Ei.slerpFlat(i,e,i,e,i,r,n)},_lerp:function(i,e,t,n,s){const r=1-n;for(let o=0;o!==s;++o){const a=e+o;i[a]=i[a]*r+i[t+o]*n}},_lerpAdditive:function(i,e,t,n,s){for(let r=0;r!==s;++r){const o=e+r;i[o]=i[o]+i[t+r]*n}}});const Ud="\\[\\]\\.:\\/",yb=new RegExp("["+Ud+"]","g"),Gd="[^"+Ud+"]",xb="[^"+Ud.replace("\\.","")+"]",wb=/((?:WC+[\/:])*)/.source.replace("WC",Gd),bb=/(WCOD+)?/.source.replace("WCOD",xb),_b=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Gd),Mb=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Gd),Eb=new RegExp("^"+wb+bb+_b+Mb+"$"),Sb=["material","materials","bones"];function pm(i,e,t){const n=t||an.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,n)}Object.assign(pm.prototype,{getValue:function(i,e){this.bind();const t=this._targetGroup.nCachedObjects_,n=this._bindings[t];n!==void 0&&n.getValue(i,e)},setValue:function(i,e){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=t.length;n!==s;++n)t[n].setValue(i,e)},bind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].bind()},unbind:function(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].unbind()}});function an(i,e,t){this.path=e,this.parsedPath=t||an.parseTrackName(e),this.node=an.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i}Object.assign(an,{Composite:pm,create:function(i,e,t){return i&&i.isAnimationObjectGroup?new an.Composite(i,e,t):new an(i,e,t)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(yb,"")},parseTrackName:function(i){const e=Eb.exec(i);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const t={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=t.nodeName&&t.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=t.nodeName.substring(n+1);Sb.indexOf(s)!==-1&&(t.nodeName=t.nodeName.substring(0,n),t.objectName=s)}if(t.propertyName===null||t.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return t},findNode:function(i,e){if(!e||e===""||e==="."||e===-1||e===i.name||e===i.uuid)return i;if(i.skeleton){const t=i.skeleton.getBoneByName(e);if(t!==void 0)return t}if(i.children){const t=function(s){for(let r=0;r<s.length;r++){const o=s[r];if(o.name===e||o.uuid===e)return o;const a=t(o.children);if(a)return a}return null},n=t(i.children);if(n)return n}return null}}),Object.assign(an.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let i=this.node;const e=this.parsedPath,t=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(i||(i=an.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(t){let l=e.objectIndex;switch(t){case"materials":if(!i.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}i=i.material.materials;break;case"bones":if(!i.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}i=i.skeleton.bones;for(let c=0;c<i.length;c++)if(i[c].name===l){l=c;break}break;default:if(i[t]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}i=i[t]}if(l!==void 0){if(i[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);return}i=i[l]}}const r=i[n];if(r===void 0){const l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+n+" but it wasn't found.",i);return}let o=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!i.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(i.geometry.isBufferGeometry){if(!i.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}i.morphTargetDictionary[s]!==void 0&&(s=i.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(an.prototype,{_getValue_unbound:an.prototype.getValue,_setValue_unbound:an.prototype.setValue});function Tb(){this.uuid=rt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let t=0,n=arguments.length;t!==n;++t)i[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(Tb.prototype,{isAnimationObjectGroup:!0,add:function(){const i=this._objects,e=this._indicesByUUID,t=this._paths,n=this._parsedPaths,s=this._bindings,r=s.length;let o,a=i.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const h=arguments[c],d=h.uuid;let f=e[d];if(f===void 0){f=a++,e[d]=f,i.push(h);for(let m=0,v=r;m!==v;++m)s[m].push(new an(h,t[m],n[m]))}else if(f<l){o=i[f];const m=--l,v=i[m];e[v.uuid]=f,i[f]=v,e[d]=m,i[m]=h;for(let _=0,y=r;_!==y;++_){const x=s[_],R=x[m];let I=x[f];x[f]=R,I===void 0&&(I=new an(h,t[_],n[_])),x[m]=I}}else i[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,n=t.length;let s=this.nCachedObjects_;for(let r=0,o=arguments.length;r!==o;++r){const a=arguments[r],l=a.uuid,c=e[l];if(c!==void 0&&c>=s){const u=s++,h=i[u];e[h.uuid]=c,i[c]=h,e[l]=u,i[u]=a;for(let d=0,f=n;d!==f;++d){const m=t[d],v=m[u],_=m[c];m[c]=v,m[u]=_}}}this.nCachedObjects_=s},uncache:function(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,n=t.length;let s=this.nCachedObjects_,r=i.length;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=e[c];if(u!==void 0)if(delete e[c],u<s){const h=--s,d=i[h],f=--r,m=i[f];e[d.uuid]=u,i[u]=d,e[m.uuid]=h,i[h]=m,i.pop();for(let v=0,_=n;v!==_;++v){const y=t[v],x=y[h],R=y[f];y[u]=x,y[h]=R,y.pop()}}else{const h=--r,d=i[h];h>0&&(e[d.uuid]=u),i[u]=d,i.pop();for(let f=0,m=n;f!==m;++f){const v=t[f];v[u]=v[h],v.pop()}}}this.nCachedObjects_=s},subscribe_:function(i,e){const t=this._bindingsIndicesByPath;let n=t[i];const s=this._bindings;if(n!==void 0)return s[n];const r=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);n=s.length,t[i]=n,r.push(i),o.push(e),s.push(u);for(let h=c,d=a.length;h!==d;++h){const f=a[h];u[h]=new an(f,i,e)}return u},unsubscribe_:function(i){const e=this._bindingsIndicesByPath,t=e[i];if(t!==void 0){const n=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length-1,a=r[o],l=i[o];e[l]=t,r[t]=a,r.pop(),s[t]=s[o],s.pop(),n[t]=n[o],n.pop()}}});class Ab{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:or,endingEnd:or};for(let c=0;c!==o;++c){const u=r[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zo,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const s=this._clip.duration,r=e._clip.duration,o=r/s,a=s/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,r=s.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case pl:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case Da:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,r=this._loopCount;const o=n===bc;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(n===fl){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=Os,s.endingEnd=Os):(e?s.endingStart=this.zeroSlopeAtStart?Os:or:s.endingStart=no,t?s.endingEnd=this.zeroSlopeAtEnd?Os:or:s.endingEnd=no)}_scheduleFading(e,t,n){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=n,this}}function mm(i){this._root=i,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}mm.prototype=Object.assign(Object.create(Rn.prototype),{constructor:mm,_bindAction:function(i,e){const t=i._localRoot||this._root,n=i._clip.tracks,s=n.length,r=i._propertyBindings,o=i._interpolants,a=t.uuid,l=this._bindingsByRootAndName;let c=l[a];c===void 0&&(c={},l[a]=c);for(let u=0;u!==s;++u){const h=n[u],d=h.name;let f=c[d];if(f!==void 0)r[u]=f;else{if(f=r[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,a,d));continue}const m=e&&e._propertyBindings[u].binding.parsedPath;f=new fm(an.create(t,d,m),h.ValueTypeName,h.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,a,d),r[u]=f}o[u].resultBuffer=f.buffer}},_activateAction:function(i){if(!this._isActiveAction(i)){if(i._cacheIndex===null){const t=(i._localRoot||this._root).uuid,n=i._clip.uuid,s=this._actionsByClip[n];this._bindAction(i,s&&s.knownActions[0]),this._addInactiveAction(i,n,t)}const e=i._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const s=e[t];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(i)}},_deactivateAction:function(i){if(this._isActiveAction(i)){const e=i._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const s=e[t];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(i)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const i=this;this.stats={actions:{get total(){return i._actions.length},get inUse(){return i._nActiveActions}},bindings:{get total(){return i._bindings.length},get inUse(){return i._nActiveBindings}},controlInterpolants:{get total(){return i._controlInterpolants.length},get inUse(){return i._nActiveControlInterpolants}}}},_isActiveAction:function(i){const e=i._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(i,e,t){const n=this._actions,s=this._actionsByClip;let r=s[e];if(r===void 0)r={knownActions:[i],actionByRoot:{}},i._byClipCacheIndex=0,s[e]=r;else{const o=r.knownActions;i._byClipCacheIndex=o.length,o.push(i)}i._cacheIndex=n.length,n.push(i),r.actionByRoot[t]=i},_removeInactiveAction:function(i){const e=this._actions,t=e[e.length-1],n=i._cacheIndex;t._cacheIndex=n,e[n]=t,e.pop(),i._cacheIndex=null;const s=i._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,l=a[a.length-1],c=i._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),i._byClipCacheIndex=null;const u=o.actionByRoot,h=(i._localRoot||this._root).uuid;delete u[h],a.length===0&&delete r[s],this._removeInactiveBindingsForAction(i)},_removeInactiveBindingsForAction:function(i){const e=i._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const s=e[t];--s.referenceCount===0&&this._removeInactiveBinding(s)}},_lendAction:function(i){const e=this._actions,t=i._cacheIndex,n=this._nActiveActions++,s=e[n];i._cacheIndex=n,e[n]=i,s._cacheIndex=t,e[t]=s},_takeBackAction:function(i){const e=this._actions,t=i._cacheIndex,n=--this._nActiveActions,s=e[n];i._cacheIndex=n,e[n]=i,s._cacheIndex=t,e[t]=s},_addInactiveBinding:function(i,e,t){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[e];r===void 0&&(r={},n[e]=r),r[t]=i,i._cacheIndex=s.length,s.push(i)},_removeInactiveBinding:function(i){const e=this._bindings,t=i.binding,n=t.rootNode.uuid,s=t.path,r=this._bindingsByRootAndName,o=r[n],a=e[e.length-1],l=i._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[s],Object.keys(o).length===0&&delete r[n]},_lendBinding:function(i){const e=this._bindings,t=i._cacheIndex,n=this._nActiveBindings++,s=e[n];i._cacheIndex=n,e[n]=i,s._cacheIndex=t,e[t]=s},_takeBackBinding:function(i){const e=this._bindings,t=i._cacheIndex,n=--this._nActiveBindings,s=e[n];i._cacheIndex=n,e[n]=i,s._cacheIndex=t,e[t]=s},_lendControlInterpolant:function(){const i=this._controlInterpolants,e=this._nActiveControlInterpolants++;let t=i[e];return t===void 0&&(t=new ch(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),t.__cacheIndex=e,i[e]=t),t},_takeBackControlInterpolant:function(i){const e=this._controlInterpolants,t=i.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];i.__cacheIndex=n,e[n]=i,s.__cacheIndex=t,e[t]=s},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(i,e,t){const n=e||this._root,s=n.uuid;let r=typeof i=="string"?as.findByName(n,i):i;const o=r!==null?r.uuid:i,a=this._actionsByClip[o];let l=null;if(t===void 0&&(r!==null?t=r.blendMode:t=Da),a!==void 0){const u=a.actionByRoot[s];if(u!==void 0&&u.blendMode===t)return u;l=a.knownActions[0],r===null&&(r=l._clip)}if(r===null)return null;const c=new Ab(this,r,e,t);return this._bindAction(c,l),this._addInactiveAction(c,o,s),c},existingAction:function(i,e){const t=e||this._root,n=t.uuid,s=typeof i=="string"?as.findByName(t,i):i,r=s?s.uuid:i,o=this._actionsByClip[r];return o!==void 0&&o.actionByRoot[n]||null},stopAllAction:function(){const i=this._actions,e=this._nActiveActions;for(let t=e-1;t>=0;--t)i[t].stop();return this},update:function(i){i*=this.timeScale;const e=this._actions,t=this._nActiveActions,n=this.time+=i,s=Math.sign(i),r=this._accuIndex^=1;for(let l=0;l!==t;++l)e[l]._update(n,i,s,r);const o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(r);return this},setTime:function(i){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(i)},getRoot:function(){return this._root},uncacheClip:function(i){const e=this._actions,t=i.uuid,n=this._actionsByClip,s=n[t];if(s!==void 0){const r=s.knownActions;for(let o=0,a=r.length;o!==a;++o){const l=r[o];this._deactivateAction(l);const c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[t]}},uncacheRoot:function(i){const e=i.uuid,t=this._actionsByClip;for(const r in t){const o=t[r].actionByRoot,a=o[e];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const n=this._bindingsByRootAndName,s=n[e];if(s!==void 0)for(const r in s){const o=s[r];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(i,e){const t=this.existingAction(i,e);t!==null&&(this._deactivateAction(t),this._removeInactiveAction(t))}});class Hd{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Hd(this.value.clone===void 0?this.value:this.value.clone())}}function Jc(i,e,t){Ms.call(this,i,e),this.meshPerAttribute=t||1}Jc.prototype=Object.assign(Object.create(Ms.prototype),{constructor:Jc,isInstancedInterleavedBuffer:!0,copy:function(i){return Ms.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){const e=Ms.prototype.clone.call(this,i);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(i){const e=Ms.prototype.toJSON.call(this,i);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}});function gm(i,e,t,n,s){this.buffer=i,this.type=e,this.itemSize=t,this.elementSize=n,this.count=s,this.version=0}Object.defineProperty(gm.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),Object.assign(gm.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,e){return this.type=i,this.elementSize=e,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}});function kr(i,e,t,n){this.ray=new We(i,e),this.near=t||0,this.far=n||1/0,this.camera=null,this.layers=new Un,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function vm(i,e){return i.distance-e.distance}function Vd(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const s=i.children;for(let r=0,o=s.length;r<o;r++)Vd(s[r],e,t,!0)}}Object.assign(kr.prototype,{set:function(i,e){this.ray.set(i,e)},setFromCamera:function(i,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(i,e,t){const n=t||[];return Vd(i,this,n,e),n.sort(vm),n},intersectObjects:function(i,e,t){const n=t||[];if(Array.isArray(i)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(let s=0,r=i.length;s<r;s++)Vd(i[s],this,n,e);return n.sort(vm),n}});class CM{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}clone(){return new this.constructor().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(rt.clamp(t/this.radius,-1,1))),this}}class DM{constructor(e,t,n){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=n!==void 0?n:0,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}clone(){return new this.constructor().copy(this)}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}const ym=new Se;class Kc{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=e!==void 0?e:new Se(1/0,1/0),this.max=t!==void 0?t:new Se(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ym.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Se),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Se),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Se),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Se),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ym.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const xm=new S,fh=new S;class ia{constructor(e,t){this.start=e!==void 0?e:new S,this.end=t!==void 0?t:new S}set(e,t){return this.start.copy(e),this.end.copy(t),this}clone(){return new this.constructor().copy(this)}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new S),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new S),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new S),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){xm.subVectors(e,this.start),fh.subVectors(this.end,this.start);const n=fh.dot(fh);let r=fh.dot(xm)/n;return t&&(r=rt.clamp(r,0,1)),r}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new S),this.delta(n).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}function ph(i){qe.call(this),this.material=i,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ph.prototype=Object.create(qe.prototype),ph.prototype.constructor=ph,ph.prototype.isImmediateRenderObject=!0;const wm=new S;class PM extends qe{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new wt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new ft(s,3));const r=new ri({fog:!1,toneMapped:!1});this.cone=new Hi(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),wm.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(wm),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const na=new S,mh=new xe,jd=new xe;class Cb extends Hi{constructor(e){const t=bm(e),n=new wt,s=[],r=[],o=new Ee(0,0,1),a=new Ee(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new ft(s,3)),n.setAttribute("color",new ft(r,3));const l=new ri({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");jd.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(mh.multiplyMatrices(jd,a.matrixWorld),na.setFromMatrixPosition(mh),s.setXYZ(o,na.x,na.y,na.z),mh.multiplyMatrices(jd,a.parent.matrixWorld),na.setFromMatrixPosition(mh),s.setXYZ(o+1,na.x,na.y,na.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function bm(i){const e=[];i&&i.isBone&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,bm(i.children[t]));return e}class LM extends ot{constructor(e,t,n){const s=new ah(t,4,2),r=new Ut({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Db=new S,_m=new Ee,Mm=new Ee;class RM extends qe{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const s=new gd(t);s.rotateY(Math.PI*.5),this.material=new Ut({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new tt(o,3)),this.add(new ot(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");_m.copy(this.light.color),Mm.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const r=n<s/2?_m:Mm;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Db.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Pb extends Hi{constructor(e=10,t=10,n=4473924,s=8947848){n=new Ee(n),s=new Ee(s);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,f=0,m=-a;d<=t;d++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const v=d===r?n:s;v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3}const u=new wt;u.setAttribute("position",new ft(l,3)),u.setAttribute("color",new ft(c,3));const h=new ri({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}}class IM extends Hi{constructor(e=10,t=16,n=8,s=64,r=4473924,o=8947848){r=new Ee(r),o=new Ee(o);const a=[],l=[];for(let h=0;h<=t;h++){const d=h/t*(Math.PI*2),f=Math.sin(d)*e,m=Math.cos(d)*e;a.push(0,0,0),a.push(f,0,m);const v=h&1?r:o;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<=n;h++){const d=h&1?r:o,f=e-e/n*h;for(let m=0;m<s;m++){let v=m/s*(Math.PI*2),_=Math.sin(v)*f,y=Math.cos(v)*f;a.push(_,0,y),l.push(d.r,d.g,d.b),v=(m+1)/s*(Math.PI*2),_=Math.sin(v)*f,y=Math.cos(v)*f,a.push(_,0,y),l.push(d.r,d.g,d.b)}}const c=new wt;c.setAttribute("position",new ft(a,3)),c.setAttribute("color",new ft(l,3));const u=new ri({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}}const Em=new S,gh=new S,Sm=new S;class FM extends qe{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let s=new wt;s.setAttribute("position",new ft([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new ri({fog:!1,toneMapped:!1});this.lightPlane=new wn(s,r),this.add(this.lightPlane),s=new wt,s.setAttribute("position",new ft([0,0,0,0,0,1],3)),this.targetLine=new wn(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Em.setFromMatrixPosition(this.light.matrixWorld),gh.setFromMatrixPosition(this.light.target.matrixWorld),Sm.subVectors(gh,Em),this.lightPlane.lookAt(gh),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(gh),this.targetLine.scale.z=Sm.length()}}const vh=new S,$i=new bs;class BM extends Hi{constructor(e){const t=new wt,n=new ri({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={},a=new Ee(16755200),l=new Ee(16711680),c=new Ee(43775),u=new Ee(16777215),h=new Ee(3355443);d("n1","n2",a),d("n2","n4",a),d("n4","n3",a),d("n3","n1",a),d("f1","f2",a),d("f2","f4",a),d("f4","f3",a),d("f3","f1",a),d("n1","f1",a),d("n2","f2",a),d("n3","f3",a),d("n4","f4",a),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",c),d("u2","u3",c),d("u3","u1",c),d("c","t",u),d("p","c",h),d("cn1","cn2",h),d("cn3","cn4",h),d("cf1","cf2",h),d("cf3","cf4",h);function d(m,v,_){f(m,_),f(v,_)}function f(m,v){s.push(0,0,0),r.push(v.r,v.g,v.b),o[m]===void 0&&(o[m]=[]),o[m].push(s.length/3-1)}t.setAttribute("position",new ft(s,3)),t.setAttribute("color",new ft(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;$i.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qi("c",t,e,$i,0,0,-1),Qi("t",t,e,$i,0,0,1),Qi("n1",t,e,$i,-n,-s,-1),Qi("n2",t,e,$i,n,-s,-1),Qi("n3",t,e,$i,-n,s,-1),Qi("n4",t,e,$i,n,s,-1),Qi("f1",t,e,$i,-n,-s,1),Qi("f2",t,e,$i,n,-s,1),Qi("f3",t,e,$i,-n,s,1),Qi("f4",t,e,$i,n,s,1),Qi("u1",t,e,$i,n*.7,s*1.1,-1),Qi("u2",t,e,$i,-n*.7,s*1.1,-1),Qi("u3",t,e,$i,0,s*2,-1),Qi("cf1",t,e,$i,-n,0,1),Qi("cf2",t,e,$i,n,0,1),Qi("cf3",t,e,$i,0,-s,1),Qi("cf4",t,e,$i,0,s,1),Qi("cn1",t,e,$i,-n,0,-1),Qi("cn2",t,e,$i,n,0,-1),Qi("cn3",t,e,$i,0,-s,-1),Qi("cn4",t,e,$i,0,s,-1),e.getAttribute("position").needsUpdate=!0}}function Qi(i,e,t,n,s,r,o){vh.set(s,r,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],vh.x,vh.y,vh.z)}}const yh=new Wt;class Lb extends Hi{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new wt;r.setIndex(new tt(n,1)),r.setAttribute("position",new tt(s,3)),super(r,new ri({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&yh.setFromObject(this.object),yh.isEmpty())return;const t=yh.min,n=yh.max,s=this.geometry.attributes.position,r=s.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Hi.prototype.copy.call(this,e),this.object=e.object,this}}class NM extends Hi{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new wt;r.setIndex(new tt(n,1)),r.setAttribute("position",new ft(s,3)),super(r,new ri({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Rb extends wn{constructor(e,t=1,n=16776960){const s=n,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new wt;o.setAttribute("position",new ft(r,3)),o.computeBoundingSphere(),super(o,new ri({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new wt;l.setAttribute("position",new ft(a,3)),l.computeBoundingSphere(),this.add(new ot(l,new Ut({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?qt:Kt,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const Tm=new S;let xh,Wd;class OM extends qe{constructor(e,t,n,s,r,o){super(),this.type="ArrowHelper",e===void 0&&(e=new S(0,0,1)),t===void 0&&(t=new S(0,0,0)),n===void 0&&(n=1),s===void 0&&(s=16776960),r===void 0&&(r=.2*n),o===void 0&&(o=.2*r),xh===void 0&&(xh=new wt,xh.setAttribute("position",new ft([0,0,0,0,1,0],3)),Wd=new Ju(0,.5,1,5,1),Wd.translate(0,-.5,0)),this.position.copy(t),this.line=new wn(xh,new ri({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ot(Wd,new Ut({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Tm.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Tm,t)}}setLength(e,t,n){t===void 0&&(t=.2*e),n===void 0&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Ib extends Hi{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new wt;s.setAttribute("position",new ft(t,3)),s.setAttribute("color",new ft(n,3));const r=new ri({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}}const Am=new Float32Array(1),Fb=new Int32Array(Am.buffer),kM={toHalfFloat:function(i){Am[0]=i;const e=Fb[0];let t=e>>16&32768,n=e>>12&2047;const s=e>>23&255;return s<103?t:s>142?(t|=31744,t|=(s==255?0:1)&&e&8388607,t):s<113?(n|=2048,t|=(n>>114-s)+(n>>113-s&1),t):(t|=s-112<<10|n>>1,t+=n&1,t)}},Zl=4,sa=8,zr=Math.pow(2,sa),Cm=[.125,.215,.35,.446,.526,.582],Dm=sa-Zl+1+Cm.length,Jl=20,Ur={[D]:0,[H]:1,[q]:2,[_e]:3,[Ce]:4,[ze]:5,[U]:6},$d=new Fn,{_lodPlanes:Qc,_sizeLods:Pm,_sigmas:wh}=Nb(),Lm=new Ee;let qd=null;const $a=(1+Math.sqrt(5))/2,Kl=1/$a,Rm=[new S(1,1,1),new S(-1,1,1),new S(1,1,-1),new S(-1,1,-1),new S(0,$a,Kl),new S(0,$a,-Kl),new S(Kl,0,$a),new S(-Kl,0,$a),new S($a,Kl,0),new S(-$a,Kl,0)];class zM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=Ob(Jl),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){qd=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=Bm(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=Fm(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Qc.length;e++)Qc[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(qd),e.scissorTest=!1,bh(e,0,0,e.width,e.height)}_fromTexture(e){qd=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:ei,minFilter:ei,generateMipmaps:!1,type:ms,format:Qr,encoding:Bb(e)?e.encoding:q,depthBuffer:!1},n=Im(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Im(t),n}_compileMaterial(e){const t=new ot(Qc[0],e);this._renderer.compile(t,$d)}_sceneToCubeUV(e,t,n,s){const a=new mi(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.outputEncoding,d=u.toneMapping;u.getClearColor(Lm);const f=u.getClearAlpha();u.toneMapping=ps,u.outputEncoding=D;let m=e.background;if(m&&m.isColor){m.convertSRGBToLinear();const v=Math.max(m.r,m.g,m.b),_=Math.min(Math.max(Math.ceil(Math.log2(v)),-128),127);m=m.multiplyScalar(Math.pow(2,-_));const y=(_+128)/255;u.setClearColor(m,y),e.background=null}for(let v=0;v<6;v++){const _=v%3;_==0?(a.up.set(0,l[v],0),a.lookAt(c[v],0,0)):_==1?(a.up.set(0,0,l[v]),a.lookAt(0,c[v],0)):(a.up.set(0,l[v],0),a.lookAt(0,0,c[v])),bh(s,_*zr,v>2?zr:0,zr,zr),u.setRenderTarget(s),u.render(e,a)}u.toneMapping=d,u.outputEncoding=h,u.setClearColor(Lm,f)}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=Bm()):this._equirectShader==null&&(this._equirectShader=Fm());const s=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new ot(Qc[0],s),o=s.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Ur[e.encoding],o.outputEncoding.value=Ur[t.texture.encoding],bh(t,0,0,3*zr,2*zr),n.setRenderTarget(t),n.render(r,$d)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<Dm;s++){const r=Math.sqrt(wh[s]*wh[s]-wh[s-1]*wh[s-1]),o=Rm[(s-1)%Rm.length];this._blur(e,s-1,s,r,o)}t.autoClear=n}_blur(e,t,n,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,s,"latitudinal",r),this._halfBlur(o,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new ot(Qc[s],c),d=c.uniforms,f=Pm[n]-1,m=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*Jl-1),v=r/m,_=isFinite(r)?1+Math.floor(u*v):Jl;_>Jl&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${Jl}`);const y=[];let x=0;for(let N=0;N<Jl;++N){const J=N/v,ne=Math.exp(-J*J/2);y.push(ne),N==0?x+=ne:N<_&&(x+=2*ne)}for(let N=0;N<y.length;N++)y[N]=y[N]/x;d.envMap.value=e.texture,d.samples.value=_,d.weights.value=y,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a),d.dTheta.value=m,d.mipInt.value=sa-n,d.inputEncoding.value=Ur[e.texture.encoding],d.outputEncoding.value=Ur[e.texture.encoding];const R=Pm[s],I=3*Math.max(0,zr-2*R),B=(s===0?0:2*zr)+2*R*(s>sa-Zl?s-sa+Zl:0);bh(t,I,B,3*R,2*R),l.setRenderTarget(t),l.render(h,$d)}}function Bb(i){return i===void 0||i.type!==ms?!1:i.encoding===D||i.encoding===H||i.encoding===U}function Nb(){const i=[],e=[],t=[];let n=sa;for(let s=0;s<Dm;s++){const r=Math.pow(2,n);e.push(r);let o=1/r;s>sa-Zl?o=Cm[s-sa+Zl-1]:s==0&&(o=0),t.push(o);const a=1/(r-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,f=3,m=2,v=1,_=new Float32Array(f*d*h),y=new Float32Array(m*d*h),x=new Float32Array(v*d*h);for(let I=0;I<h;I++){const B=I%3*2/3-1,N=I>2?0:-1,J=[B,N,0,B+2/3,N,0,B+2/3,N+1,0,B,N,0,B+2/3,N+1,0,B,N+1,0];_.set(J,f*d*I),y.set(u,m*d*I);const ne=[I,I,I,I,I,I];x.set(ne,v*d*I)}const R=new wt;R.setAttribute("position",new tt(_,f)),R.setAttribute("uv",new tt(y,m)),R.setAttribute("faceIndex",new tt(x,v)),i.push(R),n>Zl&&n--}return{_lodPlanes:i,_sizeLods:e,_sigmas:t}}function Im(i){const e=new bi(3*zr,3*zr,i);return e.texture.mapping=xi,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function bh(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function Ob(i){const e=new Float32Array(i),t=new S(0,1,0);return new Vs({name:"SphericalGaussianBlur",defines:{n:i},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Ur[D]},outputEncoding:{value:Ur[D]}},vertexShader:Xd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Yd()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function Fm(){const i=new Se(1,1);return new Vs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:i},inputEncoding:{value:Ur[D]},outputEncoding:{value:Ur[D]}},vertexShader:Xd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Yd()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function Bm(){return new Vs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ur[D]},outputEncoding:{value:Ur[D]}},vertexShader:Xd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Yd()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:cn,depthTest:!1,depthWrite:!1})}function Xd(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Yd(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function UM(i,e,t,n,s,r,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new bu(i,e,t,s,r,o)}const GM=0,kb=1,HM=0,VM=1,Zd=2;function jM(i){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),i}function WM(i=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),i.isMultiMaterial=!0,i.materials=i,i.clone=function(){return i.slice()},i}function zb(i,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ho(i,e)}function $M(i){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Oc(i)}function qM(i,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ho(i,e)}function XM(i){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ur(i)}function YM(i){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ur(i)}function ZM(i){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ur(i)}function JM(i,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new S(i,e,t)}function KM(i,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new tt(i,e).setUsage(yt)}function QM(i,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Mu(i,e)}function eE(i,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Eu(i,e)}function tE(i,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Su(i,e)}function iE(i,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Tu(i,e)}function nE(i,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Ra(i,e)}function sE(i,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Au(i,e)}function rE(i,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new wl(i,e)}function oE(i,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new ft(i,e)}function aE(i,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Du(i,e)}Dt.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(Dt.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i},Object.assign(ta.prototype,{createPointsGeometry:function(i){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(i);return this.createGeometry(e)},createSpacedPointsGeometry:function(i){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(i);return this.createGeometry(e)},createGeometry:function(i){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new ti;for(let t=0,n=i.length;t<n;t++){const s=i[t];e.vertices.push(new S(s.x,s.y,s.z||0))}return e}}),Object.assign(Nr.prototype,{fromPoints:function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)}});function Ub(i){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),bn.call(this,i),this.type="catmullrom",this.closed=!0}Ub.prototype=Object.create(bn.prototype);function Gb(i){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),bn.call(this,i),this.type="catmullrom"}Gb.prototype=Object.create(bn.prototype);function Nm(i){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),bn.call(this,i),this.type="catmullrom"}Nm.prototype=Object.create(bn.prototype),Object.assign(Nm.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});function lE(i){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Ib(i)}function cE(i,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Lb(i,e)}function uE(i,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Hi(new Pp(i.geometry),new ri({color:e!==void 0?e:16777215}))}Pb.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Cb.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function hE(i,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Hi(new vd(i.geometry),new ri({color:e!==void 0?e:16777215}))}Object.assign(gi.prototype,{extractUrlBase:function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Or.extractUrlBase(i)}}),gi.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function dE(i){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ls(i)}function fE(i){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Sd(i)}Object.assign(Kc.prototype,{center:function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},size:function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)}}),Object.assign(Wt.prototype,{center:function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionSphere:function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)},size:function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)}}),Object.assign(fi.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Pl.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)},ia.prototype.center=function(i){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(i)},Object.assign(rt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(i){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),rt.floorPowerOfTwo(i)},nextPowerOfTwo:function(i){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),rt.ceilPowerOfTwo(i)}}),Object.assign(rn.prototype,{flattenToArrayOffset:function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)},multiplyVector3:function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),Object.assign(xe.prototype,{extractPosition:function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)},flattenToArrayOffset:function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new S().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector4:function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)},crossVector:function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(i,e,t,n,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,n,t,s,r)},getInverse:function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),yi.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)},Object.assign(Ei.prototype,{multiplyVector3:function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(We.prototype,{isIntersectionBox:function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionPlane:function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)},isIntersectionSphere:function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)}}),Object.assign(Gn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)},midpoint:function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)},normal:function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)},plane:function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)}}),Object.assign(Gn,{barycoordFromPoint:function(i,e,t,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Gn.getBarycoord(i,e,t,n,s)},normal:function(i,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Gn.getNormal(i,e,t,n)}}),Object.assign(Ga.prototype,{extractAllPoints:function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)},extrude:function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Op(this,i)},makeGeometry:function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Hp(this,i)}}),Object.assign(Se.prototype,{fromAttribute:function(i,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)},distanceToManhattan:function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(S.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)},getScaleFromMatrix:function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)},getColumnFromMatrix:function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)},applyProjection:function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)},fromAttribute:function(i,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)},distanceToManhattan:function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(_t.prototype,{fromAttribute:function(i,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ti.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(i){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.assign(qe.prototype,{getChildByName:function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(qe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(ot.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(ot.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),p},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Gu.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(zl.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),kl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Dt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}}),mi.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)},Object.defineProperties(Ri.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}}),Object.defineProperties(tt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===yt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(yt)}}}),Object.assign(tt.prototype,{setDynamic:function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?yt:Ft),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(wt.prototype,{addIndex:function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)},addAttribute:function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new tt(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)},addDrawCall:function(i,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)},applyMatrix:function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(wt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Yl.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}}),Object.defineProperties(kr.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}}),Object.defineProperties(Ms.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===yt},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}}),Object.assign(Ms.prototype,{setDynamic:function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?yt:Ft),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(rh.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Si.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Hd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Nt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ee}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===L}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}}),Object.defineProperties(Lr.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(fo.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}}),Object.defineProperties(In.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}}),Object.assign(Il.prototype,{clearTarget:function(i,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,t,n)},animate:function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Il.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?H:D}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(cp.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function pE(i,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Yo(i,t)}Object.defineProperties(bi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}}),Object.defineProperties(hm.prototype,{load:{value:function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new zd().load(i,function(n){e.setBuffer(n)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),vb.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Cl.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)},Cl.prototype.clear=function(i,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,t,n)};const mE={merge:function(i,e,t){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");let n;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),i.merge(e,n,t)},center:function(i){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),i.center()}};Go.crossOrigin=void 0,Go.loadTexture=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new jn;s.setCrossOrigin(this.crossOrigin);const r=s.load(i,t,void 0,n);return e&&(r.mapping=e),r},Go.loadTextureCube=function(i,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new Ed;s.setCrossOrigin(this.crossOrigin);const r=s.load(i,t,void 0,n);return e&&(r.mapping=e),r},Go.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Go.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function gE(){console.error("THREE.CanvasRenderer has been removed")}function vE(){console.error("THREE.JSONLoader has been removed.")}const yE={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function xE(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:st}}));class Om{constructor(e,t,n,s,r){this.path=e,this.length=this.path.spline.getLength(),this.speed=s,this.callback=r,this.tween=null,this.startPoint=Math.max(t,0),this.endPoint=Math.min(n,this.length),this.t=0}start(e=!1){this.tween&&(this.tween.stop(),this.tween=null);let t;e?t=this.t:t=this.startPoint/this.length;let n=this.endPoint/this.length,s=(n-t)*this.length*1e3/this.speed,r={t};this.tween=new TWEEN.Tween(r).to({t:n},s),this.tween.easing(TWEEN.Easing.Linear.None),this.tween.onUpdate(o=>{this.t=r.t,this.callback(r.t)}),this.tween.onComplete(()=>{this.repeat&&this.start()}),setTimeout(()=>{this.tween.start()},0)}stop(){this.tween&&(this.tween.stop(),this.tween=null,this.t=0)}pause(){this.tween&&(this.tween.stop(),TWEEN.remove(this.tween),this.tween=null)}resume(){this.start(!0)}getPoint(e){return this.path.spline.getPoint(e)}}class Hb{constructor(e=[]){this.points=e,this.spline=new bn(e)}get(e){return this.spline.getPoint(e)}getLength(){return this.spline.getLength()}animate(e,t,n,s){let r=new Om(this,e,t,n,s);return r.start(),r}pause(){this.tween&&this.tween.stop()}resume(){this.tween&&this.tween.start()}getGeometry(){let e=new ti,t=500,n=0;for(let s=0;s<=1;s+=1/t){let r=this.spline.getPoint(s);e.vertices[n]=new S(r.x,r.y,r.z),n++}if(this.closed){let s=this.spline.getPoint(0);e.vertices[n]=new S(s.x,s.y,s.z)}return e}get closed(){return this.spline.closed}set closed(e){this.spline.closed=e}}const qa={config:{withCredentials:!1,customHeaders:[{header:null,value:null}]},createXMLHttpRequest:function(){let i=new XMLHttpRequest;if(this.config.customHeaders&&Array.isArray(this.config.customHeaders)&&this.config.customHeaders.length>0){let e=i.open,t=this.config.customHeaders;i.open=function(){e.apply(this,[].slice.call(arguments)),t.forEach(function(n){n.header&&n.value&&i.setRequestHeader(n.header,n.value)})}}return i}};class wo extends qe{constructor(e){super();let t=new oi;t.minFilter=et,t.magFilter=et;let n=new Jo({map:t,depthTest:!1,depthWrite:!1});this.texture=t,this.material=n,this.sprite=new Oc(this.material),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.setText(e)}setText(e){this.text!==e&&(this.text=e,this.update())}setTextColor(e){this.textColor=e,this.update()}setBorderColor(e){this.borderColor=e,this.update()}setBackgroundColor(e){this.backgroundColor=e,this.update()}update(){let e=document.createElement("canvas"),t=e.getContext("2d");t.font="Bold "+this.fontsize+"px "+this.fontface;let s=t.measureText(this.text).width,r=5,o=2*r+s+2*this.borderThickness,a=this.fontsize*1.4+2*this.borderThickness;t.canvas.width=o,t.canvas.height=a,t.font="Bold "+this.fontsize+"px "+this.fontface,t.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",t.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",t.lineWidth=this.borderThickness,this.roundRect(t,this.borderThickness/2,this.borderThickness/2,s+this.borderThickness+2*r,this.fontsize*1.4+this.borderThickness,6),t.strokeStyle="rgba(0, 0, 0, 1.0)",t.strokeText(this.text,this.borderThickness+r,this.fontsize+this.borderThickness),t.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",t.fillText(this.text,this.borderThickness+r,this.fontsize+this.borderThickness);let l=new oi(e);l.minFilter=et,l.magFilter=et,l.needsUpdate=!0,this.sprite.material.map=l,this.texture=l,this.sprite.scale.set(o*.01,a*.01,1)}roundRect(e,t,n,s,r,o){e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+s-o,n),e.quadraticCurveTo(t+s,n,t+s,n+o),e.lineTo(t+s,n+r-o),e.quadraticCurveTo(t+s,n+r,t+s-o,n+r),e.lineTo(t+o,n+r),e.quadraticCurveTo(t,n+r,t,n+r-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath(),e.fill(),e.stroke()}}class bo extends qe{constructor(e={}){super(),this.constructor.name==="Volume"&&console.warn("Can't create object of class Volume directly. Use classes BoxVolume or SphereVolume instead."),this._clip=e.clip||!1,this._visible=!0,this.showVolumeLabel=!0,this._modifiable=e.modifiable||!0,this.label=new wo("0"),this.label.setBorderColor({r:0,g:255,b:0,a:0}),this.label.setBackgroundColor({r:0,g:255,b:0,a:0}),this.label.material.depthTest=!1,this.label.material.depthWrite=!1,this.label.material.transparent=!0,this.label.position.y-=.5,this.add(this.label),this.label.updateMatrixWorld=()=>{let t=new S;t.setFromMatrixPosition(this.matrixWorld),this.label.position.copy(t),this.label.updateMatrix(),this.label.matrixWorld.copy(this.label.matrix),this.label.matrixWorldNeedsUpdate=!1;for(let n=0,s=this.label.children.length;n<s;n++)this.label.children[n].updateMatrixWorld(!0)},this.addEventListener("select",t=>{}),this.addEventListener("deselect",t=>{})}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.dispatchEvent({type:"visibility_changed",object:this}))}getVolume(){console.warn("override this in subclass")}update(){}raycast(e,t){}get clip(){return this._clip}set clip(e){this._clip!==e&&(this._clip=e,this.update(),this.dispatchEvent({type:"clip_changed",object:this}))}get modifieable(){return this._modifiable}set modifieable(e){this._modifiable=e,this.update()}}class Xa extends bo{constructor(e={}){super(e),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="box_"+this.constructor.counter;let t=new Ul(1,1,1);t.computeBoundingBox();let n=new ti;{let s=S;n.vertices.push(new s(-.5,-.5,.5),new s(.5,-.5,.5),new s(.5,-.5,.5),new s(.5,-.5,-.5),new s(.5,-.5,-.5),new s(-.5,-.5,-.5),new s(-.5,-.5,-.5),new s(-.5,-.5,.5),new s(-.5,.5,.5),new s(.5,.5,.5),new s(.5,.5,.5),new s(.5,.5,-.5),new s(.5,.5,-.5),new s(-.5,.5,-.5),new s(-.5,.5,-.5),new s(-.5,.5,.5),new s(-.5,-.5,.5),new s(-.5,.5,.5),new s(.5,-.5,.5),new s(.5,.5,.5),new s(.5,-.5,-.5),new s(.5,.5,-.5),new s(-.5,-.5,-.5),new s(-.5,.5,-.5))}this.material=new Ut({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1}),this.box=new ot(t,this.material),this.box.geometry.computeBoundingBox(),this.boundingBox=this.box.geometry.boundingBox,this.add(this.box),this.frame=new Hi(n,new ri({color:16711680})),this.add(this.frame),this.update()}update(){this.boundingBox=this.box.geometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new fi),this._clip?(this.box.visible=!1,this.label.visible=!1):(this.box.visible=!0,this.label.visible=this.showVolumeLabel)}raycast(e,t){let n=[];if(this.box.raycast(e,n),n.length>0){let s=n[0];t.push({distance:s.distance,object:this,point:s.point.clone()})}}getVolume(){return Math.abs(this.scale.x*this.scale.y*this.scale.z)}}class _o extends bo{constructor(e={}){super(e),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="sphere_"+this.constructor.counter;let t=new Li(1,32,32);t.computeBoundingBox(),this.material=new Ut({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1}),this.sphere=new ot(t,this.material),this.sphere.visible=!1,this.sphere.geometry.computeBoundingBox(),this.boundingBox=this.sphere.geometry.boundingBox,this.add(this.sphere),this.label.visible=!1;let n=new ti;{let r=64,o=8,a=5,l=1;for(let c=0;c<o;c++){let u=c/o*Math.PI*2,h=Math.cos(u),d=Math.sin(u);for(let f=0;f<=r;f++){let m=f/r*Math.PI*2,v=m+2*Math.PI/r,_=Math.sin(m),y=Math.cos(m),x=Math.sin(v),R=Math.cos(v),I=new S(h*y,d*y,_);n.vertices.push(I);let B=new S(h*R,d*R,x);n.vertices.push(B)}}for(let c=0;c<=a+1;c++){let u=c/(a+1);u=(1-u)*(-Math.PI/2)+u*(Math.PI/2);let h=Math.sin(u);console.log(u,h);for(let d=0;d<=r;d++){let f=d/r*Math.PI*2,m=f+2*Math.PI/r,v=Math.cos(f),_=Math.sin(f),y=Math.cos(m),x=Math.sin(m),R=Math.sqrt(1-h*h),I=new S(v*R,_*R,h);n.vertices.push(I);let B=new S(y*R,x*R,h);n.vertices.push(B)}}}this.frame=new Hi(n,new ri({color:0})),this.add(this.frame);let s=new Ut({wireframe:!0,color:0});this.frame=new ot(t,s),this.update()}update(){this.boundingBox=this.sphere.geometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new fi)}raycast(e,t){let n=[];if(this.sphere.raycast(e,n),n.length>0){let s=n[0];t.push({distance:s.distance,object:this,point:s.point.clone()})}}getVolume(){return 4/3*Math.PI*this.scale.x*this.scale.y*this.scale.z}}class Ya extends qe{constructor(){super(),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="Profile_"+this.constructor.counter,this.points=[],this.spheres=[],this.edges=[],this.boxes=[],this.width=1,this.height=20,this._modifiable=!0,this.sphereGeometry=new Li(.4,10,10),this.color=new Ee(16711680),this.lineColor=new Ee(16711680)}createSphereMaterial(){return new po({color:16711680,depthTest:!1,depthWrite:!1})}getSegments(){let e=[];for(let t=0;t<this.points.length-1;t++){let n=this.points[t].clone(),s=this.points[t+1].clone();e.push({start:n,end:s})}return e}getSegmentMatrices(){let e=this.getSegments(),t=[];for(let n of e){let{start:s,end:r}=n,o=new qe,a=s.clone().setZ(0).distanceTo(r.clone().setZ(0));o.scale.set(a,1e4,this.width),o.up.set(0,0,1);let l=new S().addVectors(s,r).multiplyScalar(.5),c=new S().subVectors(r,s),u=new S(c.y,-c.x,0);o.position.set(0,0,0),o.lookAt(u),o.position.copy(l),o.updateMatrixWorld(),t.push(o.matrixWorld)}return t}addMarker(e){this.points.push(e);let t=new ot(this.sphereGeometry,this.createSphereMaterial());if(this.add(t),this.spheres.push(t),this.points.length>1){let s=new ti;s.vertices.push(new S,new S),s.colors.push(this.lineColor,this.lineColor,this.lineColor);let r=new ri({vertexColors:Zd,linewidth:2,transparent:!0,opacity:.4});r.depthTest=!1;let o=new wn(s,r);o.visible=!1,this.add(o),this.edges.push(o);let a=new Ul(1,1,1),l=new Ut({color:16711680,transparent:!0,opacity:.2}),c=new ot(a,l);c.visible=!1,this.add(c),this.boxes.push(c)}{let s=l=>{let c=He.getMousePointCloudIntersection(l.drag.end,l.viewer.scene.getActiveCamera(),l.viewer,l.viewer.scene.pointclouds);if(c){let u=this.spheres.indexOf(l.drag.object);u!==-1&&this.setPosition(u,c.location)}},r=l=>{let c=this.spheres.indexOf(l.drag.object);c!==-1&&this.dispatchEvent({type:"marker_dropped",profile:this,index:c})},o=l=>l.object.material.emissive.setHex(8947848),a=l=>l.object.material.emissive.setHex(0);t.addEventListener("drag",s),t.addEventListener("drop",r),t.addEventListener("mouseover",o),t.addEventListener("mouseleave",a)}let n={type:"marker_added",profile:this,sphere:t};this.dispatchEvent(n),this.setPosition(this.points.length-1,e)}removeMarker(e){this.points.splice(e,1),this.remove(this.spheres[e]);let t=e===0?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.boxes[t]),this.boxes.splice(t,1),this.spheres.splice(e,1),this.update(),this.dispatchEvent({type:"marker_removed",profile:this})}setPosition(e,t){let n=this.points[e];n.copy(t);let s={type:"marker_moved",profile:this,index:e,position:n.clone()};this.dispatchEvent(s),this.update()}setWidth(e){this.width=e;let t={type:"width_changed",profile:this,width:e};this.dispatchEvent(t),this.update()}getWidth(){return this.width}update(){if(this.points.length===0)return;if(this.points.length===1){let r=this.points[0];this.spheres[0].position.copy(r);return}let e=this.points[0].clone(),t=this.points[0].clone(),n=new S,s=this.points.length-1;for(let r=0;r<=s;r++){let o=this.points[r],a=this.spheres[r],l=r===0?s:r-1,c=this.points[l],u=this.edges[l],h=this.edges[r],d=this.boxes[l];if(a.position.copy(o),this._modifiable?a.visible=!0:a.visible=!1,u&&(u.geometry.vertices[1].copy(o),u.geometry.verticesNeedUpdate=!0,u.geometry.computeBoundingSphere()),h&&(h.geometry.vertices[0].copy(o),h.geometry.verticesNeedUpdate=!0,h.geometry.computeBoundingSphere()),d){let f=c,m=o,v=f.clone().setZ(0).distanceTo(m.clone().setZ(0));d.scale.set(v,1e6,this.width),d.up.set(0,0,1);let _=new S().addVectors(f,m).multiplyScalar(.5),y=new S().subVectors(m,f),x=new S(y.y,-y.x,0);d.position.set(0,0,0),d.lookAt(x),d.position.copy(_)}n.add(o),e.min(o),t.max(o)}n.multiplyScalar(1/this.points.length);for(let r=0;r<this.boxes.length;r++){let o=this.boxes[r];o.position.z=e.z+(t.z-e.z)/2}}raycast(e,t){for(let n=0;n<this.points.length;n++)this.spheres[n].raycast(e,t);for(let n=0;n<t.length;n++){let s=t[n];s.distance=e.ray.origin.distanceTo(s.point)}t.sort(function(n,s){return n.distance-s.distance})}get modifiable(){return this._modifiable}set modifiable(e){this._modifiable=e,this.update()}}var Za=function(){Yl.call(this),this.type="LineSegmentsGeometry";var i=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],t=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(t),this.setAttribute("position",new ft(i,3)),this.setAttribute("uv",new ft(e,2))};Za.prototype=Object.assign(Object.create(Yl.prototype),{constructor:Za,isLineSegmentsGeometry:!0,applyMatrix4:function(i){var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(i),t.applyMatrix4(i),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},setPositions:function(i){var e;i instanceof Float32Array?e=i:Array.isArray(i)&&(e=new Float32Array(i));var t=new Jc(e,6,1);return this.setAttribute("instanceStart",new ss(t,3,0)),this.setAttribute("instanceEnd",new ss(t,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(i){var e;i instanceof Float32Array?e=i:Array.isArray(i)&&(e=new Float32Array(i));var t=new Jc(e,6,1);return this.setAttribute("instanceColorStart",new ss(t,3,0)),this.setAttribute("instanceColorEnd",new ss(t,3,3)),this},fromWireframeGeometry:function(i){return this.setPositions(i.attributes.position.array),this},fromEdgesGeometry:function(i){return this.setPositions(i.attributes.position.array),this},fromMesh:function(i){return this.fromWireframeGeometry(new vd(i.geometry)),this},fromLineSegments:function(i){var e=i.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},computeBoundingBox:function(){var i=new Wt;return function(){this.boundingBox===null&&(this.boundingBox=new Wt);var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;t!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(t),i.setFromBufferAttribute(n),this.boundingBox.union(i))}}(),computeBoundingSphere:function(){var i=new S;return function(){this.boundingSphere===null&&(this.boundingSphere=new fi),this.boundingBox===null&&this.computeBoundingBox();var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(t!==void 0&&n!==void 0){var s=this.boundingSphere.center;this.boundingBox.getCenter(s);for(var r=0,o=0,a=t.count;o<a;o++)i.fromBufferAttribute(t,o),r=Math.max(r,s.distanceToSquared(i)),i.fromBufferAttribute(n,o),r=Math.max(r,s.distanceToSquared(i));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(i){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(i)}}),mt.line={linewidth:{value:1},resolution:{value:new Se(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},ns.line={uniforms:id.merge([mt.common,mt.fog,mt.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec2 ndcStart = clipStart.xy / clipStart.w;
			vec2 ndcEnd = clipEnd.xy / clipEnd.w;

			// direction
			vec2 dir = ndcEnd - ndcStart;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			// perpendicular to dir
			vec2 offset = vec2( dir.y, - dir.x );

			// undo aspect ratio adjustment
			dir.x /= aspect;
			offset.x /= aspect;

			// sign flip
			if ( position.x < 0.0 ) offset *= - 1.0;

			// endcaps
			if ( position.y < 0.0 ) {

				offset += - dir;

			} else if ( position.y > 1.0 ) {

				offset += dir;

			}

			// adjust for linewidth
			offset *= linewidth;

			// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
			offset /= resolution.y;

			// select end
			vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

			// back to clip space
			offset *= clip.w;

			clip.xy += offset;

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float dashOffset;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			if ( abs( vUv.y ) > 1.0 ) {

				float a = vUv.x;
				float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
				float len2 = a * a + b * b;

				if ( len2 > 1.0 ) discard;

			}

			vec4 diffuseColor = vec4( diffuse, opacity );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var dn=function(i){In.call(this,{type:"LineMaterial",uniforms:id.clone(ns.line.uniforms),vertexShader:ns.line.vertexShader,fragmentShader:ns.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(i)};dn.prototype=Object.create(In.prototype),dn.prototype.constructor=dn,dn.prototype.isLineMaterial=!0;var _h=function(i,e){i===void 0&&(i=new Za),e===void 0&&(e=new dn({color:Math.random()*16777215})),ot.call(this,i,e),this.type="LineSegments2"};_h.prototype=Object.assign(Object.create(ot.prototype),{constructor:_h,isLineSegments2:!0,computeLineDistances:function(){var i=new S,e=new S;return function(){for(var n=this.geometry,s=n.attributes.instanceStart,r=n.attributes.instanceEnd,o=new Float32Array(2*s.data.count),a=0,l=0,c=s.data.count;a<c;a++,l+=2)i.fromBufferAttribute(s,a),e.fromBufferAttribute(r,a),o[l]=l===0?0:o[l-1],o[l+1]=o[l]+i.distanceTo(e);var u=new Jc(o,2,1);return n.setAttribute("instanceDistanceStart",new ss(u,1,0)),n.setAttribute("instanceDistanceEnd",new ss(u,1,1)),this}}(),raycast:function(){var i=new _t,e=new _t,t=new _t,n=new S,s=new xe,r=new ia,o=new S;return function(l,c){l.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=l.params.Line2!==void 0&&l.params.Line2.threshold||0,h=l.ray,d=l.camera,f=d.projectionMatrix,m=this.geometry,v=this.material,_=v.resolution,y=v.linewidth+u,x=m.attributes.instanceStart,R=m.attributes.instanceEnd;h.at(1,t),t.w=1,t.applyMatrix4(d.matrixWorldInverse),t.applyMatrix4(f),t.multiplyScalar(1/t.w),t.x*=_.x/2,t.y*=_.y/2,t.z=0,n.copy(t);var I=this.matrixWorld;s.multiplyMatrices(d.matrixWorldInverse,I);for(var B=0,N=x.count;B<N;B++){i.fromBufferAttribute(x,B),e.fromBufferAttribute(R,B),i.w=1,e.w=1,i.applyMatrix4(s),e.applyMatrix4(s),i.applyMatrix4(f),e.applyMatrix4(f),i.multiplyScalar(1/i.w),e.multiplyScalar(1/e.w);var J=i.z<-1&&e.z<-1,ne=i.z>1&&e.z>1;if(!(J||ne)){i.x*=_.x/2,i.y*=_.y/2,e.x*=_.x/2,e.y*=_.y/2,r.start.copy(i),r.start.z=0,r.end.copy(e),r.end.z=0;var se=r.closestPointToPointParameter(n,!0);r.at(se,o);var E=rt.lerp(i.z,e.z,se),M=E>=-1&&E<=1,A=n.distanceTo(o)<y*.5;if(M&&A){r.start.fromBufferAttribute(x,B),r.end.fromBufferAttribute(R,B),r.start.applyMatrix4(I),r.end.applyMatrix4(I);var F=new S,P=new S;h.distanceSqToSegment(r.start,r.end,P,F),c.push({point:P,pointOnLine:F,distance:h.origin.distanceTo(P),object:this,face:null,faceIndex:B,uv:null,uv2:null})}}}}}()});var _n=function(){Za.call(this),this.type="LineGeometry"};_n.prototype=Object.assign(Object.create(Za.prototype),{constructor:_n,isLineGeometry:!0,setPositions:function(i){for(var e=i.length-3,t=new Float32Array(2*e),n=0;n<e;n+=3)t[2*n]=i[n],t[2*n+1]=i[n+1],t[2*n+2]=i[n+2],t[2*n+3]=i[n+3],t[2*n+4]=i[n+4],t[2*n+5]=i[n+5];return Za.prototype.setPositions.call(this,t),this},setColors:function(i){for(var e=i.length-3,t=new Float32Array(2*e),n=0;n<e;n+=3)t[2*n]=i[n],t[2*n+1]=i[n+1],t[2*n+2]=i[n+2],t[2*n+3]=i[n+3],t[2*n+4]=i[n+4],t[2*n+5]=i[n+5];return Za.prototype.setColors.call(this,t),this},fromLine:function(i){var e=i.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},copy:function(){return this}});var Bn=function(i,e){i===void 0&&(i=new _n),e===void 0&&(e=new dn({color:Math.random()*16777215})),_h.call(this,i,e),this.type="Line2"};Bn.prototype=Object.assign(Object.create(_h.prototype),{constructor:Bn,isLine2:!0});function Vb(){let i=new _n;i.setPositions([0,0,0,0,0,0]);let e=new dn({color:65280,dashSize:5,gapSize:2,linewidth:2,resolution:new Se(1e3,1e3)});e.depthTest=!1;const t=new Bn(i,e);return t.visible=!1,t}function jb(){const i=new wo("");return i.setTextColor({r:140,g:250,b:140,a:1}),i.setBorderColor({r:0,g:0,b:0,a:1}),i.setBackgroundColor({r:0,g:0,b:0,a:1}),i.fontsize=16,i.material.depthTest=!1,i.material.opacity=1,i.visible=!1,i}function Wb(){const i=new wo("");return i.setTextColor({r:140,g:250,b:140,a:1}),i.setBorderColor({r:0,g:0,b:0,a:1}),i.setBackgroundColor({r:0,g:0,b:0,a:1}),i.fontsize=16,i.material.depthTest=!1,i.material.opacity=1,i.visible=!1,i}function $b(){const i=new wo("");return i.setTextColor({r:140,g:250,b:140,a:1}),i.setBorderColor({r:0,g:0,b:0,a:1}),i.setBackgroundColor({r:0,g:0,b:0,a:1}),i.fontsize=16,i.material.depthTest=!1,i.material.opacity=1,i.visible=!1,i}function qb(){const i=new _n;i.setPositions([0,0,0,0,0,0]);const e=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3),gapSize:1,dashed:!0});e.depthTest=!1;const t=new Bn(i,e);return t.visible=!1,t}function Xb(){const i=[];let e=128;for(let r=0;r<=e;r++){let o=2*Math.PI*(r/e),a=2*Math.PI*(r+1)/e,l=new S(Math.cos(o),Math.sin(o),0),c=new S(Math.cos(a),Math.sin(a),0);i.push(...l.toArray(),...c.toArray())}const t=new _n;t.setPositions(i);const n=new dn({color:16711680,dashSize:5,gapSize:2,linewidth:2,resolution:new Se(1e3,1e3)});n.depthTest=!1;const s=new Bn(t,n);return s.visible=!1,s.computeLineDistances(),s}function Yb(){const i=new Li(1,32,32),e=new Ki,t=new ot(i,e);return t.visible=!1,t}function Mh(){const i=new _n;i.setPositions([0,0,0,0,0,0]);const e=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3),gapSize:1,dashed:!0});return e.depthTest=!1,new Bn(i,e)}function Zb(){const i=[];let e=128;for(let r=0;r<=e;r++){let o=2*Math.PI*(r/e),a=2*Math.PI*(r+1)/e,l=new S(Math.cos(o),Math.sin(o),0),c=new S(Math.cos(a),Math.sin(a),0);i.push(...l.toArray(),...c.toArray())}const t=new _n;t.setPositions(i);const n=new dn({color:16711680,dashSize:5,gapSize:2,linewidth:2,resolution:new Se(1e3,1e3)});n.depthTest=!1;const s=new Bn(t,n);return s.computeLineDistances(),s}function Jb(){const i={label:null,center:null,target:null,north:null,centerToNorth:null,centerToTarget:null,centerToTargetground:null,targetgroundToTarget:null,circle:null,node:null},e=new Li(1,32,32),t=new Ki;{const n=new wo("");n.setTextColor({r:140,g:250,b:140,a:1}),n.setBorderColor({r:0,g:0,b:0,a:1}),n.setBackgroundColor({r:0,g:0,b:0,a:1}),n.fontsize=16,n.material.depthTest=!1,n.material.opacity=1,i.label=n}return i.center=new ot(e,t),i.target=new ot(e,t),i.north=new ot(e,t),i.centerToNorth=Mh(),i.centerToTarget=Mh(),i.centerToTargetground=Mh(),i.targetgroundToTarget=Mh(),i.circle=Zb(),i.node=new qe,i.node.add(i.centerToNorth,i.centerToTarget,i.centerToTargetground,i.targetgroundToTarget,i.circle,i.label,i.center,i.target,i.north),i}class Gr extends qe{constructor(){super(),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="Measure_"+this.constructor.counter,this.points=[],this._showDistances=!0,this._showCoordinates=!1,this._showArea=!1,this._closed=!0,this._showAngles=!1,this._showCircle=!1,this._showHeight=!1,this._showEdges=!0,this._showAzimuth=!1,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.sphereGeometry=new Li(.4,10,10),this.color=new Ee(16711680),this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.coordinateLabels=[],this.heightEdge=Vb(),this.heightLabel=jb(),this.areaLabel=Wb(),this.circleRadiusLabel=$b(),this.circleRadiusLine=qb(),this.circleLine=Xb(),this.circleCenter=Yb(),this.azimuth=Jb(),this.add(this.heightEdge),this.add(this.heightLabel),this.add(this.areaLabel),this.add(this.circleRadiusLabel),this.add(this.circleRadiusLine),this.add(this.circleLine),this.add(this.circleCenter),this.add(this.azimuth.node)}createSphereMaterial(){return new po({color:this.color,depthTest:!1,depthWrite:!1})}addMarker(e){e.x!=null?e={position:e}:e instanceof Array&&(e={position:new S(...e)}),this.points.push(e);let t=new ot(this.sphereGeometry,this.createSphereMaterial());this.add(t),this.spheres.push(t);{let s=new _n;s.setPositions([0,0,0,0,0,0]);let r=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3)});r.depthTest=!1;let o=new Bn(s,r);o.visible=!0,this.add(o),this.edges.push(o)}{let s=new wo;s.setBorderColor({r:0,g:0,b:0,a:1}),s.setBackgroundColor({r:0,g:0,b:0,a:1}),s.material.depthTest=!1,s.visible=!1,s.fontsize=16,this.edgeLabels.push(s),this.add(s)}{let s=new wo;s.setBorderColor({r:0,g:0,b:0,a:1}),s.setBackgroundColor({r:0,g:0,b:0,a:1}),s.fontsize=16,s.material.depthTest=!1,s.material.opacity=1,s.visible=!1,this.angleLabels.push(s),this.add(s)}{let s=new wo;s.setBorderColor({r:0,g:0,b:0,a:1}),s.setBackgroundColor({r:0,g:0,b:0,a:1}),s.fontsize=16,s.material.depthTest=!1,s.material.opacity=1,s.visible=!1,this.coordinateLabels.push(s),this.add(s)}{let s=l=>{let c=He.getMousePointCloudIntersection(l.drag.end,l.viewer.scene.getActiveCamera(),l.viewer,l.viewer.scene.pointclouds,{pickClipped:!0});if(c){let u=this.spheres.indexOf(l.drag.object);if(u!==-1){let h=this.points[u];for(let d of Object.keys(h))c.point[d]||delete h[d];for(let d of Object.keys(c.point).filter(f=>f!=="position"))h[d]=c.point[d];this.setPosition(u,c.location)}}},r=l=>{let c=this.spheres.indexOf(l.drag.object);c!==-1&&this.dispatchEvent({type:"marker_dropped",measurement:this,index:c})},o=l=>l.object.material.emissive.setHex(8947848),a=l=>l.object.material.emissive.setHex(0);t.addEventListener("drag",s),t.addEventListener("drop",r),t.addEventListener("mouseover",o),t.addEventListener("mouseleave",a)}let n={type:"marker_added",measurement:this,sphere:t};this.dispatchEvent(n),this.setMarker(this.points.length-1,e)}removeMarker(e){this.points.splice(e,1),this.remove(this.spheres[e]);let t=e===0?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.edgeLabels[t]),this.edgeLabels.splice(t,1),this.coordinateLabels.splice(e,1),this.remove(this.angleLabels[e]),this.angleLabels.splice(e,1),this.spheres.splice(e,1),this.update(),this.dispatchEvent({type:"marker_removed",measurement:this})}setMarker(e,t){this.points[e]=t;let n={type:"marker_moved",measure:this,index:e,position:t.position.clone()};this.dispatchEvent(n),this.update()}setPosition(e,t){this.points[e].position.copy(t);let s={type:"marker_moved",measure:this,index:e,position:t.clone()};this.dispatchEvent(s),this.update()}getArea(){let e=0,t=this.points.length-1;for(let n=0;n<this.points.length;n++){let s=this.points[n].position,r=this.points[t].position;e+=(r.x+s.x)*(s.y-r.y),t=n}return Math.abs(e/2)}getTotalDistance(){if(this.points.length===0)return 0;let e=0;for(let t=1;t<this.points.length;t++){let n=this.points[t-1].position,s=this.points[t].position,r=n.distanceTo(s);e+=r}if(this.closed&&this.points.length>1){let t=this.points[0].position,s=this.points[this.points.length-1].position.distanceTo(t);e+=s}return e}getAngleBetweenLines(e,t,n){let s=new S().subVectors(t.position,e.position),r=new S().subVectors(n.position,e.position);return Math.sqrt(s.lengthSq()*r.lengthSq())===0?0:s.angleTo(r)}getAngle(e){if(this.points.length<3||e>=this.points.length)return 0;let t=e===0?this.points[this.points.length-1]:this.points[e-1],n=this.points[e],s=this.points[(e+1)%this.points.length];return this.getAngleBetweenLines(n,t,s)}update(){if(this.points.length===0)return;if(this.points.length===1){let s=this.points[0].position;this.spheres[0].position.copy(s);{let r=this.coordinateLabels[0],o=s.toArray().map(a=>He.addCommas(a.toFixed(2))).join(" / ");r.setText(o),r.visible=this.showCoordinates}return}let e=this.points.length-1,t=new S;for(let n=0;n<=e;n++){let s=this.points[n];t.add(s.position)}t.divideScalar(this.points.length);for(let n=0;n<=e;n++){let s=n,r=n+1>e?0:n+1,o=n===0?e:n-1,a=this.points[s],l=this.points[r],c=this.points[o],u=this.spheres[s];u.position.copy(a.position),u.material.color=this.color;{let h=this.edges[s];h.material.color=this.color,h.position.copy(a.position),h.geometry.setPositions([0,0,0,...l.position.clone().sub(a.position).toArray()]),h.geometry.verticesNeedUpdate=!0,h.geometry.computeBoundingSphere(),h.computeLineDistances(),h.visible=s<e||this.closed,this.showEdges||(h.visible=!1)}{let h=this.edgeLabels[n],d=new S().add(a.position);d.add(l.position),d=d.multiplyScalar(.5);let f=a.position.distanceTo(l.position);h.position.copy(d);let m="";this.lengthUnit!=null&&this.lengthUnitDisplay!=null&&(f=f/this.lengthUnit.unitspermeter*this.lengthUnitDisplay.unitspermeter,m=this.lengthUnitDisplay.code);let v=He.addCommas(f.toFixed(2));h.setText(`${v} ${m}`),h.visible=this.showDistances&&(s<e||this.closed)&&this.points.length>=2&&f>0}{let h=this.angleLabels[n],d=this.getAngleBetweenLines(a,c,l),f=l.position.clone().sub(c.position);f.multiplyScalar(.5),f=c.position.clone().add(f).sub(a.position).normalize();let m=Math.min(a.position.distanceTo(c.position),a.position.distanceTo(l.position));m=m/9;let v=a.position.clone().add(f.multiplyScalar(m));h.position.copy(v);let _=He.addCommas((d*(180/Math.PI)).toFixed(1))+"\xB0";h.setText(_),h.visible=this.showAngles&&(s<e||this.closed)&&this.points.length>=3&&d>0}}{let n=this.heightEdge;if(n.visible=this.showHeight,this.heightLabel.visible=this.showHeight,this.showHeight){let s=this.points.slice().sort((_,y)=>_.position.z-y.position.z),r=s[0].position.clone(),o=s[s.length-1].position.clone(),a=r.z,l=o.z,c=l-a,u=new S(o.x,o.y,a),h=new S(o.x,o.y,l);n.position.copy(r),n.geometry.setPositions([0,0,0,...u.clone().sub(r).toArray(),...u.clone().sub(r).toArray(),...h.clone().sub(r).toArray()]),n.geometry.verticesNeedUpdate=!0,n.geometry.computeBoundingSphere(),n.computeLineDistances();let d=u.clone().add(h).multiplyScalar(.5);this.heightLabel.position.copy(d);let f="";this.lengthUnit!=null&&this.lengthUnitDisplay!=null&&(c=c/this.lengthUnit.unitspermeter*this.lengthUnitDisplay.unitspermeter,f=this.lengthUnitDisplay.code);let v=`${He.addCommas(c.toFixed(2))} ${f}`;this.heightLabel.setText(v)}}{const n=this.circleRadiusLabel,s=this.circleRadiusLine,r=this.circleLine,o=this.circleCenter,a=this.points.length===3;if(n.visible=this.showCircle&&a,s.visible=this.showCircle&&a,r.visible=this.showCircle&&a,o.visible=this.showCircle&&a,this.showCircle&&a){const l=this.points[0].position,c=this.points[1].position,u=this.points[2].position,h=c.clone().sub(l),f=u.clone().sub(l).clone().cross(h).normalize(),m=Potree.Utils.computeCircleCenter(l,c,u),v=m.distanceTo(l),_=v/20;o.position.copy(m),o.scale.set(_,_,_),s.geometry.setPositions([0,0,0,...c.clone().sub(m).toArray()]),s.geometry.verticesNeedUpdate=!0,s.geometry.computeBoundingSphere(),s.position.copy(m),s.computeLineDistances();const y=m.clone().add(f);r.position.copy(m),r.scale.set(v,v,v),r.lookAt(y),n.visible=!0,n.position.copy(m.clone().add(c).multiplyScalar(.5)),n.setText(`${v.toFixed(3)}`)}}{this.areaLabel.position.copy(t),this.areaLabel.visible=this.showArea&&this.points.length>=3;let n=this.getArea(),s="";this.lengthUnit!=null&&this.lengthUnitDisplay!=null&&(n=n/Math.pow(this.lengthUnit.unitspermeter,2)*Math.pow(this.lengthUnitDisplay.unitspermeter,2),s=this.lengthUnitDisplay.code);let o=`${He.addCommas(n.toFixed(1))} ${s}\xB2`;this.areaLabel.setText(o)}}raycast(e,t){for(let n=0;n<this.points.length;n++)this.spheres[n].raycast(e,t);for(let n=0;n<t.length;n++){let s=t[n];s.distance=e.ray.origin.distanceTo(s.point)}t.sort(function(n,s){return n.distance-s.distance})}get showCoordinates(){return this._showCoordinates}set showCoordinates(e){this._showCoordinates=e,this.update()}get showAngles(){return this._showAngles}set showAngles(e){this._showAngles=e,this.update()}get showCircle(){return this._showCircle}set showCircle(e){this._showCircle=e,this.update()}get showAzimuth(){return this._showAzimuth}set showAzimuth(e){this._showAzimuth=e,this.update()}get showEdges(){return this._showEdges}set showEdges(e){this._showEdges=e,this.update()}get showHeight(){return this._showHeight}set showHeight(e){this._showHeight=e,this.update()}get showArea(){return this._showArea}set showArea(e){this._showArea=e,this.update()}get closed(){return this._closed}set closed(e){this._closed=e,this.update()}get showDistances(){return this._showDistances}set showDistances(e){this._showDistances=e,this.update()}}class eu extends qe{constructor(e){super(),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="polygon_clip_volume_"+this.constructor.counter,this.camera=e.clone(),this.camera.rotation.set(...e.rotation.toArray()),this.camera.rotation.order=e.rotation.order,this.camera.updateMatrixWorld(),this.camera.updateProjectionMatrix(),this.camera.matrixWorldInverse.copy(this.camera.matrixWorld).invert(),this.viewMatrix=this.camera.matrixWorldInverse.clone(),this.projMatrix=this.camera.projectionMatrix.clone(),this.markers=[],this.initialized=!1}addMarker(){let e=new ot,t,n=r=>{let o=r.viewer.renderer.getSize(new Se),a=new S(2*(r.drag.end.x/o.width)-1,-2*(r.drag.end.y/o.height)+1,0);e.position.copy(a)},s=r=>{t()};t=r=>{e.removeEventListener("drag",n),e.removeEventListener("drop",s)},e.addEventListener("drag",n),e.addEventListener("drop",s),this.markers.push(e)}removeLastMarker(){this.markers.length>0&&this.markers.splice(this.markers.length-1,1)}}class He{static async loadShapefileFeatures(e,t){let n=[],s=()=>{t(n)},r=await shapefile.open(e);for(;;){let o=await r.read();if(o.done){s();break}o.value&&o.value.type==="Feature"&&o.value.geometry!==void 0&&n.push(o.value)}}static toString(e){return e.x!=null?e.x.toFixed(2)+", "+e.y.toFixed(2)+", "+e.z.toFixed(2):""+e}static normalizeURL(e){let t=new URL(e);return t.protocol+"//"+t.hostname+t.pathname.replace(/\/+/g,"/")}static pathExists(e){let t=qa.createXMLHttpRequest();return t.open("GET",e,!1),t.send(null),t.status===200}static debugSphere(e,t,n,s){let r=new Li(1,8,8),o;s!==void 0?o=new Ut({color:s}):o=new Ki;let a=new ot(r,o);return a.position.copy(t),a.scale.set(n,n,n),e.add(a),a}static debugLine(e,t,n,s){let r=new ri({color:s}),o=new ti;const a=new S(0,0,0),l=n.clone().sub(t);o.vertices.push(a,l);let c=new wn(o,r);return c.position.copy(t),e.add(c),{node:c,set:(h,d)=>{o.vertices[0].copy(h),o.vertices[1].copy(d),o.verticesNeedUpdate=!0}}}static debugCircle(e,t,n,s,r){let o=new ri({color:r}),a=new ti,l=32;for(let u=0;u<=l;u++){let h=2*Math.PI*(u/l),d=2*Math.PI*(u+1)/l,f=new S(Math.cos(h),Math.sin(h),0),m=new S(Math.cos(d),Math.sin(d),0);a.vertices.push(f,m)}let c=new wn(a,o);c.position.copy(t),c.scale.set(n,n,n),e.add(c)}static debugBox(e,t,n=new xe,s=16776960){let r=[[t.min.x,t.min.y,t.min.z],[t.min.x,t.min.y,t.max.z],[t.min.x,t.max.y,t.min.z],[t.min.x,t.max.y,t.max.z],[t.max.x,t.min.y,t.min.z],[t.max.x,t.min.y,t.max.z],[t.max.x,t.max.y,t.min.z],[t.max.x,t.max.y,t.max.z]].map(c=>new S(...c)),o=[[0,4],[4,5],[5,1],[1,0],[2,6],[6,7],[7,3],[3,2],[0,2],[4,6],[5,7],[1,3]],a=t.getCenter(new S),l=[{position:[t.min.x,a.y,a.z],color:16711680},{position:[t.max.x,a.y,a.z],color:8912896},{position:[a.x,t.min.y,a.z],color:65280},{position:[a.x,t.max.y,a.z],color:34816},{position:[a.x,a.y,t.min.z],color:255},{position:[a.x,a.y,t.max.z],color:136}];for(let c of r){let u=c.clone().applyMatrix4(n);He.debugSphere(e,u,.1,16711680)}for(let c of o){let u=r[c[0]].clone().applyMatrix4(n),h=r[c[1]].clone().applyMatrix4(n);He.debugLine(e,u,h,s)}for(let c of l){let u=new S(...c.position).applyMatrix4(n);He.debugSphere(e,u,.1,c.color)}}static debugPlane(e,t,n=1,s=255){let r=new Rb(t,n,s);e.add(r)}static computeTransformedBoundingBox(e,t){let n=[new S(e.min.x,e.min.y,e.min.z).applyMatrix4(t),new S(e.max.x,e.min.y,e.min.z).applyMatrix4(t),new S(e.min.x,e.max.y,e.min.z).applyMatrix4(t),new S(e.max.x,e.max.y,e.min.z).applyMatrix4(t),new S(e.min.x,e.min.y,e.max.z).applyMatrix4(t),new S(e.max.x,e.min.y,e.max.z).applyMatrix4(t),new S(e.min.x,e.max.y,e.max.z).applyMatrix4(t),new S(e.max.x,e.max.y,e.max.z).applyMatrix4(t)],s=new Wt;return s.setFromPoints(n),s}static addCommas(e){e+="";let t=e.split("."),n=t[0],s=t.length>1?"."+t[1]:"",r=/(\d+)(\d{3})/;for(;r.test(n);)n=n.replace(r,"$1,$2");return n+s}static removeCommas(e){return e.replace(/,/g,"")}static createWorker(e){let t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}static moveTo(e,t,n){let s=e.view,r=e.getActiveCamera(),o=500,a=TWEEN.Easing.Quartic.Out;{let l=new TWEEN.Tween(s.position).to(t,o);l.easing(a),l.start()}{let l=r.position.distanceTo(n),c=new S().addVectors(r.position,r.getWorldDirection(new S).clone().multiplyScalar(l)),u=new TWEEN.Tween(c).to(n,o);u.easing(a),u.onUpdate(()=>{s.lookAt(c)}),u.onComplete(()=>{s.lookAt(c)}),u.start()}}static loadSkybox(e){let t=new qe("skybox_root"),n=new mi(75,window.innerWidth/window.innerHeight,.1,1e5);n.up.set(0,0,1);let s=new Si,r=".jpg",o=[e+"px"+r,e+"nx"+r,e+"py"+r,e+"ny"+r,e+"pz"+r,e+"nz"+r],a=[];for(let u=0;u<6;u++){let h=new Ut({map:null,side:qt,depthTest:!1,depthWrite:!1,color:4343126});a.push(h),new jn().load(o[u],function(m){h.map=m,h.needsUpdate=!0,h.color.setHex(16777215)},function(m){},function(m){console.log("An error happened",m)})}let l=new Ul(700,700,700),c=new ot(l,a);return s.add(c),s.traverse(u=>u.frustumCulled=!1),s.rotation.x=Math.PI/2,t.children.push(n),n.parent=t,{camera:n,scene:s,parent:t}}static createGrid(e,t,n,s){let r=new ri({color:s||8947848}),o=new ti;for(let l=0;l<=t;l++)o.vertices.push(new S(-(n*e)/2,l*n-n*t/2,0)),o.vertices.push(new S(+(n*e)/2,l*n-n*t/2,0));for(let l=0;l<=e;l++)o.vertices.push(new S(l*n-n*e/2,-(n*t)/2,0)),o.vertices.push(new S(l*n-n*e/2,+(n*t)/2,0));let a=new Hi(o,r,kb);return a.receiveShadow=!0,a}static createBackgroundTexture(e,t){function n(c,u){return 1/(2*Math.PI)*Math.exp(-(c*c+u*u)/2)}let s=e*t,r=new Uint8Array(3*s),o=[1,1.5,1.7],a=n(0,0);for(let c=0;c<e;c++)for(let u=0;u<t;u++){let h=2*(c/e)-1,d=2*(u/t)-1,f=c+e*u,m=n(2*h,2*d)/a,v=(Math.random()+Math.random()+Math.random())/3;v=(m*.5+.5)*v*.03,v=v*.4,r[3*f+0]=255*(m/15+.05+v)*o[0],r[3*f+1]=255*(m/15+.05+v)*o[1],r[3*f+2]=255*(m/15+.05+v)*o[2]}let l=new Gs(r,e,t,Yi);return l.needsUpdate=!0,l}static getMousePointCloudIntersection(e,t,n,s,r={}){let o=n.renderer,a={x:e.x/o.domElement.clientWidth*2-1,y:-(e.y/o.domElement.clientHeight)*2+1},l={};r.pickClipped&&(l.pickClipped=r.pickClipped),l.x=e.x,l.y=o.domElement.clientHeight-e.y;let c=new kr;c.setFromCamera(a,t);let u=c.ray,h=null,d=1/0,f=null,m=null;for(let v of s){let _=v.pick(n,t,u,l);if(!_)continue;let y=t.position.distanceTo(_.position);y<d&&(d=y,h=v,f=_.position,m=_)}return h?{location:f,distance:d,pointcloud:h,point:m}:null}static pixelsArrayToImage(e,t,n){let s=document.createElement("canvas");s.width=t,s.height=n;let r=s.getContext("2d");e=new e.constructor(e);for(let l=0;l<e.length;l++)e[l*4+3]=255;let o=r.createImageData(t,n);o.data.set(e),r.putImageData(o,0,0);let a=new Image;return a.src=s.toDataURL(),a}static pixelsArrayToDataUrl(e,t,n){let s=document.createElement("canvas");s.width=t,s.height=n;let r=s.getContext("2d");e=new e.constructor(e);for(let l=0;l<e.length;l++)e[l*4+3]=255;let o=r.createImageData(t,n);return o.data.set(e),r.putImageData(o,0,0),s.toDataURL()}static pixelsArrayToCanvas(e,t,n){let s=document.createElement("canvas");s.width=t,s.height=n;let r=s.getContext("2d");e=new e.constructor(e);let o=t*4;for(let l=0;l<parseInt(n/2);l++){let c=n-l-1,u=e.slice(l*o,l*o+o),h=e.slice(c*o,c*o+o);e.set(h,l*o),e.set(u,c*o)}let a=r.createImageData(t,n);return a.data.set(e),r.putImageData(a,0,0),s}static removeListeners(e,t){e._listeners!==void 0&&e._listeners[t]&&delete e._listeners[t]}static mouseToRay(e,t,n,s){let r={x:e.x/n*2-1,y:-(e.y/s)*2+1},o=new S(r.x,r.y,.5),a=t.position.clone();o.unproject(t);let l=new S().subVectors(o,a).normalize();return new We(a,l)}static projectedRadius(e,t,n,s,r){if(t instanceof Fn)return He.projectedRadiusOrtho(e,t.projectionMatrix,s,r);if(t instanceof mi)return He.projectedRadiusPerspective(e,t.fov*Math.PI/180,n,r);throw new Error("invalid parameters")}static projectedRadiusPerspective(e,t,n,s){let r=1/Math.tan(t/2)/n;return r=r*s/2,e*r}static projectedRadiusOrtho(e,t,n,s){let r=new _t(0),o=new _t(e);return r.applyMatrix4(t),o.applyMatrix4(t),r=new S(r.x,r.y,r.z),o=new S(o.x,o.y,o.z),r.x=(r.x+1)*.5*n,r.y=(r.y+1)*.5*s,o.x=(o.x+1)*.5*n,o.y=(o.y+1)*.5*s,r.distanceTo(o)}static topView(e,t){e.position.set(0,1,0),e.rotation.set(-Math.PI/2,0,0),e.zoomTo(t,1)}static frontView(e,t){e.position.set(0,0,1),e.rotation.set(0,0,0),e.zoomTo(t,1)}static leftView(e,t){e.position.set(-1,0,0),e.rotation.set(0,-Math.PI/2,0),e.zoomTo(t,1)}static rightView(e,t){e.position.set(1,0,0),e.rotation.set(0,Math.PI/2,0),e.zoomTo(t,1)}static findClosestGpsTime(e,t){const n=performance.now(),s=[];for(const f of t.scene.pointclouds){s.push(f.root);for(const m of f.root.children)m&&s.push(m)}let r=null,o=1/0,a=1/0,l=0;for(const f of s){if(!(f.geometryNode!=null&&f.geometryNode.geometry!=null&&f.sceneNode!=null))continue;let _=f.geometryNode.geometry.attributes["gps-time"],y=_.potree.range;for(let x=0;x<_.array.length;x++){let R=_.array[x];R=R*(y[1]-y[0])+y[0];const I=Math.abs(e-R);I<a&&(o=x,a=I,l=R,r=f)}}const c=r.geometryNode.geometry,u=new S(c.attributes.position.array[3*o+0],c.attributes.position.array[3*o+1],c.attributes.position.array[3*o+2]);u.applyMatrix4(r.sceneNode.matrixWorld);const d=performance.now()-n;return console.log(`duration: ${d.toFixed(3)}ms`),{node:r,index:o,position:u}}static frustumSphereIntersection(e,t){let n=e.planes,s=t.center,r=-t.radius,o=Number.MAX_VALUE;for(let a=0;a<6;a++){let l=n[a].distanceToPoint(s);if(l<r)return 0;o=Math.min(o,l)}return o>=t.radius?2:1}static generateDataTexture(e,t,n){let s=e*t,r=new Uint8Array(4*e*t),o=Math.floor(n.r*255),a=Math.floor(n.g*255),l=Math.floor(n.b*255);for(let u=0;u<s;u++)r[u*3]=o,r[u*3+1]=a,r[u*3+2]=l;let c=new Gs(r,e,t,jt);return c.needsUpdate=!0,c.magFilter=ei,c}static getParameterByName(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(document.location.search);return n===null?null:decodeURIComponent(n[1].replace(/\+/g," "))}static setParameter(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let s=new RegExp("([\\?&])("+e+"=([^&#]*))").exec(document.location.search),r=window.location.href;if(s===null)window.location.search.length===0?r=r+"?":r=r+"&",r=r+e+"="+t;else{let o=e+"="+t;r=r.replace(s[2],o)}window.history.replaceState({},"",r)}static createChildAABB(e,t){let n=e.min.clone(),s=e.max.clone(),r=new S().subVectors(s,n);return(t&1)>0?n.z+=r.z/2:s.z-=r.z/2,(t&2)>0?n.y+=r.y/2:s.y-=r.y/2,(t&4)>0?n.x+=r.x/2:s.x-=r.x/2,new Wt(n,s)}static clipboardCopy(e){let t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{let n=document.execCommand("copy");console.log(n?"copied text to clipboard":"copy to clipboard failed")}catch{console.log("error while trying to copy to clipboard")}document.body.removeChild(t)}static getMeasurementIcon(e){if(e instanceof Gr)return e.showDistances&&!e.showArea&&!e.showAngles?`${Potree.resourcePath}/icons/distance.svg`:e.showDistances&&e.showArea&&!e.showAngles?`${Potree.resourcePath}/icons/area.svg`:e.maxMarkers===1?`${Potree.resourcePath}/icons/point.svg`:!e.showDistances&&!e.showArea&&e.showAngles?`${Potree.resourcePath}/icons/angle.png`:e.showHeight?`${Potree.resourcePath}/icons/height.svg`:`${Potree.resourcePath}/icons/distance.svg`;if(e instanceof Ya)return`${Potree.resourcePath}/icons/profile.svg`;if(e instanceof bo)return`${Potree.resourcePath}/icons/volume.svg`;if(e instanceof eu)return`${Potree.resourcePath}/icons/clip-polygon.svg`}static lineToLineIntersection(e,t,n,s){const r=[e,t,n,s],o=(m,v,_,y)=>(r[m].x-r[v].x)*(r[_].x-r[y].x)+(r[m].y-r[v].y)*(r[_].y-r[y].y)+(r[m].z-r[v].z)*(r[_].z-r[y].z),a=(o(0,2,3,2)*o(3,2,1,0)-o(0,2,1,0)*o(3,2,3,2))/(o(1,0,1,0)*o(3,2,3,2)-o(3,2,1,0)*o(3,2,1,0)),l=(o(0,2,3,2)+a*o(3,2,1,0))/o(3,2,3,2),c=t.clone().sub(e),u=s.clone().sub(n),h=e.clone().add(c.multiplyScalar(a)),d=n.clone().add(u.multiplyScalar(l));return h.clone().add(d).multiplyScalar(.5)}static computeCircleCenter(e,t,n){const s=t.clone().sub(e),r=n.clone().sub(e),o=r.clone().cross(s).normalize(),a=s.clone().cross(o).normalize(),l=r.clone().cross(o).normalize(),c=e.clone().add(t).multiplyScalar(.5),u=e.clone().add(n).multiplyScalar(.5),h=c,d=c.clone().add(a),f=u,m=u.clone().add(l);return He.lineToLineIntersection(h,d,f,m)}static getNorthVec(e,t,n){if(n){proj4.defs("pointcloud",n);const s=proj4("pointcloud","WGS84"),r=s.forward(e.toArray());let o=s.forward([e.x,e.y+t]);const a=Math.sqrt((o[0]-r[0])**2+(o[1]-r[1])**2);o=[r[0],r[1]+a];const l=s.inverse(o);return new S(...l,e.z).sub(e)}else return new S(0,1,0).multiplyScalar(t)}static computeAzimuth(e,t,n){let s=0;if(n){let r;n.includes("EPSG")?r=proj4(n,"WGS84"):(proj4.defs("pointcloud",n),r=proj4("pointcloud","WGS84"));const o=r.forward(e.toArray()),a=r.forward(t.toArray()),l=[a[0]-o[0],a[1]-o[1]];s=Math.atan2(l[1],l[0])-Math.PI/2}else{const r=[t.x-e.x,t.y-e.y];s=Math.atan2(r[1],r[0])-Math.PI/2}return s=-s,s}static async loadScript(e){return new Promise(t=>{if(document.getElementById(e))t();else{const s=document.createElement("script");s.id=e,s.onload=()=>{t()},s.src=e,document.body.appendChild(s)}})}static createSvgGradient(e){const t=`${Math.random()}_${Date.now()}`,n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg");s.setAttributeNS(null,"width","2em"),s.setAttributeNS(null,"height","3em");{const o=document.createElementNS(n,"defs"),a=document.createElementNS(n,"linearGradient");a.setAttributeNS(null,"id",t),a.setAttributeNS(null,"gradientTransform","rotate(90)");for(let l=e.length-1;l>=0;l--){const c=e[l],u=parseInt(100-c[0]*100),[h,d,f]=c[1].toArray().map(v=>parseInt(v*255)),m=document.createElementNS(n,"stop");m.setAttributeNS(null,"offset",`${u}%`),m.setAttributeNS(null,"stop-color",`rgb(${h}, ${d}, ${f})`),a.appendChild(m)}o.appendChild(a),s.appendChild(o)}const r=document.createElementNS(n,"rect");return r.setAttributeNS(null,"width","100%"),r.setAttributeNS(null,"height","100%"),r.setAttributeNS(null,"fill",`url("#${t}")`),r.setAttributeNS(null,"stroke","black"),r.setAttributeNS(null,"stroke-width","0.1em"),s.appendChild(r),s}static async waitAny(e){return new Promise(t=>{e.map(n=>{n.then(()=>{t()})})})}}He.screenPass=new function(){this.screenScene=new Si,this.screenQuad=new ot(new Ll(2,2,1)),this.screenQuad.material.depthTest=!0,this.screenQuad.material.depthWrite=!0,this.screenQuad.material.transparent=!0,this.screenScene.add(this.screenQuad),this.camera=new bs,this.render=function(i,e,t){this.screenQuad.material=e,typeof t>"u"?i.render(this.screenScene,this.camera):i.render(this.screenScene,this.camera,t)}};class ra extends Ne{constructor(e={}){super(),this.scene=null,this._title=e.title||"",this._description=e.description||"",this.offset=new S,this.uuid=rt.generateUUID(),e.position?e.position.x!=null?this.position=e.position:this.position=new S(...e.position):this.position=null,this.cameraPosition=e.cameraPosition instanceof Array?new S().fromArray(e.cameraPosition):e.cameraPosition,this.cameraTarget=e.cameraTarget instanceof Array?new S().fromArray(e.cameraTarget):e.cameraTarget,this.radius=e.radius,this.view=e.view||null,this.keepOpen=!1,this.descriptionVisible=!1,this.showDescription=!0,this.actions=e.actions||[],this.isHighlighted=!1,this._visible=!0,this.__visible=!0,this._display=!0,this._expand=!1,this.collapseThreshold=[e.collapseThreshold,100].find(s=>s!==void 0),this.children=[],this.parent=null,this.boundingBox=new Wt;let t=z.resourcePath+"/icons/close.svg";this.domElement=e.domElement?e.domElement:$(`
			<div class="annotation" oncontextmenu="return false;">
				<div class="annotation-titlebar">
					<span class="annotation-label"></span>
				</div>
				<div class="annotation-description">
					<span class="annotation-description-close">
						<img src="${t}" width="16px">
					</span>
					<span class="annotation-description-content">${this._description}</span>
				</div>
			</div>
		`),e.domElement?(this.elTitlebar=this.domElement.find(".annotation-titlebar"),this.elTitle=this.elTitlebar.find(".annotation-label"),this.elTitle.append(this._title),this.elDescriptionClose=null,this.elDescriptionContent=null):(this.elTitlebar=this.domElement.find(".annotation-titlebar"),this.elTitle=this.elTitlebar.find(".annotation-label"),this.elTitle.append(this._title)),this.clickTitle=()=>{this.hasView()&&this.moveHere(this.scene.getActiveCamera()),this.dispatchEvent({type:"click",target:this})},this.elTitle.click(this.clickTitle),this.actions=this.actions.map(s=>s instanceof Ve?s:new Ve(s));for(let s of this.actions)s.pairWith(this);let n=this.actions.filter(s=>s.showIn===void 0||s.showIn.includes("scene"));for(let s of n){let r=$(`<img src="${s.icon}" class="annotation-action-icon">`);this.elTitlebar.append(r),r.click(()=>s.onclick({annotation:this}))}this.elDescriptionClose&&(this.elDescriptionClose.hover(),this.elDescriptionClose.click(s=>this.setHighlighted(!1))),this.domElement.mouseenter(s=>this.setHighlighted(!0)),this.domElement.mouseleave(s=>this.setHighlighted(!1)),this.domElement.on("touchstart",s=>{this.setHighlighted(!this.isHighlighted)}),this.display=!1}installHandles(e){if(this.handles!==void 0)return;let t=$(`
			<div style="position: absolute; left: 300; top: 200; pointer-events: none">
				<svg width="300" height="600">
					<line x1="0" y1="0" x2="1200" y2="200" style="stroke: black; stroke-width:2" />
					<circle cx="50" cy="50" r="4" stroke="black" stroke-width="2" fill="gray" />
					<circle cx="150" cy="50" r="4" stroke="black" stroke-width="2" fill="gray" />
				</svg>
			</div>
		`),n=t.find("svg")[0],s=t.find("line")[0],r=t.find("circle")[0],o=t.find("circle")[1],a=(h,d)=>{r.setAttribute("cx",`${h.x}`),r.setAttribute("cy",`${h.y}`),o.setAttribute("cx",`${d.x}`),o.setAttribute("cy",`${d.y}`),s.setAttribute("x1",h.x),s.setAttribute("y1",h.y),s.setAttribute("x2",d.x),s.setAttribute("y2",d.y);let f=n.getBBox();n.setAttribute("width",`${f.width}`),n.setAttribute("height",`${f.height}`),n.setAttribute("viewBox",`${f.x} ${f.y} ${f.width} ${f.height}`);let m=h.y-d.y,v=h.x-d.x;m>0&&(h.y=h.y-m),v>0&&(h.x=h.x-v),t.css("left",`${h.x}px`),t.css("top",`${h.y}px`)};$(e.renderArea).append(t);let l=this.position.clone(),c=this.offset.clone();$(this.domElement).draggable({start:(h,d)=>{l=this.position.clone(),c=this.offset.clone(),console.log($(this.domElement).find(".annotation-titlebar"))},stop:()=>{},drag:(h,d)=>{let f=e.renderer.getSize(new Se).width,m={x:d.originalPosition.left-d.position.left,y:d.originalPosition.top-d.position.top},v={x:-(m.x/f)*2,y:m.y/f*2},_=e.scene.getActiveCamera(),x=new S().addVectors(l,c).project(_).clone();x.x+=v.x,x.y+=v.y;let R=x.clone();R.unproject(_);let I=new S().subVectors(R,this.position);this.offset.copy(I)}});let u=()=>{let h=this.position,d=e.scene;const f=e.renderer.getSize(new Se);let m=f.width,v=f.height,_=this.position.clone(),y=new S().addVectors(this.position,this.offset),x=R=>{let I=d.getActiveCamera(),B=new S,N=new xe().multiplyMatrices(I.projectionMatrix,I.matrixWorldInverse),J=new _t(R.x,R.y,R.z,1).applyMatrix4(N);return J.w=Math.max(J.w,.1),J.divideScalar(J.w),B.copy(J),B.x=m*(B.x+1)/2,B.y=v*(1-(B.y+1)/2),B};_=x(_),y=x(y),a(_,y)};e.addEventListener("update",u),this.handles={domElement:t,setCoordinates:a,updateCallback:u}}removeHandles(e){this.handles!==void 0&&(this.handles.domElement.remove(),e.removeEventListener("update",this.handles.updateCallback),delete this.handles)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.dispatchEvent({type:"visibility_changed",annotation:this}))}get display(){return this._display}set display(e){this._display!==e&&(this._display=e,e?this.domElement.show():this.domElement.hide())}get expand(){return this._expand}set expand(e){this._expand!==e&&(e?this.display=!1:(this.display=!0,this.traverseDescendants(t=>{t.display=!1})),this._expand=e)}get title(){return this._title}set title(e){this._title!==e&&(this._title=e,this.elTitle.empty(),this.elTitle.append(this._title),this.dispatchEvent({type:"annotation_changed",annotation:this}))}get description(){return this._description}set description(e){this._description!==e&&(this._description=e,this.dispatchEvent({type:"annotation_changed",annotation:this}))}add(e){if(!this.children.includes(e)){this.children.push(e),e.parent=this;let t=[];e.traverse(n=>{t.push(n)});for(let n of t){let s=this;for(;s!==null;)s.dispatchEvent({type:"annotation_added",annotation:n}),s=s.parent}}}level(){return this.parent===null?0:this.parent.level()+1}hasChild(e){return this.children.includes(e)}remove(e){this.hasChild(e)&&(e.removeAllChildren(),e.dispose(),this.children=this.children.filter(t=>t!==e),e.parent=null)}removeAllChildren(){this.children.forEach(e=>{e.children.length>0&&e.removeAllChildren(),this.remove(e)})}updateBounds(){let e=new Wt;this.position&&e.expandByPoint(this.position);for(let t of this.children)t.updateBounds(),e.union(t.boundingBox);this.boundingBox.copy(e)}traverse(e){let t=e(this);if(t===void 0||t===!0)for(let n of this.children)n.traverse(e)}traverseDescendants(e){for(let t of this.children)t.traverse(e)}flatten(){let e=[];return this.traverse(t=>{e.push(t)}),e}descendants(){let e=[];return this.traverse(t=>{t!==this&&e.push(t)}),e}setHighlighted(e){e?(this.domElement.css("opacity","0.8"),this.elTitlebar.css("box-shadow","0 0 5px #fff"),this.domElement.css("z-index","1000"),this.domElement.css("pointer-events","auto"),this._description&&(this.descriptionVisible=!0)):(this.domElement.css("opacity","1"),this.elTitlebar.css("box-shadow",""),this.domElement.css("z-index","100"),this.domElement.css("pointer-events","auto"),this.descriptionVisible=!1),this.isHighlighted=e}hasView(){if(this.cameraTarget){let e=this.cameraTarget.x!=null;e=e&&this.cameraPosition.x!=null;let t=this.radius!==void 0;return e||t}}moveHere(e){if(!this.hasView())return;let t=this.scene.view,n=500,s=TWEEN.Easing.Quartic.Out,r;if(this.cameraTarget?r=this.cameraTarget:this.position?r=this.position:r=this.boundingBox.getCenter(new S),this.cameraPosition){let o=this.cameraPosition;He.moveTo(this.scene,o,r)}else if(this.radius){let o=t.direction,a=r.clone().add(o.multiplyScalar(-this.radius)),l=t.radius,c=this.radius;{let u=new TWEEN.Tween(t.position).to(a,n);u.easing(s),u.start()}{let u={x:0},h=new TWEEN.Tween(u).to({x:1},n).onUpdate(function(){t.radius=this.x*c+(1-this.x)*l});h.easing(s),h.start()}}}dispose(){this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)}toString(){return"Annotation: "+this._title}}class km{constructor(e){for(let t of Object.keys(e))this[t]=e[t]}inspect(){return`Enum(${this.name}: ${this.value})`}}class Eh{constructor(e){this.object=e;for(let t of Object.keys(e)){let n=e[t];typeof n=="object"?n.name=t:n={name:t,value:n},this[t]=new km(n)}}fromValue(e){for(let t of Object.keys(this.object))if(this[t].value===e)return this[t];throw new Error(`No enum for value: ${e}`)}}const cs={ORTHOGRAPHIC:0,PERSPECTIVE:1,VR:2},fr={NONE:0,HIGHLIGHT:1,SHOW_INSIDE:2,SHOW_OUTSIDE:3},oa={INSIDE_ANY:0,INSIDE_ALL:1},pr={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},Mo={LEFT:1,RIGHT:2,MIDDLE:4},Ws={FIXED:0,ATTENUATED:1,ADAPTIVE:2},Eo={SQUARE:0,CIRCLE:1,PARABOLOID:2},tu={OCTREE:0,KDTREE:1},Yn={METER:{code:"m",unitspermeter:1},FEET:{code:"ft",unitspermeter:3.28084},INCH:{code:"\u2033",unitspermeter:39.3701}};let zm=document.createElement("canvas");const Jd=function(){let i=zm.getContext("webgl")||zm.getContext("experimental-webgl");if(i===null)return null;let e=i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT),t=i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT),n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT),s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT),r=e.precision>0&&n.precision>0,o=t.precision>0&&s.precision>0,a;return r?a="highp":o?a="mediump":a="lowp",{SHADER_INTERPOLATION:{isSupported:function(){let l=!0;return l=l&&i.getExtension("EXT_frag_depth"),l=l&&i.getParameter(i.MAX_VARYING_VECTORS)>=8,l}},SHADER_SPLATS:{isSupported:function(){let l=!0;return l=l&&i.getExtension("EXT_frag_depth"),l=l&&i.getExtension("OES_texture_float"),l=l&&i.getParameter(i.MAX_VARYING_VECTORS)>=8,l}},SHADER_EDL:{isSupported:function(){let l=!0;return l=l&&i.getExtension("EXT_frag_depth"),l=l&&i.getExtension("OES_texture_float"),l=l&&i.getParameter(i.MAX_VARYING_VECTORS)>=8,l}},precision:a}}(),Um={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,DELETE:46,A:65,S:83,D:68,W:87,Q:81,E:69,R:82,F:70};class Gm{constructor(e){this.previous=null,this.next=null,this.node=e}}class Hm{constructor(){this.first=null,this.last=null,this.items={},this.elements=0,this.numPoints=0}size(){return this.elements}contains(e){return this.items[e.id]==null}touch(e){if(!e.loaded)return;let t;this.items[e.id]==null?(t=new Gm(e),t.previous=this.last,this.last=t,t.previous!==null&&(t.previous.next=t),this.items[e.id]=t,this.elements++,this.first===null&&(this.first=t),this.numPoints+=e.numPoints):(t=this.items[e.id],t.previous===null?t.next!==null&&(this.first=t.next,this.first.previous=null,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t):t.next===null||(t.previous.next=t.next,t.next.previous=t.previous,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t))}remove(e){let t=this.items[e.id];t&&(this.elements===1?(this.first=null,this.last=null):(t.previous||(this.first=t.next,this.first.previous=null),t.next||(this.last=t.previous,this.last.next=null),t.previous&&t.next&&(t.previous.next=t.next,t.next.previous=t.previous)),delete this.items[e.id],this.elements--,this.numPoints-=e.numPoints)}getLRUItem(){return this.first===null?null:this.first.node}toString(){let e="{ ",t=this.first;for(;t!==null;)e+=t.node.id,t.next!==null&&(e+=", "),t=t.next;return e+="}",e+="("+this.size()+")",e}freeMemory(){if(!(this.elements<=1))for(;this.numPoints>Potree.pointLoadLimit;){let t=this.first.node;this.disposeDescendants(t)}}disposeDescendants(e){let t=[];for(t.push(e);t.length>0;){let n=t.pop();n.dispose(),this.remove(n);for(let s in n.children)n.children.hasOwnProperty(s)&&n.children[s].loaded&&t.push(n.children[s])}}}class iu extends Ne{constructor(){super(),this.needsTransformUpdate=!0}getChildren(){throw new Error("override function")}getBoundingBox(){throw new Error("override function")}isLoaded(){throw new Error("override function")}isGeometryNode(){throw new Error("override function")}isTreeNode(){throw new Error("override function")}getLevel(){throw new Error("override function")}getBoundingSphere(){throw new Error("override function")}}class Ja extends qe{constructor(){super()}initialized(){return this.root!==null}}const Lt={DATA_TYPE_DOUBLE:{ordinal:0,name:"double",size:8},DATA_TYPE_FLOAT:{ordinal:1,name:"float",size:4},DATA_TYPE_INT8:{ordinal:2,name:"int8",size:1},DATA_TYPE_UINT8:{ordinal:3,name:"uint8",size:1},DATA_TYPE_INT16:{ordinal:4,name:"int16",size:2},DATA_TYPE_UINT16:{ordinal:5,name:"uint16",size:2},DATA_TYPE_INT32:{ordinal:6,name:"int32",size:4},DATA_TYPE_UINT32:{ordinal:7,name:"uint32",size:4},DATA_TYPE_INT64:{ordinal:8,name:"int64",size:8},DATA_TYPE_UINT64:{ordinal:9,name:"uint64",size:8}};let Vm=0;for(let i in Lt)Lt[Vm]=Lt[i],Vm++;class St{constructor(e,t,n){this.name=e,this.type=t,this.numElements=n,this.byteSize=this.numElements*this.type.size,this.description="",this.range=[1/0,-1/0]}}St.POSITION_CARTESIAN=new St("POSITION_CARTESIAN",Lt.DATA_TYPE_FLOAT,3),St.RGBA_PACKED=new St("COLOR_PACKED",Lt.DATA_TYPE_INT8,4),St.COLOR_PACKED=St.RGBA_PACKED,St.RGB_PACKED=new St("COLOR_PACKED",Lt.DATA_TYPE_INT8,3),St.NORMAL_FLOATS=new St("NORMAL_FLOATS",Lt.DATA_TYPE_FLOAT,3),St.INTENSITY=new St("INTENSITY",Lt.DATA_TYPE_UINT16,1),St.CLASSIFICATION=new St("CLASSIFICATION",Lt.DATA_TYPE_UINT8,1),St.NORMAL_SPHEREMAPPED=new St("NORMAL_SPHEREMAPPED",Lt.DATA_TYPE_UINT8,2),St.NORMAL_OCT16=new St("NORMAL_OCT16",Lt.DATA_TYPE_UINT8,2),St.NORMAL=new St("NORMAL",Lt.DATA_TYPE_FLOAT,3),St.RETURN_NUMBER=new St("RETURN_NUMBER",Lt.DATA_TYPE_UINT8,1),St.NUMBER_OF_RETURNS=new St("NUMBER_OF_RETURNS",Lt.DATA_TYPE_UINT8,1),St.SOURCE_ID=new St("SOURCE_ID",Lt.DATA_TYPE_UINT16,1),St.INDICES=new St("INDICES",Lt.DATA_TYPE_UINT32,1),St.SPACING=new St("SPACING",Lt.DATA_TYPE_FLOAT,1),St.GPS_TIME=new St("GPS_TIME",Lt.DATA_TYPE_DOUBLE,1);class Ql{constructor(e){if(this.attributes=[],this.byteSize=0,this.size=0,this.vectors=[],e!=null)for(let t=0;t<e.length;t++){let n=e[t],s=St[n];this.attributes.push(s),this.byteSize+=s.byteSize,this.size++}}add(e){this.attributes.push(e),this.byteSize+=e.byteSize,this.size++}addVector(e){this.vectors.push(e)}hasNormals(){for(let e in this.attributes){let t=this.attributes[e];if(t===St.NORMAL_SPHEREMAPPED||t===St.NORMAL_FLOATS||t===St.NORMAL||t===St.NORMAL_OCT16)return!0}return!1}}class Ss{static toVector3(e,t){return new S().fromArray(e,t||0)}static toBox3(e){return new Wt(Ss.toVector3(e),Ss.toVector3(e,3))}static findDim(e,t){var n=e.find(s=>s.name==t);if(!n)throw new Error("Failed to find "+t+" in schema");return n}static sphereFrom(e){return e.getBoundingSphere(new fi)}static toPotreeName([e,t,n,s]){for(var r="r",o=0;o<e;++o){var a=e-o-1,l=1<<a,c=0;t&l&&(c+=4),n&l&&(c+=2),s&l&&(c+=1),r+=c}return r}static maybeSrs(e){try{return proj4(e),e}catch{}}}class jm{constructor({cube:e,boundsConforming:t,spacing:n,srs:s}){this.cube=e,this.boundingBox=Ss.toBox3(e),this.tightBoundingBox=Ss.toBox3(t),this.boundingSphere=Ss.sphereFrom(this.boundingBox),this.tightBoundingSphere=Ss.sphereFrom(this.tightBoundingBox),this.offset=Ss.toVector3([0,0,0]),this.version=new Potree.Version("1.7"),this.loader=new Potree.CopcLaszipLoader,this.spacing=n,this.projection=s||null;try{proj4(this.projection)}catch{this.projection=null}const r=new Ql;r.add(St.POSITION_CARTESIAN),r.add(new St("rgba",Lt.DATA_TYPE_UINT8,4)),r.add(new St("intensity",Lt.DATA_TYPE_UINT16,1)),r.add(new St("classification",Lt.DATA_TYPE_UINT8,1)),r.add(new St("gps-time",Lt.DATA_TYPE_FLOAT,1)),r.add(new St("returnNumber",Lt.DATA_TYPE_UINT8,1)),r.add(new St("number of returns",Lt.DATA_TYPE_UINT8,1)),r.add(new St("return number",Lt.DATA_TYPE_UINT8,1)),r.add(new St("source id",Lt.DATA_TYPE_UINT16,1)),this.pointAttributes=r}}class Kd extends jm{static parse({header:e,info:t,wkt:n}){return{cube:t.cube,boundsConforming:[...e.min,...e.max],spacing:t.spacing,srs:n}}constructor(e,t){super(Kd.parse(t)),this.type="copc",this.getter=e,this.copc=t,this.pages={"0-0-0-0":t.info.rootHierarchyPage},this.loader=new Potree.CopcLaszipLoader}async loadHierarchyPage(e){const{Copc:t,Key:n}=window.Copc,s=this.pages[n.toString(e)];return t.loadHierarchyPage(this.getter,s)}}class Qd extends jm{static parse(e){const{bounds:t,boundsConforming:n,span:s,srs:r}=e,o=(t[3]-t[0])/s;let a;if(r){const{authority:l,horizontal:c,wkt:u}=r;l&&c&&(a=Ss.maybeSrs(`${l}:${c}`)),!a&&u&&(a=Ss.maybeSrs(u))}return{cube:t,boundsConforming:n,spacing:o,srs:a}}constructor(e,t){super(Qd.parse(t)),this.type="ept",this.base=e,this.ept=t,this.loader=(()=>{switch(t.dataType){case"laszip":return new Potree.EptLaszipLoader;case"binary":return new Potree.EptBinaryLoader;case"zstandard":return new Potree.EptZstandardLoader;default:throw new Error("Invalid data type: "+t.dataType)}})()}async loadHierarchyPage(e){const{Ept:t,Key:n}=window.Copc,s=`${this.base}/ept-hierarchy/${n.toString(e)}.json`,o=await(await fetch(s)).json();return t.Hierarchy.parse(o)}}class Sh extends iu{constructor(e,t,n){super();const{Key:s}=Copc;this.owner=e,this.key=t||s.create(0,0,0,0),this.bounds=n||e.cube,this.id=Sh.IDCount++,this.geometry=null,this.boundingBox=Ss.toBox3(this.bounds),this.tightBoundingBox=this.boundingBox,this.spacing=this.owner.spacing/Math.pow(2,s.depth(this.key)),this.boundingSphere=Ss.sphereFrom(this.boundingBox),this.hasChildren=!1,this.children={},this.nodeinfo=void 0,this.numPoints=-1,this.level=s.depth(this.key),this.loaded=!1,this.loading=!1,this.oneTimeDisposeHandlers=[],this.name=Ss.toPotreeName(this.key),this.index=parseInt(this.name.charAt(this.name.length-1))}isGeometryNode(){return!0}getLevel(){return this.level}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}getNumPoints(){return this.nodeinfo?this.nodeinfo.pointCount:-1}getChildren(){let e=[];for(let t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e}addChild(e){this.children[e.index]=e,e.parent=this}async load(){this.loaded||this.loading||Potree.numNodesLoading>=Potree.maxNodesLoading||(this.loading=!0,++Potree.numNodesLoading,this.nodeinfo||await this.loadHierarchy(),this.loadPoints())}loadPoints(){this.owner.loader.load(this)}async loadHierarchy(){const{Bounds:e,Key:t}=window.Copc,n=t.toString(this.key);let s={};s[n]=this,this.hasChildren=!1;const{nodes:r,pages:o}=await this.owner.loadHierarchyPage(this.key);Object.keys({...r,...o}).map(t.create).sort(t.compare).forEach(l=>{const c=t.toString(l);if(c===n){this.nodeinfo=r[c];return}const[u,h,d,f]=l,m=[h&1,d&1,f&1];let v=t.toString(t.up(l)),_=s[v];if(!_)return;_.hasChildren=!0;const y=e.step(_.bounds,m),x=new Potree.PointCloudCopcGeometryNode(this.owner,l,y);_.addChild(x),s[c]=x;const R=r[c];R&&(x.nodeinfo=R);const I=o[c];this.owner.pages&&I&&(this.owner.pages[c]=I)})}doneLoading(e,t,n,s){e.boundingBox=this.boundingBox,this.geometry=e,this.tightBoundingBox=t,this.numPoints=n,this.mean=s,this.loaded=!0,this.loading=!1,--Potree.numNodesLoading}dispose(){if(this.geometry&&this.parent){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(let e=0;e<this.oneTimeDisposeHandlers.length;e++){let t=this.oneTimeDisposeHandlers[e];t()}this.oneTimeDisposeHandlers=[]}}}Sh.IDCount=0;class Wm{constructor(){this.url=null,this.octreeDir=null,this.spacing=0,this.boundingBox=null,this.root=null,this.nodes=null,this.pointAttributes=null,this.hierarchyStepSize=-1,this.loader=null}}class aa extends iu{constructor(e,t,n){super(),this.id=aa.IDCount++,this.name=e,this.index=parseInt(e.charAt(e.length-1)),this.pcoGeometry=t,this.geometry=null,this.boundingBox=n,this.boundingSphere=n.getBoundingSphere(new fi),this.children={},this.numPoints=0,this.level=null,this.loaded=!1,this.oneTimeDisposeHandlers=[]}isGeometryNode(){return!0}getLevel(){return this.level}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}getChildren(){let e=[];for(let t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e}getBoundingBox(){return this.boundingBox}getURL(){let e="",t=this.pcoGeometry.loader.version;return t.equalOrHigher("1.5")?e=this.pcoGeometry.octreeDir+"/"+this.getHierarchyPath()+"/"+this.name:t.equalOrHigher("1.4")?e=this.pcoGeometry.octreeDir+"/"+this.name:t.upTo("1.3")&&(e=this.pcoGeometry.octreeDir+"/"+this.name),e}getHierarchyPath(){let e="r/",t=this.pcoGeometry.hierarchyStepSize,n=this.name.substr(1),s=Math.floor(n.length/t);for(let r=0;r<s;r++)e+=n.substr(r*t,t)+"/";return e=e.slice(0,-1),e}addChild(e){this.children[e.index]=e,e.parent=this}load(){this.loading===!0||this.loaded===!0||Potree.numNodesLoading>=Potree.maxNodesLoading||(this.loading=!0,Potree.numNodesLoading++,this.pcoGeometry.loader.version.equalOrHigher("1.5")?this.level%this.pcoGeometry.hierarchyStepSize===0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints():this.loadPoints())}loadPoints(){this.pcoGeometry.loader.load(this)}loadHierachyThenPoints(){let e=this,t=function(n,s){let r=performance.now(),o=new DataView(s),a=[],l=o.getUint8(0),c=o.getUint32(1,!0);n.numPoints=c,a.push({children:l,numPoints:c,name:n.name});let u=[],h=5;for(;a.length>0;){let v=a.shift(),_=1;for(let y=0;y<8;y++){if(v.children&_){let x=v.name+y,R=o.getUint8(h),I=o.getUint32(h+1,!0);a.push({children:R,numPoints:I,name:x}),u.push({children:R,numPoints:I,name:x}),h+=5}_=_*2}if(h===s.byteLength)break}let d={};d[n.name]=n;let f=n.pcoGeometry;for(let v=0;v<u.length;v++){let _=u[v].name,y=u[v].numPoints,x=parseInt(_.charAt(_.length-1)),R=_.substring(0,_.length-1),I=d[R],B=_.length-1,N=He.createChildAABB(I.boundingBox,x),J=new aa(_,f,N);J.level=B,J.numPoints=y,J.hasChildren=u[v].children>0,J.spacing=f.spacing/Math.pow(2,B),I.addChild(J),d[_]=J}let m=performance.now()-r;if(m>5){let v=`duration: ${m}ms, numNodes: ${u.length}`;console.log(v)}n.loadPoints()};if(e.level%e.pcoGeometry.hierarchyStepSize===0){let n=e.pcoGeometry.octreeDir+"/"+e.getHierarchyPath()+"/"+e.name+".hrc",s=qa.createXMLHttpRequest();s.open("GET",n,!0),s.responseType="arraybuffer",s.overrideMimeType("text/plain; charset=x-user-defined"),s.onreadystatechange=()=>{if(s.readyState===4)if(s.status===200||s.status===0){let r=s.response;t(e,r)}else console.log("Failed to load file! HTTP status: "+s.status+", file: "+n),Potree.numNodesLoading--};try{s.send(null)}catch(r){console.log("fehler beim laden der punktwolke: "+r)}}}getNumPoints(){return this.numPoints}dispose(){if(this.geometry&&this.parent!=null){this.geometry.dispose(),this.geometry=null,this.loaded=!1,this.dispatchEvent({type:"dispose"});for(let e=0;e<this.oneTimeDisposeHandlers.length;e++){let t=this.oneTimeDisposeHandlers[e];t()}this.oneTimeDisposeHandlers=[]}}}aa.IDCount=0;let Th={SPECTRAL:[[0,new Ee(.3686,.3098,.6353)],[.1,new Ee(.1961,.5333,.7412)],[.2,new Ee(.4,.7608,.6471)],[.3,new Ee(.6706,.8667,.6431)],[.4,new Ee(.902,.9608,.5961)],[.5,new Ee(1,1,.749)],[.6,new Ee(.9961,.8784,.5451)],[.7,new Ee(.9922,.6824,.3804)],[.8,new Ee(.9569,.4275,.2627)],[.9,new Ee(.8353,.2431,.3098)],[1,new Ee(.6196,.0039,.2588)]],PLASMA:[[0,new Ee(.241,.015,.61)],[.1,new Ee(.387,.001,.654)],[.2,new Ee(.524,.025,.653)],[.3,new Ee(.651,.125,.596)],[.4,new Ee(.752,.227,.513)],[.5,new Ee(.837,.329,.431)],[.6,new Ee(.907,.435,.353)],[.7,new Ee(.963,.554,.272)],[.8,new Ee(.992,.681,.195)],[.9,new Ee(.987,.822,.144)],[1,new Ee(.94,.975,.131)]],YELLOW_GREEN:[[0,new Ee(.1647,.2824,.3451)],[.1,new Ee(.1338,.3555,.4227)],[.2,new Ee(.061,.4319,.4864)],[.3,new Ee(0,.5099,.5319)],[.4,new Ee(0,.5881,.5569)],[.5,new Ee(.137,.665,.5614)],[.6,new Ee(.2906,.7395,.5477)],[.7,new Ee(.4453,.8099,.5201)],[.8,new Ee(.6102,.8748,.485)],[.9,new Ee(.7883,.9323,.4514)],[1,new Ee(.9804,.9804,.4314)]],VIRIDIS:[[0,new Ee(.267,.005,.329)],[.1,new Ee(.283,.141,.458)],[.2,new Ee(.254,.265,.53)],[.3,new Ee(.207,.372,.553)],[.4,new Ee(.164,.471,.558)],[.5,new Ee(.128,.567,.551)],[.6,new Ee(.135,.659,.518)],[.7,new Ee(.267,.749,.441)],[.8,new Ee(.478,.821,.318)],[.9,new Ee(.741,.873,.15)],[1,new Ee(.993,.906,.144)]],INFERNO:[[0,new Ee(.077,.042,.206)],[.1,new Ee(.225,.036,.388)],[.2,new Ee(.373,.074,.432)],[.3,new Ee(.522,.128,.42)],[.4,new Ee(.665,.182,.37)],[.5,new Ee(.797,.255,.287)],[.6,new Ee(.902,.364,.184)],[.7,new Ee(.969,.516,.063)],[.8,new Ee(.988,.683,.072)],[.9,new Ee(.961,.859,.298)],[1,new Ee(.988,.998,.645)]],GRAYSCALE:[[0,new Ee(0,0,0)],[1,new Ee(1,1,1)]],TURBO:[[0,new Ee(.18995,.07176,.23217)],[.07,new Ee(.25107,.25237,.63374)],[.13,new Ee(.27628,.42118,.89123)],[.2,new Ee(.25862,.57958,.99876)],[.27,new Ee(.15844,.73551,.92305)],[.33,new Ee(.09267,.86554,.7623)],[.4,new Ee(.19659,.94901,.59466)],[.47,new Ee(.42778,.99419,.38575)],[.53,new Ee(.64362,.98999,.23356)],[.6,new Ee(.80473,.92452,.20459)],[.67,new Ee(.93301,.81236,.22667)],[.73,new Ee(.99314,.67408,.20348)],[.8,new Ee(.9836,.49291,.12849)],[.87,new Ee(.92105,.31489,.05475)],[.93,new Ee(.81608,.18462,.01809)],[1,new Ee(.66449,.08436,.00424)]],RAINBOW:[[0,new Ee(.278,0,.714)],[1/6,new Ee(0,0,1)],[2/6,new Ee(0,1,1)],[3/6,new Ee(0,1,0)],[4/6,new Ee(1,1,0)],[5/6,new Ee(1,.64,0)],[1,new Ee(1,0,0)]],CONTOUR:[[0,new Ee(0,0,0)],[.03,new Ee(0,0,0)],[.04,new Ee(1,1,1)],[1,new Ee(1,1,1)]]},Ti={};Ti["pointcloud.vs"]=`
precision highp float;
precision highp int;

#define max_clip_polygons 8
#define PI 3.141592653589793

attribute vec3 position;
attribute vec3 color;
attribute float intensity;
attribute float classification;
attribute float returnNumber;
attribute float numberOfReturns;
attribute float pointSourceID;
attribute vec4 indices;
attribute float spacing;
attribute float gpsTime;
attribute vec3 normal;
attribute float aExtra;

uniform mat4 modelMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat4 uViewInv;

uniform float uScreenWidth;
uniform float uScreenHeight;
uniform float fov;
uniform float near;
uniform float far;

uniform bool uDebug;

uniform bool uUseOrthographicCamera;
uniform float uOrthoWidth;
uniform float uOrthoHeight;

#define CLIPTASK_NONE 0
#define CLIPTASK_HIGHLIGHT 1
#define CLIPTASK_SHOW_INSIDE 2
#define CLIPTASK_SHOW_OUTSIDE 3

#define CLIPMETHOD_INSIDE_ANY 0
#define CLIPMETHOD_INSIDE_ALL 1

uniform int clipTask;
uniform int clipMethod;
#if defined(num_clipboxes) && num_clipboxes > 0
	uniform mat4 clipBoxes[num_clipboxes];
#endif

#if defined(num_clipspheres) && num_clipspheres > 0
	uniform mat4 uClipSpheres[num_clipspheres];
#endif

#if defined(num_clippolygons) && num_clippolygons > 0
	uniform int uClipPolygonVCount[num_clippolygons];
	uniform vec3 uClipPolygonVertices[num_clippolygons * 8];
	uniform mat4 uClipPolygonWVP[num_clippolygons];
#endif


uniform float size;
uniform float minSize;
uniform float maxSize;

uniform float uPCIndex;
uniform float uOctreeSpacing;
uniform float uNodeSpacing;
uniform float uOctreeSize;
uniform vec3 uBBSize;
uniform float uLevel;
uniform float uVNStart;
uniform bool uIsLeafNode;

uniform vec3 uColor;
uniform float uOpacity;

uniform vec2 elevationRange;
uniform vec2 intensityRange;

uniform vec2 uFilterReturnNumberRange;
uniform vec2 uFilterNumberOfReturnsRange;
uniform vec2 uFilterPointSourceIDClipRange;
uniform vec2 uFilterGPSTimeClipRange;
uniform float uGpsScale;
uniform float uGpsOffset;

uniform vec2 uNormalizedGpsBufferRange;

uniform vec3 uIntensity_gbc;
uniform vec3 uRGB_gbc;
uniform vec3 uExtra_gbc;

uniform float uTransition;
uniform float wRGB;
uniform float wIntensity;
uniform float wElevation;
uniform float wClassification;
uniform float wReturnNumber;
uniform float wSourceID;

uniform vec2 uExtraNormalizedRange;
uniform vec2 uExtraRange;
uniform float uExtraScale;
uniform float uExtraOffset;

uniform vec3 uShadowColor;

uniform sampler2D visibleNodes;
uniform sampler2D gradient;
uniform sampler2D classificationLUT;

#if defined(color_type_matcap)
uniform sampler2D matcapTextureUniform;
#endif
uniform bool backfaceCulling;

#if defined(num_shadowmaps) && num_shadowmaps > 0
uniform sampler2D uShadowMap[num_shadowmaps];
uniform mat4 uShadowWorldView[num_shadowmaps];
uniform mat4 uShadowProj[num_shadowmaps];
#endif

varying vec3	vColor;
varying float	vLogDepth;
varying vec3	vViewPosition;
varying float 	vRadius;
varying float 	vPointSize;
varying vec3 	vPosition;//dyj\u65B0\u589E


float round(float number){
	return floor(number + 0.5);
}

// 
//    ###    ########     ###    ########  ######## #### ##     ## ########     ######  #### ######## ########  ######  
//   ## ##   ##     ##   ## ##   ##     ##    ##     ##  ##     ## ##          ##    ##  ##       ##  ##       ##    ## 
//  ##   ##  ##     ##  ##   ##  ##     ##    ##     ##  ##     ## ##          ##        ##      ##   ##       ##       
// ##     ## ##     ## ##     ## ########     ##     ##  ##     ## ######       ######   ##     ##    ######    ######  
// ######### ##     ## ######### ##           ##     ##   ##   ##  ##                ##  ##    ##     ##             ## 
// ##     ## ##     ## ##     ## ##           ##     ##    ## ##   ##          ##    ##  ##   ##      ##       ##    ## 
// ##     ## ########  ##     ## ##           ##    ####    ###    ########     ######  #### ######## ########  ######  
// 																			


// ---------------------
// OCTREE
// ---------------------

#if (defined(adaptive_point_size) || defined(color_type_level_of_detail)) && defined(tree_type_octree)
/**
 * number of 1-bits up to inclusive index position\uFF0Cnumber is treated as if it were an integer in the range 0-255
 */
int numberOfOnes(int number, int index){
	int numOnes = 0;
	int tmp = 128;
	for(int i = 7; i >= 0; i--){
		if(number >= tmp){
			number = number - tmp;

			if(i <= index){
				numOnes++;
			}
		}
		tmp = tmp / 2;
	}
	return numOnes;
}

/**
 * checks whether the bit at index is 1\uFF0Cnumber is treated as if it were an integer in the range 0-255
 */
bool isBitSet(int number, int index){
	// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0
	int powi = 1;
	if(index == 0){
		powi = 1;
	}else if(index == 1){
		powi = 2;
	}else if(index == 2){
		powi = 4;
	}else if(index == 3){
		powi = 8;
	}else if(index == 4){
		powi = 16;
	}else if(index == 5){
		powi = 32;
	}else if(index == 6){
		powi = 64;
	}else if(index == 7){
		powi = 128;
	}else{
		return false;
	}
	int ndp = number / powi;
	return mod(float(ndp), 2.0) != 0.0;
}

/**
 * find the LOD at the point position
 */
float getLOD(){
	
	vec3 offset = vec3(0.0, 0.0, 0.0);
	int iOffset = int(uVNStart);
	float depth = uLevel;
	for(float i = 0.0; i <= 30.0; i++){
		float nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);
		vec3 index3d = (position-offset) / nodeSizeAtLevel;
		index3d = floor(index3d + 0.5);
		int index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));
		vec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));
		int mask = int(round(value.r * 255.0));
		if(isBitSet(mask, index)){
			// there are more visible child nodes at this position
			int advanceG = int(round(value.g * 255.0)) * 256;
			int advanceB = int(round(value.b * 255.0));
			int advanceChild = numberOfOnes(mask, index - 1);
			int advance = advanceG + advanceB + advanceChild;
			iOffset = iOffset + advance;
			depth++;
		}else{
			// no more visible child nodes at this position
			//return value.a * 255.0;
			float lodOffset = (255.0 * value.a) / 10.0 - 10.0;
			return depth  + lodOffset;
		}
		offset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;
	}
	return depth;
}

float getSpacing(){
	vec3 offset = vec3(0.0, 0.0, 0.0);
	int iOffset = int(uVNStart);
	float depth = uLevel;
	float spacing = uNodeSpacing;
	for(float i = 0.0; i <= 30.0; i++){
		float nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);
		
		vec3 index3d = (position-offset) / nodeSizeAtLevel;
		index3d = floor(index3d + 0.5);
		int index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));
		
		vec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));
		int mask = int(round(value.r * 255.0));
		float spacingFactor = value.a;

		if(i > 0.0){
			spacing = spacing / (255.0 * spacingFactor);
		}

		if(isBitSet(mask, index)){
			// there are more visible child nodes at this position
			int advanceG = int(round(value.g * 255.0)) * 256;
			int advanceB = int(round(value.b * 255.0));
			int advanceChild = numberOfOnes(mask, index - 1);
			int advance = advanceG + advanceB + advanceChild;

			iOffset = iOffset + advance;
			
			depth++;
		}else{
			// no more visible child nodes at this position
			return spacing;
		}
		
		offset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;
	}
		
	return spacing;
}

float getPointSizeAttenuation(){
	return pow(2.0, getLOD());
}

#endif


// ---------------------
// KD-TREE
// ---------------------

#if (defined(adaptive_point_size) || defined(color_type_level_of_detail)) && defined(tree_type_kdtree)

float getLOD(){
	vec3 offset = vec3(0.0, 0.0, 0.0);
	float iOffset = 0.0;
	float depth = 0.0;
		
		
	vec3 size = uBBSize;	
	vec3 pos = position;
		
	for(float i = 0.0; i <= 1000.0; i++){
		
		vec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));
		
		int children = int(value.r * 255.0);
		float next = value.g * 255.0;
		int split = int(value.b * 255.0);
		
		if(next == 0.0){
		 	return depth;
		}
		
		vec3 splitv = vec3(0.0, 0.0, 0.0);
		if(split == 1){
			splitv.x = 1.0;
		}else if(split == 2){
		 	splitv.y = 1.0;
		}else if(split == 4){
		 	splitv.z = 1.0;
		}
		
		iOffset = iOffset + next;
		
		float factor = length(pos * splitv / size);
		if(factor < 0.5){
			// left
		if(children == 0 || children == 2){
				return depth;
			}
		}else{
			// right
			pos = pos - size * splitv * 0.5;
			if(children == 0 || children == 1){
				return depth;
			}
			if(children == 3){
				iOffset = iOffset + 1.0;
			}
		}
		size = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);
		
		depth++;
	}
		
		
	return depth;	
}

float getPointSizeAttenuation(){
	return 0.5 * pow(1.3, getLOD());
}

#endif



// 
//    ###    ######## ######## ########  #### ########  ##     ## ######## ########  ######  
//   ## ##      ##       ##    ##     ##  ##  ##     ## ##     ##    ##    ##       ##    ## 
//  ##   ##     ##       ##    ##     ##  ##  ##     ## ##     ##    ##    ##       ##       
// ##     ##    ##       ##    ########   ##  ########  ##     ##    ##    ######    ######  
// #########    ##       ##    ##   ##    ##  ##     ## ##     ##    ##    ##             ## 
// ##     ##    ##       ##    ##    ##   ##  ##     ## ##     ##    ##    ##       ##    ## 
// ##     ##    ##       ##    ##     ## #### ########   #######     ##    ########  ######                                                                               
// 



// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/
float getContrastFactor(float contrast){
	return (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);
}

vec3 getRGB(){
	vec3 rgb = color;
	
	rgb = pow(rgb, vec3(uRGB_gbc.x));
	rgb = rgb + uRGB_gbc.y;
	rgb = (rgb - 0.5) * getContrastFactor(uRGB_gbc.z) + 0.5;
	rgb = clamp(rgb, 0.0, 1.0);

	return rgb;
}

float getIntensity(){
	float w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);
	w = pow(w, uIntensity_gbc.x);
	w = w + uIntensity_gbc.y;
	w = (w - 0.5) * getContrastFactor(uIntensity_gbc.z) + 0.5;
	w = clamp(w, 0.0, 1.0);

	return w;
}

vec3 getGpsTime(){

	float w = (gpsTime + uGpsOffset) * uGpsScale;


	vec3 c = texture2D(gradient, vec2(w, 1.0 - w)).rgb;


	// vec2 r = uNormalizedGpsBufferRange;
	// float w = gpsTime * (r.y - r.x) + r.x;
	// w = clamp(w, 0.0, 1.0);
	// vec3 c = texture2D(gradient, vec2(w,1.0-w)).rgb;
	
	return c;
}

vec3 getElevation(){
	vec4 world = modelMatrix * vec4( position, 1.0 );
	float w = (world.z - elevationRange.x) / (elevationRange.y - elevationRange.x);
	vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;
	
	return cElevation;
}

vec4 getClassification(){
	vec2 uv = vec2(classification / 255.0, 0.5);
	vec4 classColor = texture2D(classificationLUT, uv);
	
	return classColor;
}

vec3 getReturns(){

	// 0b 00_000_111
	float rn = mod(returnNumber, 8.0);
	// 0b 00_111_000
	float nr = mod(returnNumber / 8.0, 8.0);

	if(nr <= 1.0){
		return vec3(1.0, 0.0, 0.0);
	}else{
		return vec3(0.0, 1.0, 0.0);
	}
}

vec3 getReturnNumber(){
	if(numberOfReturns == 1.0){
		return vec3(1.0, 1.0, 0.0);
	}else{
		if(returnNumber == 1.0){
			return vec3(1.0, 0.0, 0.0);
		}else if(returnNumber == numberOfReturns){
			return vec3(0.0, 0.0, 1.0);
		}else{
			return vec3(0.0, 1.0, 0.0);
		}
	}
}

vec3 getNumberOfReturns(){
	float value = numberOfReturns;

	float w = value / 6.0;

	vec3 color = texture2D(gradient, vec2(w, 1.0 - w)).rgb;

	return color;
}

vec3 getSourceID(){
	float w = mod(pointSourceID, 10.0) / 10.0;
	return texture2D(gradient, vec2(w,1.0 - w)).rgb;
}

vec3 getCompositeColor(){
	vec3 c;
	float w;

	c += wRGB * getRGB();
	w += wRGB;
	
	c += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);
	w += wIntensity;
	
	c += wElevation * getElevation();
	w += wElevation;
	
	c += wReturnNumber * getReturnNumber();
	w += wReturnNumber;
	
	c += wSourceID * getSourceID();
	w += wSourceID;
	
	vec4 cl = wClassification * getClassification();
	c += cl.a * cl.rgb;
	w += wClassification * cl.a;

	c = c / w;
	
	if(w == 0.0){
		//c = color;
		gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
	}
	
	return c;
}


vec3 getNormal(){
	//vec3 n_hsv = vec3( modelMatrix * vec4( normal, 0.0 )) * 0.5 + 0.5; // (n_world.xyz + vec3(1.,1.,1.)) / 2.;
	vec3 n_view = normalize( vec3(modelViewMatrix * vec4( normal, 0.0 )) );
	return n_view;
}
bool applyBackfaceCulling() {
	// Black not facing vertices / Backface culling
	vec3 e = normalize(vec3(modelViewMatrix * vec4( position, 1. )));
	vec3 n = getNormal(); // normalize( vec3(modelViewMatrix * vec4( normal, 0.0 )) );

	if((uUseOrthographicCamera && n.z <= 0.) || (!uUseOrthographicCamera && dot( n, e ) >= 0.)) { 
		return true;
	} else {
		return false;
	}
}

#if defined(color_type_matcap)
// Matcap Material
vec3 getMatcap(){ 
	vec3 eye = normalize( vec3( modelViewMatrix * vec4( position, 1. ) ) ); 
	if(uUseOrthographicCamera) { 
		eye = vec3(0., 0., -1.);
	}
	vec3 r_en = reflect( eye, getNormal() ); // or r_en = e - 2. * dot( n, e ) * n;
	float m = 2. * sqrt(pow( r_en.x, 2. ) + pow( r_en.y, 2. ) + pow( r_en.z + 1., 2. ));
	vec2 vN = r_en.xy / m + .5;
	return texture2D(matcapTextureUniform, vN).rgb; 
}
#endif

vec3 getExtra(){

	float w = (aExtra + uExtraOffset) * uExtraScale;
	w = clamp(w, 0.0, 1.0);
	vec3 color = texture2D(gradient, vec2(w,1.0-w)).rgb;
	return color;
}

vec3 getColor(){
	vec3 color;
	
	#ifdef color_type_rgba
		color = getRGB();
	#elif defined color_type_height || defined color_type_elevation
		color = getElevation();
	#elif defined color_type_rgb_height
		vec3 cHeight = getElevation();
		color = (1.0 - uTransition) * getRGB() + uTransition * cHeight;
	#elif defined color_type_depth
		float linearDepth = gl_Position.w;
		float expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;
		color = vec3(linearDepth, expDepth, 0.0);
		//color = vec3(1.0, 0.5, 0.3);
	#elif defined color_type_intensity
		float w = getIntensity();
		color = vec3(w, w, w);
	#elif defined color_type_gps_time
		color = getGpsTime();
	#elif defined color_type_intensity_gradient
		float w = getIntensity();
		color = texture2D(gradient, vec2(w,1.0-w)).rgb;
	#elif defined color_type_color
		color = uColor;
	#elif defined color_type_level_of_detail
		float depth = getLOD();
		float w = depth / 10.0;
		color = texture2D(gradient, vec2(w,1.0-w)).rgb;
	#elif defined color_type_indices
		color = indices.rgb;
	#elif defined color_type_classification
		vec4 cl = getClassification(); 
		color = cl.rgb;
	#elif defined color_type_return_number
		color = getReturnNumber();
	#elif defined color_type_returns
		color = getReturns();
	#elif defined color_type_number_of_returns
		color = getNumberOfReturns();
	#elif defined color_type_source_id
		color = getSourceID();
	#elif defined color_type_point_source_id
		color = getSourceID();
	#elif defined color_type_normal
		color = (modelMatrix * vec4(normal, 0.0)).xyz;
	#elif defined color_type_phong
		color = color;
	#elif defined color_type_composite
		color = getCompositeColor();
	#elif defined color_type_matcap
		color = getMatcap();
	#else 
		color = getExtra();
	#endif
	
	if (backfaceCulling && applyBackfaceCulling()) {
		color = vec3(0.);
	}

	return color;
}

float getPointSize(){
	float pointSize = 1.0;
	
	float slope = tan(fov / 2.0);
	float projFactor = -0.5 * uScreenHeight / (slope * vViewPosition.z);

	float scale = length(
		modelViewMatrix * vec4(0, 0, 0, 1) - 
		modelViewMatrix * vec4(uOctreeSpacing, 0, 0, 1)
	) / uOctreeSpacing;
	projFactor = projFactor * scale;
	
	float r = uOctreeSpacing * 1.7;
	vRadius = r;
	#if defined fixed_point_size
		pointSize = size;
	#elif defined attenuated_point_size
		if(uUseOrthographicCamera){
			pointSize = size;
		}else{
			pointSize = size * spacing * projFactor;
			//pointSize = pointSize * projFactor;
		}
	#elif defined adaptive_point_size
		if(uUseOrthographicCamera) {
			float worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();
			pointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;
		} else {
			float worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();
			pointSize = worldSpaceSize * projFactor;
		}
	#endif

	pointSize = max(minSize, pointSize);
	pointSize = min(maxSize, pointSize);
	
	vRadius = pointSize / projFactor;

	return pointSize;
}

#if defined(num_clippolygons) && num_clippolygons > 0
bool pointInClipPolygon(vec3 point, int polyIdx) {

	mat4 wvp = uClipPolygonWVP[polyIdx];
	//vec4 screenClipPos = uClipPolygonVP[polyIdx] * modelMatrix * vec4(point, 1.0);
	//screenClipPos.xy = screenClipPos.xy / screenClipPos.w * 0.5 + 0.5;

	vec4 pointNDC = wvp * vec4(point, 1.0);
	pointNDC.xy = pointNDC.xy / pointNDC.w;

	int j = uClipPolygonVCount[polyIdx] - 1;
	bool c = false;
	for(int i = 0; i < 8; i++) {
		if(i == uClipPolygonVCount[polyIdx]) {
			break;
		}

		vec3 verti = uClipPolygonVertices[polyIdx * 8 + i];
		vec3 vertj = uClipPolygonVertices[polyIdx * 8 + j];

		if( ((verti.y > pointNDC.y) != (vertj.y > pointNDC.y)) && 
			(pointNDC.x < (vertj.x-verti.x) * (pointNDC.y-verti.y) / (vertj.y-verti.y) + verti.x) ) {
			c = !c;
		}
		j = i;
	}

	return c;
}
#endif

void doClipping(){

	{
		vec4 cl = getClassification(); 
		if(cl.a == 0.0){
			gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
			
			return;
		}
	}

	#if defined(clip_return_number_enabled)
	{ // return number filter
		vec2 range = uFilterReturnNumberRange;
		if(returnNumber < range.x || returnNumber > range.y){
			gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
			
			return;
		}
	}
	#endif

	#if defined(clip_number_of_returns_enabled)
	{ // number of return filter
		vec2 range = uFilterNumberOfReturnsRange;
		if(numberOfReturns < range.x || numberOfReturns > range.y){
			gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
			
			return;
		}
	}
	#endif

	#if defined(clip_gps_enabled)
	{ // GPS time filter
		float time = (gpsTime + uGpsOffset) * uGpsScale;
		vec2 range = uFilterGPSTimeClipRange;

		if(time < range.x || time > range.y){
			gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
			
			return;
		}
	}
	#endif

	#if defined(clip_point_source_id_enabled)
	{ // point source id filter
		vec2 range = uFilterPointSourceIDClipRange;
		if(pointSourceID < range.x || pointSourceID > range.y){
			gl_Position = vec4(100.0, 100.0, 100.0, 0.0);
			
			return;
		}
	}
	#endif

	int clipVolumesCount = 0;
	int insideCount = 0;

	#if defined(num_clipboxes) && num_clipboxes > 0
		for(int i = 0; i < num_clipboxes; i++){
			vec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );
			bool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;
			inside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;
			inside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;

			insideCount = insideCount + (inside ? 1 : 0);
			clipVolumesCount++;
		}	
	#endif

	#if defined(num_clippolygons) && num_clippolygons > 0
		for(int i = 0; i < num_clippolygons; i++) {
			bool inside = pointInClipPolygon(position, i);

			insideCount = insideCount + (inside ? 1 : 0);
			clipVolumesCount++;
		}
	#endif

	bool insideAny = insideCount > 0;
	bool insideAll = (clipVolumesCount > 0) && (clipVolumesCount == insideCount);

	if(clipMethod == CLIPMETHOD_INSIDE_ANY){
		if(insideAny && clipTask == CLIPTASK_HIGHLIGHT){
			vColor.r += 0.5;
		}else if(!insideAny && clipTask == CLIPTASK_SHOW_INSIDE){
			gl_Position = vec4(100.0, 100.0, 100.0, 1.0);
		}else if(insideAny && clipTask == CLIPTASK_SHOW_OUTSIDE){
			gl_Position = vec4(100.0, 100.0, 100.0, 1.0);
		}
	}else if(clipMethod == CLIPMETHOD_INSIDE_ALL){
		if(insideAll && clipTask == CLIPTASK_HIGHLIGHT){
			vColor.r += 0.5;
		}else if(!insideAll && clipTask == CLIPTASK_SHOW_INSIDE){
			gl_Position = vec4(100.0, 100.0, 100.0, 1.0);
		}else if(insideAll && clipTask == CLIPTASK_SHOW_OUTSIDE){
			gl_Position = vec4(100.0, 100.0, 100.0, 1.0);
		}
	}
}



// 
// ##     ##    ###    #### ##    ## 
// ###   ###   ## ##    ##  ###   ## 
// #### ####  ##   ##   ##  ####  ## 
// ## ### ## ##     ##  ##  ## ## ## 
// ##     ## #########  ##  ##  #### 
// ##     ## ##     ##  ##  ##   ### 
// ##     ## ##     ## #### ##    ## 
//

void main() {
	vPosition = position;//dyj\u65B0\u589E
	vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
	vViewPosition = mvPosition.xyz;
	gl_Position = projectionMatrix * mvPosition;
	vLogDepth = log2(-mvPosition.z);

	// POINT SIZE
	float pointSize = getPointSize();
	gl_PointSize = pointSize;
	vPointSize = pointSize;

	// COLOR
	vColor = getColor();

	#if defined hq_depth_pass
		float originalDepth = gl_Position.w;
		float adjustedDepth = originalDepth + 2.0 * vRadius;
		float adjust = adjustedDepth / originalDepth;

		mvPosition.xyz = mvPosition.xyz * adjust;
		gl_Position = projectionMatrix * mvPosition;
	#endif


	// CLIPPING
	doClipping();

	#if defined(num_clipspheres) && num_clipspheres > 0
		for(int i = 0; i < num_clipspheres; i++){
			vec4 sphereLocal = uClipSpheres[i] * mvPosition;

			float distance = length(sphereLocal.xyz);

			if(distance < 1.0){
				float w = distance;
				vec3 cGradient = texture2D(gradient, vec2(w, 1.0 - w)).rgb;
				
				vColor = cGradient;
				//vColor = cGradient * 0.7 + vColor * 0.3;
			}
		}
	#endif

	#if defined(num_shadowmaps) && num_shadowmaps > 0

		const float sm_near = 0.1;
		const float sm_far = 10000.0;

		for(int i = 0; i < num_shadowmaps; i++){
			vec3 viewPos = (uShadowWorldView[i] * vec4(position, 1.0)).xyz;
			float distanceToLight = abs(viewPos.z);
			
			vec4 projPos = uShadowProj[i] * uShadowWorldView[i] * vec4(position, 1);
			vec3 nc = projPos.xyz / projPos.w;
			
			float u = nc.x * 0.5 + 0.5;
			float v = nc.y * 0.5 + 0.5;

			vec2 sampleStep = vec2(1.0 / (2.0*1024.0), 1.0 / (2.0*1024.0)) * 1.5;
			vec2 sampleLocations[9];
			sampleLocations[0] = vec2(0.0, 0.0);
			sampleLocations[1] = sampleStep;
			sampleLocations[2] = -sampleStep;
			sampleLocations[3] = vec2(sampleStep.x, -sampleStep.y);
			sampleLocations[4] = vec2(-sampleStep.x, sampleStep.y);

			sampleLocations[5] = vec2(0.0, sampleStep.y);
			sampleLocations[6] = vec2(0.0, -sampleStep.y);
			sampleLocations[7] = vec2(sampleStep.x, 0.0);
			sampleLocations[8] = vec2(-sampleStep.x, 0.0);

			float visibleSamples = 0.0;
			float numSamples = 0.0;

			float bias = vRadius * 2.0;

			for(int j = 0; j < 9; j++){
				vec4 depthMapValue = texture2D(uShadowMap[i], vec2(u, v) + sampleLocations[j]);

				float linearDepthFromSM = depthMapValue.x + bias;
				float linearDepthFromViewer = distanceToLight;

				if(linearDepthFromSM > linearDepthFromViewer){
					visibleSamples += 1.0;
				}

				numSamples += 1.0;
			}

			float visibility = visibleSamples / numSamples;

			if(u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0 || nc.x < -1.0 || nc.x > 1.0 || nc.y < -1.0 || nc.y > 1.0 || nc.z < -1.0 || nc.z > 1.0){
				//vColor = vec3(0.0, 0.0, 0.2);
			}else{
				//vColor = vec3(1.0, 1.0, 1.0) * visibility + vec3(1.0, 1.0, 1.0) * vec3(0.5, 0.0, 0.0) * (1.0 - visibility);
				vColor = vColor * visibility + vColor * uShadowColor * (1.0 - visibility);
			}


		}

	#endif
}
`,Ti["pointcloud.fs"]=`
#if defined paraboloid_point_shape
	#extension GL_EXT_frag_depth : enable
#endif

precision highp float;
precision highp int;

uniform mat4 viewMatrix;
uniform mat4 uViewInv;
uniform mat4 uProjInv;
uniform vec3 cameraPosition;


uniform mat4 projectionMatrix;
uniform float uOpacity;

uniform float blendHardness;
uniform float blendDepthSupplement;
uniform float fov;
uniform float uSpacing;
uniform float near;
uniform float far;
uniform float uPCIndex;
uniform float uScreenWidth;
uniform float uScreenHeight;

varying vec3	vColor;
varying float	vLogDepth;
varying vec3	vViewPosition;
varying float	vRadius;
varying float 	vPointSize;
varying vec3 	vPosition;//dyj\u65B0\u589E


float specularStrength = 1.0;

void main() {

	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }
	// if (vViewPosition.z < 1.0 || vViewPosition.z > 10.0) {
	// 	discard;
	// }

	

	// gl_FragColor = vec4(vColor, 1.0);

	vec3 color = vColor;
	float depth = gl_FragCoord.z;

	#if defined(circle_point_shape) || defined(paraboloid_point_shape) 
		float u = 2.0 * gl_PointCoord.x - 1.0;
		float v = 2.0 * gl_PointCoord.y - 1.0;
	#endif
	
	#if defined(circle_point_shape) 
		float cc = u*u + v*v;
		if(cc > 1.0){
			discard;
		}
	#endif
		
	#if defined color_type_indices
		gl_FragColor = vec4(color, uPCIndex / 255.0);
	#else
		gl_FragColor = vec4(color, uOpacity);
	#endif

	#if defined paraboloid_point_shape
		float wi = 0.0 - ( u*u + v*v);
		vec4 pos = vec4(vViewPosition, 1.0);
		pos.z += wi * vRadius;
		float linearDepth = -pos.z;
		pos = projectionMatrix * pos;
		pos = pos / pos.w;
		float expDepth = pos.z;
		depth = (pos.z + 1.0) / 2.0;
		gl_FragDepthEXT = depth;
		
		#if defined(color_type_depth)
			color.r = linearDepth;
			color.g = expDepth;
		#endif
		
		#if defined(use_edl)
			gl_FragColor.a = log2(linearDepth);
		#endif
		
	#else
		#if defined(use_edl)
			gl_FragColor.a = vLogDepth;
		#endif
	#endif

	#if defined(weighted_splats)
		float distance = 2.0 * length(gl_PointCoord.xy - 0.5);
		float weight = max(0.0, 1.0 - distance);
		weight = pow(weight, 1.5);

		gl_FragColor.a = weight;
		gl_FragColor.xyz = gl_FragColor.xyz * weight;
	#endif

	//gl_FragColor = vec4(0.0, 0.7, 0.0, 1.0);
	
}


`,Ti["pointcloud_sm.vs"]=`
precision mediump float;
precision mediump int;

attribute vec3 position;
attribute vec3 color;

uniform mat4 modelMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

uniform float uScreenWidth;
uniform float uScreenHeight;
uniform float near;
uniform float far;

uniform float uSpacing;
uniform float uOctreeSize;
uniform float uLevel;
uniform float uVNStart;

uniform sampler2D visibleNodes;

varying float vLinearDepth;
varying vec3 vColor;
varying vec3 	vPosition;//dyj\u65B0\u589E
#define PI 3.141592653589793



// ---------------------
// OCTREE
// ---------------------

#if defined(adaptive_point_size)
/**
 * number of 1-bits up to inclusive index position
 * number is treated as if it were an integer in the range 0-255
 *
 */
float numberOfOnes(float number, float index){
	float tmp = mod(number, pow(2.0, index + 1.0));
	float numOnes = 0.0;
	for(float i = 0.0; i < 8.0; i++){
		if(mod(tmp, 2.0) != 0.0){
			numOnes++;
		}
		tmp = floor(tmp / 2.0);
	}
	return numOnes;
}


/**
 * checks whether the bit at index is 1
 * number is treated as if it were an integer in the range 0-255
 *
 */
bool isBitSet(float number, float index){
	return mod(floor(number / pow(2.0, index)), 2.0) != 0.0;
}


/**
 * find the LOD at the point position
 */
float getLOD(){
	
	vec3 offset = vec3(0.0, 0.0, 0.0);
	float iOffset = uVNStart;
	float depth = uLevel;
	for(float i = 0.0; i <= 30.0; i++){
		float nodeSizeAtLevel = uOctreeSize  / pow(2.0, i + uLevel + 0.0);
		
		vec3 index3d = (position-offset) / nodeSizeAtLevel;
		index3d = floor(index3d + 0.5);
		float index = 4.0 * index3d.x + 2.0 * index3d.y + index3d.z;
		
		vec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));
		float mask = value.r * 255.0;
		if(isBitSet(mask, index)){
			// there are more visible child nodes at this position
			iOffset = iOffset + value.g * 255.0 * 256.0 + value.b * 255.0 + numberOfOnes(mask, index - 1.0);
			depth++;
		}else{
			// no more visible child nodes at this position
			return depth;
		}
		
		offset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;
	}
		
	return depth;
}

#endif

float getPointSize(){
	float pointSize = 1.0;
	
	float slope = tan(fov / 2.0);
	float projFactor =  -0.5 * uScreenHeight / (slope * vViewPosition.z);
	
	float r = uOctreeSpacing * 1.5;
	vRadius = r;
	#if defined fixed_point_size
		pointSize = size;
	#elif defined attenuated_point_size
		if(uUseOrthographicCamera){
			pointSize = size;			
		}else{
			pointSize = pointSize * projFactor;
		}
	#elif defined adaptive_point_size
		if(uUseOrthographicCamera) {
			float worldSpaceSize = 1.5 * size * r / getPointSizeAttenuation();
			pointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;
		} else {
			float worldSpaceSize = 1.5 * size * r / getPointSizeAttenuation();
			pointSize = worldSpaceSize * projFactor;
		}
	#endif

	pointSize = max(minSize, pointSize);
	pointSize = min(maxSize, pointSize);
	
	vRadius = pointSize / projFactor;

	return pointSize;
}


void main() {
	vPosition = position;//dyj\u65B0\u589E
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	vLinearDepth = gl_Position.w;

	float pointSize = getPointSize();
	gl_PointSize = pointSize;

}
`,Ti["pointcloud_sm.fs"]=`
precision mediump float;
precision mediump int;

varying vec3 vColor;
varying float vLinearDepth;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }

	//gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
	//gl_FragColor = vec4(vColor, 1.0);
	//gl_FragColor = vec4(vLinearDepth, pow(vLinearDepth, 2.0), 0.0, 1.0);
	gl_FragColor = vec4(vLinearDepth, vLinearDepth / 30.0, vLinearDepth / 30.0, 1.0);
	
}


`,Ti["normalize.vs"]=`
precision mediump float;
precision mediump int;

attribute vec3 position;
attribute vec2 uv;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	vPosition = position;//dyj\u65B0\u589E
	vUv = uv;
	gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
}`,Ti["normalize.fs"]=`
#extension GL_EXT_frag_depth : enable

precision mediump float;
precision mediump int;

uniform sampler2D uWeightMap;
uniform sampler2D uDepthMap;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }
	float depth = texture2D(uDepthMap, vUv).r;
	
	if(depth >= 1.0){
		discard;
	}

	gl_FragColor = vec4(depth, 1.0, 0.0, 1.0);

	vec4 color = texture2D(uWeightMap, vUv); 
	color = color / color.w;
	
	gl_FragColor = vec4(color.xyz, 1.0); 
	
	gl_FragDepthEXT = depth;


}`,Ti["normalize_and_edl.fs"]=`
#extension GL_EXT_frag_depth : enable

// 
// adapted from the EDL shader code from Christian Boucheny in cloud compare:
// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL
//

precision mediump float;
precision mediump int;

uniform sampler2D uWeightMap;
uniform sampler2D uEDLMap;
uniform sampler2D uDepthMap;

uniform float screenWidth;
uniform float screenHeight;
uniform vec2 neighbours[NEIGHBOUR_COUNT];
uniform float edlStrength;
uniform float radius;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

float response(float depth){
	vec2 uvRadius = radius / vec2(screenWidth, screenHeight);
	
	float sum = 0.0;
	
	for(int i = 0; i < NEIGHBOUR_COUNT; i++){
		vec2 uvNeighbor = vUv + uvRadius * neighbours[i];
		
		float neighbourDepth = texture2D(uEDLMap, uvNeighbor).a;

		if(neighbourDepth != 0.0){
			if(depth == 0.0){
				sum += 100.0;
			}else{
				sum += max(0.0, depth - neighbourDepth);
			}
		}
	}
	
	return sum / float(NEIGHBOUR_COUNT);
}

void main() {
	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }

	float edlDepth = texture2D(uEDLMap, vUv).a;
	float res = response(edlDepth);
	float shade = exp(-res * 300.0 * edlStrength);

	float depth = texture2D(uDepthMap, vUv).r;
	if(depth >= 1.0 && res == 0.0){
		discard;
	}
	
	vec4 color = texture2D(uWeightMap, vUv); 
	color = color / color.w;
	color = color * shade;

	gl_FragColor = vec4(color.xyz, 1.0); 

	gl_FragDepthEXT = depth;
}`,Ti["edl.vs"]=`
precision mediump float;
precision mediump int;

attribute vec3 position;
attribute vec2 uv;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	vPosition = position;//dyj\u65B0\u589E
	vUv = uv;
	
	vec4 mvPosition = modelViewMatrix * vec4(position,1.0);

	gl_Position = projectionMatrix * mvPosition;
}`,Ti["edl.fs"]=`
#extension GL_EXT_frag_depth : enable

// 
// adapted from the EDL shader code from Christian Boucheny in cloud compare:
// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL
//

precision mediump float;
precision mediump int;

uniform float screenWidth;
uniform float screenHeight;
uniform vec2 neighbours[NEIGHBOUR_COUNT];
uniform float edlStrength;
uniform float radius;
uniform float opacity;

uniform float uNear;
uniform float uFar;

uniform mat4 uProj;

uniform sampler2D uEDLColor;
uniform sampler2D uEDLDepth;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

float response(float depth){
	vec2 uvRadius = radius / vec2(screenWidth, screenHeight);
	
	float sum = 0.0;
	
	for(int i = 0; i < NEIGHBOUR_COUNT; i++){
		vec2 uvNeighbor = vUv + uvRadius * neighbours[i];
		
		float neighbourDepth = texture2D(uEDLColor, uvNeighbor).a;
		neighbourDepth = (neighbourDepth == 1.0) ? 0.0 : neighbourDepth;

		if(neighbourDepth != 0.0){
			if(depth == 0.0){
				sum += 100.0;
			}else{
				sum += max(0.0, depth - neighbourDepth);
			}
		}
	}
	
	return sum / float(NEIGHBOUR_COUNT);
}

void main(){
	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }
	vec4 cEDL = texture2D(uEDLColor, vUv);
	
	float depth = cEDL.a;
	depth = (depth == 1.0) ? 0.0 : depth;
	float res = response(depth);
	float shade = exp(-res * 300.0 * edlStrength);

	gl_FragColor = vec4(cEDL.rgb * shade, opacity);

	{ // write regular hyperbolic depth values to depth buffer
		float dl = pow(2.0, depth);

		vec4 dp = uProj * vec4(0.0, 0.0, -dl, 1.0);
		float pz = dp.z / dp.w;
		float fragDepth = (pz + 1.0) / 2.0;

		gl_FragDepthEXT = fragDepth;
	}

	if(depth == 0.0){
		discard;
	}

}
`,Ti["blur.vs"]=`
varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	vPosition = position;//dyj\u65B0\u589E
	vUv = uv;

	gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);
}`,Ti["blur.fs"]=`
uniform mat4 projectionMatrix;

uniform float screenWidth;
uniform float screenHeight;
uniform float near;
uniform float far;

uniform sampler2D map;

varying vec2 vUv;
varying vec3 	vPosition;//dyj\u65B0\u589E

void main() {
	//dyj\u65B0\u589E
	// if (vPosition.z > 1.0) {
	// 	discard;
	// }

	float dx = 1.0 / screenWidth;
	float dy = 1.0 / screenHeight;

	vec3 color = vec3(0.0, 0.0, 0.0);
	color += texture2D(map, vUv + vec2(-dx, -dy)).rgb;
	color += texture2D(map, vUv + vec2(  0, -dy)).rgb;
	color += texture2D(map, vUv + vec2(+dx, -dy)).rgb;
	color += texture2D(map, vUv + vec2(-dx,   0)).rgb;
	color += texture2D(map, vUv + vec2(  0,   0)).rgb;
	color += texture2D(map, vUv + vec2(+dx,   0)).rgb;
	color += texture2D(map, vUv + vec2(-dx,  dy)).rgb;
	color += texture2D(map, vUv + vec2(  0,  dy)).rgb;
	color += texture2D(map, vUv + vec2(+dx,  dy)).rgb;

	color = color / 9.0;
	
	gl_FragColor = vec4(color, 1.0);
}`;const Ah={DEFAULT:{0:{visible:!0,name:"never classified",color:[.5,.5,.5,1]},1:{visible:!0,name:"unclassified",color:[.5,.5,.5,1]},2:{visible:!0,name:"ground",color:[.63,.32,.18,1]},3:{visible:!0,name:"low vegetation",color:[0,1,0,1]},4:{visible:!0,name:"medium vegetation",color:[0,.8,0,1]},5:{visible:!0,name:"high vegetation",color:[0,.6,0,1]},6:{visible:!0,name:"building",color:[1,.66,0,1]},7:{visible:!0,name:"low point(noise)",color:[1,0,1,1]},8:{visible:!0,name:"key-point",color:[1,0,0,1]},9:{visible:!0,name:"water",color:[0,0,1,1]},12:{visible:!0,name:"overlap",color:[1,1,0,1]},DEFAULT:{visible:!0,name:"default",color:[.3,.6,.6,.5]}}};Object.defineProperty(Ah,"RANDOM",{get:function(){let i={};for(let e=0;e<=255;e++)i[e]=new _t(Math.random(),Math.random(),Math.random());return i.DEFAULT=new _t(Math.random(),Math.random(),Math.random()),i}});class Hr extends Vs{constructor(e={}){super(),this.visibleNodesTexture=He.generateDataTexture(2048,1,new Ee(16777215)),this.visibleNodesTexture.minFilter=ei,this.visibleNodesTexture.magFilter=ei;let t=(a,l)=>a!==void 0?a:l,n=t(e.size,1),s=t(e.minSize,2),r=t(e.maxSize,50),o=t(e.treeType,tu.OCTREE);this._pointSizeType=Ws.FIXED,this._shape=Eo.SQUARE,this._useClipBox=!1,this.clipBoxes=[],this.clipPolygons=[],this._weighted=!1,this._gradient=Th.SPECTRAL,this.gradientTexture=Hr.generateGradientTexture(this._gradient),this._matcap="matcap.jpg",this.matcapTexture=Potree.PointCloudMaterial.generateMatcapTexture(this._matcap),this.lights=!1,this.fog=!1,this._treeType=o,this._useEDL=!1,this.defines=new Map,this.ranges=new Map,this._activeAttributeName=null,this._defaultIntensityRangeChanged=!1,this._defaultElevationRangeChanged=!1;{const[a,l]=[256,1];let c=new Uint8Array(a*4),u=new Gs(c,a,l,jt);u.magFilter=ei,u.needsUpdate=!0,this.classificationTexture=u}this.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},indices:{type:"fv",value:[]}},this.uniforms={level:{type:"f",value:0},vnStart:{type:"f",value:0},spacing:{type:"f",value:1},blendHardness:{type:"f",value:2},blendDepthSupplement:{type:"f",value:0},fov:{type:"f",value:1},screenWidth:{type:"f",value:1},screenHeight:{type:"f",value:1},near:{type:"f",value:.1},far:{type:"f",value:1},uColor:{type:"c",value:new Ee(16777215)},uOpacity:{type:"f",value:1},size:{type:"f",value:n},minSize:{type:"f",value:s},maxSize:{type:"f",value:r},octreeSize:{type:"f",value:0},bbSize:{type:"fv",value:[0,0,0]},elevationRange:{type:"2fv",value:[0,0]},clipBoxCount:{type:"f",value:0},clipPolygonCount:{type:"i",value:0},clipBoxes:{type:"Matrix4fv",value:[]},clipPolygons:{type:"3fv",value:[]},clipPolygonVCount:{type:"iv",value:[]},clipPolygonVP:{type:"Matrix4fv",value:[]},visibleNodes:{type:"t",value:this.visibleNodesTexture},pcIndex:{type:"f",value:0},gradient:{type:"t",value:this.gradientTexture},classificationLUT:{type:"t",value:this.classificationTexture},uHQDepthMap:{type:"t",value:null},toModel:{type:"Matrix4f",value:[]},diffuse:{type:"fv",value:[1,1,1]},transition:{type:"f",value:.5},intensityRange:{type:"fv",value:[1/0,-1/0]},intensity_gbc:{type:"fv",value:[1,0,0]},uRGB_gbc:{type:"fv",value:[1,0,0]},wRGB:{type:"f",value:1},wIntensity:{type:"f",value:0},wElevation:{type:"f",value:0},wClassification:{type:"f",value:0},wReturnNumber:{type:"f",value:0},wSourceID:{type:"f",value:0},useOrthographicCamera:{type:"b",value:!1},elevationGradientRepat:{type:"i",value:pr.CLAMP},clipTask:{type:"i",value:1},clipMethod:{type:"i",value:1},uShadowColor:{type:"3fv",value:[0,0,0]},uExtraScale:{type:"f",value:1},uExtraOffset:{type:"f",value:0},uExtraRange:{type:"2fv",value:[0,1]},uExtraGammaBrightContr:{type:"3fv",value:[1,0,0]},uFilterReturnNumberRange:{type:"fv",value:[0,7]},uFilterNumberOfReturnsRange:{type:"fv",value:[0,7]},uFilterGPSTimeClipRange:{type:"fv",value:[0,7]},uFilterPointSourceIDClipRange:{type:"fv",value:[0,65535]},matcapTextureUniform:{type:"t",value:this.matcapTexture},backfaceCulling:{type:"b",value:!1}},this.classification=Ah.DEFAULT,this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.defaultAttributeValues.indices=[0,0,0,0],this.vertexShader=Ti["pointcloud.vs"],this.fragmentShader=Ti["pointcloud.fs"],this.vertexColors=Zd,this.updateShaderSource()}setDefine(e,t){t!=null?this.defines.get(e)!==t&&(this.defines.set(e,t),this.updateShaderSource()):this.removeDefine(e)}removeDefine(e){this.defines.delete(e)}updateShaderSource(){let e=Ti["pointcloud.vs"],t=Ti["pointcloud.fs"],n=this.getDefines(),s=e.indexOf("#version "),r=t.indexOf("#version ");s>=0?e=e.replace(/(#version .*)/,`$1
${n}`):e=`${n}
${e}`,r>=0?t=t.replace(/(#version .*)/,`$1
${n}`):t=`${n}
${t}`,this.vertexShader=e,this.fragmentShader=t,this.opacity===1?(this.blending=cn,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=kn):this.opacity<1&&!this.useEDL&&(this.blending=Ht,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0,this.depthFunc=Lo),this.weighted&&(this.blending=Ht,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1),this.needsUpdate=!0}getDefines(){let e=[];if(this.pointSizeType===Ws.FIXED?e.push("#define fixed_point_size"):this.pointSizeType===Ws.ATTENUATED?e.push("#define attenuated_point_size"):this.pointSizeType===Ws.ADAPTIVE&&e.push("#define adaptive_point_size"),this.shape===Eo.SQUARE?e.push("#define square_point_shape"):this.shape===Eo.CIRCLE?e.push("#define circle_point_shape"):this.shape===Eo.PARABOLOID&&e.push("#define paraboloid_point_shape"),this._useEDL&&e.push("#define use_edl"),this.activeAttributeName){let t=this.activeAttributeName.replace(/[^a-zA-Z0-9]/g,"_");e.push(`#define color_type_${t}`)}this._treeType===tu.OCTREE?e.push("#define tree_type_octree"):this._treeType===tu.KDTREE&&e.push("#define tree_type_kdtree"),this.weighted&&e.push("#define weighted_splats");for(let[t,n]of this.defines)e.push(n);return e.join(`
`)}setClipBoxes(e){if(!e)return;let t=this.clipBoxes.length!==e.length&&(e.length===0||this.clipBoxes.length===0);this.uniforms.clipBoxCount.value=this.clipBoxes.length,this.clipBoxes=e,t&&this.updateShaderSource(),this.uniforms.clipBoxes.value=new Float32Array(this.clipBoxes.length*16);for(let n=0;n<this.clipBoxes.length;n++){let s=e[n];this.uniforms.clipBoxes.value.set(s.inverse.elements,16*n)}for(let n=0;n<this.uniforms.clipBoxes.value.length;n++)Number.isNaN(this.uniforms.clipBoxes.value[n])&&(this.uniforms.clipBoxes.value[n]=1/0)}setClipPolygons(e,t){if(!e)return;this.clipPolygons=e,this.clipPolygons.length!==e.length&&this.updateShaderSource()}get gradient(){return this._gradient}set gradient(e){this._gradient!==e&&(this._gradient=e,this.gradientTexture=Hr.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}get matcap(){return this._matcap}set matcap(e){this._matcap!==e&&(this._matcap=e,this.matcapTexture=Potree.PointCloudMaterial.generateMatcapTexture(this._matcap),this.uniforms.matcapTextureUniform.value=this.matcapTexture)}get useOrthographicCamera(){return this.uniforms.useOrthographicCamera.value}set useOrthographicCamera(e){this.uniforms.useOrthographicCamera.value!==e&&(this.uniforms.useOrthographicCamera.value=e)}get backfaceCulling(){return this.uniforms.backfaceCulling.value}set backfaceCulling(e){this.uniforms.backfaceCulling.value!==e&&(this.uniforms.backfaceCulling.value=e,this.dispatchEvent({type:"backface_changed",target:this}))}recomputeClassification(){const e=this.classification,t=this.classificationTexture.image.data;let n=256;const s=[1,1,1,1];let r=!1;for(let o=0;o<n;o++){let a,l=!0;e[o]?(a=e[o].color,l=e[o].visible):e[o%32]?(a=e[o%32].color,l=e[o%32].visible):e.DEFAULT?(a=e.DEFAULT.color,l=e.DEFAULT.visible):a=s;const c=parseInt(255*a[0]),u=parseInt(255*a[1]),h=parseInt(255*a[2]),d=l?parseInt(255*a[3]):0;t[4*o+0]!==c&&(t[4*o+0]=c,r=!0),t[4*o+1]!==u&&(t[4*o+1]=u,r=!0),t[4*o+2]!==h&&(t[4*o+2]=h,r=!0),t[4*o+3]!==d&&(t[4*o+3]=d,r=!0)}r&&(this.classificationTexture.needsUpdate=!0,this.dispatchEvent({type:"material_property_changed",target:this}))}get spacing(){return this.uniforms.spacing.value}set spacing(e){this.uniforms.spacing.value!==e&&(this.uniforms.spacing.value=e)}get useClipBox(){return this._useClipBox}set useClipBox(e){this._useClipBox!==e&&(this._useClipBox=e,this.updateShaderSource())}get clipTask(){return this.uniforms.clipTask.value}set clipTask(e){this.uniforms.clipTask.value=e}get elevationGradientRepat(){return this.uniforms.elevationGradientRepat.value}set elevationGradientRepat(e){this.uniforms.elevationGradientRepat.value=e}get clipMethod(){return this.uniforms.clipMethod.value}set clipMethod(e){this.uniforms.clipMethod.value=e}get weighted(){return this._weighted}set weighted(e){this._weighted!==e&&(this._weighted=e,this.updateShaderSource())}get fov(){return this.uniforms.fov.value}set fov(e){this.uniforms.fov.value!==e&&(this.uniforms.fov.value=e)}get screenWidth(){return this.uniforms.screenWidth.value}set screenWidth(e){this.uniforms.screenWidth.value!==e&&(this.uniforms.screenWidth.value=e)}get screenHeight(){return this.uniforms.screenHeight.value}set screenHeight(e){this.uniforms.screenHeight.value!==e&&(this.uniforms.screenHeight.value=e)}get near(){return this.uniforms.near.value}set near(e){this.uniforms.near.value!==e&&(this.uniforms.near.value=e)}get far(){return this.uniforms.far.value}set far(e){this.uniforms.far.value!==e&&(this.uniforms.far.value=e)}get opacity(){return this.uniforms.uOpacity.value}set opacity(e){this.uniforms&&this.uniforms.uOpacity&&this.uniforms.uOpacity.value!==e&&(this.uniforms.uOpacity.value=e,this.updateShaderSource(),this.dispatchEvent({type:"opacity_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get activeAttributeName(){return this._activeAttributeName}set activeAttributeName(e){this._activeAttributeName!==e&&(this._activeAttributeName=e,this.updateShaderSource(),this.dispatchEvent({type:"active_attribute_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get pointSizeType(){return this._pointSizeType}set pointSizeType(e){this._pointSizeType!==e&&(this._pointSizeType=e,this.updateShaderSource(),this.dispatchEvent({type:"point_size_type_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get useEDL(){return this._useEDL}set useEDL(e){this._useEDL!==e&&(this._useEDL=e,this.updateShaderSource())}get color(){return this.uniforms.uColor.value}set color(e){this.uniforms.uColor.value.equals(e)||(this.uniforms.uColor.value.copy(e),this.dispatchEvent({type:"color_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get shape(){return this._shape}set shape(e){this._shape!==e&&(this._shape=e,this.updateShaderSource(),this.dispatchEvent({type:"point_shape_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get treeType(){return this._treeType}set treeType(e){this._treeType!==e&&(this._treeType=e,this.updateShaderSource())}get bbSize(){return this.uniforms.bbSize.value}set bbSize(e){this.uniforms.bbSize.value=e}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value!==e&&(this.uniforms.size.value=e,this.dispatchEvent({type:"point_size_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get minSize(){return this.uniforms.minSize.value}set minSize(e){this.uniforms.minSize.value!==e&&(this.uniforms.minSize.value=e,this.dispatchEvent({type:"point_size_changed",target:this}),this.dispatchEvent({type:"material_property_changed",target:this}))}get elevationRange(){return this.uniforms.elevationRange.value}set elevationRange(e){(this.uniforms.elevationRange.value[0]!==e[0]||this.uniforms.elevationRange.value[1]!==e[1])&&(this.uniforms.elevationRange.value=e,this._defaultElevationRangeChanged=!0,this.dispatchEvent({type:"material_property_changed",target:this}))}get heightMin(){return this.uniforms.elevationRange.value[0]}set heightMin(e){this.elevationRange=[e,this.elevationRange[1]]}get heightMax(){return this.uniforms.elevationRange.value[1]}set heightMax(e){this.elevationRange=[this.elevationRange[0],e]}get transition(){return this.uniforms.transition.value}set transition(e){this.uniforms.transition.value=e}get intensityRange(){return this.uniforms.intensityRange.value}set intensityRange(e){e instanceof Array&&e.length===2&&(e[0]===this.uniforms.intensityRange.value[0]&&e[1]===this.uniforms.intensityRange.value[1]||(this.uniforms.intensityRange.value=e,this._defaultIntensityRangeChanged=!0,this.dispatchEvent({type:"material_property_changed",target:this})))}get intensityGamma(){return this.uniforms.intensity_gbc.value[0]}set intensityGamma(e){this.uniforms.intensity_gbc.value[0]!==e&&(this.uniforms.intensity_gbc.value[0]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get intensityContrast(){return this.uniforms.intensity_gbc.value[2]}set intensityContrast(e){this.uniforms.intensity_gbc.value[2]!==e&&(this.uniforms.intensity_gbc.value[2]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get intensityBrightness(){return this.uniforms.intensity_gbc.value[1]}set intensityBrightness(e){this.uniforms.intensity_gbc.value[1]!==e&&(this.uniforms.intensity_gbc.value[1]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get rgbGamma(){return this.uniforms.uRGB_gbc.value[0]}set rgbGamma(e){this.uniforms.uRGB_gbc.value[0]!==e&&(this.uniforms.uRGB_gbc.value[0]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get rgbContrast(){return this.uniforms.uRGB_gbc.value[2]}set rgbContrast(e){this.uniforms.uRGB_gbc.value[2]!==e&&(this.uniforms.uRGB_gbc.value[2]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get rgbBrightness(){return this.uniforms.uRGB_gbc.value[1]}set rgbBrightness(e){this.uniforms.uRGB_gbc.value[1]!==e&&(this.uniforms.uRGB_gbc.value[1]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get extraGamma(){return this.uniforms.uExtraGammaBrightContr.value[0]}set extraGamma(e){this.uniforms.uExtraGammaBrightContr.value[0]!==e&&(this.uniforms.uExtraGammaBrightContr.value[0]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get extraBrightness(){return this.uniforms.uExtraGammaBrightContr.value[1]}set extraBrightness(e){this.uniforms.uExtraGammaBrightContr.value[1]!==e&&(this.uniforms.uExtraGammaBrightContr.value[1]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get extraContrast(){return this.uniforms.uExtraGammaBrightContr.value[2]}set extraContrast(e){this.uniforms.uExtraGammaBrightContr.value[2]!==e&&(this.uniforms.uExtraGammaBrightContr.value[2]=e,this.dispatchEvent({type:"material_property_changed",target:this}))}getRange(e){return this.ranges.get(e)}setRange(e,t){let n=!1,s=this.ranges.get(e);s!=null&&t!=null?n=s[0]!==t[0]||s[1]!==t[1]:n=!0,this.ranges.set(e,t),n&&this.dispatchEvent({type:"material_property_changed",target:this})}get extraRange(){return this.uniforms.uExtraRange.value}set extraRange(e){e instanceof Array&&e.length===2&&(e[0]===this.uniforms.uExtraRange.value[0]&&e[1]===this.uniforms.uExtraRange.value[1]||(this.uniforms.uExtraRange.value=e,this._defaultExtraRangeChanged=!0,this.dispatchEvent({type:"material_property_changed",target:this})))}get weightRGB(){return this.uniforms.wRGB.value}set weightRGB(e){this.uniforms.wRGB.value!==e&&(this.uniforms.wRGB.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get weightIntensity(){return this.uniforms.wIntensity.value}set weightIntensity(e){this.uniforms.wIntensity.value!==e&&(this.uniforms.wIntensity.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get weightElevation(){return this.uniforms.wElevation.value}set weightElevation(e){this.uniforms.wElevation.value!==e&&(this.uniforms.wElevation.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get weightClassification(){return this.uniforms.wClassification.value}set weightClassification(e){this.uniforms.wClassification.value!==e&&(this.uniforms.wClassification.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get weightReturnNumber(){return this.uniforms.wReturnNumber.value}set weightReturnNumber(e){this.uniforms.wReturnNumber.value!==e&&(this.uniforms.wReturnNumber.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}get weightSourceID(){return this.uniforms.wSourceID.value}set weightSourceID(e){this.uniforms.wSourceID.value!==e&&(this.uniforms.wSourceID.value=e,this.dispatchEvent({type:"material_property_changed",target:this}))}static generateGradientTexture(e){let t=64,n=document.createElement("canvas");n.width=t,n.height=t;let s=n.getContext("2d");s.rect(0,0,t,t);let r=s.createLinearGradient(0,0,t,t);for(let a=0;a<e.length;a++){let l=e[a];r.addColorStop(l[0],"#"+l[1].getHexString())}s.fillStyle=r,s.fill();let o=new ka(n);return o.needsUpdate=!0,o.minFilter=et,o.wrap=vi,o.repeat=2,o}static generateMatcapTexture(e){var t=new URL(Potree.resourcePath+"/textures/matcap/"+e).href;let n=new jn().load(t);return n.magFilter=n.minFilter=et,n.needsUpdate=!0,n}disableEvents(){this._hiddenListeners===void 0&&(this._hiddenListeners=this._listeners,this._listeners={})}enableEvents(){this._listeners=this._hiddenListeners,this._hiddenListeners=void 0}}class Ch extends iu{constructor(){super(),this.children=[],this.sceneNode=null,this.octree=null}getNumPoints(){return this.geometryNode.numPoints}isLoaded(){return!0}isTreeNode(){return!0}isGeometryNode(){return!1}getLevel(){return this.geometryNode.level}getBoundingSphere(){return this.geometryNode.boundingSphere}getBoundingBox(){return this.geometryNode.boundingBox}getChildren(){let e=[];for(let t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e}getPointsInBox(e){if(!this.sceneNode)return null;let t=this.geometryNode.buffer,n=t.offset("position"),s=t.stride,r=new DataView(t.data),o=e.matrixWorld.clone().invert(),a=new xe().multiplyMatrices(o,this.sceneNode.matrixWorld),l=[],c=new _t;for(let u=0;u<t.numElements;u++){let h=r.getFloat32(u*s+n+0,!0),d=r.getFloat32(u*s+n+4,!0),f=r.getFloat32(u*s+n+8,!0);c.set(h,d,f,1),c.applyMatrix4(a),-.5<c.x&&c.x<.5&&-.5<c.y&&c.y<.5&&-.5<c.z&&c.z<.5&&(c.set(h,d,f,1).applyMatrix4(this.sceneNode.matrixWorld),l.push(new S(c.x,c.y,c.z)))}return l}get name(){return this.geometryNode.name}}class ec extends Ja{constructor(e,t){super(),this.pointBudget=1/0,this.pcoGeometry=e,this.boundingBox=this.pcoGeometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new fi),this.material=t||new Hr,this.visiblePointsTarget=2*1e3*1e3,this.minimumNodePixelSize=150,this.level=0,this.position.copy(e.offset),this.updateMatrix();{let n=["rgba","rgb","intensity","classification"],s="rgba";for(let r of n){let o=this.pcoGeometry.pointAttributes.attributes.find(d=>d.name===r);if(!o)continue;let a=o.range[0].constructor.name==="Array"?o.range[0]:[o.range[0]],l=o.range[1].constructor.name==="Array"?o.range[1]:[o.range[1]],c=new S(...a),u=new S(...l);if(c.distanceTo(u)!==0){s=r;break}}this.material.activeAttributeName=s}this.showBoundingBox=!1,this.boundingBoxNodes=[],this.loadQueue=[],this.visibleBounds=new Wt,this.visibleNodes=[],this.visibleGeometry=[],this.generateDEM=!1,this.profileRequests=[],this.name="",this._visible=!0;{let n=[this.pcoGeometry.tightBoundingBox,this.getBoundingBoxWorld()].find(o=>o!==void 0);this.updateMatrixWorld(!0),n=He.computeTransformedBoundingBox(n,this.matrixWorld);let s=n.min.z,r=n.max.z;this.material.heightMin=s,this.material.heightMax=r}this.projection=e.projection,this.fallbackProjection=e.fallbackProjection,this.root=this.pcoGeometry.root}setName(e){this.name!==e&&(this.name=e,this.dispatchEvent({type:"name_changed",name:e,pointcloud:this}))}getName(){return this.name}getAttribute(e){const t=this.pcoGeometry.pointAttributes.attributes.find(n=>n.name===e);return t||null}getAttributes(){return this.pcoGeometry.pointAttributes}toTreeNode(e,t){let n=new Ch,s=new ho(e.geometry,this.material);s.name=e.name,s.position.copy(e.boundingBox.min),s.frustumCulled=!1,s.onBeforeRender=(o,a,l,c,u,h)=>{if(u.program){if(o.getContext().useProgram(u.program.program),u.program.getUniforms().map.level){let d=e.getLevel();u.uniforms.level.value=d,u.program.getUniforms().map.level.setValue(o.getContext(),d)}if(this.visibleNodeTextureOffsets&&u.program.getUniforms().map.vnStart){let d=this.visibleNodeTextureOffsets.get(n);u.uniforms.vnStart.value=d,u.program.getUniforms().map.vnStart.setValue(o.getContext(),d)}if(u.program.getUniforms().map.pcIndex){let d=n.pcIndex?n.pcIndex:this.visibleNodes.indexOf(n);u.uniforms.pcIndex.value=d,u.program.getUniforms().map.pcIndex.setValue(o.getContext(),d)}}},n.geometryNode=e,n.sceneNode=s,n.pointcloud=this,n.children=[];for(let o=0;o<8;o++)n.children[o]=e.children[o];if(!t)this.root=n,this.add(s);else{let o=parseInt(e.name[e.name.length-1]);t.sceneNode.add(s),t.children[o]=n}let r=function(){let o=parseInt(e.name[e.name.length-1]);t.sceneNode.remove(n.sceneNode),t.children[o]=e};return e.oneTimeDisposeHandlers.push(r),n}updateVisibleBounds(){let e=[];for(let t=0;t<this.visibleNodes.length;t++){let n=this.visibleNodes[t],s=!0;for(let r=0;r<n.children.length;r++){let o=n.children[r];o instanceof Ch?s=s&&!o.sceneNode.visible:o instanceof aa&&(s=!0)}s&&e.push(n)}this.visibleBounds.min=new S(1/0,1/0,1/0),this.visibleBounds.max=new S(-1/0,-1/0,-1/0);for(let t=0;t<e.length;t++){let n=e[t];this.visibleBounds.expandByPoint(n.getBoundingBox().min),this.visibleBounds.expandByPoint(n.getBoundingBox().max)}}updateMaterial(e,t,n,s){e.fov=n.fov*(Math.PI/180),e.screenWidth=s.domElement.clientWidth,e.screenHeight=s.domElement.clientHeight,e.spacing=this.pcoGeometry.spacing,e.near=n.near,e.far=n.far,e.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.getSize(new S).x}computeVisibilityTextureData(e,t){Potree.measureTimings&&performance.mark("computeVisibilityTextureData-start");let n=new Uint8Array(e.length*4),s=new Map;e=e.slice();let r=function(c,u){let h=c.geometryNode.name,d=u.geometryNode.name;return h.length!==d.length?h.length-d.length:h<d?-1:h>d?1:0};e.sort(r);let o=new S,a=new Map,l=new Array(e.length).fill(1/0);for(let c=0;c<e.length;c++){let u=e[c];if(a.set(u.name,u),s.set(u,c),c>0){let d=parseInt(u.name.slice(-1)),f=u.name.slice(0,-1),m=a.get(f),v=s.get(m),_=c-v;l[v]=Math.min(l[v],_),n[v*4+0]=n[v*4+0]|1<<d,n[v*4+1]=l[v]>>8,n[v*4+2]=l[v]%256}let h=u.geometryNode.density;if(typeof h=="number"&&!Number.isNaN(h)){let f=(Math.log2(h)/2-1.5+10)*10;n[c*4+3]=f}else n[c*4+3]=100}return Potree.measureTimings&&(performance.mark("computeVisibilityTextureData-end"),performance.measure("render.computeVisibilityTextureData","computeVisibilityTextureData-start","computeVisibilityTextureData-end")),{data:n,offsets:s}}nodeIntersectsProfile(e,t){let s=e.boundingBox.clone().applyMatrix4(this.matrixWorld).getBoundingSphere(new fi),r=!1;for(let o=0;o<t.points.length-1;o++){let a=new S(t.points[o+0].x,t.points[o+0].y,s.center.z),l=new S(t.points[o+1].x,t.points[o+1].y,s.center.z),u=new ia(a,l).closestPointToPoint(s.center,!0,new S).distanceTo(s.center);r=r||u<s.radius+t.width}return r}deepestNodeAt(e){const t=this.matrixWorld.clone().invert(),n=e.clone().applyMatrix4(t);let s=this.root;for(;;){let o=null;for(const a of s.children)a!==void 0&&a.getBoundingBox().containsPoint(n)&&(o=a);if(o!==null&&o instanceof Ch)s=o;else break}return s}nodesOnRay(e,t){let n=[],s=t.clone();for(let r=0;r<e.length;r++){let o=e[r],a=o.getBoundingSphere().clone().applyMatrix4(this.matrixWorld);s.intersectsSphere(a)&&n.push(o)}return n}updateMatrixWorld(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0)}hideDescendants(e){let t=[];for(let n=0;n<e.children.length;n++){let s=e.children[n];s.visible&&t.push(s)}for(;t.length>0;){let n=t.shift();n.visible=!1;for(let s=0;s<n.children.length;s++){let r=n.children[s];r.visible&&t.push(r)}}}moveToOrigin(){this.position.set(0,0,0),this.updateMatrixWorld(!0);let e=this.boundingBox,t=this.matrixWorld,n=He.computeTransformedBoundingBox(e,t);this.position.set(0,0,0).sub(n.getCenter(new S))}moveToGroundPlane(){this.updateMatrixWorld(!0);let e=this.boundingBox,t=this.matrixWorld,n=He.computeTransformedBoundingBox(e,t);this.position.y+=-n.min.y}getBoundingBoxWorld(){this.updateMatrixWorld(!0);let e=this.boundingBox,t=this.matrixWorld;return He.computeTransformedBoundingBox(e,t)}getPointsInProfile(e,t,n){if(n){let o=new Potree.ProfileRequest(this,e,t,n);return this.profileRequests.push(o),o}let s={segments:[],boundingBox:new Wt,projectedBoundingBox:new Kc};for(let o=0;o<e.points.length-1;o++){let a=e.points[o],l=e.points[o+1],c=this.getProfile(a,l,e.width,t),u={start:a,end:l,points:c,project:null};s.segments.push(u),s.boundingBox.expandByPoint(c.boundingBox.min),s.boundingBox.expandByPoint(c.boundingBox.max)}let r=new S;for(let o=0;o<s.segments.length;o++){let a=s.segments[o],l=a.start,c=a.end,u=function(h,d,f,m){let v=h,_=d,y=f,x=m,R=new S(1,0,0),I=new S().subVectors(_,v);I.y=0,I.normalize();let B=Math.acos(R.dot(I));return I.z>0&&(B=-B),function(N){let J=new xe().makeTranslation(-v.x,-x.min.y,-v.z),ne=new xe().makeRotationY(-B),se=new xe().makeTranslation(y.x,0,0),E=N.clone();return E.applyMatrix4(J),E.applyMatrix4(ne),E.applyMatrix4(se),E}}(l,c,r.clone(),s.boundingBox.clone());a.project=u,r.x+=new S(l.x,0,l.z).distanceTo(new S(c.x,0,c.z)),r.y+=c.y-l.y}return s.projectedBoundingBox.min.x=0,s.projectedBoundingBox.min.y=s.boundingBox.min.y,s.projectedBoundingBox.max.x=r.x,s.projectedBoundingBox.max.y=s.boundingBox.max.y,s}getProfile(e,t,n,s,r){let o=new Potree.ProfileRequest(e,t,n,s,r);this.profileRequests.push(o)}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}intersectsPoint(e){if(!(this.pcoGeometry.root&&this.pcoGeometry.root.geometry))return!1;if(typeof this.signedDistanceField>"u"){const s=new Float32Array(32768).fill(1/0),r=this.pcoGeometry.root.geometry.attributes.position,o=this.boundingBox,a=r.count;for(let c=0;c<a;c=c+3){const u=r.array[3*c+0],h=r.array[3*c+1],d=r.array[3*c+2],f=parseInt(Math.min(32*(u/o.max.x),31)),m=parseInt(Math.min(32*(h/o.max.y),31)),v=parseInt(Math.min(32*(d/o.max.z),31)),_=f+m*32+v*32*32;s[_]=0}const l={resolution:32,field:s};this.signedDistanceField=l}{const n=this.signedDistanceField,s=this.boundingBox,r=this.matrixWorld.clone().invert(),o=e.clone().applyMatrix4(r),a=n.resolution,l=parseInt(a*(o.x/s.max.x)),c=parseInt(a*(o.y/s.max.y)),u=parseInt(a*(o.z/s.max.z));if(l<0||c<0||u<0||l>=a||c>=a||u>=a)return!1;const h=l+c*a+u*a*a;if(n.field[h]===0)return!0}return!1}pick(e,t,n,s={}){let r=e.renderer,o=e.pRenderer;performance.mark("pick-start");let a=(O,V)=>O!==void 0?O:V,l=a(s.pickWindowSize,65),c=a(s.pickOutsideClipRegion,!1),u=r.getSize(new Se),h=Math.ceil(a(s.width,u.width)),d=Math.ceil(a(s.height,u.height)),f=a(s.pointSizeType,this.material.pointSizeType),m=a(s.pointSize,this.material.size),v=this.nodesOnRay(this.visibleNodes,n);if(v.length===0)return null;if(!this.pickState){let O=new Si,V=new Potree.PointCloudMaterial;V.activeAttributeName="indices";let W=new bi(1,1,{minFilter:et,magFilter:ei,format:jt});this.pickState={renderTarget:W,material:V,scene:O}}let _=this.pickState,y=_.material;y.pointSizeType=f,y.shape=Potree.PointShape.PARABOLOID,y.uniforms.uFilterReturnNumberRange.value=this.material.uniforms.uFilterReturnNumberRange.value,y.uniforms.uFilterNumberOfReturnsRange.value=this.material.uniforms.uFilterNumberOfReturnsRange.value,y.uniforms.uFilterGPSTimeClipRange.value=this.material.uniforms.uFilterGPSTimeClipRange.value,y.uniforms.uFilterPointSourceIDClipRange.value=this.material.uniforms.uFilterPointSourceIDClipRange.value,y.activeAttributeName="indices",y.size=m,y.uniforms.minSize.value=this.material.uniforms.minSize.value,y.uniforms.maxSize.value=this.material.uniforms.maxSize.value,y.classification=this.material.classification,y.recomputeClassification(),s.pickClipped?(y.clipBoxes=this.material.clipBoxes,y.uniforms.clipBoxes=this.material.uniforms.clipBoxes,this.material.clipTask===Potree.ClipTask.HIGHLIGHT?y.clipTask=Potree.ClipTask.NONE:y.clipTask=this.material.clipTask,y.clipMethod=this.material.clipMethod):y.clipBoxes=[],this.updateMaterial(y,v,t,r),_.renderTarget.setSize(h,d);let x=new Se(s.x,s.y),R=r.getContext();R.enable(R.SCISSOR_TEST),R.scissor(parseInt(x.x-(l-1)/2),parseInt(x.y-(l-1)/2),parseInt(l),parseInt(l)),r.state.buffers.depth.setTest(y.depthTest),r.state.buffers.depth.setMask(y.depthWrite),r.state.setBlending(cn);{r.setRenderTarget(_.renderTarget),R.clearColor(0,0,0,0),r.clear(!0,!0,!0);let O=this.material;this.material=y,o.renderOctree(this,v,t,_.renderTarget),this.material=O}let I=(O,V,W)=>Math.min(Math.max(V,O),W),B=parseInt(I(x.x-(l-1)/2,0,h)),N=parseInt(I(x.y-(l-1)/2,0,d)),J=parseInt(Math.min(B+l,h)-B),ne=parseInt(Math.min(N+l,d)-N),se=J*ne,E=new Uint8Array(4*se);R.readPixels(B,N,l,l,R.RGBA,R.UNSIGNED_BYTE,E),r.setRenderTarget(null),r.state.reset(),r.setScissorTest(!1),R.disable(R.SCISSOR_TEST);let M=E,A=new Uint32Array(E.buffer),F=Number.MAX_VALUE,P=[];for(let O=0;O<l;O++)for(let V=0;V<l;V++){let W=O+V*l,fe=Math.pow(O-(l-1)/2,2)+Math.pow(V-(l-1)/2,2),ve=M[4*W+3];M[4*W+3]=0;let pe=A[W];if(!(ve===0&&pe===0)&&ve!==void 0&&pe!==void 0){let Me={pIndex:pe,pcIndex:ve,distanceToCenter:fe};s.all?P.push(Me):P.length>0?fe<P[0].distanceToCenter&&(P[0]=Me):P.push(Me)}}for(let O of P){let V={};if(!v[O.pcIndex])return null;let W=v[O.pcIndex],fe=W.sceneNode,ve=W.geometryNode.geometry;for(let pe in ve.attributes){let Me=ve.attributes[pe];if(pe==="position"){let Fe=Me.array[3*O.pIndex+0],at=Me.array[3*O.pIndex+1],bt=Me.array[3*O.pIndex+2],Ie=new S(Fe,at,bt);Ie.applyMatrix4(fe.matrixWorld),V[pe]=Ie}else if(pe!=="indices"){let Fe=Me.array.slice(Me.itemSize*O.pIndex,Me.itemSize*(O.pIndex+1));if(Me.potree){const{scale:at,offset:bt}=Me.potree;Fe=Fe.map(Ie=>Ie/at+bt)}V[pe]=Fe}}O.point=V}return performance.mark("pick-end"),performance.measure("pick","pick-start","pick-end"),s.all?P.map(O=>O.point):P.length===0?null:P[0].point}*getFittedBoxGen(e){let t=performance.now(),n=new Wt,s=e.matrixWorld.clone().invert();for(let c of this.visibleNodes){if(!c.sceneNode)continue;let u=c.geometryNode.buffer,h=u.offset("position"),d=u.stride,f=new DataView(u.data),m=new xe().multiplyMatrices(s,c.sceneNode.matrixWorld),v=new _t;for(let _=0;_<u.numElements;_++){let y=f.getFloat32(_*d+h+0,!0),x=f.getFloat32(_*d+h+4,!0),R=f.getFloat32(_*d+h+8,!0);v.set(y,x,R,1),v.applyMatrix4(m),-.5<v.x&&v.x<.5&&-.5<v.y&&v.y<.5&&-.5<v.z&&v.z<.5&&n.expandByPoint(v)}yield}let r=n.getCenter(new S).applyMatrix4(e.matrixWorld),o=new qe;o.position.copy(r),o.scale.copy(e.scale),o.rotation.copy(e.rotation);let a=new S().subVectors(n.max,n.min);o.scale.multiply(a);let l=performance.now()-t;console.log("duration: ",l),yield o}getFittedBox(e,t=1/0){t=1/0;let n=performance.now(),s=new Wt,r=e.matrixWorld.clone().invert();for(let u of this.visibleNodes){if(!u.sceneNode||u.getLevel()>t)continue;let h=u.geometryNode.buffer,d=h.offset("position"),f=h.stride,m=new DataView(h.data),v=new xe().multiplyMatrices(r,u.sceneNode.matrixWorld),_=new _t;for(let y=0;y<h.numElements;y++){let x=m.getFloat32(y*f+d+0,!0),R=m.getFloat32(y*f+d+4,!0),I=m.getFloat32(y*f+d+8,!0);_.set(x,R,I,1),_.applyMatrix4(v),-.5<_.x&&_.x<.5&&-.5<_.y&&_.y<.5&&-.5<_.z&&_.z<.5&&s.expandByPoint(_)}}let o=s.getCenter(new S).applyMatrix4(e.matrixWorld),a=new qe;a.position.copy(o),a.scale.copy(e.scale),a.rotation.copy(e.rotation);let l=new S().subVectors(s.max,s.min);a.scale.multiply(l);let c=performance.now()-n;return console.log("duration: ",c),a}get progress(){return this.visibleNodes.length/this.visibleGeometry.length}find(e){let t=null;for(let n of e)n==="r"?t=this.root:t=t.children[n];return t}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.dispatchEvent({type:"visibility_changed",pointcloud:this}))}}class Dh{constructor(){this.boundingBox=new Wt,this.numPoints=0,this.data={}}add(e){let t=this.numPoints,n=e.numPoints,s=t+n,r=Object.keys(this.data),o=Object.keys(e.data),a=new Set([...r,...o]);for(let l of a)if(r.includes(l)&&o.includes(l)){let c=this.data[l].constructor,u=new c(this.data[l].length+e.data[l].length);u.set(this.data[l],0),u.set(e.data[l],this.data[l].length),this.data[l]=u}else if(r.includes(l)&&!o.includes(l)){let c=this.data[l].length/this.numPoints,u=this.data[l].constructor,h=new u(c*s);h.set(this.data[l],0),this.data[l]=h}else if(!r.includes(l)&&o.includes(l)){let c=e.data[l].length/e.numPoints,u=e.data[l].constructor,h=new u(c*s);h.set(e.data[l],c*t),this.data[l]=h}this.numPoints=s,this.boundingBox.union(e.boundingBox)}}class $m extends Hi{constructor(e,t){t===void 0&&(t=16776960);let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array([e.min.x,e.min.y,e.min.z,e.max.x,e.min.y,e.min.z,e.max.x,e.min.y,e.max.z,e.min.x,e.min.y,e.max.z,e.min.x,e.max.y,e.min.z,e.max.x,e.max.y,e.min.z,e.max.x,e.max.y,e.max.z,e.min.x,e.max.y,e.max.z]),r=new wt;r.setIndex(new tt(n,1)),r.setAttribute("position",new tt(s,3));let o=new ri({color:t});super(r,o)}}function Kb(i,e,t){for(let s of i){let r=performance.now();for(let a of s.profileRequests)if(a.update(),performance.now()-r>5)break;let o=performance.now()-r}let n=Xm(i,e,t);for(let s of i)s.updateMaterial(s.material,s.visibleNodes,e,t),s.updateVisibleBounds();return z.lru.freeMemory(),n}function qm(i,e,t){let n=[],s=[],r=new BinaryHeap(function(o){return 1/o.weight});for(let o=0;o<i.length;o++){let a=i[o];if(!a.initialized())continue;a.numVisibleNodes=0,a.numVisiblePoints=0,a.deepestVisibleLevel=0,a.visibleNodes=[],a.visibleGeometry=[],e.updateMatrixWorld();let l=new Pl,c=e.matrixWorldInverse,u=a.matrixWorld,h=e.clone();h.near=Math.min(e.near,.1),h.updateProjectionMatrix();let d=e.projectionMatrix,f=new xe().multiply(d).multiply(c).multiply(u);l.setFromProjectionMatrix(f),n.push(l);let m=e.matrixWorld,v=u.clone().invert(),_=new xe().multiply(v).multiply(m),y=new S().setFromMatrixPosition(_);s.push(y),a.visible&&a.root!==null&&r.push({pointcloud:o,node:a.root,weight:Number.MAX_VALUE}),a.root.isTreeNode()&&a.hideDescendants(a.root.sceneNode);for(let x=0;x<a.boundingBoxNodes.length;x++)a.boundingBoxNodes[x].visible=!1}return{frustums:n,camObjPositions:s,priorityQueue:r}}function Xm(i,e,t){let n=0,s=0,r=new Map(i.map(x=>[x,0])),o=[],a=[],l=[],c=1/0,u=qm(i,e,t),h=u.frustums,d=u.camObjPositions,f=u.priorityQueue,m=0,v=t.domElement.clientWidth,_=t.domElement.clientHeight;Potree._pointcloudTransformVersion||(Potree._pointcloudTransformVersion=new Map);let y=Potree._pointcloudTransformVersion;for(let x of i)if(x.visible)if(x.updateMatrixWorld(),!y.has(x))y.set(x,{number:0,transform:x.matrixWorld.clone()});else{let R=y.get(x);R.transform.equals(x.matrixWorld)||(R.number++,R.transform.copy(x.matrixWorld),x.dispatchEvent({type:"transformation_changed",target:x}))}for(;f.size()>0;){let x=f.pop(),R=x.node,I=x.parent,B=i[x.pointcloud],N=R.getBoundingBox(),J=h[x.pointcloud],ne=d[x.pointcloud],se=J.intersectsBox(N),E=B.maxLevel||1/0,M=R.getLevel(),A=se;A=A&&!(s+R.getNumPoints()>Potree.pointBudget),A=A&&!(r.get(B)+R.getNumPoints()>B.pointBudget),A=A&&M<E,A=A||R.getLevel()<=2;let F=B.material.clipBoxes;if(F.length>0){let V=0,W=0;for(let pe of F){let Me=B.matrixWorld.clone().invert(),Fe=Me.multiply(pe.box.matrixWorld),at=new S(.5,0,0).applyMatrix4(Me),bt=new S(-.5,0,0).applyMatrix4(Me),Ie=new S(0,.5,0).applyMatrix4(Me),Y=new S(0,-.5,0).applyMatrix4(Me),X=new S(0,0,.5).applyMatrix4(Me),ce=new S(0,0,-.5).applyMatrix4(Me),ie=new S().subVectors(bt,at).normalize(),he=ie.clone().multiplyScalar(-1),ge=new S().subVectors(Y,Ie).normalize(),le=ge.clone().multiplyScalar(-1),oe=new S().subVectors(ce,X).normalize(),we=oe.clone().multiplyScalar(-1),Le=new yi().setFromNormalAndCoplanarPoint(ie,at),Ae=new yi().setFromNormalAndCoplanarPoint(he,bt),K=new yi().setFromNormalAndCoplanarPoint(ge,Ie),Q=new yi().setFromNormalAndCoplanarPoint(le,Y),Ue=new yi().setFromNormalAndCoplanarPoint(oe,X),Be=new yi().setFromNormalAndCoplanarPoint(we,ce);new Pl(Le,Ae,K,Q,Ue,Be).intersectsBox(N)&&V++,W++}let fe=V>0,ve=V===W;B.material.clipTask===fr.SHOW_INSIDE?B.material.clipMethod===oa.INSIDE_ANY&&fe||B.material.clipMethod===oa.INSIDE_ALL&&ve||(A=!1):(B.material.clipTask,fr.SHOW_OUTSIDE)}if(R.spacing?c=Math.min(c,R.spacing):R.geometryNode&&R.geometryNode.spacing&&(c=Math.min(c,R.geometryNode.spacing)),s+R.getNumPoints()>Potree.pointBudget)break;if(!A)continue;s+=R.getNumPoints();let P=r.get(B);if(r.set(B,P+R.getNumPoints()),B.numVisibleNodes++,B.numVisiblePoints+=R.getNumPoints(),R.isGeometryNode()&&(!I||I.isTreeNode())&&(R.isLoaded()&&m<2?(R=B.toTreeNode(R,I),m++):(l.push(R),a.push(R))),R.isTreeNode()){z.lru.touch(R.geometryNode),R.sceneNode.visible=!0,R.sceneNode.material=B.material,o.push(R),B.visibleNodes.push(R),R._transformVersion===void 0&&(R._transformVersion=-1);let V=y.get(B);if(R._transformVersion!==V.number&&(R.sceneNode.updateMatrix(),R.sceneNode.matrixWorld.multiplyMatrices(B.matrixWorld,R.sceneNode.matrix),R._transformVersion=V.number),B.showBoundingBox&&!R.boundingBoxNode&&R.getBoundingBox){let W=new $m(R.getBoundingBox());W.matrixAutoUpdate=!1,B.boundingBoxNodes.push(W),R.boundingBoxNode=W,R.boundingBoxNode.matrix.copy(B.matrixWorld)}else B.showBoundingBox?(R.boundingBoxNode.visible=!0,R.boundingBoxNode.matrix.copy(B.matrixWorld)):!B.showBoundingBox&&R.boundingBoxNode&&(R.boundingBoxNode.visible=!1)}let O=R.getChildren();for(let V=0;V<O.length;V++){let W=O[V],fe=0;if(e.isPerspectiveCamera){let ve=W.getBoundingSphere(),pe=ve.center,Me=ne.x-pe.x,Fe=ne.y-pe.y,at=ne.z-pe.z,bt=Me*Me+Fe*Fe+at*at,Ie=Math.sqrt(bt),Y=ve.radius,X=e.fov*Math.PI/180,ce=Math.tan(X/2),ie=.5*_/(ce*Ie),he=Y*ie;if(he<B.minimumNodePixelSize)continue;fe=he,Ie-Y<0&&(fe=Number.MAX_VALUE)}else{let ve=W.getBoundingBox(),pe=W.getBoundingSphere().center.distanceTo(ne);fe=ve.max.clone().sub(ve.min).length()}f.push({pointcloud:x.pointcloud,node:W,parent:R,weight:fe})}}{let x=4,R=i.filter(I=>I.generateDEM&&I.dem instanceof Potree.DEM);for(let I of R){let B=I.visibleNodes.filter(N=>N.getLevel()<=x);I.dem.update(B)}}for(let x=0;x<Math.min(Potree.maxNodesLoading,l.length);x++)l[x].load();return{visibleNodes:o,numVisiblePoints:s,lowestSpacing:c}}class ef extends iu{constructor(){super(),this.left=null,this.right=null,this.sceneNode=null,this.kdtree=null}getNumPoints(){return this.geometryNode.numPoints}isLoaded(){return!0}isTreeNode(){return!0}isGeometryNode(){return!1}getLevel(){return this.geometryNode.level}getBoundingSphere(){return this.geometryNode.boundingSphere}getBoundingBox(){return this.geometryNode.boundingBox}toTreeNode(e){let t=null;if(this.left===e?t=this.left:this.right===e&&(t=this.right),!t.loaded)return;let n=new ef,s=zb(t.geometry,this.kdtree.material);s.visible=!1,n.kdtree=this.kdtree,n.geometryNode=t,n.sceneNode=s,n.parent=this,n.left=this.geometryNode.left,n.right=this.geometryNode.right}getChildren(){let e=[];return this.left&&e.push(this.left),this.right&&e.push(this.right),e}}class wE extends Ja{constructor(e){super(),this.root=null,e.root?this.root=e.root:e.addEventListener("hierarchy_loaded",()=>{this.root=e.root}),this.visiblePointsTarget=2*1e3*1e3,this.minimumNodePixelSize=150,this.position.sub(e.offset),this.updateMatrix(),this.numVisibleNodes=0,this.numVisiblePoints=0,this.boundingBoxNodes=[],this.loadQueue=[],this.visibleNodes=[],this.pcoGeometry=e,this.boundingBox=this.pcoGeometry.boundingBox,this.boundingSphere=this.pcoGeometry.boundingSphere,this.material=new Hr({vertexColors:Zd,size:.05,treeType:tu.KDTREE}),this.material.sizeType=Ws.ATTENUATED,this.material.size=.05,this.profileRequests=[],this.name=""}getBoundingBoxWorld(){this.updateMatrixWorld(!0);let e=this.boundingBox,t=this.matrixWorld;return He.computeTransformedBoundingBox(e,t)}setName(e){this.name!==e&&(this.name=e,this.dispatchEvent({type:"name_changed",name:e,pointcloud:this}))}getName(){return this.name}getLevel(){return this.level}toTreeNode(e,t){let n=new ef,s=new ho(e.geometry,this.material);s.frustumCulled=!1,s.onBeforeRender=(o,a,l,c,u,h)=>{if(u.program){if(o.getContext().useProgram(u.program.program),u.program.getUniforms().map.level){let d=e.getLevel();u.uniforms.level.value=d,u.program.getUniforms().map.level.setValue(o.getContext(),d)}if(this.visibleNodeTextureOffsets&&u.program.getUniforms().map.vnStart){let d=this.visibleNodeTextureOffsets.get(n);u.uniforms.vnStart.value=d,u.program.getUniforms().map.vnStart.setValue(o.getContext(),d)}if(u.program.getUniforms().map.pcIndex){let d=n.pcIndex?n.pcIndex:this.visibleNodes.indexOf(n);u.uniforms.pcIndex.value=d,u.program.getUniforms().map.pcIndex.setValue(o.getContext(),d)}}},n.geometryNode=e,n.sceneNode=s,n.pointcloud=this,n.left=e.left,n.right=e.right,t?(t.sceneNode.add(s),t.left===e?t.left=n:t.right===e&&(t.right=n)):(this.root=n,this.add(s));let r=function(){t.sceneNode.remove(n.sceneNode),t.left===n?t.left=e:t.right===n&&(t.right=e)};return e.oneTimeDisposeHandlers.push(r),n}updateMaterial(e,t,n,s){e.fov=n.fov*(Math.PI/180),e.screenWidth=s.domElement.clientWidth,e.screenHeight=s.domElement.clientHeight,e.spacing=this.pcoGeometry.spacing,e.near=n.near,e.far=n.far,this.maxLevel>e.levels&&(e.levels=this.maxLevel+2);let r=this.boundingBox.getSize(new S);e.bbSize=[r.x,r.y,r.z]}updateVisibleBounds(){}hideDescendants(e){let t=[];for(let n=0;n<e.children.length;n++){let s=e.children[n];s.visible&&t.push(s)}for(;t.length>0;){let n=t.shift();n.visible=!1,n.boundingBoxNode&&(n.boundingBoxNode.visible=!1);for(let s=0;s<n.children.length;s++){let r=n.children[s];r.visible&&t.push(r)}}}updateMatrixWorld(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0)}nodesOnRay(e,t){let n=[],s=t.clone();for(let r=0;r<e.length;r++){let o=e[r],a=o.getBoundingSphere().clone().applyMatrix4(o.sceneNode.matrixWorld);s.intersectsSphere(a)&&n.push(o)}return n}pick(e,t,n,s={}){let r=e.renderer,o=e.pRenderer;performance.mark("pick-start");let a=(O,V)=>O!==void 0?O:V,l=a(s.pickWindowSize,17),c=a(s.pickOutsideClipRegion,!1),u=r.getSize(new Se),h=Math.ceil(a(s.width,u.width)),d=Math.ceil(a(s.height,u.height)),f=a(s.pointSizeType,this.material.pointSizeType),m=a(s.pointSize,this.material.size),v=this.nodesOnRay(this.visibleNodes,n);if(v.length===0)return null;if(!this.pickState){let O=new Si,V=new Hr;V.activeAttributeName="indices";let W=new bi(1,1,{minFilter:et,magFilter:ei,format:jt});this.pickState={renderTarget:W,material:V,scene:O}}let _=this.pickState,y=_.material;y.pointSizeType=f,y.shape=this.material.shape,y.size=m,y.uniforms.minSize.value=this.material.uniforms.minSize.value,y.uniforms.maxSize.value=this.material.uniforms.maxSize.value,y.classification=this.material.classification,s.pickClipped?(y.clipBoxes=this.material.clipBoxes,this.material.clipTask===fr.HIGHLIGHT?y.clipTask=fr.NONE:y.clipTask=this.material.clipTask):y.clipBoxes=[],this.updateMaterial(y,v,t,r),_.renderTarget.setSize(h,d);let x=new Se(s.x,s.y),R=r.getContext();R.enable(R.SCISSOR_TEST),R.scissor(parseInt(x.x-(l-1)/2),parseInt(x.y-(l-1)/2),parseInt(l),parseInt(l)),r.state.buffers.depth.setTest(y.depthTest),r.state.buffers.depth.setMask(y.depthWrite),r.state.setBlending(cn),r.clearTarget(_.renderTarget,!0,!0,!0);{r.setRenderTarget(_.renderTarget),R.clearColor(0,0,0,0),r.clearTarget(_.renderTarget,!0,!0,!0);let O=this.material;this.material=y,o.renderOctree(this,v,t,_.renderTarget),this.material=O}let I=(O,V,W)=>Math.min(Math.max(V,O),W),B=parseInt(I(x.x-(l-1)/2,0,h)),N=parseInt(I(x.y-(l-1)/2,0,d)),J=parseInt(Math.min(B+l,h)-B),ne=parseInt(Math.min(N+l,d)-N),se=J*ne,E=new Uint8Array(4*se);R.readPixels(B,N,l,l,R.RGBA,R.UNSIGNED_BYTE,E),r.setRenderTarget(null),r.state.reset(),r.setScissorTest(!1),R.disable(R.SCISSOR_TEST);let M=E,A=new Uint32Array(E.buffer),F=Number.MAX_VALUE,P=[];for(let O=0;O<l;O++)for(let V=0;V<l;V++){let W=O+V*l,fe=Math.pow(O-(l-1)/2,2)+Math.pow(V-(l-1)/2,2),ve=M[4*W+3];M[4*W+3]=0;let pe=A[W];if(!(ve===0&&pe===0)&&ve!==void 0&&pe!==void 0){let Me={pIndex:pe,pcIndex:ve,distanceToCenter:fe};s.all?P.push(Me):P.length>0?fe<P[0].distanceToCenter&&(P[0]=Me):P.push(Me)}}for(let O of P){let V={};if(!v[O.pcIndex])return null;let W=v[O.pcIndex],fe=W.sceneNode,ve=W.geometryNode.geometry;for(let pe in ve.attributes){let Me=ve.attributes[pe];if(pe==="position"){let Fe=Me.array[3*O.pIndex+0],at=Me.array[3*O.pIndex+1],bt=Me.array[3*O.pIndex+2],Ie=new S(Fe,at,bt);Ie.applyMatrix4(fe.matrixWorld),V[pe]=Ie}}O.point=V}return performance.mark("pick-end"),performance.measure("pick","pick-start","pick-end"),s.all?P.map(O=>O.point):P.length===0?null:P[0].point}computeVisibilityTextureData(e){z.measureTimings&&performance.mark("computeVisibilityTextureData-start");let t=new Uint8Array(e.length*3),n=new Map;e=e.slice();let s=function(o,a){let l=o.geometryNode.level,c=a.geometryNode.level,u=o.geometryNode.number,h=a.geometryNode.number;return l!==c?l-c:u<h?-1:u>h?1:0};e.sort(s);let r=[];for(let o=0;o<e.length;o++)r.push(e[o].geometryNode.number);for(let o=0;o<e.length;o++){let a=e[o];n.set(a,o);let l=0,c=0,u=0;a.geometryNode.left&&r.indexOf(a.geometryNode.left.number)>0&&(l+=1,c=r.indexOf(a.geometryNode.left.number)-o),a.geometryNode.right&&r.indexOf(a.geometryNode.right.number)>0&&(l+=2,c=c===0?r.indexOf(a.geometryNode.right.number)-o:c),a.geometryNode.split==="X"?u=1:a.geometryNode.split==="Y"?u=2:a.geometryNode.split==="Z"&&(u=4),t[o*3+0]=l,t[o*3+1]=c,t[o*3+2]=u}return z.measureTimings&&(performance.mark("computeVisibilityTextureData-end"),performance.measure("render.computeVisibilityTextureData","computeVisibilityTextureData-start","computeVisibilityTextureData-end")),{data:t,offsets:n}}get progress(){return this.pcoGeometry.root?z.numNodesLoading>0?0:1:0}}function la(i,e){let t;if(e===vi)return i.REPEAT;if(e===li)return i.CLAMP_TO_EDGE;if(e===Kn)return i.MIRRORED_REPEAT;if(e===ei)return i.NEAREST;if(e===Zr)return i.NEAREST_MIPMAP_NEAREST;if(e===Jr)return i.NEAREST_MIPMAP_LINEAR;if(e===et)return i.LINEAR;if(e===Qn)return i.LINEAR_MIPMAP_NEAREST;if(e===wr)return i.LINEAR_MIPMAP_LINEAR;if(e===ms)return i.UNSIGNED_BYTE;if(e===wa)return i.UNSIGNED_SHORT_4_4_4_4;if(e===ba)return i.UNSIGNED_SHORT_5_5_5_1;if(e===Is)return i.UNSIGNED_SHORT_5_6_5;if(e===al)return i.BYTE;if(e===Ot)return i.SHORT;if(e===Kr)return i.UNSIGNED_SHORT;if(e===zi)return i.INT;if(e===es)return i.UNSIGNED_INT;if(e===vn)return i.FLOAT;if(e===br&&(t=extensions.get("OES_texture_half_float"),t!==null))return t.HALF_FLOAT_OES;if(e===Fo)return i.ALPHA;if(e===Yi)return i.RGB;if(e===jt)return i.RGBA;if(e===Zi)return i.LUMINANCE;if(e===Ks)return i.LUMINANCE_ALPHA;if(e===Qs)return i.DEPTH_COMPONENT;if(e===Fs)return i.DEPTH_STENCIL;if(e===mn)return i.FUNC_ADD;if(e===On)return i.FUNC_SUBTRACT;if(e===nn)return i.FUNC_REVERSE_SUBTRACT;if(e===Xr)return i.ZERO;if(e===ga)return i.ONE;if(e===sl)return i.SRC_COLOR;if(e===Do)return i.ONE_MINUS_SRC_COLOR;if(e===va)return i.SRC_ALPHA;if(e===Po)return i.ONE_MINUS_SRC_ALPHA;if(e===Dn)return i.DST_ALPHA;if(e===ya)return i.ONE_MINUS_DST_ALPHA;if(e===Xs)return i.DST_COLOR;if(e===vr)return i.ONE_MINUS_DST_COLOR;if(e===xa)return i.SRC_ALPHA_SATURATE;if((e===Ji||e===RGBA_S3TC_DXT1_Format||e===$n||e===RGBA_S3TC_DXT5_Format)&&(t=extensions.get("WEBGL_compressed_texture_s3tc"),t!==null)){if(e===Ji)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Bs)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===$n)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Sa)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===No||e===_r||e===Ns||e===er)&&(t=extensions.get("WEBGL_compressed_texture_pvrtc"),t!==null)){if(e===No)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===_r)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ns)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===er)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Ta&&(t=extensions.get("WEBGL_compressed_texture_etc1"),t!==null))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===hs||e===ds)&&(t=extensions.get("EXT_blend_minmax"),t!==null)){if(e===hs)return t.MIN_EXT;if(e===ds)return t.MAX_EXT}return e===UnsignedInt248Type&&(t=extensions.get("WEBGL_depth_texture"),t!==null)?t.UNSIGNED_INT_24_8_WEBGL:0}let mr={position:{name:"position",location:0},color:{name:"color",location:1},rgba:{name:"color",location:1},intensity:{name:"intensity",location:2},classification:{name:"classification",location:3},returnNumber:{name:"returnNumber",location:4},"return number":{name:"returnNumber",location:4},returns:{name:"returnNumber",location:4},numberOfReturns:{name:"numberOfReturns",location:5},"number of returns":{name:"numberOfReturns",location:5},pointSourceID:{name:"pointSourceID",location:6},"source id":{name:"pointSourceID",location:6},"point source id":{name:"pointSourceID",location:6},indices:{name:"indices",location:7},normal:{name:"normal",location:8},spacing:{name:"spacing",location:9},"gps-time":{name:"gpsTime",location:10},aExtra:{name:"aExtra",location:11}};class Qb{constructor(e,t,n,s){this.gl=e,this.name=t,this.vsSource=n,this.fsSource=s,this.cache=new Map,this.vs=null,this.fs=null,this.program=null,this.uniformLocations={},this.attributeLocations={},this.uniformBlockIndices={},this.uniformBlocks={},this.uniforms={},this.update(n,s)}update(e,t){this.vsSource=e,this.fsSource=t,this.linkProgram()}compileShader(e,t){let n=this.gl;if(n.shaderSource(e,t),n.compileShader(e),!n.getShaderParameter(e,n.COMPILE_STATUS)){let r=n.getShaderInfoLog(e),o=t.split(`
`).map((a,l)=>`${l+1}`.padEnd(5)+a).join(`
`);throw`could not compile shader ${this.name}: ${r}, 
${o}`}}linkProgram(){const e=performance.now();let t=this.gl;this.uniformLocations={},this.attributeLocations={},this.uniforms={},t.useProgram(null);let n=this.cache.get(`${this.vsSource}, ${this.fsSource}`);if(n){this.program=n.program,this.vs=n.vs,this.fs=n.fs,this.attributeLocations=n.attributeLocations,this.uniformLocations=n.uniformLocations,this.uniformBlocks=n.uniformBlocks,this.uniforms=n.uniforms;return}else{this.vs=t.createShader(t.VERTEX_SHADER),this.fs=t.createShader(t.FRAGMENT_SHADER),this.program=t.createProgram();for(let c of Object.keys(mr)){let u=mr[c].location,h=mr[c].name;t.bindAttribLocation(this.program,u,h)}this.compileShader(this.vs,this.vsSource),this.compileShader(this.fs,this.fsSource);let o=this.program;if(t.attachShader(o,this.vs),t.attachShader(o,this.fs),t.linkProgram(o),t.detachShader(o,this.vs),t.detachShader(o,this.fs),!t.getProgramParameter(o,t.LINK_STATUS)){let c=t.getProgramInfoLog(o);throw`could not link program ${this.name}: ${c}`}{let c=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES);for(let u=0;u<c;u++){let h=t.getActiveAttrib(o,u),d=t.getAttribLocation(o,h.name);this.attributeLocations[h.name]=d}}{let c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let u=0;u<c;u++){let h=t.getActiveUniform(o,u),d=t.getUniformLocation(o,h.name);this.uniformLocations[h.name]=d,this.uniforms[h.name]={location:d,value:null}}}if(t instanceof WebGL2RenderingContext){let c=t.getProgramParameter(o,t.ACTIVE_UNIFORM_BLOCKS);for(let u=0;u<c;u++){let h=t.getActiveUniformBlockName(o,u),d=t.getUniformBlockIndex(o,h);this.uniformBlockIndices[h]=d,t.uniformBlockBinding(o,d,d);let f=t.getActiveUniformBlockParameter(o,d,t.UNIFORM_BLOCK_DATA_SIZE),m=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,m),t.bufferData(t.UNIFORM_BUFFER,f,t.DYNAMIC_READ),t.bindBufferBase(t.UNIFORM_BUFFER,d,m),t.bindBuffer(t.UNIFORM_BUFFER,null),this.uniformBlocks[h]={name:h,index:d,dataSize:f,buffer:m}}}let l={program:this.program,vs:this.vs,fs:this.fs,attributeLocations:this.attributeLocations,uniformLocations:this.uniformLocations,uniforms:this.uniforms,uniformBlocks:this.uniformBlocks};this.cache.set(`${this.vsSource}, ${this.fsSource}`,l)}const r=performance.now()-e;console.log(`shader compile duration: ${r.toFixed(3)}`)}setUniformMatrix4(e,t){const n=this.gl,s=this.uniformLocations[e];if(s==null)return;let r=new Float32Array(t.elements);n.uniformMatrix4fv(s,!1,r)}setUniform1f(e,t){const n=this.gl,s=this.uniforms[e];s!==void 0&&s.value!==t&&(s.value=t,n.uniform1f(s.location,t))}setUniformBoolean(e,t){const n=this.gl,s=this.uniforms[e];s!==void 0&&s.value!==t&&(s.value=t,n.uniform1i(s.location,t))}setUniformTexture(e,t){const n=this.gl,s=this.uniformLocations[e];s!=null&&n.uniform1i(s,t)}setUniform2f(e,t){const n=this.gl,s=this.uniformLocations[e];s!=null&&n.uniform2f(s,t[0],t[1])}setUniform3f(e,t){const n=this.gl,s=this.uniformLocations[e];s!=null&&n.uniform3f(s,t[0],t[1],t[2])}setUniform(e,t){t.constructor===xe?this.setUniformMatrix4(e,t):typeof t=="number"?this.setUniform1f(e,t):typeof t=="boolean"?this.setUniformBoolean(e,t):t instanceof Ym?this.setUniformTexture(e,t):t instanceof Array?t.length===2?this.setUniform2f(e,t):t.length===3&&this.setUniform3f(e,t):console.error("unhandled uniform type: ",e,t)}setUniform1i(e,t){let n=this.gl,s=this.uniformLocations[e];s!=null&&n.uniform1i(s,t)}}class Ym{constructor(e,t){this.gl=e,this.texture=t,this.id=e.createTexture(),this.target=e.TEXTURE_2D,this.version=-1,this.update(t)}update(){if(!this.texture.image){this.version=this.texture.version;return}let e=this.gl,t=this.texture;if(this.version===t.version)return;this.target=e.TEXTURE_2D,e.bindTexture(this.target,this.id);let n=0,s=la(e,t.format),r=t.image.width,o=t.image.height,a=0,l=s,c=la(e,t.type),u;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,t.unpackAlignment),t instanceof Gs?(u=t.image.data,e.texParameteri(this.target,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(this.target,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,la(e,t.magFilter)),e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,la(e,t.minFilter)),e.texImage2D(this.target,n,s,r,o,a,l,c,u)):(t instanceof ka||t instanceof oi)&&(u=t.image,e.texParameteri(this.target,e.TEXTURE_WRAP_S,la(e,t.wrapS)),e.texParameteri(this.target,e.TEXTURE_WRAP_T,la(e,t.wrapT)),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,la(e,t.magFilter)),e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,la(e,t.minFilter)),e.texImage2D(this.target,n,s,s,c,u),t instanceof oi&&e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(this.target,null),this.version=t.version}}class e1{constructor(){this.numElements=0,this.vao=null,this.vbos=new Map}}class tf{constructor(e){this.threeRenderer=e,this.gl=this.threeRenderer.getContext(),this.buffers=new Map,this.shaders=new Map,this.textures=new Map,this.glTypeMapping=new Map,this.glTypeMapping.set(Float32Array,this.gl.FLOAT),this.glTypeMapping.set(Uint8Array,this.gl.UNSIGNED_BYTE),this.glTypeMapping.set(Uint16Array,this.gl.UNSIGNED_SHORT),this.toggle=0}deleteBuffer(e){let t=this.gl,n=this.buffers.get(e);if(n!=null){for(let s in e.attributes)t.deleteBuffer(n.vbos.get(s).handle);this.buffers.delete(e)}}createBuffer(e){let t=this.gl,n=new e1;n.vao=t.createVertexArray(),n.numElements=e.attributes.position.count,t.bindVertexArray(n.vao);for(let r in e.attributes){let o=e.attributes[r],a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,o.array,t.STATIC_DRAW);let l=o.normalized,c=this.glTypeMapping.get(o.array.constructor);if(mr[r]!==void 0){let u=mr[r].location;t.vertexAttribPointer(u,o.itemSize,c,l,0,0),t.enableVertexAttribArray(u)}n.vbos.set(r,{handle:a,name:r,count:o.count,itemSize:o.itemSize,type:e.attributes.position.array.constructor,version:0})}t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null);let s=r=>{this.deleteBuffer(e),e.removeEventListener("dispose",s)};return e.addEventListener("dispose",s),n}updateBuffer(e){let t=this.gl,n=this.buffers.get(e);t.bindVertexArray(n.vao);for(let s in e.attributes){let r=e.attributes[s],o=r.normalized,a=this.glTypeMapping.get(r.array.constructor),l=null;if(n.vbos.has(s)?(l=n.vbos.get(s).handle,n.vbos.get(s).version=r.version):(l=t.createBuffer(),n.vbos.set(s,{handle:l,name:s,count:r.count,itemSize:r.itemSize,type:e.attributes.position.array.constructor,version:r.version})),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,r.array,t.STATIC_DRAW),mr[s]!==void 0){let c=mr[s].location;t.vertexAttribPointer(c,r.itemSize,a,o,0,0),t.enableVertexAttribArray(c)}}t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null)}traverse(e){let t=[],n=[e];for(;n.length>0;){let r=n.pop();if(r instanceof Ja){t.push(r);continue}let o=r.children.filter(a=>a.visible);n.push(...o)}return{octrees:t}}renderNodes(e,t,n,s,r,o,a){z.measureTimings&&performance.mark("renderNodes-start");let l=this.gl,c=a.material?a.material:e.material,u=a.shadowMaps==null?[]:a.shadowMaps,h=s.matrixWorldInverse;a.viewOverride&&(h=a.viewOverride);let d=new xe,f=new Float32Array(16),m=0;for(let v of t){if(z.debug.allowedNodes!==void 0&&!z.debug.allowedNodes.includes(v.name))continue;let _=v.sceneNode.matrixWorld;if(d.multiplyMatrices(h,_),n){let ne=n.offsets.get(v);o.setUniform1f("uVNStart",ne)}let y=v.getLevel();v.debug?o.setUniform("uDebug",!0):o.setUniform("uDebug",!1);const x=o.uniformLocations.modelMatrix;x&&(f.set(_.elements),l.uniformMatrix4fv(x,!1,f));const R=o.uniformLocations.modelViewMatrix;for(let ne=0;ne<16;ne++)f[ne]=d.elements[ne];if(l.uniformMatrix4fv(R,!1,f),c.clipPolygons&&c.clipPolygons.length>0){let ne=[],se=[];for(let O of c.clipPolygons){let V=O.viewMatrix,fe=O.projMatrix.clone().multiply(V).multiply(_);ne.push(O.markers.length),se.push(fe)}let E=[].concat(...se.map(O=>O.elements)),M=new Array(8*3*c.clipPolygons.length);for(let O=0;O<c.clipPolygons.length;O++){let V=c.clipPolygons[O];for(let W=0;W<V.markers.length;W++)M[O*24+(W*3+0)]=V.markers[W].position.x,M[O*24+(W*3+1)]=V.markers[W].position.y,M[O*24+(W*3+2)]=V.markers[W].position.z}const A=o.uniformLocations["uClipPolygonVCount[0]"];l.uniform1iv(A,ne);const F=o.uniformLocations["uClipPolygonWVP[0]"];l.uniformMatrix4fv(F,!1,E);const P=o.uniformLocations["uClipPolygonVertices[0]"];l.uniform3fv(P,M)}if(o.setUniform1f("uLevel",y),o.setUniform1f("uNodeSpacing",v.geometryNode.estimatedSpacing),o.setUniform1f("uPCIndex",m),u.length>0){const ne=o.uniformLocations["uShadowMap[0]"];o.setUniform3f("uShadowColor",c.uniforms.uShadowColor.value);let E=new Array(u.length).fill(5).map((M,A)=>M+A);l.uniform1iv(ne,E);for(let M=0;M<u.length;M++){let A=u[M],F=E[M],P=this.threeRenderer.properties.get(A.target.texture).__webglTexture;l.activeTexture(l[`TEXTURE${F}`]),l.bindTexture(l.TEXTURE_2D,P)}{let M=u.map(P=>P.camera.matrixWorldInverse).map(P=>new xe().multiplyMatrices(P,_)),A=[].concat(...M.map(P=>P.elements));const F=o.uniformLocations["uShadowWorldView[0]"];l.uniformMatrix4fv(F,!1,A)}{let M=[].concat(...u.map(F=>F.camera.projectionMatrix.elements));const A=o.uniformLocations["uShadowProj[0]"];l.uniformMatrix4fv(A,!1,M)}}const I=v.geometryNode.geometry;if(I||console.log("Missing geometry",v),I.attributes["gps-time"]){const ne=I.attributes["gps-time"],se=e.getAttribute("gps-time");let E=se.initialRange,M=E[1]-E[0],A=se.range,F=A[1]-A[0],P=M/F,O=-(A[0]-E[0])/M;P=Number.isNaN(P)?1:P,O=Number.isNaN(O)?0:O,o.setUniform1f("uGpsScale",P),o.setUniform1f("uGpsOffset",O);let V=c.uniforms.uFilterGPSTimeClipRange.value,W=[(V[0]-A[0])/F,(V[1]-A[0])/F];o.setUniform2f("uFilterGPSTimeClipRange",W)}{let ne=c.uniforms.uFilterReturnNumberRange.value,se=c.uniforms.uFilterNumberOfReturnsRange.value,E=c.uniforms.uFilterPointSourceIDClipRange.value;o.setUniform2f("uFilterReturnNumberRange",ne),o.setUniform2f("uFilterNumberOfReturnsRange",se),o.setUniform2f("uFilterPointSourceIDClipRange",E)}let B=null;if(!this.buffers.has(I))B=this.createBuffer(I),this.buffers.set(I,B);else{B=this.buffers.get(I);for(let ne in I.attributes)I.attributes[ne].version>B.vbos.get(ne).version&&this.updateBuffer(I)}if(l.bindVertexArray(B.vao),mr[c.activeAttributeName]===void 0&&Object.keys(I.attributes).includes(c.activeAttributeName)){const ne=mr.aExtra.location;for(const A in I.attributes){const F=I.attributes[A],P=B.vbos.get(A);l.bindBuffer(l.ARRAY_BUFFER,P.handle),l.disableVertexAttribArray(ne)}const se=c.activeAttributeName,E=I.attributes[se],M=B.vbos.get(se);if(E!==void 0&&M!==void 0){let A=this.glTypeMapping.get(E.array.constructor),F=E.normalized;l.bindBuffer(l.ARRAY_BUFFER,M.handle),l.vertexAttribPointer(ne,E.itemSize,A,F,0,0),l.enableVertexAttribArray(ne)}{const A=e.pcoGeometry.pointAttributes.attributes.find(pe=>pe.name===se);let F=c.getRange(se);F||(F=A.range),F||(F=[0,1]);let P=A.initialRange,O=P[1]-P[0],V=F,W=V[1]-V[0],fe=O/W,ve=-(V[0]-P[0])/O;fe=Number.isNaN(fe)?1:fe,ve=Number.isNaN(ve)?0:ve,o.setUniform1f("uExtraScale",fe),o.setUniform1f("uExtraOffset",ve)}}else for(const ne in I.attributes){const se=I.attributes[ne],E=B.vbos.get(ne);if(mr[ne]!==void 0){const M=mr[ne].location;let A=this.glTypeMapping.get(se.array.constructor),F=se.normalized;l.bindBuffer(l.ARRAY_BUFFER,E.handle),l.vertexAttribPointer(M,se.itemSize,A,F,0,0),l.enableVertexAttribArray(M)}}let J=B.numElements;l.drawArrays(l.POINTS,0,J),m++}l.bindVertexArray(null),z.measureTimings&&(performance.mark("renderNodes-end"),performance.measure("render.renderNodes","renderNodes-start","renderNodes-end"))}renderOctree(e,t,n,s,r={}){let o=this.gl,a=r.material?r.material:e.material,l=r.shadowMaps==null?[]:r.shadowMaps,c=n.matrixWorldInverse,u=n.matrixWorld;r.viewOverride&&(c=r.viewOverride,u=c.clone().invert());let h=n.projectionMatrix,d=h.clone().invert(),f=null,m=null,v=0;if(a.pointSizeType>=0&&(a.pointSizeType===Ws.ADAPTIVE||a.activeAttributeName==="level of detail")){let y=r.vnTextureNodes!=null?r.vnTextureNodes:t;m=e.computeVisibilityTextureData(y,n);const x=a.visibleNodesTexture;x.image.data.set(m.data),x.needsUpdate=!0}{if(!this.shaders.has(a)){let[y,x]=[a.vertexShader,a.fragmentShader],R=new Qb(o,"pointcloud",y,x);this.shaders.set(a,R)}f=this.shaders.get(a);{let[y,x]=[a.vertexShader,a.fragmentShader],R=a.snapEnabled?a.numSnapshots:0,I=a.clipBoxes&&a.clipBoxes.length?a.clipBoxes.length:0,B=r.clipSpheres&&r.clipSpheres.length?r.clipSpheres.length:0,N=a.clipPolygons&&a.clipPolygons.length?a.clipPolygons.length:0,J=[`#define num_shadowmaps ${l.length}`,`#define num_snapshots ${R}`,`#define num_clipboxes ${I}`,`#define num_clipspheres ${B}`,`#define num_clippolygons ${N}`];if(e.pcoGeometry.root.isLoaded()){let M=e.pcoGeometry.root.geometry.attributes;M["gps-time"]&&J.push("#define clip_gps_enabled"),M["return number"]&&J.push("#define clip_return_number_enabled"),M["number of returns"]&&J.push("#define clip_number_of_returns_enabled"),(M["source id"]||M["point source id"])&&J.push("#define clip_point_source_id_enabled")}let ne=J.join(`
`),se=y.indexOf("#version "),E=x.indexOf("#version ");se>=0?y=y.replace(/(#version .*)/,`$1
${ne}`):y=`${ne}
${y}`,E>=0?x=x.replace(/(#version .*)/,`$1
${ne}`):x=`${ne}
${x}`,f.update(y,x),a.needsUpdate=!1}for(let y of Object.keys(a.uniforms)){let x=a.uniforms[y];if(x.type=="t"){let R=x.value;if(!R)continue;if(!this.textures.has(R)){let B=new Ym(o,R);this.textures.set(R,B)}this.textures.get(R).update()}}}o.useProgram(f.program);let _=!1;r.transparent!==void 0?_=r.transparent&&a.opacity<1:_=a.opacity<1,_?(o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE),o.depthMask(!1),o.disable(o.DEPTH_TEST)):(o.disable(o.BLEND),o.depthMask(!0),o.enable(o.DEPTH_TEST)),r.blendFunc!==void 0&&(o.enable(o.BLEND),o.blendFunc(...r.blendFunc)),r.depthTest!==void 0&&(r.depthTest===!0?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST)),r.depthWrite!==void 0&&(r.depthWrite===!0?o.depthMask(!0):o.depthMask(!1));{f.setUniformMatrix4("projectionMatrix",h),f.setUniformMatrix4("viewMatrix",c),f.setUniformMatrix4("uViewInv",u),f.setUniformMatrix4("uProjInv",d);let y=s?s.width:a.screenWidth,x=s?s.height:a.screenHeight;if(f.setUniform1f("uScreenWidth",y),f.setUniform1f("uScreenHeight",x),f.setUniform1f("fov",Math.PI*n.fov/180),f.setUniform1f("near",n.near),f.setUniform1f("far",n.far),n instanceof Fn?(f.setUniform("uUseOrthographicCamera",!0),f.setUniform("uOrthoWidth",n.right-n.left),f.setUniform("uOrthoHeight",n.top-n.bottom)):f.setUniform("uUseOrthographicCamera",!1),a.clipBoxes.length+a.clipPolygons.length===0?f.setUniform1i("clipTask",fr.NONE):f.setUniform1i("clipTask",a.clipTask),f.setUniform1i("clipMethod",a.clipMethod),a.clipBoxes&&a.clipBoxes.length>0){const ne=f.uniformLocations["clipBoxes[0]"];o.uniformMatrix4fv(ne,!1,a.uniforms.clipBoxes.value)}if(r.clipSpheres&&r.clipSpheres.length>0){let ne=r.clipSpheres,se=[];for(let A of ne){let F=A.matrixWorld,P=n.matrixWorld,O=F.clone().invert(),V=new xe().multiplyMatrices(O,P);se.push(V)}let E=[].concat(...se.map(A=>A.elements));const M=f.uniformLocations["uClipSpheres[0]"];o.uniformMatrix4fv(M,!1,E)}f.setUniform1f("size",a.size),f.setUniform1f("maxSize",a.uniforms.maxSize.value),f.setUniform1f("minSize",a.uniforms.minSize.value),f.setUniform1f("uOctreeSpacing",a.spacing),f.setUniform("uOctreeSize",a.uniforms.octreeSize.value),f.setUniform3f("uColor",a.color.toArray()),f.setUniform1f("uOpacity",a.opacity),f.setUniform2f("elevationRange",a.elevationRange),f.setUniform2f("intensityRange",a.intensityRange),f.setUniform3f("uIntensity_gbc",[a.intensityGamma,a.intensityBrightness,a.intensityContrast]),f.setUniform3f("uRGB_gbc",[a.rgbGamma,a.rgbBrightness,a.rgbContrast]),f.setUniform1f("uTransition",a.transition),f.setUniform1f("wRGB",a.weightRGB),f.setUniform1f("wIntensity",a.weightIntensity),f.setUniform1f("wElevation",a.weightElevation),f.setUniform1f("wClassification",a.weightClassification),f.setUniform1f("wReturnNumber",a.weightReturnNumber),f.setUniform1f("wSourceID",a.weightSourceID),f.setUniform("backfaceCulling",a.uniforms.backfaceCulling.value);let R=this.textures.get(a.visibleNodesTexture);R&&(f.setUniform1i("visibleNodesTexture",v),o.activeTexture(o.TEXTURE0+v),o.bindTexture(R.target,R.id),v++);let I=this.textures.get(a.gradientTexture);f.setUniform1i("gradient",v),o.activeTexture(o.TEXTURE0+v),o.bindTexture(I.target,I.id);const B=a.elevationGradientRepeat;B===pr.REPEAT?(o.texParameteri(I.target,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(I.target,o.TEXTURE_WRAP_T,o.REPEAT)):B===pr.MIRRORED_REPEAT?(o.texParameteri(I.target,o.TEXTURE_WRAP_S,o.MIRRORED_REPEAT),o.texParameteri(I.target,o.TEXTURE_WRAP_T,o.MIRRORED_REPEAT)):(o.texParameteri(I.target,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(I.target,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)),v++;let N=this.textures.get(a.classificationTexture);f.setUniform1i("classificationLUT",v),o.activeTexture(o.TEXTURE0+v),o.bindTexture(N.target,N.id),v++;let J=this.textures.get(a.matcapTexture);if(f.setUniform1i("matcapTextureUniform",v),o.activeTexture(o.TEXTURE0+v),o.bindTexture(J.target,J.id),v++,a.snapEnabled===!0){{const ne=f.uniformLocations["uSnapshot[0]"],se=f.uniformLocations["uSnapshotDepth[0]"];let E=v,M=new Array(5).fill(E).map((F,P)=>F+P),A=new Array(5).fill(1+Math.max(...M)).map((F,P)=>F+P);v=1+Math.max(...A),o.uniform1iv(ne,M),o.uniform1iv(se,A);for(let F=0;F<5;F++){let P=a.uniforms.uSnapshot.value[F],O=a.uniforms.uSnapshotDepth.value[F];if(!P)break;let V=this.threeRenderer.properties.get(P).__webglTexture,W=this.threeRenderer.properties.get(O).__webglTexture,fe=M[F],ve=A[F];o.activeTexture(o[`TEXTURE${fe}`]),o.bindTexture(o.TEXTURE_2D,V),o.activeTexture(o[`TEXTURE${ve}`]),o.bindTexture(o.TEXTURE_2D,W)}}{let ne=[].concat(...a.uniforms.uSnapView.value.map(E=>E.elements));const se=f.uniformLocations["uSnapView[0]"];o.uniformMatrix4fv(se,!1,ne)}{let ne=[].concat(...a.uniforms.uSnapProj.value.map(E=>E.elements));const se=f.uniformLocations["uSnapProj[0]"];o.uniformMatrix4fv(se,!1,ne)}{let ne=[].concat(...a.uniforms.uSnapProjInv.value.map(E=>E.elements));const se=f.uniformLocations["uSnapProjInv[0]"];o.uniformMatrix4fv(se,!1,ne)}{let ne=[].concat(...a.uniforms.uSnapViewInv.value.map(E=>E.elements));const se=f.uniformLocations["uSnapViewInv[0]"];o.uniformMatrix4fv(se,!1,ne)}}}this.renderNodes(e,t,m,n,s,f,r),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0)}render(e,t,n=null,s={}){const r=this.gl;n!=null&&this.threeRenderer.setRenderTarget(n);const o=this.traverse(e);for(const a of o.octrees){let l=a.visibleNodes;this.renderOctree(a,l,t,n,s)}r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindVertexArray(null),this.threeRenderer.resetState()}}class Ph{constructor(e){this.profile=e,this.segments=[],this.boundingBox=new Wt;for(let t=0;t<e.points.length-1;t++){let n=e.points[t],s=e.points[t+1],r=new S(n.x,n.y,0),o=new S(s.x,s.y,0),a=new S().addVectors(o,r).multiplyScalar(.5),l=r.distanceTo(o),c=new S().subVectors(o,r).normalize(),u=new S(0,0,1),d=new S().crossVectors(c,u).normalize(),f=new yi().setFromNormalAndCoplanarPoint(d,r),m=new yi().setFromNormalAndCoplanarPoint(c,a),v={start:n,end:s,cutPlane:f,halfPlane:m,length:l,points:new Dh};this.segments.push(v)}}size(){let e=0;for(let t of this.segments)e+=t.points.numPoints;return e}}class t1{constructor(e,t,n,s){this.pointcloud=e,this.profile=t,this.maxDepth=n||Number.MAX_VALUE,this.callback=s,this.temporaryResult=new Ph(this.profile),this.pointsServed=0,this.highestLevelServed=0,this.priorityQueue=new BinaryHeap(function(r){return 1/r.weight}),this.initialize()}initialize(){this.priorityQueue.push({node:this.pointcloud.pcoGeometry.root,weight:1/0})}traverse(e){let t=[];for(let n=0;n<8;n++){let s=e.children[n];s&&this.pointcloud.nodeIntersectsProfile(s,this.profile)&&t.push(s)}for(;t.length>0;){let n=t.pop(),s=n.boundingSphere.radius;if(this.priorityQueue.push({node:n,weight:s}),n.level<this.maxDepth)for(let r=0;r<8;r++){let o=n.children[r];o&&this.pointcloud.nodeIntersectsProfile(o,this.profile)&&t.push(o)}}}update(){this.updateGeneratorInstance||(this.updateGeneratorInstance=this.updateGenerator()),this.updateGeneratorInstance.next().done&&(this.updateGeneratorInstance=null)}*updateGenerator(){let e=performance.now(),t=1,n=[];for(let a=0;a<Math.min(t,this.priorityQueue.size());a++){let l=this.priorityQueue.pop(),c=l.node;if(!(c.level>this.maxDepth))if(c.loaded){n.push(c),z.lru.touch(c),this.highestLevelServed=Math.max(c.getLevel(),this.highestLevelServed);var s=c.pcoGeometry,r=s?s.hierarchyStepSize:1,o=c.getLevel()===0||c.level%r===0&&c.hasChildren;o&&this.traverse(c)}else c.load(),this.priorityQueue.push(l)}if(n.length>0){for(let a of this.getPointsInsideProfile(n,this.temporaryResult))a||(yield!1);this.temporaryResult.size()>100&&(this.pointsServed+=this.temporaryResult.size(),this.callback.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Ph(this.profile))}if(this.priorityQueue.size()===0){this.temporaryResult.size()>0&&(this.pointsServed+=this.temporaryResult.size(),this.callback.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Ph(this.profile)),this.callback.onFinish({request:this});let a=this.pointcloud.profileRequests.indexOf(this);a>=0&&this.pointcloud.profileRequests.splice(a,1)}yield!0}*getAccepted(e,t,n,s,r,o,a){let l=performance.now(),c=new Uint32Array(e),u=new Float64Array(e),h=new Float32Array(e*3),d=0,f=new S,m=new S,v=new Float32Array(t.geometry.attributes.position.array);for(let _=0;_<e;_++){f.set(v[_*3+0],v[_*3+1],v[_*3+2]),f.applyMatrix4(n);let y=Math.abs(s.cutPlane.distanceToPoint(f)),x=Math.abs(s.halfPlane.distanceToPoint(f));if(y<this.profile.width/2&&x<s.length/2){m.subVectors(f,s.start);let R=r.dot(m);c[d]=_,u[d]=R+a,o.boundingBox.expandByPoint(f),f.sub(this.pointcloud.position),h[3*d+0]=f.x,h[3*d+1]=f.y,h[3*d+2]=f.z,d++}_%1e3===0&&performance.now()-l>4&&(yield!1,l=performance.now())}c=c.subarray(0,d),u=u.subarray(0,d),h=h.subarray(0,d*3),yield[c,u,h]}*getPointsInsideProfile(e,t){let n=performance.now(),s=0,r=0;for(let o of t.segments){for(let a of e){let l=a.numPoints,c=a.geometry;if(!l)continue;{let B=a.boundingBox.clone().applyMatrix4(this.pointcloud.matrixWorld).getBoundingSphere(new fi),N=new S(o.start.x,o.start.y,B.center.z),J=new S(o.end.x,o.end.y,B.center.z);if(!(new ia(N,J).closestPointToPoint(B.center,!0,new S).distanceTo(B.center)<B.radius+t.profile.width))continue}let h=new S().subVectors(o.end,o.start).setZ(0).clone().normalize(),d=new Dh,f=new xe().makeTranslation(...a.boundingBox.min.toArray()),m=new xe().multiplyMatrices(this.pointcloud.matrixWorld,f);r=r+l;let v=null,_=null,y=null;for(let I of this.getAccepted(l,a,m,o,h,d,s))if(I)[v,_,y]=I;else{let B=performance.now()-n;yield!1,n=performance.now()}performance.now()-n>4&&(yield!1,n=performance.now()),d.data.position=y;let R=Object.keys(c.attributes).filter(I=>!["position","indices"].includes(I));for(let I of R){let B=c.attributes[I],N=B.array.length/l;if(N!==parseInt(N))debugger;let J=B.array.constructor,ne=new J(N*v.length),se=B.array,E=ne;for(let M=0;M<v.length;M++){let F=v[M]*N,P=F+N,O=se.subarray(F,P);E.set(O,M*N)}d.data[I]=ne}d.data.mileage=_,d.numPoints=v.length,o.points.add(d)}s+=o.length}for(let o of t.segments)t.boundingBox.union(o.points.boundingBox);yield!0}finishLevelThenCancel(){this.cancelRequested||(this.maxDepth=this.highestLevelServed,this.cancelRequested=!0)}cancel(){this.callback.onCancel(),this.priorityQueue=new BinaryHeap(function(t){return 1/t.weight});let e=this.pointcloud.profileRequests.indexOf(this);e>=0&&this.pointcloud.profileRequests.splice(e,1)}}class ca{constructor(e){this.version=e;let t=e.indexOf(".")===-1?e.length:e.indexOf(".");this.versionMajor=parseInt(e.substr(0,t)),this.versionMinor=parseInt(e.substr(t+1)),this.versionMinor.length===0&&(this.versionMinor=0)}newerThan(e){let t=new ca(e);return this.versionMajor>t.versionMajor?!0:this.versionMajor===t.versionMajor&&this.versionMinor>t.versionMinor}equalOrHigher(e){let t=new ca(e);return this.versionMajor>t.versionMajor?!0:this.versionMajor===t.versionMajor&&this.versionMinor>=t.versionMinor}upTo(e){return!this.newerThan(e)}}class Zm{constructor(){this.workers={}}getWorker(e){if(this.workers[e]||(this.workers[e]=[]),this.workers[e].length===0){let n=new Worker(e);this.workers[e].push(n)}return this.workers[e].pop()}returnWorker(e,t){this.workers[e].push(t)}}function i1(i){let e=i.material,t=[];for(let[o,a]of e.ranges)t.push({name:o,value:a});typeof e.elevationRange[0]=="number"&&t.push({name:"elevationRange",value:e.elevationRange}),typeof e.intensityRange[0]=="number"&&t.push({name:"intensityRange",value:e.intensityRange});let n=Object.entries(Potree.PointSizeType).find(o=>o[1]===e.pointSizeType)[0],s={activeAttributeName:e.activeAttributeName,ranges:t,size:e.size,minSize:e.minSize,pointSizeType:n,matcap:e.matcap};return{name:i.name,url:i.pcoGeometry.url,position:i.position.toArray(),rotation:i.rotation.toArray(),scale:i.scale.toArray(),material:s}}function n1(i){return{uuid:i.uuid,name:i.name,points:i.points.map(t=>t.toArray()),height:i.height,width:i.width}}function s1(i){return{uuid:i.uuid,type:i.constructor.name,name:i.name,position:i.position.toArray(),rotation:i.rotation.toArray(),scale:i.scale.toArray(),visible:i.visible,clip:i.clip}}function r1(i){const e=i.controlPoints.map(n=>({position:n.position.toArray(),target:n.target.toArray()}));return{uuid:i.uuid,name:i.name,duration:i.duration,t:i.t,curveType:i.curveType,visible:i.visible,controlPoints:e}}function o1(i){return{uuid:i.uuid,name:i.name,points:i.points.map(t=>t.position.toArray()),showDistances:i.showDistances,showCoordinates:i.showCoordinates,showArea:i.showArea,closed:i.closed,showAngles:i.showAngles,showHeight:i.showHeight,showCircle:i.showCircle,showAzimuth:i.showAzimuth,showEdges:i.showEdges,color:i.color.toArray()}}function a1(i){return{cameraParamsPath:i.cameraParamsPath,imageParamsPath:i.imageParamsPath}}function l1(i){return{path:i.path}}function c1(i){const e={uuid:i.uuid,title:i.title.toString(),description:i.description,position:i.position.toArray(),offset:i.offset.toArray(),children:[]};return i.cameraPosition&&(e.cameraPosition=i.cameraPosition.toArray()),i.cameraTarget&&(e.cameraTarget=i.cameraTarget.toArray()),typeof i.radius<"u"&&(e.radius=i.radius),e}function u1(i){const e=new Map;i.scene.annotations.traverseDescendants(n=>{const s=c1(n);e.set(n,s)});for(const[n,s]of e)for(const r of n.children){const o=e.get(r);s.children.push(o)}return i.scene.annotations.children.map(n=>e.get(n))}function h1(i){return{pointBudget:i.getPointBudget(),fov:i.getFOV(),edlEnabled:i.getEDLEnabled(),edlRadius:i.getEDLRadius(),edlStrength:i.getEDLStrength(),background:i.getBackground(),minNodeSize:i.getMinNodeSize(),showBoundingBoxes:i.getShowBoundingBox()}}function bE(i){const e=[],t=[];i.scene.scene.traverse(n=>{n.potree&&t.push(n)});for(const n of t)if(n.potree.file){const s={file:n.potree.file};e.push(s)}return e}function d1(i){const e=i.scene.view;return{position:e.position.toArray(),target:e.getPivot().toArray()}}function f1(i){return i.classifications}function p1(i){const e=i.scene;return{type:"Potree",version:1.7,settings:h1(i),view:d1(i),classification:f1(i),pointclouds:e.pointclouds.map(i1),measurements:e.measurements.map(o1),volumes:e.volumes.map(s1),cameraAnimations:e.cameraAnimations.map(r1),profiles:e.profiles.map(n1),annotations:u1(i),orientedImages:e.orientedImages.map(a1),geopackages:e.geopackages.map(l1)}}class m1{constructor(){this.position=new S(0,0,0),this.target=new S(0,0,0),this.positionHandle=null,this.targetHandle=null}}class tc extends Ne{constructor(e){super(),this.viewer=e,this.selectedElement=null,this.controlPoints=[],this.uuid=rt.generateUUID(),this.node=new qe,this.node.name="camera animation",this.viewer.scene.scene.add(this.node),this.frustum=this.createFrustum(),this.node.add(this.frustum),this.name="Camera Animation",this.duration=5,this.t=0,this.curveType="centripetal",this.visible=!0,this.createUpdateHook(),this.createPath()}static defaultFromView(e){const t=new tc(e),n=e.scene.getActiveCamera(),s=e.scene.view.getPivot(),r=new S(.3*n.position.x+.7*s.x,.3*n.position.y+.7*s.y,.3*n.position.z+.7*s.z),o=new S(.05*n.position.x+.95*s.x,.05*n.position.y+.95*s.y,.05*n.position.z+.95*s.z),a=n.position.distanceTo(s)*.3,l=He.computeAzimuth(n.position,s),c=5;for(let u=0;u<c;u++){let h=1.5*Math.PI*(u/c)+l;const d=a*Math.cos(h),f=a*Math.sin(h),m=[r.x+d,r.y+f,r.z],v=[o.x+d*.1,o.y+f*.1,o.z],_=t.createControlPoint();_.position.set(...m),_.target.set(...v)}return t}createUpdateHook(){const e=this.viewer;e.addEventListener("update",()=>{const t=e.scene.getActiveCamera(),{width:n,height:s}=e.renderer.getSize(new Se);this.node.visible=this.visible;for(const r of this.controlPoints){{const o=r.position.clone().project(t);if(this.visible&&o.z<1&&o.z>-1){const l=n*(o.x*.5+.5),c=s-s*(o.y*.5+.5);r.positionHandle.svg.style.left=l-r.positionHandle.svg.clientWidth/2,r.positionHandle.svg.style.top=c-r.positionHandle.svg.clientHeight/2,r.positionHandle.svg.style.display=""}else r.positionHandle.svg.style.display="none"}{const o=r.target.clone().project(t);if(this.visible&&o.z<1&&o.z>-1){const l=n*(o.x*.5+.5),c=s-s*(o.y*.5+.5);r.targetHandle.svg.style.left=l-r.targetHandle.svg.clientWidth/2,r.targetHandle.svg.style.top=c-r.targetHandle.svg.clientHeight/2,r.targetHandle.svg.style.display=""}else r.targetHandle.svg.style.display="none"}}this.line.material.resolution.set(n,s),this.updatePath();{const r=this.at(this.t),o=this.frustum;o.position.copy(r.position),o.lookAt(...r.target.toArray()),o.scale.set(20,20,20),o.material.resolution.set(n,s)}})}createControlPoint(e){e===void 0&&(e=this.controlPoints.length);const t=new m1;if(this.controlPoints.length>=2&&e===0){const n=this.controlPoints[0],s=this.controlPoints[1],r=n.position.clone().sub(s.position).multiplyScalar(.5);t.position.copy(n.position).add(r);const o=n.target.clone().sub(s.target).multiplyScalar(.5);t.target.copy(n.target).add(o)}else if(this.controlPoints.length>=2&&e===this.controlPoints.length){const n=this.controlPoints[this.controlPoints.length-2],s=this.controlPoints[this.controlPoints.length-1],r=s.position.clone().sub(n.position).multiplyScalar(.5);t.position.copy(n.position).add(r);const o=s.target.clone().sub(n.target).multiplyScalar(.5);t.target.copy(s.target).add(o)}else if(this.controlPoints.length>=2){const n=this.controlPoints[e-1],s=this.controlPoints[e];t.position.copy(n.position.clone().add(s.position).multiplyScalar(.5)),t.target.copy(n.target.clone().add(s.target).multiplyScalar(.5))}return t.positionHandle=this.createHandle(t.position),t.targetHandle=this.createHandle(t.target),this.controlPoints.splice(e,0,t),this.dispatchEvent({type:"controlpoint_added",controlpoint:t}),t}removeControlPoint(e){this.controlPoints=this.controlPoints.filter(t=>t!==e),this.dispatchEvent({type:"controlpoint_removed",controlpoint:e}),e.positionHandle.svg.remove(),e.targetHandle.svg.remove()}createPath(){{const e=new _n;let t=new dn({color:65280,dashSize:5,gapSize:2,linewidth:2,resolution:new Se(1e3,1e3)});const n=new Bn(e,t);this.line=n,this.node.add(n)}{const e=new _n;let t=new dn({color:255,dashSize:5,gapSize:2,linewidth:2,resolution:new Se(1e3,1e3)});const n=new Bn(e,t);this.targetLine=n,this.node.add(n)}}createFrustum(){const t=[0,0,0,-.3,-.3,1,0,0,0,.3,-.3,1,0,0,0,.3,.3,1,0,0,0,-.3,.3,1,-.3,-.3,1,.3,-.3,1,.3,-.3,1,.3,.3,1,.3,.3,1,-.3,.3,1,-.3,.3,1,-.3,-.3,1],n=new _n;n.setPositions(t),n.verticesNeedUpdate=!0,n.computeBoundingSphere();let s=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3)});const r=new Bn(n,s);return r.computeLineDistances(),r}updatePath(){{const e=this.controlPoints.map(o=>o.position),t=e[0],n=new bn(e);n.curveType=this.curveType;const s=100,r=[];for(let o=0;o<=s;o++){const a=o/s,l=n.getPoint(a).sub(t);r.push(l.x,l.y,l.z)}this.line.geometry.setPositions(r),this.line.geometry.verticesNeedUpdate=!0,this.line.geometry.computeBoundingSphere(),this.line.position.copy(t),this.line.computeLineDistances(),this.cameraCurve=n}{const e=this.controlPoints.map(o=>o.target),t=e[0],n=new bn(e);n.curveType=this.curveType;const s=100,r=[];for(let o=0;o<=s;o++){const a=o/s,l=n.getPoint(a).sub(t);r.push(l.x,l.y,l.z)}this.targetLine.geometry.setPositions(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.geometry.computeBoundingSphere(),this.targetLine.position.copy(t),this.targetLine.computeLineDistances(),this.targetCurve=n}}at(e){e>1?e=1:e<0&&(e=0);const t=this.cameraCurve.getPointAt(e),n=this.targetCurve.getPointAt(e);return{position:t,target:n}}set(e){this.t=e}createHandle(e){const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg");n.setAttribute("width","2em"),n.setAttribute("height","2em"),n.setAttribute("position","absolute"),n.style.left="50px",n.style.top="50px",n.style.position="absolute",n.style.zIndex="10000";const s=document.createElementNS(t,"circle");s.setAttributeNS(null,"cx","1em"),s.setAttributeNS(null,"cy","1em"),s.setAttributeNS(null,"r","0.5em"),s.setAttributeNS(null,"style","fill: red; stroke: black; stroke-width: 0.2em;"),n.appendChild(s),this.viewer.renderer.domElement.parentElement.appendChild(n);const o=u=>{this.selectedElement=n,document.addEventListener("mousemove",l)},a=u=>{this.selectedElement=null,document.removeEventListener("mousemove",l)},l=u=>{if(this.selectedElement){u.preventDefault();const h=viewer.renderer.domElement.getBoundingClientRect(),d=u.clientX-h.x,f=u.clientY-h.y,{width:m,height:v}=this.viewer.renderer.getSize(new Se),_=this.viewer.scene.getActiveCamera(),y=e.clone().project(_);y.x=(d/m-.5)/.5,y.y=(-(f-v)/v-.5)/.5;const x=y.clone().unproject(_);e.set(x.x,x.y,x.z)}};return n.addEventListener("mousedown",o),n.addEventListener("mouseup",a),{svg:n}}setVisible(e){this.node.visible=e;const t=e?"":"none";for(const n of this.controlPoints)n.positionHandle.svg.style.display=t,n.targetHandle.svg.style.display=t;this.visible=e}setDuration(e){this.duration=e}getDuration(e){return this.duration}play(){const e=performance.now(),t=this.duration,n=this.visible;this.setVisible(!1);const s=r=>{let l=(performance.now()-e)/1e3/t;this.set(l);const c=this.at(l);viewer.scene.view.position.copy(c.position),viewer.scene.view.lookAt(c.target),l>1&&(this.setVisible(n),this.viewer.removeEventListener("update",s))};this.viewer.addEventListener("update",s)}}function g1(i,e){let t=s=>{if(e.material){if(e.material.activeAttributeName!=null&&(s.activeAttributeName=e.material.activeAttributeName),e.material.ranges!=null)for(let r of e.material.ranges)r.name==="elevationRange"?s.elevationRange=r.value:r.name==="intensityRange"?s.intensityRange=r.value:s.setRange(r.name,r.value);e.material.size!=null&&(s.size=e.material.size),e.material.minSize!=null&&(s.minSize=e.material.minSize),e.material.pointSizeType!=null&&(s.pointSizeType=Ws[e.material.pointSizeType]),e.material.matcap!=null&&(s.matcap=e.material.matcap)}else e.activeAttributeName!=null&&(s.activeAttributeName=e.activeAttributeName)};return new Promise(s=>{if(i.scene.pointclouds.map(a=>a.name).includes(e.name)){s();return}Potree.loadPointCloud(e.url,e.name,a=>{const{pointcloud:l}=a;l.position.set(...e.position),l.rotation.set(...e.rotation),l.scale.set(...e.scale),t(l.material),i.scene.addPointCloud(l),s(l)})})}function v1(i,e){if(i.scene.measurements.find(s=>s.uuid===e.uuid))return;const n=new Gr;n.uuid=e.uuid,n.name=e.name,n.showDistances=e.showDistances,n.showCoordinates=e.showCoordinates,n.showArea=e.showArea,n.closed=e.closed,n.showAngles=e.showAngles,n.showHeight=e.showHeight,n.showCircle=e.showCircle,n.showAzimuth=e.showAzimuth,n.showEdges=e.showEdges;for(const s of e.points){const r=new S(...s);n.addMarker(r)}i.scene.addMeasurement(n)}function y1(i,e){if(i.scene.volumes.find(s=>s.uuid===e.uuid))return;let n=new Potree[e.type];n.uuid=e.uuid,n.name=e.name,n.position.set(...e.position),n.rotation.set(...e.rotation),n.scale.set(...e.scale),n.visible=e.visible,n.clip=e.clip,i.scene.addVolume(n)}function x1(i,e){if(i.scene.cameraAnimations.find(s=>s.uuid===e.uuid))return;const n=new tc(i);n.uuid=e.uuid,n.name=e.name,n.duration=e.duration,n.t=e.t,n.curveType=e.curveType,n.visible=e.visible,n.controlPoints=[];for(const s of e.controlPoints){const r=n.createControlPoint();r.position.set(...s.position),r.target.set(...s.target)}i.scene.addCameraAnimation(n)}function w1(i,e){const{cameraParamsPath:t,imageParamsPath:n}=e;i.scene.orientedImages.find(r=>r.imageParamsPath===n)||Potree.OrientedImageLoader.load(t,n,i).then(r=>{i.scene.addOrientedImages(r)})}function b1(i,e){const t=e.path;if(i.scene.geopackages.find(a=>a.path===t))return;const s=i.getProjection();proj4.defs("WGS84","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"),proj4.defs("pointcloud",s);const o={transform:proj4("WGS84","pointcloud")};Potree.GeoPackageLoader.loadUrl(t,o).then(a=>{i.scene.addGeopackage(a)})}function _1(i,e){e&&(i.setPointBudget(e.pointBudget),i.setFOV(e.fov),i.setEDLEnabled(e.edlEnabled),i.setEDLRadius(e.edlRadius),i.setEDLStrength(e.edlStrength),i.setBackground(e.background),i.setMinNodeSize(e.minNodeSize),i.setShowBoundingBox(e.showBoundingBoxes))}function M1(i,e){i.scene.view.position.set(...e.position),i.scene.view.lookAt(...e.target)}function E1(i){const e=new ra({position:i.position,title:i.title,cameraPosition:i.cameraPosition,cameraTarget:i.cameraTarget});return e.description=i.description,e.uuid=i.uuid,i.offset&&e.offset.set(...i.offset),e}function S1(i,e){if(!e)return;const t=s=>{let r=null;return i.scene.annotations.traverse(o=>{o.uuid===s.uuid&&(r=o)}),r},n=(s,r)=>{if(t(s))return;const a=E1(s);for(const l of s.children)n(l,a);r.add(a)};for(const s of e)n(s,i.scene.annotations)}function T1(i,e){const{name:t,points:n}=e;if(i.scene.profiles.find(o=>o.uuid===e.uuid))return;let r=new Potree.Profile;r.name=t,r.uuid=e.uuid,r.setWidth(e.width);for(const o of n)r.addMarker(new S(...o));i.scene.addProfile(r)}function A1(i,e){if(!e)return;const t=e;i.setClassifications(t)}async function C1(i,e){if(e.type!=="Potree"){console.error("not a valid Potree project");return}_1(i,e.settings),M1(i,e.view);const t=[];for(const n of e.pointclouds){const s=g1(i,n);t.push(s)}for(const n of e.measurements)v1(i,n);for(const n of e.volumes)y1(i,n);for(const n of e.cameraAnimations)x1(i,n);for(const n of e.profiles)T1(i,n);if(e.orientedImages)for(const n of e.orientedImages)w1(i,n);S1(i,e.annotations),A1(i,e.classification),He.waitAny(t).then(()=>{if(e.geopackages)for(const n of e.geopackages)b1(i,n)}),await Promise.all(t)}class Jm extends Vs{constructor(e={}){super();let t={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},edlStrength:{type:"f",value:1},uNear:{type:"f",value:1},uFar:{type:"f",value:1},radius:{type:"f",value:1},neighbours:{type:"2fv",value:[]},depthMap:{type:"t",value:null},uEDLColor:{type:"t",value:null},uEDLDepth:{type:"t",value:null},opacity:{type:"f",value:1},uProj:{type:"Matrix4fv",value:[]}};this.setValues({uniforms:t,vertexShader:this.getDefines()+Ti["edl.vs"],fragmentShader:this.getDefines()+Ti["edl.fs"],lights:!1}),this.neighbourCount=8}getDefines(){let e="";return e+="#define NEIGHBOUR_COUNT "+this.neighbourCount+`
`,e}updateShaderSource(){let e=this.getDefines()+Ti["edl.vs"],t=this.getDefines()+Ti["edl.fs"];this.setValues({vertexShader:e,fragmentShader:t}),this.uniforms.neighbours.value=this.neighbours,this.needsUpdate=!0}get neighbourCount(){return this._neighbourCount}set neighbourCount(e){if(this._neighbourCount!==e){this._neighbourCount=e,this.neighbours=new Float32Array(this._neighbourCount*2);for(let t=0;t<this._neighbourCount;t++)this.neighbours[2*t+0]=Math.cos(2*t*Math.PI/this._neighbourCount),this.neighbours[2*t+1]=Math.sin(2*t*Math.PI/this._neighbourCount);this.updateShaderSource()}}}class Km extends Vs{constructor(e={}){super();let t={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},edlStrength:{type:"f",value:1},radius:{type:"f",value:1},neighbours:{type:"2fv",value:[]},uEDLMap:{type:"t",value:null},uDepthMap:{type:"t",value:null},uWeightMap:{type:"t",value:null}};this.setValues({uniforms:t,vertexShader:this.getDefines()+Ti["normalize.vs"],fragmentShader:this.getDefines()+Ti["normalize_and_edl.fs"]}),this.neighbourCount=8}getDefines(){let e="";return e+="#define NEIGHBOUR_COUNT "+this.neighbourCount+`
`,e}updateShaderSource(){let e=this.getDefines()+Ti["normalize.vs"],t=this.getDefines()+Ti["normalize_and_edl.fs"];this.setValues({vertexShader:e,fragmentShader:t}),this.uniforms.neighbours.value=this.neighbours,this.needsUpdate=!0}get neighbourCount(){return this._neighbourCount}set neighbourCount(e){if(this._neighbourCount!==e){this._neighbourCount=e,this.neighbours=new Float32Array(this._neighbourCount*2);for(let t=0;t<this._neighbourCount;t++)this.neighbours[2*t+0]=Math.cos(2*t*Math.PI/this._neighbourCount),this.neighbours[2*t+1]=Math.sin(2*t*Math.PI/this._neighbourCount);this.updateShaderSource()}}}class Qm extends Vs{constructor(e={}){super();let t={uDepthMap:{type:"t",value:null},uWeightMap:{type:"t",value:null}};this.setValues({uniforms:t,vertexShader:this.getDefines()+Ti["normalize.vs"],fragmentShader:this.getDefines()+Ti["normalize.fs"]})}getDefines(){return""}updateShaderSource(){let e=this.getDefines()+Ti["normalize.vs"],t=this.getDefines()+Ti["normalize.fs"];this.setValues({vertexShader:e,fragmentShader:t}),this.needsUpdate=!0}}class nu{constructor(e,t){typeof e=="string"?this.version=new ca(e):this.version=e,this.extension=t}static progressCB(){}load(e){if(e.loaded)return;let t=e.getURL();this.version.equalOrHigher("1.4")&&(t+=`.${this.extension}`);let n=qa.createXMLHttpRequest();n.open("GET",t,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=()=>{if(n.readyState===4)if(n.status===200||n.status===0){let s=n.response;this.parse(e,s)}else console.log("Failed to load file! HTTP status: "+n.status+", file: "+t)},n.send(null)}async parse(e,t){let n=new LASFile(t),s=new D1(e);try{await n.open(),n.isOpen=!0}catch{console.log("failed to open file. :(");return}let r=await n.getHeader(),o=1,a=0,l=o<=1?r.pointsCount:r.pointsCount/o,c=!0;for(;c;){let u=await n.readData(1e6,0,o);s.push(new LASDecoder(u.buffer,r.pointsFormatId,r.pointsStructSize,u.count,r.scale,r.offset,r.mins,r.maxs)),a+=u.count,nu.progressCB(a/l),c=u.hasMoreData}r.totalRead=a,r.versionAsString=n.versionAsString,r.isCompressed=n.isCompressed,nu.progressCB(1);try{await n.close(),n.isOpen=!1}catch(u){throw console.error("failed to close las/laz file!!!"),u}}handle(e,t){}}class D1{constructor(e){this.node=e}push(e){const t=Potree.scriptPath+"/workers/LASDecoderWorker.js",n=Potree.workerPool.getWorker(t),r=this.node.pcoGeometry.pointAttributes;n.onmessage=a=>{let l=new wt,c=e.pointsCount,u=new Float32Array(a.data.position),h=new Uint8Array(a.data.color),d=new Float32Array(a.data.intensity),f=new Uint8Array(a.data.classification),m=new Uint8Array(a.data.returnNumber),v=new Uint8Array(a.data.numberOfReturns),_=new Uint16Array(a.data.pointSourceID),y=new Uint8Array(a.data.indices);l.setAttribute("position",new tt(u,3)),l.setAttribute("color",new tt(h,4,!0)),l.setAttribute("intensity",new tt(d,1)),l.setAttribute("classification",new tt(f,1)),l.setAttribute("return number",new tt(m,1)),l.setAttribute("number of returns",new tt(v,1)),l.setAttribute("source id",new tt(_,1)),l.setAttribute("indices",new tt(y,4)),l.attributes.indices.normalized=!0;for(const R in a.data.ranges){const I=a.data.ranges[R],B=r.attributes.find(N=>N.name===R);B.range[0]=Math.min(B.range[0],I[0]),B.range[1]=Math.max(B.range[1],I[1])}let x=new Wt(new S().fromArray(a.data.tightBoundingBox.min),new S().fromArray(a.data.tightBoundingBox.max));l.boundingBox=this.node.boundingBox,this.node.tightBoundingBox=x,this.node.geometry=l,this.node.numPoints=c,this.node.loaded=!0,this.node.loading=!1,Potree.numNodesLoading--,this.node.mean=new S(...a.data.mean),Potree.workerPool.returnWorker(t,n)};let o={buffer:e.arrayb,numPoints:e.pointsCount,pointSize:e.pointSize,pointFormatID:2,scale:e.scale,offset:e.offset,mins:e.mins,maxs:e.maxs};n.postMessage(o,[o.buffer])}}class P1{constructor(e,t,n){typeof e=="string"?this.version=new ca(e):this.version=e,this.boundingBox=t,this.scale=n}load(e){if(e.loaded)return;let t=e.getURL();this.version.equalOrHigher("1.4")&&(t+=".bin");let n=qa.createXMLHttpRequest();n.open("GET",t,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=()=>{if(n.readyState===4)if((n.status===200||n.status===0)&&n.response!==null){let s=n.response;this.parse(e,s)}else throw new Error(`Failed to load file! HTTP status: ${n.status}, file: ${t}`)};try{n.send(null)}catch(s){console.log("fehler beim laden der punktwolke: "+s)}}parse(e,t){let n=e.pcoGeometry.pointAttributes,s=t.byteLength/e.pcoGeometry.pointAttributes.byteSize;this.version.upTo("1.5")&&(e.numPoints=s);let r=Potree.scriptPath+"/workers/BinaryDecoderWorker.js",o=Potree.workerPool.getWorker(r);o.onmessage=function(l){let c=l.data,u=c.attributeBuffers,h=new Wt(new S().fromArray(c.tightBoundingBox.min),new S().fromArray(c.tightBoundingBox.max));Potree.workerPool.returnWorker(r,o);let d=new wt;for(let m in u){let v=u[m].buffer,_=u[m].attribute;if(m==="POSITION_CARTESIAN")d.setAttribute("position",new tt(new Float32Array(v),3));else if(m==="rgba")d.setAttribute("rgba",new tt(new Uint8Array(v),4,!0));else if(m==="NORMAL_SPHEREMAPPED")d.setAttribute("normal",new tt(new Float32Array(v),3));else if(m==="NORMAL_OCT16")d.setAttribute("normal",new tt(new Float32Array(v),3));else if(m==="NORMAL")d.setAttribute("normal",new tt(new Float32Array(v),3));else if(m==="INDICES"){let y=new tt(new Uint8Array(v),4);y.normalized=!0,d.setAttribute("indices",y)}else if(m==="SPACING"){let y=new tt(new Float32Array(v),1);d.setAttribute("spacing",y)}else{const y=new tt(new Float32Array(v),1);y.potree={offset:u[m].offset,scale:u[m].scale,preciseBuffer:u[m].preciseBuffer,range:_.range},d.setAttribute(m,y);const x=n.attributes.find(R=>R.name===_.name);x.range[0]=Math.min(x.range[0],_.range[0]),x.range[1]=Math.max(x.range[1],_.range[1]),e.getLevel()===0&&(x.initialRange=_.range)}}h.max.sub(h.min),h.min.set(0,0,0);let f=l.data.buffer.byteLength/n.byteSize;e.numPoints=f,e.geometry=d,e.mean=new S(...c.mean),e.tightBoundingBox=h,e.loaded=!0,e.loading=!1,e.estimatedSpacing=c.estimatedSpacing,Potree.numNodesLoading--};let a={buffer:t,pointAttributes:n,version:this.version.version,min:[e.boundingBox.min.x,e.boundingBox.min.y,e.boundingBox.min.z],offset:[e.pcoGeometry.offset.x,e.pcoGeometry.offset.y,e.pcoGeometry.offset.z],scale:this.scale,spacing:e.spacing,hasChildren:e.hasChildren,name:e.name};o.postMessage(a,[a.buffer])}}function L1(i){let e=new ca(i.version);const t={COLOR_PACKED:"rgba",RGBA:"rgba",INTENSITY:"intensity",CLASSIFICATION:"classification",GPS_TIME:"gps-time"},n=r=>t[r]?t[r]:r,s=[];if(e.upTo("1.7"))for(let r of i.pointAttributes){const o=St[r],a={name:o.name,size:o.byteSize,elements:o.numElements,elementSize:o.byteSize/o.numElements,type:o.type.name,description:""};s.push(a)}else s.push(...i.pointAttributes);{const r=new Ql,o={int8:Lt.DATA_TYPE_INT8,int16:Lt.DATA_TYPE_INT16,int32:Lt.DATA_TYPE_INT32,int64:Lt.DATA_TYPE_INT64,uint8:Lt.DATA_TYPE_UINT8,uint16:Lt.DATA_TYPE_UINT16,uint32:Lt.DATA_TYPE_UINT32,uint64:Lt.DATA_TYPE_UINT64,double:Lt.DATA_TYPE_DOUBLE,float:Lt.DATA_TYPE_FLOAT};for(const a of s){const l=n(a.name),c=o[a.type],u=a.elements,h=a.description,d=new St(l,c,u);r.add(d)}if(s.find(l=>l.name==="NormalX")!==void 0&&s.find(l=>l.name==="NormalY")!==void 0&&s.find(l=>l.name==="NormalZ")!==void 0){let l={name:"NORMAL",attributes:["NormalX","NormalY","NormalZ"]};r.addVector(l)}return r}}function eg(i){const e=new Ql;return e.add(St.POSITION_CARTESIAN),e.add(new St("rgba",Lt.DATA_TYPE_UINT8,4)),e.add(new St("intensity",Lt.DATA_TYPE_UINT16,1)),e.add(new St("classification",Lt.DATA_TYPE_UINT8,1)),e.add(new St("gps-time",Lt.DATA_TYPE_DOUBLE,1)),e.add(new St("number of returns",Lt.DATA_TYPE_UINT8,1)),e.add(new St("return number",Lt.DATA_TYPE_UINT8,1)),e.add(new St("source id",Lt.DATA_TYPE_UINT16,1)),e}class tg{static load(e,t){try{let n=new Wm;n.url=e;let s=qa.createXMLHttpRequest();s.open("GET",e,!0),s.onreadystatechange=function(){if(s.readyState===4&&(s.status===200||s.status===0)){let r=JSON.parse(s.responseText),o=new ca(r.version);r.octreeDir.indexOf("http")===0?n.octreeDir=r.octreeDir:n.octreeDir=e+"/../"+r.octreeDir,n.spacing=r.spacing,n.hierarchyStepSize=r.hierarchyStepSize,n.pointAttributes=r.pointAttributes;let a=new S(r.boundingBox.lx,r.boundingBox.ly,r.boundingBox.lz),l=new S(r.boundingBox.ux,r.boundingBox.uy,r.boundingBox.uz),c=new Wt(a,l),u=c.clone();r.tightBoundingBox&&(u.min.copy(new S(r.tightBoundingBox.lx,r.tightBoundingBox.ly,r.tightBoundingBox.lz)),u.max.copy(new S(r.tightBoundingBox.ux,r.tightBoundingBox.uy,r.tightBoundingBox.uz)));let h=a.clone();c.min.sub(h),c.max.sub(h),u.min.sub(h),u.max.sub(h),n.projection=r.projection,n.boundingBox=c,n.tightBoundingBox=u,n.boundingSphere=c.getBoundingSphere(new fi),n.tightBoundingSphere=u.getBoundingSphere(new fi),n.offset=h,r.pointAttributes==="LAS"?(n.loader=new nu(r.version,"las"),n.pointAttributes=eg(r)):r.pointAttributes==="LAZ"?(n.loader=new nu(r.version,"laz"),n.pointAttributes=eg(r)):(n.loader=new P1(r.version,c,r.scale),n.pointAttributes=L1(r));let d={};{let f="r",m=new aa(f,n,c);m.level=0,m.hasChildren=!0,m.spacing=n.spacing,o.upTo("1.5")?m.numPoints=r.hierarchy[0][1]:m.numPoints=0,n.root=m,n.root.load(),d[f]=m}if(o.upTo("1.4"))for(let f=1;f<r.hierarchy.length;f++){let m=r.hierarchy[f][0],v=r.hierarchy[f][1],_=parseInt(m.charAt(m.length-1)),y=m.substring(0,m.length-1),x=d[y],R=m.length-1,I=He.createChildAABB(x.boundingBox,_),B=new aa(m,n,I);B.level=R,B.numPoints=v,B.spacing=n.spacing/Math.pow(2,R),x.addChild(B),d[m]=B}n.nodes=d,t(n)}},s.send(null)}catch(n){console.log("loading failed: '"+e+"'"),console.log(n),t()}}loadPointAttributes(e){let t=e.pointAttributes,n=new Ql;for(let s=0;s<t.length;s++){let r=St[t[s]];n.add(r)}return n}createChildAABB(e,t){let n=e.min.clone(),s=e.max.clone(),r=new S().subVectors(s,n);return(t&1)>0?n.z+=r.z/2:s.z-=r.z/2,(t&2)>0?n.y+=r.y/2:s.y-=r.y/2,(t&4)>0?n.x+=r.x/2:s.x-=r.x/2,new Wt(n,s)}}class R1{constructor(){this.url=null,this.spacing=0,this.boundingBox=null,this.root=null,this.pointAttributes=null,this.loader=null}}class su{constructor(e,t,n){this.id=su.IDCount++,this.name=e,this.index=parseInt(e.charAt(e.length-1)),this.octreeGeometry=t,this.boundingBox=n,this.boundingSphere=n.getBoundingSphere(new fi),this.children={},this.numPoints=0,this.level=null,this.oneTimeDisposeHandlers=[]}isGeometryNode(){return!0}getLevel(){return this.level}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}getChildren(){let e=[];for(let t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e}getBoundingBox(){return this.boundingBox}load(){Potree.numNodesLoading>=Potree.maxNodesLoading||this.octreeGeometry.loader.load(this)}getNumPoints(){return this.numPoints}dispose(){if(this.geometry&&this.parent!=null){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(let e=0;e<this.oneTimeDisposeHandlers.length;e++){let t=this.oneTimeDisposeHandlers[e];t()}this.oneTimeDisposeHandlers=[]}}}su.IDCount=0;class ig{constructor(e){this.url=e}async load(e){if(!(e.loaded||e.loading)){e.loading=!0,Potree.numNodesLoading++;try{e.nodeType===2&&await this.loadHierarchy(e);let{byteOffset:t,byteSize:n}=e,s=`${this.url}/../octree.bin`,r=t,o=t+n-1n,a;n===0n?(a=new ArrayBuffer(0),console.warn(`loaded node with 0 bytes: ${e.name}`)):a=await(await fetch(s,{headers:{"content-type":"multipart/byteranges",Range:`bytes=${r}-${o}`}})).arrayBuffer();let l;this.metadata.encoding==="BROTLI"?l=Potree.scriptPath+"/workers/2.0/DecoderWorker_brotli.js":l=Potree.scriptPath+"/workers/2.0/DecoderWorker.js";let c=Potree.workerPool.getWorker(l);c.onmessage=function(R){let I=R.data,B=I.attributeBuffers;Potree.workerPool.returnWorker(l,c);let N=new wt;for(let J in B){let ne=B[J].buffer;if(J==="position")N.setAttribute("position",new tt(new Float32Array(ne),3));else if(J==="rgba")N.setAttribute("rgba",new tt(new Uint8Array(ne),4,!0));else if(J==="NORMAL")N.setAttribute("normal",new tt(new Float32Array(ne),3));else if(J==="INDICES"){let se=new tt(new Uint8Array(ne),4);se.normalized=!0,N.setAttribute("indices",se)}else{const se=new tt(new Float32Array(ne),1);let E=B[J].attribute;se.potree={offset:B[J].offset,scale:B[J].scale,preciseBuffer:B[J].preciseBuffer,range:E.range},N.setAttribute(J,se)}}e.density=I.density,e.geometry=N,e.loaded=!0,e.loading=!1,Potree.numNodesLoading--};let u=e.octreeGeometry.pointAttributes,h=e.octreeGeometry.scale,d=e.boundingBox,f=e.octreeGeometry.offset.clone().add(d.min),m=d.max.clone().sub(d.min),v=f.clone().add(m),_=e.numPoints,y=e.octreeGeometry.loader.offset,x={name:e.name,buffer:a,pointAttributes:u,scale:h,min:f,max:v,size:m,offset:y,numPoints:_};c.postMessage(x,[x.buffer])}catch(t){e.loaded=!1,e.loading=!1,Potree.numNodesLoading--,console.log(`failed to load ${e.name}`),console.log(t),console.log("trying again!")}}}parseHierarchy(e,t){let n=new DataView(t),s=performance.now(),r=22,o=t.byteLength/r,a=e.octreeGeometry,l=new Array(o);l[0]=e;let c=1;for(let h=0;h<o;h++){let d=l[h],f=n.getUint8(h*r+0),m=n.getUint8(h*r+1),v=n.getUint32(h*r+2,!0),_=n.getBigInt64(h*r+6,!0),y=n.getBigInt64(h*r+14,!0);if(d.nodeType===2?(d.byteOffset=_,d.byteSize=y,d.numPoints=v):f===2?(d.hierarchyByteOffset=_,d.hierarchyByteSize=y,d.numPoints=v):(d.byteOffset=_,d.byteSize=y,d.numPoints=v),d.byteSize===0n&&(d.numPoints=0),d.nodeType=f,d.nodeType!==2)for(let x=0;x<8;x++){if(!((1<<x&m)!==0))continue;let I=d.name+x,B=F1(d.boundingBox,x),N=new su(I,a,B);N.name=I,N.spacing=d.spacing/2,N.level=d.level+1,d.children[x]=N,N.parent=d,l[c]=N,c++}}let u=performance.now()-s}async loadHierarchy(e){let{hierarchyByteOffset:t,hierarchyByteSize:n}=e,s=`${this.url}/../hierarchy.bin`,r=t,o=r+n-1n,l=await(await fetch(s,{headers:{"content-type":"multipart/byteranges",Range:`bytes=${r}-${o}`}})).arrayBuffer();this.parseHierarchy(e,l)}}let I1=new S;function F1(i,e){let t=i.min.clone(),n=i.max.clone(),s=I1.subVectors(n,t);return(e&1)>0?t.z+=s.z/2:n.z-=s.z/2,(e&2)>0?t.y+=s.y/2:n.y-=s.y/2,(e&4)>0?t.x+=s.x/2:n.x-=s.x/2,new Wt(t,n)}let B1={double:Lt.DATA_TYPE_DOUBLE,float:Lt.DATA_TYPE_FLOAT,int8:Lt.DATA_TYPE_INT8,uint8:Lt.DATA_TYPE_UINT8,int16:Lt.DATA_TYPE_INT16,uint16:Lt.DATA_TYPE_UINT16,int32:Lt.DATA_TYPE_INT32,uint32:Lt.DATA_TYPE_UINT32,int64:Lt.DATA_TYPE_INT64,uint64:Lt.DATA_TYPE_UINT64};class ru{static parseAttributes(e){let t=new Ql,n={rgb:"rgba"};for(const s of e){let{name:r,description:o,size:a,numElements:l,elementSize:c,min:u,max:h}=s,d=B1[s.type],f=n[r]?n[r]:r,m=new St(f,d,l);l===1?m.range=[u[0],h[0]]:m.range=[u,h],r==="gps-time"&&m.range[0]===m.range[1]&&(m.range[1]+=1),m.initialRange=m.range,t.add(m)}if(t.attributes.find(r=>r.name==="NormalX")!==void 0&&t.attributes.find(r=>r.name==="NormalY")!==void 0&&t.attributes.find(r=>r.name==="NormalZ")!==void 0){let r={name:"NORMAL",attributes:["NormalX","NormalY","NormalZ"]};t.addVector(r)}return t}static async load(e){let n=await(await fetch(e)).json(),s=ru.parseAttributes(n.attributes),r=new ig(e);r.metadata=n,r.attributes=s,r.scale=n.scale,r.offset=n.offset;let o=new R1;o.url=e,o.spacing=n.spacing,o.scale=n.scale;let a=new S(...n.boundingBox.min),l=new S(...n.boundingBox.max),c=new Wt(a,l),u=a.clone();c.min.sub(u),c.max.sub(u),o.projection=n.projection,o.boundingBox=c,o.tightBoundingBox=c.clone(),o.boundingSphere=c.getBoundingSphere(new fi),o.tightBoundingSphere=c.getBoundingSphere(new fi),o.offset=u,o.pointAttributes=ru.parseAttributes(n.attributes),o.loader=r;let h=new su("r",o,c);return h.level=0,h.nodeType=2,h.hierarchyByteOffset=0n,h.hierarchyByteSize=BigInt(n.hierarchy.firstChunkSize),h.hasChildren=!1,h.spacing=o.spacing,h.byteOffset=0,o.root=h,r.load(h),{geometry:o}}}class ng{static async load(e,t){let s=await(await fetch(e)).json(),r=e.substr(0,e.lastIndexOf("/ept.json")),o=new Potree.PointCloudEptGeometry(r,s),a=new Potree.PointCloudCopcGeometryNode(o);o.root=a,o.root.load(),t(o)}}class sg{static async load(e,t){const{Copc:n,Getter:s}=window.Copc,r=e,o=s.http(r),a=await n.create(o);let l=new Potree.PointCloudCopcGeometry(o,a),c=new Potree.PointCloudCopcGeometryNode(l);l.root=c,l.root.load(),t(l)}}class rg{extension(){return".bin"}workerPath(){return Potree.scriptPath+"/workers/EptBinaryDecoderWorker.js"}load(e){if(e.loaded)return;let t=e.url()+this.extension(),n=qa.createXMLHttpRequest();n.open("GET",t,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=()=>{if(n.readyState===4)if(n.status===200){let s=n.response;this.parse(e,s)}else console.log("Failed "+t+": "+n.status)};try{n.send(null)}catch(s){console.log("Failed request: "+s)}}parse(e,t){let n=this.workerPath(),s=Potree.workerPool.getWorker(n);s.onmessage=function(a){let l=new wt,c=a.data.numPoints,u=new Float32Array(a.data.position);l.setAttribute("position",new tt(u,3));let h=new Uint8Array(a.data.indices);if(l.setAttribute("indices",new tt(h,4)),a.data.color){let f=new Uint8Array(a.data.color);l.setAttribute("color",new tt(f,4,!0))}if(a.data.intensity){let f=new Float32Array(a.data.intensity);l.setAttribute("intensity",new tt(f,1))}if(a.data.classification){let f=new Uint8Array(a.data.classification);l.setAttribute("classification",new tt(f,1))}if(a.data.returnNumber){let f=new Uint8Array(a.data.returnNumber);l.setAttribute("return number",new tt(f,1))}if(a.data.numberOfReturns){let f=new Uint8Array(a.data.numberOfReturns);l.setAttribute("number of returns",new tt(f,1))}if(a.data.pointSourceId){let f=new Uint16Array(a.data.pointSourceId);l.setAttribute("source id",new tt(f,1))}l.attributes.indices.normalized=!0;let d=new Wt(new S().fromArray(a.data.tightBoundingBox.min),new S().fromArray(a.data.tightBoundingBox.max));e.doneLoading(l,d,c,new S(...a.data.mean)),Potree.workerPool.returnWorker(n,s)};let r=a=>[a.x,a.y,a.z],o={buffer:t,schema:e.ept.schema,scale:e.ept.eptScale,offset:e.ept.eptOffset,mins:r(e.key.b.min)};s.postMessage(o,[o.buffer])}}class N1{async load(e){if(e.loaded)return;const{Key:t}=window.Copc,n=`${e.owner.base}/ept-data/${t.toString(e.key)}.laz`,r=await(await fetch(n)).arrayBuffer();this.parse(e,r)}async parse(e,t){let n=new nf(e);try{const{Bounds:s,Las:r}=Copc,o=(d,f)=>new Uint8Array(t,d,f-d),a=r.Header.parse(new Uint8Array(t)),l=await r.Vlr.walk(o,a);let c=[];const u=r.Vlr.find(l,"LASF_Spec",4);u&&(c=r.ExtraBytes.parse(await r.Vlr.fetch(o,u)));const h={isFullFile:!0,compressed:t,header:a,eb:c,pointCount:a.pointCount,nodemin:s.min(e.bounds)};n.push(h)}catch(s){console.log("Failed:",s)}}}class O1{async load(e){if(e.loaded)return;const{pointCount:t,pointDataOffset:n,pointDataLength:s}=e.nodeinfo;if(!t)return this.parse(e,new ArrayBuffer);const r=await e.owner.getter(n,n+s);this.parse(e,r.buffer)}async parse(e,t){let n=new nf(e);try{n.push({isFullFile:!1,compressed:t,header:e.owner.copc.header,eb:e.owner.copc.eb,pointCount:e.nodeinfo.pointCount,nodemin:e.bounds.slice(0,3)})}catch(s){console.log("Failed:",s)}}}class nf{constructor(e){this.node=e}push(e){const{isFullFile:t,compressed:n,header:s,eb:r,pointCount:o,nodemin:a}=e;let l=Potree.scriptPath+"/workers/EptLaszipDecoderWorker.js",c=Potree.workerPool.getWorker(l);const u=this.node.owner.pointAttributes;c.onmessage=d=>{let f=new wt,m=new Float32Array(d.data.position),v=new Uint8Array(d.data.color),_=new Float32Array(d.data.intensity),y=new Uint8Array(d.data.classification),x=new Uint8Array(d.data.returnNumber),R=new Uint8Array(d.data.numberOfReturns),I=new Uint16Array(d.data.pointSourceId),B=new Uint8Array(d.data.indices),N=new Float32Array(d.data.gpsTime);f.setAttribute("position",new tt(m,3)),f.setAttribute("rgba",new tt(v,4,!0)),f.setAttribute("intensity",new tt(_,1)),f.setAttribute("classification",new tt(y,1)),f.setAttribute("return number",new tt(x,1)),f.setAttribute("number of returns",new tt(R,1)),f.setAttribute("source id",new tt(I,1)),f.setAttribute("indices",new tt(B,4)),f.setAttribute("gps-time",new tt(N,1)),this.node.gpsTime=d.data.gpsMeta,f.attributes.indices.normalized=!0;for(const ne in d.data.ranges){const se=d.data.ranges[ne],E=u.attributes.find(M=>M.name===ne);E&&(E.range[0]=Math.min(E.range[0],se[0]),E.range[1]=Math.max(E.range[1],se[1]),E.initialRange||(E.initialRange=E.range))}let J=new Wt(new S().fromArray(d.data.tightBoundingBox.min),new S().fromArray(d.data.tightBoundingBox.max));this.node.doneLoading(f,J,o,new S(...d.data.mean)),Potree.workerPool.returnWorker(l,c)};let h={isFullFile:t,compressed:n,header:s,eb:r,pointCount:o,nodemin:a};c.postMessage(h,[h.compressed])}}class k1 extends rg{extension(){return".zst"}workerPath(){return Potree.scriptPath+"/workers/EptZstandardDecoderWorker.js"}}class z1{constructor(){this.transform=null}async load(e){const t=new dn({color:16711680,linewidth:3,resolution:new Se(1e3,1e3),dashed:!1}),n=await this.loadShapefileFeatures(e),s=new qe;for(const a of n){const l=this.featureToSceneNode(a,t);s.add(l)}return{features:n,node:s,setResolution:(a,l)=>{t.resolution.set(a,l)}}}featureToSceneNode(e,t){let n=e.geometry,s=new Ee(1,1,1),r=this.transform;if(r===null&&(r={forward:o=>o}),e.geometry.type==="Point"){let o=new Li(1,18,18),a=new Ki,l=new ot(o,a),[c,u]=n.coordinates,h=r.forward([c,u]);return l.position.set(...h,20),l.scale.set(10,10,10),l}else if(n.type==="LineString"){let o=[],a=new S(1/0,1/0,1/0);for(let u=0;u<n.coordinates.length;u++){let[h,d]=n.coordinates[u],f=r.forward([h,d]);a.x=Math.min(a.x,f[0]),a.y=Math.min(a.y,f[1]),a.z=Math.min(a.z,20),o.push(...f,20),u>0&&u<n.coordinates.length-1&&o.push(...f,20)}for(let u=0;u<o.length;u+=3)o[u+0]-=a.x,o[u+1]-=a.y,o[u+2]-=a.z;const l=new _n;l.setPositions(o);const c=new Bn(l,t);return c.computeLineDistances(),c.scale.set(1,1,1),c.position.copy(a),c}else if(n.type==="Polygon")for(let o of n.coordinates){let a=[],l=new S(1/0,1/0,1/0);for(let h=0;h<o.length;h++){let[d,f]=o[h],m=r.forward([d,f]);l.x=Math.min(l.x,m[0]),l.y=Math.min(l.y,m[1]),l.z=Math.min(l.z,20),a.push(...m,20),h>0&&h<o.length-1&&a.push(...m,20)}for(let h=0;h<a.length;h+=3)a[h+0]-=l.x,a[h+1]-=l.y,a[h+2]-=l.z;const c=new _n;c.setPositions(a);const u=new Bn(c,t);return u.computeLineDistances(),u.scale.set(1,1,1),u.position.copy(l),u}else console.log("unhandled feature: ",e)}async loadShapefileFeatures(e){let t=[],n=await shapefile.open(e);for(;;){let s=await n.read();if(s.done)break;s.value&&s.value.type==="Feature"&&s.value.geometry!==void 0&&t.push(s.value)}return t}}const og={landuse:[.5,.5,.5],natural:[0,1,0],places:[1,0,1],points:[0,1,1],roads:[1,1,0],waterways:[0,0,1],default:[.9,.6,.1]};function U1(i){let e=og[i];return e||(e=og.default),e}class ag{constructor(){this.path=null,this.node=null}}class Lh{constructor(){}static async loadUrl(e,t){await Promise.all([He.loadScript(`${Potree.scriptPath}/lazylibs/geopackage/geopackage.js`),He.loadScript(`${Potree.scriptPath}/lazylibs/sql.js/sql-wasm.js`)]);const s=await(await fetch(e)).arrayBuffer();return t=t||{},t.source=e,Lh.loadBuffer(s,t)}static async loadBuffer(e,t){await Promise.all([He.loadScript(`${Potree.scriptPath}/lazylibs/geopackage/geopackage.js`),He.loadScript(`${Potree.scriptPath}/lazylibs/sql.js/sql-wasm.js`)]),t=t||{};const n=async s=>{let r=t.transform;r||(r={forward:f=>f});const o=`${Potree.scriptPath}/lazylibs/sql.js/sql-wasm.wasm`,a=await initSqlJs({locateFile:f=>o}),l=new Uint8Array(e),c=await geopackage.open(l);window.data=c;const u=new qe;u.name=t.source,u.potree={source:t.source};const h=new ag;h.path=t.source,h.node=u;const d=c.getTables();for(const f of d.features){const m=c.getFeatureDao(f);let v=m.getBoundingBox();v=v.projectBoundingBox(m.projection,"EPSG:4326");const _=c.queryForGeoJSONFeaturesInTable(f,v),y=new dn({color:new Ee().setRGB(...U1(f)),linewidth:2,resolution:new Se(1e3,1e3),dashed:!1}),x=new qe;x.name=f,h.node.add(x);for(const[R,I]of Object.entries(_)){const B=Lh.featureToSceneNode(I,y,m.projection,r);x.add(B)}}s(h)};return new Promise(n)}static featureToSceneNode(e,t,n,s){let r=e.geometry,o=new Ee(1,1,1);if(e.geometry.type==="Point"){let a=new Li(1,18,18),l=new Ki,c=new ot(a,l),[u,h]=r.coordinates,d=s.forward(n.forward([u,h]));return c.position.set(...d,20),c.scale.set(10,10,10),c}else if(r.type==="LineString"){let a=[],l=new S(1/0,1/0,1/0);for(let h=0;h<r.coordinates.length;h++){let[d,f]=r.coordinates[h],m=s.forward(n.forward([d,f]));l.x=Math.min(l.x,m[0]),l.y=Math.min(l.y,m[1]),l.z=Math.min(l.z,20),a.push(...m,20),h>0&&h<r.coordinates.length-1&&a.push(...m,20)}for(let h=0;h<a.length;h+=3)a[h+0]-=l.x,a[h+1]-=l.y,a[h+2]-=l.z;const c=new _n;c.setPositions(a);const u=new Bn(c,t);return u.computeLineDistances(),u.scale.set(1,1,1),u.position.copy(l),u}else if(r.type==="Polygon")for(let a of r.coordinates){let l=[],c=new S(1/0,1/0,1/0);for(let d=0;d<a.length;d++){let[f,m]=a[d],v=s.forward(n.forward([f,m]));c.x=Math.min(c.x,v[0]),c.y=Math.min(c.y,v[1]),c.z=Math.min(c.z,20),l.push(...v,20),d>0&&d<a.length-1&&l.push(...v,20)}for(let d=0;d<l.length;d+=3)l[d+0]-=c.x,l[d+1]-=c.y,l[d+2]-=c.z;const u=new _n;u.setPositions(l);const h=new Bn(u,t);return h.computeLineDistances(),h.scale.set(1,1,1),h.position.copy(c),h}else console.log("unhandled feature: ",e)}}class lg extends qe{constructor(e){super(),this.constructor.counter=this.constructor.counter===void 0?0:this.constructor.counter+1,this.name="clip_volume_"+this.constructor.counter;let t=e.alpha||0,n=e.beta||0,s=e.gamma||0;this.rotation.x=t,this.rotation.y=n,this.rotation.z=s,this.clipOffset=.001,this.clipRotOffset=1;let r=new Ul(1,1,1);r.computeBoundingBox();let o=new ti;o.vertices.push(new S(-.5,-.5,.5)),o.vertices.push(new S(.5,-.5,.5)),o.vertices.push(new S(.5,-.5,.5)),o.vertices.push(new S(.5,-.5,-.5)),o.vertices.push(new S(.5,-.5,-.5)),o.vertices.push(new S(-.5,-.5,-.5)),o.vertices.push(new S(-.5,-.5,-.5)),o.vertices.push(new S(-.5,-.5,.5)),o.vertices.push(new S(-.5,.5,.5)),o.vertices.push(new S(.5,.5,.5)),o.vertices.push(new S(.5,.5,.5)),o.vertices.push(new S(.5,.5,-.5)),o.vertices.push(new S(.5,.5,-.5)),o.vertices.push(new S(-.5,.5,-.5)),o.vertices.push(new S(-.5,.5,-.5)),o.vertices.push(new S(-.5,.5,.5)),o.vertices.push(new S(-.5,-.5,.5)),o.vertices.push(new S(-.5,.5,.5)),o.vertices.push(new S(.5,-.5,.5)),o.vertices.push(new S(.5,.5,.5)),o.vertices.push(new S(.5,-.5,-.5)),o.vertices.push(new S(.5,.5,-.5)),o.vertices.push(new S(-.5,-.5,-.5)),o.vertices.push(new S(-.5,.5,-.5)),o.colors.push(new S(1,1,1));let a=new ti;a.vertices.push(new S(-.5,-.5,0)),a.vertices.push(new S(-.5,.5,0)),a.vertices.push(new S(.5,.5,0)),a.vertices.push(new S(.5,-.5,0)),a.vertices.push(new S(-.5,.5,0)),a.vertices.push(new S(.5,.5,0)),a.vertices.push(new S(-.5,-.5,0)),a.vertices.push(new S(.5,-.5,0)),this.dimension=new S(1,1,1),this.material=new Ut({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1}),this.box=new ot(r,this.material),this.box.geometry.computeBoundingBox(),this.boundingBox=this.box.geometry.boundingBox,this.add(this.box),this.frame=new Hi(o,new ri({color:0})),this.add(this.frame),this.planeFrame=new Hi(a,new ri({color:16711680})),this.add(this.planeFrame),this.setScaleZ(.1);let l=(c,u,h)=>{let d=new Ut({color:h,depthTest:!1,depthWrite:!1}),f=new ti;f.vertices.push(new S(0,0,0)),f.vertices.push(new S(0,1,0));let m=new ri({color:h,depthTest:!1,depthWrite:!1,transparent:!0}),v=new wn(f,m);v.name=c+"_shaft";let _=new Ku(0,.04,.1,10,1,!1),y=d,x=new ot(_,y);x.name=c+"_head",x.position.y=1;let R=new qe;return R.name=c,R.add(v),R.add(x),R};this.arrowX=l("arrow_x",new S(1,0,0),16711680),this.arrowY=l("arrow_y",new S(0,1,0),65280),this.arrowZ=l("arrow_z",new S(0,0,1),255),this.arrowX.rotation.z=-Math.PI/2,this.arrowZ.rotation.x=Math.PI/2,this.arrowX.visible=!1,this.arrowY.visible=!1,this.arrowZ.visible=!1,this.add(this.arrowX),this.add(this.arrowY),this.add(this.arrowZ),this.addEventListener("ui_select",c=>{this.arrowX.visible=!0,this.arrowY.visible=!0,this.arrowZ.visible=!0}),this.addEventListener("ui_deselect",c=>{this.arrowX.visible=!1,this.arrowY.visible=!1,this.arrowZ.visible=!1}),this.addEventListener("select",c=>{let u=$("#"+this.name+" .scene_header");u.next().is(":visible")||u.click()}),this.addEventListener("deselect",c=>{let u=$("#"+this.name+" .scene_header");u.next().is(":visible")&&u.click()}),this.update()}setClipOffset(e){this.clipOffset=e}setClipRotOffset(e){this.clipRotOffset=e}setScaleX(e){this.box.scale.x=e,this.frame.scale.x=e,this.planeFrame.scale.x=e}setScaleY(e){this.box.scale.y=e,this.frame.scale.y=e,this.planeFrame.scale.y=e}setScaleZ(e){this.box.scale.z=e,this.frame.scale.z=e,this.planeFrame.scale.z=e}offset(e){let t=e.cs||null,n=e.axis||null,s=e.dir||null;!t||!n||!s||(n==="x"?t==="local"?this.position.add(this.localX.clone().multiplyScalar(s*this.clipOffset)):t==="global"&&(this.position.x=this.position.x+s*this.clipOffset):n==="y"?t==="local"?this.position.add(this.localY.clone().multiplyScalar(s*this.clipOffset)):t==="global"&&(this.position.y=this.position.y+s*this.clipOffset):n==="z"&&(t==="local"?this.position.add(this.localZ.clone().multiplyScalar(s*this.clipOffset)):t==="global"&&(this.position.z=this.position.z+s*this.clipOffset)),this.dispatchEvent({type:"clip_volume_changed",viewer,volume:this}))}rotate(e){let t=e.cs||null,n=e.axis||null,s=e.dir||null;if(!(!t||!n||!s)){if(t==="local")n==="x"?this.rotateOnAxis(new S(1,0,0),s*this.clipRotOffset*Math.PI/180):n==="y"?this.rotateOnAxis(new S(0,1,0),s*this.clipRotOffset*Math.PI/180):n==="z"&&this.rotateOnAxis(new S(0,0,1),s*this.clipRotOffset*Math.PI/180);else if(t==="global"){let r=new _t(1,0,0,0);n==="y"?r=new _t(0,1,0,0):n==="z"&&(r=new _t(0,0,1,0)),this.updateMatrixWorld();let o=newthis.matrixWorld.clone().invert();r=r.applyMatrix4(o).normalize(),r=new S(r.x,r.y,r.z),this.rotateOnAxis(r,s*this.clipRotOffset*Math.PI/180)}this.updateLocalSystem(),this.dispatchEvent({type:"clip_volume_changed",viewer,volume:this})}}update(){this.boundingBox=this.box.geometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new fi),this.box.visible=!1,this.updateLocalSystem()}updateLocalSystem(){let e=this.getWorldQuaternion();this.localX=new S(1,0,0).applyQuaternion(e).normalize(),this.localY=new S(0,1,0).applyQuaternion(e).normalize(),this.localZ=new S(0,0,1).applyQuaternion(e).normalize()}raycast(e,t){let n=[];if(this.box.raycast(e,n),n.length>0){let s=n[0];t.push({distance:s.distance,object:this,point:s.point.clone()})}}}class cg extends Ne{constructor(e){super(),this.viewer=e,this.maxPolygonVertices=8,this.addEventListener("start_inserting_clipping_volume",t=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.sceneMarker=new Si,this.sceneVolume=new Si,this.sceneVolume.name="scene_clip_volume",this.viewer.inputHandler.registerInteractiveScene(this.sceneVolume),this.onRemove=t=>{this.sceneVolume.remove(t.volume)},this.onAdd=t=>{this.sceneVolume.add(t.volume)},this.viewer.inputHandler.addEventListener("delete",t=>{t.selection.filter(r=>r instanceof lg).forEach(r=>this.viewer.scene.removeClipVolume(r)),t.selection.filter(r=>r instanceof eu).forEach(r=>this.viewer.scene.removePolygonClipVolume(r))})}setScene(e){this.scene!==e&&(this.scene&&(this.scene.removeEventListeners("clip_volume_added",this.onAdd),this.scene.removeEventListeners("clip_volume_removed",this.onRemove),this.scene.removeEventListeners("polygon_clip_volume_added",this.onAdd),this.scene.removeEventListeners("polygon_clip_volume_removed",this.onRemove)),this.scene=e,this.scene.addEventListener("clip_volume_added",this.onAdd),this.scene.addEventListener("clip_volume_removed",this.onRemove),this.scene.addEventListener("polygon_clip_volume_added",this.onAdd),this.scene.addEventListener("polygon_clip_volume_removed",this.onRemove))}startInsertion(e={}){if(!(e.type||null))return null;let n=this.viewer.renderer.domElement,s=this.viewer.renderer.getSize(new Se),r=$(`
		<svg height="${s.height}" width="${s.width}" style="position:absolute; pointer-events: none">

			<defs>
				 <marker id="diamond" markerWidth="24" markerHeight="24" refX="12" refY="12"
						markerUnits="userSpaceOnUse">
					<circle cx="12" cy="12" r="6" fill="white" stroke="black" stroke-width="3"/>
				</marker>
			</defs>

			<polyline fill="none" stroke="black" 
				style="stroke:rgb(0, 0, 0);
				stroke-width:6;"
				stroke-dasharray="9, 6"
				stroke-dashoffset="2"
				/>

			<polyline fill="none" stroke="black" 
				style="stroke:rgb(255, 255, 255);
				stroke-width:2;"
				stroke-dasharray="5, 10"
				marker-start="url(#diamond)" 
				marker-mid="url(#diamond)" 
				marker-end="url(#diamond)" 
				/>
		</svg>`);$(n.parentElement).append(r);let o=new eu(this.viewer.scene.getActiveCamera().clone());this.dispatchEvent({type:"start_inserting_clipping_volume"}),this.viewer.scene.addPolygonClipVolume(o),this.sceneMarker.add(o);let a={callback:null},l=c=>{c.button===Et.LEFT?(o.addMarker(),r.find("polyline").each((u,h)=>{let d=r[0].createSVGPoint();d.x=c.offsetX,d.y=c.offsetY;let f=h.points.appendItem(d)}),o.markers.length>this.maxPolygonVertices&&a.callback(),this.viewer.inputHandler.startDragging(o.markers[o.markers.length-1])):c.button===Et.RIGHT&&a.callback(c)};return a.callback=c=>{r.remove(),o.markers.length>3?(o.removeLastMarker(),o.initialized=!0):this.viewer.scene.removePolygonClipVolume(o),this.viewer.renderer.domElement.removeEventListener("mouseup",l,!0),this.viewer.removeEventListener("cancel_insertions",a.callback),this.viewer.inputHandler.enabled=!0},this.viewer.addEventListener("cancel_insertions",a.callback),this.viewer.renderer.domElement.addEventListener("mouseup",l,!0),this.viewer.inputHandler.enabled=!1,o.addMarker(),this.viewer.inputHandler.startDragging(o.markers[o.markers.length-1]),o}update(){}}var _E=function(i){"use strict";const e=new Eh({LITTLE:"II",BIG:"MM"}),t=new Eh({BYTE:{value:1,bytes:1},ASCII:{value:2,bytes:1},SHORT:{value:3,bytes:2},LONG:{value:4,bytes:4},RATIONAL:{value:5,bytes:8},SBYTE:{value:6,bytes:1},UNDEFINED:{value:7,bytes:1},SSHORT:{value:8,bytes:2},SLONG:{value:9,bytes:4},SRATIONAL:{value:10,bytes:8},FLOAT:{value:11,bytes:4},DOUBLE:{value:12,bytes:8}}),n=new Eh({IMAGE_WIDTH:256,IMAGE_HEIGHT:257,BITS_PER_SAMPLE:258,COMPRESSION:259,PHOTOMETRIC_INTERPRETATION:262,STRIP_OFFSETS:273,ORIENTATION:274,SAMPLES_PER_PIXEL:277,ROWS_PER_STRIP:278,STRIP_BYTE_COUNTS:279,X_RESOLUTION:282,Y_RESOLUTION:283,PLANAR_CONFIGURATION:284,RESOLUTION_UNIT:296,SOFTWARE:305,COLOR_MAP:320,SAMPLE_FORMAT:339,MODEL_PIXEL_SCALE:33550,MODEL_TIEPOINT:33922,GEO_KEY_DIRECTORY:34735,GEO_DOUBLE_PARAMS:34736,GEO_ASCII_PARAMS:34737}),s=new Map([[t.BYTE,Uint8Array],[t.ASCII,Uint8Array],[t.SHORT,Uint16Array],[t.LONG,Uint32Array],[t.RATIONAL,Uint32Array],[t.SBYTE,Int8Array],[t.UNDEFINED,Uint8Array],[t.SSHORT,Int16Array],[t.SLONG,Int32Array],[t.SRATIONAL,Int32Array],[t.FLOAT,Float32Array],[t.DOUBLE,Float64Array]]);class r{constructor(u,h,d,f,m){this.tag=u,this.type=h,this.count=d,this.offset=f,this.value=m}}class o{constructor(){this.width=0,this.height=0,this.buffer=null,this.metadata=[]}}class a{constructor(){}static read(u){let h=String.fromCharCode(...Array.from(u.slice(0,2))),d=e.fromValue(h);if(u.readUInt8(2)!==42)throw new Error("not a valid tiff file");let m=u.readUInt32LE(4);console.log("offsetToFirstIFD",m);let v=[],_=!1,y=m,x=0;for(;_||x<100;){console.log("currentIFDOffset",y);let V=u.readUInt16LE(y),W=u.readUInt32LE(y+2+V*12);console.log("next offset: ",y+2+V*12);let fe=u.slice(y+2,y+2+12*V);for(let ve=0;ve<V;ve++){let pe=n.fromValue(fe.readUInt16LE(ve*12)),Me=t.fromValue(fe.readUInt16LE(ve*12+2)),Fe=fe.readUInt32LE(ve*12+4),at=fe.readUInt32LE(ve*12+8),bt=Me.bytes*Fe,Ie;if(bt<=4)Ie=at;else{let X=new Uint8Array(bt);X.set(u.slice(at,at+bt));let ce=s.get(Me);Ie=new ce(X.buffer),Me===t.ASCII&&(Ie=String.fromCharCode(...Ie))}let Y=new r(pe,Me,Fe,at,Ie);v.push(Y)}if(console.log("nextIFDOffset",W),W===0)break;y=W,x++}let R=V=>{for(let W of v)if(W.tag===V)return W;return null},I=R(n.IMAGE_WIDTH,v).value,B=R(n.IMAGE_HEIGHT,v).value,N=R(n.COMPRESSION,v).value,J=R(n.ROWS_PER_STRIP,v).value,ne=R(n.STRIP_OFFSETS,v),se=R(n.STRIP_BYTE_COUNTS,v),E=Math.ceil(B/J),M=[];for(let V=0;V<se.count;V++){let W=se.type,fe=se.offset+V*W.bytes,ve;W===t.SHORT?ve=u.readUInt16LE(fe):W===t.LONG&&(ve=u.readUInt32LE(fe)),M.push(ve)}let A=[];for(let V=0;V<ne.count;V++){let W=ne.type,fe=ne.offset+V*W.bytes,ve;W===t.SHORT?ve=u.readUInt16LE(fe):W===t.LONG&&(ve=u.readUInt32LE(fe)),A.push(ve)}let F=new Uint8Array(I*B*3),P=0;for(let V=0;V<E;V++){let W=A[V],fe=M[V],ve=u.slice(W,W+fe),pe=I*3;for(let Me=0;Me<J;Me++){let Fe=ve.slice(Me*pe,Me*pe+pe);if(F.set(Fe,P*pe),Fe.length===pe)P++;else break}}console.log(`width: ${I}`),console.log(`height: ${B}`),console.log(`numStrips: ${E}`),console.log("stripByteCounts",M.join(", ")),console.log("stripOffsets",A.join(", "));let O=new o;return O.width=I,O.height=B,O.buffer=F,O.metadata=v,O}}class l{constructor(){}static toTiffBuffer(u,h={}){let d=8,f=new Uint8Array([73,73,42,0,d,0,0,0]),[m,v]=[u.width,u.height],_=[new r(n.IMAGE_WIDTH,t.SHORT,1,null,m),new r(n.IMAGE_HEIGHT,t.SHORT,1,null,v),new r(n.BITS_PER_SAMPLE,t.SHORT,4,null,new Uint16Array([8,8,8,8])),new r(n.COMPRESSION,t.SHORT,1,null,1),new r(n.PHOTOMETRIC_INTERPRETATION,t.SHORT,1,null,2),new r(n.ORIENTATION,t.SHORT,1,null,1),new r(n.SAMPLES_PER_PIXEL,t.SHORT,1,null,4),new r(n.ROWS_PER_STRIP,t.LONG,1,null,v),new r(n.STRIP_BYTE_COUNTS,t.LONG,1,null,m*v*3),new r(n.PLANAR_CONFIGURATION,t.SHORT,1,null,1),new r(n.RESOLUTION_UNIT,t.SHORT,1,null,1),new r(n.SOFTWARE,t.ASCII,6,null,"......"),new r(n.STRIP_OFFSETS,t.LONG,1,null,null),new r(n.X_RESOLUTION,t.RATIONAL,1,null,new Uint32Array([1,1])),new r(n.Y_RESOLUTION,t.RATIONAL,1,null,new Uint32Array([1,1]))];h.ifdEntries&&_.push(...h.ifdEntries);let y=d+2+_.length*12+4,x=new Map,R=new Map;for(let se of _){let E=new ArrayBuffer(12),M=new DataView(E),A=se.type.bytes*se.count;if(M.setUint16(0,se.tag.value,!0),M.setUint16(2,se.type.value,!0),M.setUint32(4,se.count,!0),se.count===1&&se.type.bytes<=4)M.setUint32(8,se.value,!0);else{M.setUint32(8,y,!0);let F=new Uint8Array(se.count*se.type.bytes);se.type===t.ASCII?F.set(new Uint8Array(se.value.split("").map(P=>P.charCodeAt(0)))):F.set(new Uint8Array(se.value.buffer)),R.set(se.tag,F),y=y+F.byteLength}x.set(se.tag,E)}let I=y;new DataView(x.get(n.STRIP_OFFSETS)).setUint32(8,I,!0);let B=se=>{let E=se.reduce((F,P)=>F+P.byteLength,0),M=new Uint8Array(E),A=0;for(let F of se)M.set(new Uint8Array(F),A),A+=F.byteLength;return M},N=B([new Uint16Array([_.length]),...x.values(),new Uint32Array([0])]),J=B([...R.values()]),ne=B([f,N,J,u.buffer]);return{width:m,height:v,buffer:ne}}}return i.Tag=n,i.Type=t,i.IFDEntry=r,i.Image=o,i.Reader=a,i.Exporter=l,i}({});function G1(i,e){const t=e.azimuth,n=e.points.length===2;if(t.node.visible=n&&e.showAzimuth,!t.node.visible)return;const s=i.scene.getActiveCamera(),r=i.renderer.getSize(new Se),o=r.width,a=r.height,[l,c]=e.points,u=l.position.distanceTo(c.position),h=He.getNorthVec(l.position,u,i.getProjection()),d=l.position.clone().add(h);t.center.position.copy(l.position),t.center.scale.set(2,2,2),t.center.visible=!1;{t.north.position.copy(d),t.north.scale.set(2,2,2);let I=t.north.position.distanceTo(s.position),N=5/He.projectedRadius(1,s,I,o,a);t.north.scale.set(N,N,N)}{t.target.position.copy(c.position),t.target.position.z=t.north.position.z;let I=t.target.position.distanceTo(s.position),N=5/He.projectedRadius(1,s,I,o,a);t.target.scale.set(N,N,N)}t.circle.position.copy(l.position),t.circle.scale.set(u,u,u),t.circle.material.resolution.set(o,a),t.centerToTarget.geometry.setPositions([0,0,0,...c.position.clone().sub(l.position).toArray()]),t.centerToTarget.position.copy(l.position),t.centerToTarget.geometry.verticesNeedUpdate=!0,t.centerToTarget.geometry.computeBoundingSphere(),t.centerToTarget.computeLineDistances(),t.centerToTarget.material.resolution.set(o,a),t.centerToTargetground.geometry.setPositions([0,0,0,c.position.x-l.position.x,c.position.y-l.position.y,0]),t.centerToTargetground.position.copy(l.position),t.centerToTargetground.geometry.verticesNeedUpdate=!0,t.centerToTargetground.geometry.computeBoundingSphere(),t.centerToTargetground.computeLineDistances(),t.centerToTargetground.material.resolution.set(o,a),t.centerToNorth.geometry.setPositions([0,0,0,d.x-l.position.x,d.y-l.position.y,0]),t.centerToNorth.position.copy(l.position),t.centerToNorth.geometry.verticesNeedUpdate=!0,t.centerToNorth.geometry.computeBoundingSphere(),t.centerToNorth.computeLineDistances(),t.centerToNorth.material.resolution.set(o,a);const f=He.computeAzimuth(l.position,c.position,i.getProjection());let m=rt.radToDeg(f);m<0&&(m=360+m);const v=`${m.toFixed(2)}\xB0`,_=d.clone().add(c.position).multiplyScalar(.5).sub(l.position);if(_.length()>0){_.z=0,_.normalize();const I=_.clone().multiplyScalar(u),B=l.position.clone().add(I);t.label.position.copy(B)}t.label.setText(v);let y=t.label.position.distanceTo(s.position),R=70/He.projectedRadius(1,s,y,o,a);t.label.scale.set(R,R,R)}class ug extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_measurement",t=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.showLabels=!0,this.scene=new Si,this.scene.name="scene_measurement",this.light=new yo(16777215,1),this.scene.add(this.light),this.viewer.inputHandler.registerInteractiveScene(this.scene),this.onRemove=t=>{this.scene.remove(t.measurement)},this.onAdd=t=>{this.scene.add(t.measurement)};for(let t of e.scene.measurements)this.onAdd({measurement:t});e.addEventListener("update",this.update.bind(this)),e.addEventListener("render.pass.perspective_overlay",this.render.bind(this)),e.addEventListener("scene_changed",this.onSceneChange.bind(this)),e.scene.addEventListener("measurement_added",this.onAdd),e.scene.addEventListener("measurement_removed",this.onRemove)}onSceneChange(e){e.oldScene&&(e.oldScene.removeEventListener("measurement_added",this.onAdd),e.oldScene.removeEventListener("measurement_removed",this.onRemove)),e.scene.addEventListener("measurement_added",this.onAdd),e.scene.addEventListener("measurement_removed",this.onRemove)}startInsertion(e={}){let t=this.viewer.renderer.domElement,n=new Gr;this.dispatchEvent({type:"start_inserting_measurement",measure:n});const s=(a,l)=>a??l;n.showDistances=e.showDistances===null?!0:e.showDistances,n.showArea=s(e.showArea,!1),n.showAngles=s(e.showAngles,!1),n.showCoordinates=s(e.showCoordinates,!1),n.showHeight=s(e.showHeight,!1),n.showCircle=s(e.showCircle,!1),n.showAzimuth=s(e.showAzimuth,!1),n.showEdges=s(e.showEdges,!0),n.closed=s(e.closed,!1),n.maxMarkers=s(e.maxMarkers,1/0),n.name=e.name||"Measurement",this.scene.add(n);let r={removeLastMarker:n.maxMarkers>3,callback:null},o=a=>{a.button===Et.LEFT?(n.addMarker(n.points[n.points.length-1].position.clone()),n.points.length>=n.maxMarkers&&r.callback(),this.viewer.inputHandler.startDragging(n.spheres[n.spheres.length-1])):a.button===Et.RIGHT&&r.callback()};return r.callback=a=>{r.removeLastMarker&&n.removeMarker(n.points.length-1),t.removeEventListener("mouseup",o,!1),this.viewer.removeEventListener("cancel_insertions",r.callback)},n.maxMarkers>1&&(this.viewer.addEventListener("cancel_insertions",r.callback),t.addEventListener("mouseup",o,!1)),n.addMarker(new S(0,0,0)),this.viewer.inputHandler.startDragging(n.spheres[n.spheres.length-1]),this.viewer.scene.addMeasurement(n),n}update(){let e=this.viewer.scene.getActiveCamera(),t=this.renderer.domElement,n=this.viewer.scene.measurements;const s=this.renderer.getSize(new Se);let r=s.width,o=s.height;this.light.position.copy(e.position);for(let a of n){a.lengthUnit=this.viewer.lengthUnit,a.lengthUnitDisplay=this.viewer.lengthUnitDisplay,a.update(),G1(this.viewer,a);for(let c of a.spheres){let u=e.position.distanceTo(c.getWorldPosition(new S)),d=15/He.projectedRadius(1,e,u,r,o);c.scale.set(d,d,d)}let l=a.edgeLabels.concat(a.angleLabels);for(let c of l){let u=e.position.distanceTo(c.getWorldPosition(new S)),h=He.projectedRadius(1,e,u,r,o),d=70/h;Potree.debug.scale&&(d=Potree.debug.scale/h),c.scale.set(d,d,d)}for(let c=0;c<a.coordinateLabels.length;c++){let u=a.coordinateLabels[c],h=a.spheres[c],d=e.position.distanceTo(h.getWorldPosition(new S)),f=h.getWorldPosition(new S).clone().project(e);f.x=Math.round((f.x+1)*r/2),f.y=Math.round((-f.y+1)*o/2),f.z=0,f.y-=30;let m=new S(f.x/r*2-1,-(f.y/o)*2+1,.5);if(m.unproject(e),this.viewer.scene.cameraMode==cs.PERSPECTIVE){let y=m.sub(e.position).normalize();m=new S().addVectors(e.position,y.multiplyScalar(d))}u.position.copy(m);let _=70/He.projectedRadius(1,e,d,r,o);u.scale.set(_,_,_)}if(a.showHeight){let c=a.heightLabel;{let u=c.position.distanceTo(e.position),d=70/He.projectedRadius(1,e,u,r,o);c.scale.set(d,d,d)}{let u=a.heightEdge,h=a.points.slice().sort((M,A)=>M.position.z-A.position.z),d=h[0].position.clone(),f=h[h.length-1].position.clone(),m=d.z,v=f.z,_=new S(f.x,f.y,m),y=new S(f.x,f.y,v),x=d.clone().project(e),R=_.clone().project(e),I=y.clone().project(e),B=M=>{let A=M.clone().addScalar(1).divideScalar(2);return A.x=A.x*r,A.y=A.y*o,A.z=0,A},N=B(x),J=B(R),ne=B(I),se=N.distanceTo(J),E=J.distanceTo(ne);u.geometry.lineDistances=[0,se,se,se+E],u.geometry.lineDistancesNeedUpdate=!0,u.material.dashSize=10,u.material.gapSize=10}}{let c=a.areaLabel,u=c.position.distanceTo(e.position),d=70/He.projectedRadius(1,e,u,r,o);c.scale.set(d,d,d)}{let c=a.circleRadiusLabel,u=c.position.distanceTo(e.position),d=70/He.projectedRadius(1,e,u,r,o);c.scale.set(d,d,d)}{const c=[a.circleRadiusLine.material,...a.edges.map(u=>u.material),a.heightEdge.material,a.circleLine.material];for(const u of c)u.resolution.set(r,o)}if(!this.showLabels){const c=[...a.sphereLabels,...a.edgeLabels,...a.angleLabels,...a.coordinateLabels,a.heightLabel,a.areaLabel,a.circleRadiusLabel];for(const u of c)u.visible=!1}}}render(){this.viewer.renderer.render(this.scene,this.viewer.scene.getActiveCamera())}}class hg{constructor(e){this.content=e;let t=`${z.resourcePath}/icons/close.svg`;this.element=$(`
			<div class="potree_message">
				<span name="content_container" style="flex-grow: 1; padding: 5px"></span>
				<img name="close" src="${t}" class="button-icon" style="width: 16px; height: 16px;">
			</div>`),this.elClose=this.element.find("img[name=close]"),this.elContainer=this.element.find("span[name=content_container]"),typeof e=="string"?this.elContainer.append($(`<span>${e}</span>`)):this.elContainer.append(e)}setMessage(e){this.elContainer.empty(),typeof e=="string"?this.elContainer.append($(`<span>${e}</span>`)):this.elContainer.append(e)}}class dg{constructor(e){this.potreeRenderer=e,this.threeRenderer=this.potreeRenderer.threeRenderer,this.target=new bi(2*1024,2*1024,{minFilter:et,magFilter:et,format:jt,type:vn}),this.target.depthTexture=new Ko,this.target.depthTexture.type=es,this.threeRenderer.setClearColor(16711680,1);{const t=this.threeRenderer.getRenderTarget();this.threeRenderer.setRenderTarget(this.target),this.threeRenderer.clear(!0,!0,!0),this.threeRenderer.setRenderTarget(t)}}setLight(e){this.light=e;let t=180*e.angle/Math.PI,n=e.shadow.mapSize.width/e.shadow.mapSize.height,s=.1,r=e.distance===0?1e4:e.distance;this.camera=new mi(t,n,s,r),this.camera.up.set(0,0,1),this.camera.position.copy(e.position);let o=new S().subVectors(e.position,e.getWorldDirection(new S));this.camera.lookAt(o),this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera.matrixWorldInverse.copy(this.camera.matrixWorld).invert()}setSize(e,t){(this.target.width!==e||this.target.height!==t)&&this.target.dispose(),this.target.setSize(e,t)}render(e,t){this.threeRenderer.setClearColor(0,1);const n=this.threeRenderer.getRenderTarget();this.threeRenderer.setRenderTarget(this.target),this.threeRenderer.clear(!0,!0,!0),this.potreeRenderer.render(e,this.camera,this.target,{}),this.threeRenderer.setRenderTarget(n)}}class fg extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_profile",t=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.scene=new Si,this.scene.name="scene_profile",this.light=new yo(16777215,1),this.scene.add(this.light),this.viewer.inputHandler.registerInteractiveScene(this.scene),this.onRemove=t=>this.scene.remove(t.profile),this.onAdd=t=>this.scene.add(t.profile);for(let t of e.scene.profiles)this.onAdd({profile:t});e.addEventListener("update",this.update.bind(this)),e.addEventListener("render.pass.perspective_overlay",this.render.bind(this)),e.addEventListener("scene_changed",this.onSceneChange.bind(this)),e.scene.addEventListener("profile_added",this.onAdd),e.scene.addEventListener("profile_removed",this.onRemove)}onSceneChange(e){e.oldScene&&(e.oldScene.removeEventListeners("profile_added",this.onAdd),e.oldScene.removeEventListeners("profile_removed",this.onRemove)),e.scene.addEventListener("profile_added",this.onAdd),e.scene.addEventListener("profile_removed",this.onRemove)}startInsertion(e={}){let t=this.viewer.renderer.domElement,n=new Ya;n.name=e.name||"Profile",this.dispatchEvent({type:"start_inserting_profile",profile:n}),this.scene.add(n);let s={callback:null},r=o=>{if(o.button===Et.LEFT){if(n.points.length<=1){let a=this.viewer.scene.getActiveCamera(),l=a.position.distanceTo(n.points[0]),c=this.viewer.renderer.getSize(new Se),h=10/He.projectedRadius(1,a,l,c.width,c.height);n.setWidth(h)}n.addMarker(n.points[n.points.length-1].clone()),this.viewer.inputHandler.startDragging(n.spheres[n.spheres.length-1])}else o.button===Et.RIGHT&&s.callback()};return s.callback=o=>{n.removeMarker(n.points.length-1),t.removeEventListener("mouseup",r,!1),this.viewer.removeEventListener("cancel_insertions",s.callback)},this.viewer.addEventListener("cancel_insertions",s.callback),t.addEventListener("mouseup",r,!1),n.addMarker(new S(0,0,0)),this.viewer.inputHandler.startDragging(n.spheres[n.spheres.length-1]),this.viewer.scene.addProfile(n),n}update(){let e=this.viewer.scene.getActiveCamera(),t=this.viewer.scene.profiles,n=this.viewer.renderer.getSize(new Se),s=n.width,r=n.height;this.light.position.copy(e.position);for(let o of t)for(let a of o.spheres){let l=e.position.distanceTo(a.getWorldPosition(new S)),u=15/He.projectedRadius(1,e,l,s,r);a.scale.set(u,u,u)}}render(){this.viewer.renderer.render(this.scene,this.viewer.scene.getActiveCamera())}}class pg extends Ne{constructor(e){super(),this.viewer=e,this.scene=new Si,e.addEventListener("update",this.update.bind(this)),e.addEventListener("render.pass.perspective_overlay",this.render.bind(this)),e.addEventListener("scene_changed",this.onSceneChange.bind(this))}onSceneChange(e){console.log("scene changed")}startInsertion(){let e=this.viewer.renderer.domElement,t=new Xa;t.position.set(12345,12345,12345),t.showVolumeLabel=!1,t.visible=!1,t.update(),this.viewer.scene.addVolume(t),this.importance=10;let n=$('<div style="position: absolute; border: 2px solid white; pointer-events: none; border-style:dashed"></div>');$(e.parentElement).append(n),n.css("right","10px"),n.css("bottom","10px");let s=o=>{t.visible=!0;let a=o.drag.start,l=o.drag.end,c=new Kc;c.expandByPoint(a),c.expandByPoint(l),n.css("left",`${c.min.x}px`),n.css("top",`${c.min.y}px`),n.css("width",`${c.max.x-c.min.x}px`),n.css("height",`${c.max.y-c.min.y}px`);let u=o.viewer.scene.getActiveCamera(),h=o.viewer.renderer.getSize(new Se),d=new Se(u.right-u.left,u.top-u.bottom),f=new Se().addVectors(o.drag.end,o.drag.start).multiplyScalar(.5),m=He.mouseToRay(f,u,h.width,h.height),v=new Se().subVectors(o.drag.end,o.drag.start);v.divide(h).multiply(d),t.position.copy(m.origin),t.up.copy(u.up),t.rotation.copy(u.rotation),t.scale.set(v.x,v.y,1e3*100),o.consume()},r=o=>{this.importance=0,$(n).remove(),this.viewer.inputHandler.deselectAll(),this.viewer.inputHandler.toggleSelection(t);let a=o.viewer.scene.getActiveCamera(),l=o.viewer.renderer.getSize(new Se),c=new Se().addVectors(o.drag.end,o.drag.start).multiplyScalar(.5),u=He.mouseToRay(c,a,l.width,l.height),h=new ia(u.origin,new S().addVectors(u.origin,u.direction));this.removeEventListener("drag",s),this.removeEventListener("drop",r);let d=[],f=[];for(let m of this.viewer.scene.pointclouds){if(!m.visible)continue;let v=a.clone();v.left=-t.scale.x/2,v.right=+t.scale.x/2,v.top=+t.scale.y/2,v.bottom=-t.scale.y/2,v.near=-t.scale.z/2,v.far=+t.scale.z/2,v.rotation.copy(t.rotation),v.position.copy(t.position),v.updateMatrix(),v.updateMatrixWorld(),v.updateProjectionMatrix(),v.matrixWorldInverse.copy(v.matrixWorld).invert();let _=new We(v.getWorldPosition(new S),v.getWorldDirection(new S)),y=new We(_.origin.clone().add(_.direction.clone().multiplyScalar(t.scale.z)),_.direction.clone().multiplyScalar(-1)),x={width:8,height:8,pickWindowSize:8,all:!0,pickClipped:!0,pointSizeType:Ws.FIXED,pointSize:1},R=m.pick(viewer,v,_,x);v.rotateX(Math.PI),v.updateMatrix(),v.updateMatrixWorld(),v.updateProjectionMatrix(),v.matrixWorldInverse.copy(v.matrixWorld).invert();let I=m.pick(viewer,v,y,x);d.push(...R),f.push(...I)}if(d.length>0&&f.length>0){let m=new ia(u.origin,new S().addVectors(u.origin,u.direction)),_=d.map(B=>m.closestPointToPoint(B.position,!1,new S)).sort((B,N)=>u.origin.distanceTo(B)-u.origin.distanceTo(N))[0],x=f.map(B=>m.closestPointToPoint(B.position,!1,new S)).sort((B,N)=>u.origin.distanceTo(N)-u.origin.distanceTo(B))[0],R=_.distanceTo(x),I=new S().addVectors(_,x).multiplyScalar(.5);t.scale.z=R*1.1,t.position.copy(I)}t.clip=!0};return this.addEventListener("drag",s),this.addEventListener("drop",r),viewer.inputHandler.addInputListener(this),t}update(e){}render(){this.viewer.renderer.render(this.scene,this.viewer.scene.getActiveCamera())}}class H1 extends qe{constructor(e,t){super(),this.light=e,this.color=t,this.updateMatrix(),this.updateMatrixWorld();{let n=new Li(1,32,32),s=new Ki;this.sphere=new ot(n,s),this.sphere.scale.set(.5,.5,.5),this.add(this.sphere)}{let n=new Float32Array([0,0,0,0,0,-1,0,0,0,-1,-1,-1,0,0,0,1,-1,-1,0,0,0,1,1,-1,0,0,0,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,-1,1,-1,-1,-1,-1]),s=new wt;s.setAttribute("position",new tt(n,3));let r=new ri;this.frustum=new Hi(s,r),this.add(this.frustum)}this.update()}update(){this.light.updateMatrix(),this.light.updateMatrixWorld();let e=this.light.position,t=new S().addVectors(this.light.position,this.light.getWorldDirection(new S).multiplyScalar(-1)),n=new Ei().setFromRotationMatrix(new xe().lookAt(e,t,new S(0,0,1)));this.setRotationFromQuaternion(n),this.position.copy(e);let s=this.light.distance>0?this.light.distance:1e3,r=s*Math.tan(this.light.angle*.5);this.frustum.scale.set(r,r,s)}}class mg{constructor(e){this.viewer=e,this.scene=new Si,this.selection=[],this.pivot=new S,this.dragging=!1,this.showPickVolumes=!1,this.viewer.inputHandler.registerInteractiveScene(this.scene),this.viewer.inputHandler.addEventListener("selection_changed",o=>{for(let a of this.selection)this.viewer.inputHandler.blacklist.delete(a);this.selection=o.selection;for(let a of this.selection)this.viewer.inputHandler.blacklist.add(a)});let t=15151360,n=4497994,s=2517479;this.activeHandle=null,this.scaleHandles={"scale.x+":{name:"scale.x+",node:new qe,color:t,alignment:[1,0,0]},"scale.x-":{name:"scale.x-",node:new qe,color:t,alignment:[-1,0,0]},"scale.y+":{name:"scale.y+",node:new qe,color:n,alignment:[0,1,0]},"scale.y-":{name:"scale.y-",node:new qe,color:n,alignment:[0,-1,0]},"scale.z+":{name:"scale.z+",node:new qe,color:s,alignment:[0,0,1]},"scale.z-":{name:"scale.z-",node:new qe,color:s,alignment:[0,0,-1]}},this.focusHandles={"focus.x+":{name:"focus.x+",node:new qe,color:t,alignment:[1,0,0]},"focus.x-":{name:"focus.x-",node:new qe,color:t,alignment:[-1,0,0]},"focus.y+":{name:"focus.y+",node:new qe,color:n,alignment:[0,1,0]},"focus.y-":{name:"focus.y-",node:new qe,color:n,alignment:[0,-1,0]},"focus.z+":{name:"focus.z+",node:new qe,color:s,alignment:[0,0,1]},"focus.z-":{name:"focus.z-",node:new qe,color:s,alignment:[0,0,-1]}},this.translationHandles={"translation.x":{name:"translation.x",node:new qe,color:t,alignment:[1,0,0]},"translation.y":{name:"translation.y",node:new qe,color:n,alignment:[0,1,0]},"translation.z":{name:"translation.z",node:new qe,color:s,alignment:[0,0,1]}},this.rotationHandles={"rotation.x":{name:"rotation.x",node:new qe,color:t,alignment:[1,0,0]},"rotation.y":{name:"rotation.y",node:new qe,color:n,alignment:[0,1,0]},"rotation.z":{name:"rotation.z",node:new qe,color:s,alignment:[0,0,1]}},this.handles=Object.assign({},this.scaleHandles,this.focusHandles,this.translationHandles,this.rotationHandles),this.pickVolumes=[],this.initializeScaleHandles(),this.initializeFocusHandles(),this.initializeTranslationHandles(),this.initializeRotationHandles();let r=new ti;r.vertices.push(new S(-.5,-.5,.5)),r.vertices.push(new S(.5,-.5,.5)),r.vertices.push(new S(.5,-.5,.5)),r.vertices.push(new S(.5,-.5,-.5)),r.vertices.push(new S(.5,-.5,-.5)),r.vertices.push(new S(-.5,-.5,-.5)),r.vertices.push(new S(-.5,-.5,-.5)),r.vertices.push(new S(-.5,-.5,.5)),r.vertices.push(new S(-.5,.5,.5)),r.vertices.push(new S(.5,.5,.5)),r.vertices.push(new S(.5,.5,.5)),r.vertices.push(new S(.5,.5,-.5)),r.vertices.push(new S(.5,.5,-.5)),r.vertices.push(new S(-.5,.5,-.5)),r.vertices.push(new S(-.5,.5,-.5)),r.vertices.push(new S(-.5,.5,.5)),r.vertices.push(new S(-.5,-.5,.5)),r.vertices.push(new S(-.5,.5,.5)),r.vertices.push(new S(.5,-.5,.5)),r.vertices.push(new S(.5,.5,.5)),r.vertices.push(new S(.5,-.5,-.5)),r.vertices.push(new S(.5,.5,-.5)),r.vertices.push(new S(-.5,-.5,-.5)),r.vertices.push(new S(-.5,.5,-.5)),this.frame=new Hi(r,new ri({color:16776960})),this.scene.add(this.frame)}initializeScaleHandles(){let e=new Li(1,32,32),t=new Li(1,16,16);for(let n of Object.keys(this.scaleHandles)){let s=this.scaleHandles[n],r=s.node;this.scene.add(r),r.position.set(...s.alignment).multiplyScalar(.5);let o=new Ut({color:s.color,opacity:.4,transparent:!0}),a=new Ut({color:0,side:qt,opacity:.4,transparent:!0}),l=new Ki({opacity:.2,transparent:!0,visible:this.showPickVolumes}),c=new ot(e,o);c.scale.set(1.3,1.3,1.3),c.name=`${n}.handle`,r.add(c);let u=new ot(e,a);u.scale.set(1.4,1.4,1.4),u.name=`${n}.outline`,c.add(u);let h=new ot(t,l);h.name=`${n}.pick_volume`,h.scale.set(3,3,3),c.add(h),h.handle=n,this.pickVolumes.push(h),r.setOpacity=d=>{let f={x:o.opacity},m=new TWEEN.Tween(f).to({x:d},100);m.onUpdate(()=>{c.visible=f.x>0,h.visible=f.x>0,o.opacity=f.x,a.opacity=f.x,h.material.opacity=f.x*.5}),m.start()},h.addEventListener("drag",d=>this.dragScaleHandle(d)),h.addEventListener("drop",d=>this.dropScaleHandle(d)),h.addEventListener("mouseover",d=>{}),h.addEventListener("click",d=>{d.consume()}),h.addEventListener("mouseleave",d=>{})}}initializeFocusHandles(){let e=new jc(4,4,1,1),t=new Li(1,16,16),n=new jn().load(`${z.resourcePath}/icons/eye_2.png`);for(let s of Object.keys(this.focusHandles)){let r=this.focusHandles[s],o=r.node;this.scene.add(o);let a=r.alignment;o.lookAt(new S(...a));let l=.8;a[0]===1?(o.position.set(1,l,-l).multiplyScalar(.5),o.rotation.z=Math.PI/2):a[0]===-1?(o.position.set(-1,-l,-l).multiplyScalar(.5),o.rotation.z=Math.PI/2):a[1]===1?(o.position.set(-l,1,-l).multiplyScalar(.5),o.rotation.set(Math.PI/2,Math.PI,0)):a[1]===-1?(o.position.set(l,-1,-l).multiplyScalar(.5),o.rotation.set(Math.PI/2,0,0)):a[2]===1?o.position.set(l,l,1).multiplyScalar(.5):a[2]===-1&&o.position.set(-l,l,-1).multiplyScalar(.5);let c=new Ut({color:r.color,opacity:0,transparent:!0,map:n}),u=new Ki({transparent:!0,visible:this.showPickVolumes}),h=new ot(e,c);h.name=`${s}.handle`,h.scale.set(1.5,1.5,1.5),h.position.set(0,0,0),h.visible=!1,o.add(h);let d=new ot(t,u);d.name=`${s}.pick_volume`,d.scale.set(3,3,3),h.add(d),d.handle=s,this.pickVolumes.push(d),o.setOpacity=f=>{let m={x:c.opacity},v=new TWEEN.Tween(m).to({x:f},100);v.onUpdate(()=>{d.visible=m.x>0,h.visible=m.x>0,c.opacity=m.x,d.material.opacity=m.x*.5}),v.start()},d.addEventListener("drag",f=>{}),d.addEventListener("mouseup",f=>{f.consume()}),d.addEventListener("mousedown",f=>{f.consume()}),d.addEventListener("click",f=>{f.consume();let m=this.selection[0],v=Math.max(...m.scale.toArray()),_=Math.min(...m.scale.toArray()),y=Math.abs(m.scale.dot(new S(...r.alignment))),x=new S(...r.alignment).multiplyScalar(2*v/y);x.applyMatrix4(m.matrixWorld);let R=x,I=m.getWorldPosition(new S);He.moveTo(this.viewer.scene,R,I)}),d.addEventListener("mouseover",f=>{}),d.addEventListener("mouseleave",f=>{})}}initializeTranslationHandles(){let e=new Ul(1,1,1);for(let t of Object.keys(this.translationHandles)){let n=this.handles[t],s=n.node;this.scene.add(s);let r=new Ut({color:n.color,opacity:.4,transparent:!0}),o=new Ut({color:0,side:qt,opacity:.4,transparent:!0}),a=new Ki({opacity:.2,transparent:!0,visible:this.showPickVolumes}),l=new ot(e,r);l.name=`${t}.handle`,l.scale.set(.2,.2,40),l.lookAt(new S(...n.alignment)),l.renderOrder=10,s.add(l),n.translateNode=l;let c=new ot(e,o);c.name=`${t}.outline`,c.scale.set(3,3,1.03),c.renderOrder=0,l.add(c);let u=new ot(e,a);u.name=`${t}.pick_volume`,u.scale.set(12,12,1.1),u.handle=t,l.add(u),this.pickVolumes.push(u),s.setOpacity=h=>{let d={x:r.opacity},f=new TWEEN.Tween(d).to({x:h},100);f.onUpdate(()=>{l.visible=d.x>0,u.visible=d.x>0,r.opacity=d.x,o.opacity=d.x,a.opacity=d.x*.5}),f.start()},u.addEventListener("drag",h=>{this.dragTranslationHandle(h)}),u.addEventListener("drop",h=>{this.dropTranslationHandle(h)})}}initializeRotationHandles(){let e=.5,t=new lh(1,e*.015,8,64,Math.PI/2),n=new lh(1,e*.04,8,64,Math.PI/2),s=new lh(1,e*.1,6,4,Math.PI/2);for(let r of Object.keys(this.rotationHandles)){let o=this.handles[r],a=o.node;this.scene.add(a);let l=new Ut({color:o.color,opacity:.4,transparent:!0}),c=new Ut({color:0,side:qt,opacity:.4,transparent:!0}),u=new Ki({opacity:.2,transparent:!0,visible:this.showPickVolumes}),h=new ot(t,l);h.name=`${r}.handle`,h.scale.set(20,20,20),h.lookAt(new S(...o.alignment)),a.add(h),o.translateNode=h;let d=new ot(n,c);d.name=`${r}.outline`,d.scale.set(1,1,1),d.renderOrder=0,h.add(d);let f=new ot(s,u);f.name=`${r}.pick_volume`,f.scale.set(1,1,1),f.handle=r,h.add(f),this.pickVolumes.push(f),a.setOpacity=m=>{let v={x:l.opacity},_=new TWEEN.Tween(v).to({x:m},100);_.onUpdate(()=>{h.visible=v.x>0,f.visible=v.x>0,l.opacity=v.x,c.opacity=v.x,u.opacity=v.x*.5}),_.start()},f.addEventListener("drag",m=>{this.dragRotationHandle(m)}),f.addEventListener("drop",m=>{this.dropRotationHandle(m)})}}dragRotationHandle(e){let t=e.drag,n=this.activeHandle,s=this.viewer.scene.getActiveCamera();if(!n)return;let r=new S(...n.alignment),o=new S;if(o.copy(new _t(...r.toArray(),0).applyMatrix4(n.node.matrixWorld)),o.normalize(),t.intersectionStart)n=t.handle;else{t.intersectionStart=t.location,t.objectStart=t.object.getWorldPosition(new S),t.handle=n;let h=new yi().setFromNormalAndCoplanarPoint(o,t.intersectionStart);t.dragPlane=h,t.pivot=t.intersectionStart}this.dragging=!0;let a=t.end,l=this.viewer.renderer.domElement,u=He.mouseToRay(a,s,l.clientWidth,l.clientHeight).intersectPlane(t.dragPlane,new S);if(u){let h=this.scene.getWorldPosition(new S),d=t.pivot,f=u,m=d.clone().sub(h).normalize(),v=f.clone().sub(h).normalize(),_=Math.acos(m.dot(v)),y=Math.sign(m.cross(v).dot(o));if(_=_*y,Number.isNaN(_))return;let x=new S(...n.alignment);for(let R of this.selection)R.rotateOnAxis(x,_),R.dispatchEvent({type:"orientation_changed",object:R});t.pivot=u}}dropRotationHandle(e){this.dragging=!1,this.setActiveHandle(null)}dragTranslationHandle(e){let t=e.drag,n=this.activeHandle,s=this.viewer.scene.getActiveCamera();if(!t.intersectionStart&&n){t.intersectionStart=t.location,t.objectStart=t.object.getWorldPosition(new S);let r=t.intersectionStart,o=new _t(...n.alignment,0).applyMatrix4(this.scene.matrixWorld),a=new S().addVectors(r,o),l=new ia(r.clone(),a.clone());t.line=l;let c=l.closestPointToPoint(s.position,!1,new S),u=new S().subVectors(s.position,c),h=new yi().setFromNormalAndCoplanarPoint(u,t.intersectionStart);t.dragPlane=h,t.pivot=t.intersectionStart}else n=t.handle;this.dragging=!0;{let r=t.end,o=this.viewer.renderer.domElement,l=He.mouseToRay(r,s,o.clientWidth,o.clientHeight).intersectPlane(t.dragPlane,new S);if(l){let c=t.line.closestPointToPoint(l,!1,new S),u=new S().subVectors(c,t.pivot);for(let h of this.selection)h.position.add(u),h.dispatchEvent({type:"position_changed",object:h});t.pivot=t.pivot.add(u)}}}dropTranslationHandle(e){this.dragging=!1,this.setActiveHandle(null)}dropScaleHandle(e){this.dragging=!1,this.setActiveHandle(null)}dragScaleHandle(e){let t=e.drag,n=this.activeHandle,s=this.viewer.scene.getActiveCamera();if(t.intersectionStart)n=t.handle;else{t.intersectionStart=t.location,t.objectStart=t.object.getWorldPosition(new S),t.handle=n;let r=t.intersectionStart,o=new _t(...n.alignment,0).applyMatrix4(this.scene.matrixWorld),a=new S().addVectors(r,o),l=new ia(r.clone(),a.clone());t.line=l;let c=l.closestPointToPoint(s.position,!1,new S),u=new S().subVectors(s.position,c),h=new yi().setFromNormalAndCoplanarPoint(u,t.intersectionStart);t.dragPlane=h,t.pivot=t.intersectionStart}this.dragging=!0;{let r=t.end,o=this.viewer.renderer.domElement,l=He.mouseToRay(r,s,o.clientWidth,o.clientHeight).intersectPlane(t.dragPlane,new S);if(l){let c=t.line.closestPointToPoint(l,!1,new S),u=n.alignment.reduce((I,B)=>I+B,0),h=this.selection[0].matrixWorld.clone().invert(),d=c.clone().applyMatrix4(h),f=t.pivot.clone().applyMatrix4(h),v=new S().subVectors(d,f).clone().normalize();c.distanceTo(t.pivot)===0&&v.set(0,0,0);let _=v.dot(new S(...n.alignment)),y=new S().subVectors(c,t.pivot),x=new S(...n.alignment).multiplyScalar(y.length()*u*_),R=y.clone().multiplyScalar(.5);for(let I of this.selection)I.scale.add(x),I.scale.x=Math.max(.1,I.scale.x),I.scale.y=Math.max(.1,I.scale.y),I.scale.z=Math.max(.1,I.scale.z),I.position.add(R),I.dispatchEvent({type:"position_changed",object:I}),I.dispatchEvent({type:"scale_changed",object:I});t.pivot.copy(c)}}}setActiveHandle(e){if(!this.dragging&&this.activeHandle!==e){if(this.activeHandle=e,e===null)for(let t of Object.keys(this.handles))this.handles[t].node.setOpacity(0);for(let t of Object.keys(this.focusHandles)){let n=this.focusHandles[t];this.activeHandle===n?n.node.setOpacity(1):n.node.setOpacity(.4)}for(let t of Object.keys(this.translationHandles)){let n=this.translationHandles[t];this.activeHandle===n?n.node.setOpacity(1):n.node.setOpacity(.4)}for(let t of Object.keys(this.rotationHandles))this.rotationHandles[t].node.setOpacity(.4);for(let t of Object.keys(this.scaleHandles)){let n=this.scaleHandles[t];if(this.activeHandle===n){n.node.setOpacity(1),this.focusHandles[n.name.replace("scale","focus")].node.setOpacity(.4);for(let o of Object.keys(this.translationHandles))this.translationHandles[o].node.setOpacity(.4)}else n.node.setOpacity(.4)}e&&e.node.setOpacity(1)}}update(){if(this.selection.length===1){this.scene.visible=!0,this.scene.updateMatrix(),this.scene.updateMatrixWorld();let e=this.selection[0],t=e.matrixWorld,n=this.viewer.scene.getActiveCamera(),s=this.viewer.renderer.domElement,r=this.viewer.inputHandler.mouse,o=e.boundingBox.getCenter(new S).clone().applyMatrix4(e.matrixWorld);this.scene.scale.copy(e.boundingBox.getSize(new S).multiply(e.scale)),this.scene.position.copy(o),this.scene.rotation.copy(e.rotation),this.scene.updateMatrixWorld();{for(let a of Object.keys(this.handles)){let c=this.handles[a].node,h=c.getWorldPosition(new S).distanceTo(n.position),d=He.projectedRadius(1,n,h,s.clientWidth,s.clientHeight),f=c.parent.getWorldScale(new S),m=7/d,v=new S(m,m,m).divide(f),y=new xe().makeRotationFromEuler(c.rotation).clone().invert();v.applyMatrix4(y),v.x=Math.abs(v.x),v.y=Math.abs(v.y),v.z=Math.abs(v.z),c.scale.copy(v)}if(!this.dragging){let l=this.scene.matrixWorld.clone().invert(),c=n.getWorldPosition(new S).applyMatrix4(l),u=this.rotationHandles["rotation.x"].node.rotation,h=this.rotationHandles["rotation.y"].node.rotation,d=this.rotationHandles["rotation.z"].node.rotation;u.order="ZYX",h.order="ZYX";let f=c.z>0,m=!f,v=Math.PI/2;f?c.x>0&&c.y>0?(u.x=1*v,h.y=3*v,d.z=0*v):c.x<0&&c.y>0?(u.x=1*v,h.y=2*v,d.z=1*v):c.x<0&&c.y<0?(u.x=2*v,h.y=2*v,d.z=2*v):c.x>0&&c.y<0&&(u.x=2*v,h.y=3*v,d.z=3*v):m&&(c.x>0&&c.y>0?(u.x=0*v,h.y=0*v,d.z=0*v):c.x<0&&c.y>0?(u.x=0*v,h.y=1*v,d.z=1*v):c.x<0&&c.y<0?(u.x=3*v,h.y=1*v,d.z=2*v):c.x>0&&c.y<0&&(u.x=3*v,h.y=0*v,d.z=3*v))}{let a=He.mouseToRay(r,n,s.clientWidth,s.clientHeight),c=new kr(a.origin,a.direction).intersectObjects(this.pickVolumes.filter(u=>u.visible),!0);if(c.length>0){let h=c[0].object.handle;this.setActiveHandle(this.handles[h])}else this.setActiveHandle(null)}for(let a of Object.keys(this.scaleHandles)){let l=this.handles[a],c=l.node,u=l.alignment}}}else this.scene.visible=!1}}class gg extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_volume",t=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.scene=new Si,this.scene.name="scene_volume",this.viewer.inputHandler.registerInteractiveScene(this.scene),this.onRemove=t=>{this.scene.remove(t.volume)},this.onAdd=t=>{this.scene.add(t.volume)};for(let t of e.scene.volumes)this.onAdd({volume:t});this.viewer.inputHandler.addEventListener("delete",t=>{t.selection.filter(s=>s instanceof bo).forEach(s=>this.viewer.scene.removeVolume(s))}),e.addEventListener("update",this.update.bind(this)),e.addEventListener("render.pass.scene",t=>this.render(t)),e.addEventListener("scene_changed",this.onSceneChange.bind(this)),e.scene.addEventListener("volume_added",this.onAdd),e.scene.addEventListener("volume_removed",this.onRemove)}onSceneChange(e){e.oldScene&&(e.oldScene.removeEventListeners("volume_added",this.onAdd),e.oldScene.removeEventListeners("volume_removed",this.onRemove)),e.scene.addEventListener("volume_added",this.onAdd),e.scene.addEventListener("volume_removed",this.onRemove)}startInsertion(e={}){let t;e.type?t=new e.type:t=new Xa,t.clip=e.clip||!1,t.name=e.name||"Volume",this.dispatchEvent({type:"start_inserting_volume",volume:t}),this.viewer.scene.addVolume(t),this.scene.add(t);let n={callback:null},s=o=>{let a=this.viewer.scene.getActiveCamera(),l=He.getMousePointCloudIntersection(o.drag.end,this.viewer.scene.getActiveCamera(),this.viewer,this.viewer.scene.pointclouds,{pickClipped:!1});if(l){t.position.copy(l.location);let c=t.getWorldPosition(new S).applyMatrix4(a.matrixWorldInverse),u=Math.abs(c.z/5);t.scale.set(u,u,u)}},r=o=>{t.removeEventListener("drag",s),t.removeEventListener("drop",r),n.callback()};return n.callback=o=>{t.removeEventListener("drag",s),t.removeEventListener("drop",r),this.viewer.removeEventListener("cancel_insertions",n.callback)},t.addEventListener("drag",s),t.addEventListener("drop",r),this.viewer.addEventListener("cancel_insertions",n.callback),this.viewer.inputHandler.startDragging(t),t}update(){if(!this.viewer.scene)return;let e=this.viewer.scene.getActiveCamera(),t=this.viewer.renderer.getSize(new Se),n=t.width,s=t.height,r=this.viewer.scene.volumes;for(let o of r){let a=o.label;{let u=a.position.distanceTo(e.position),d=70/He.projectedRadius(1,e,u,n,s);a.scale.set(d,d,d)}let l=o.getVolume();l=l/Math.pow(this.viewer.lengthUnit.unitspermeter,3)*Math.pow(this.viewer.lengthUnitDisplay.unitspermeter,3);let c=He.addCommas(l.toFixed(3))+" "+this.viewer.lengthUnitDisplay.code+"\xB3";a.setText(c)}}render(e){const t=this.viewer.renderer,n=t.getRenderTarget();e.renderTarget&&t.setRenderTarget(e.renderTarget),t.render(this.scene,this.viewer.scene.getActiveCamera()),t.setRenderTarget(n)}}class vg{constructor(e){this.viewer=e,this.visible=!1,this.dom=this.createElement(),e.addEventListener("update",()=>{const n=e.scene.view.direction.clone();n.z=0,n.normalize();const r=e.scene.getActiveCamera().getWorldPosition(new S),o=r.clone().add(n),a=e.getProjection(),l=He.computeAzimuth(r,o,a);this.dom.css("transform",`rotateZ(${-l}rad)`)}),this.dom.click(()=>{e.setTopView()}),$(e.renderArea).append(this.dom),this.setVisible(this.visible)}setVisible(e){this.visible=e;const t=e?"":"none";this.dom.css("display",t)}isVisible(){return this.visible}createElement(){return $(`<img src="${Potree.resourcePath}/images/compas.svg" style="position: absolute; top: 10px; right: 10px; z-index: 10000; width: 64px;" />`)}}class yg extends qe{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Se(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const ic=new S,xg=new xe,wg=new xe,bg=new S,_g=new S;class V1{constructor(e={}){const t=this;let n,s,r,o;const a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:n,height:s}},this.render=function(m,v){m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),v.parent===null&&v.matrixWorldAutoUpdate===!0&&v.updateMatrixWorld(),xg.copy(v.matrixWorldInverse),wg.multiplyMatrices(v.projectionMatrix,xg),u(m,m,v),f(m)},this.setSize=function(m,v){n=m,s=v,r=n/2,o=s/2,l.style.width=m+"px",l.style.height=v+"px"};function c(m){m.isCSS2DObject&&(m.element.style.display="none");for(let v=0,_=m.children.length;v<_;v++)c(m.children[v])}function u(m,v,_){if(m.visible===!1){c(m);return}if(m.isCSS2DObject){ic.setFromMatrixPosition(m.matrixWorld),ic.applyMatrix4(wg);const y=ic.z>=-1&&ic.z<=1&&m.layers.test(_.layers)===!0,x=m.element;x.style.display=y===!0?"":"none",y===!0&&(m.onBeforeRender(t,v,_),x.style.transform="translate("+-100*m.center.x+"%,"+-100*m.center.y+"%)translate("+(ic.x*r+r)+"px,"+(-ic.y*o+o)+"px)",x.parentNode!==l&&l.appendChild(x),m.onAfterRender(t,v,_));const R={distanceToCameraSquared:h(_,m)};a.objects.set(m,R)}for(let y=0,x=m.children.length;y<x;y++)u(m.children[y],v,_)}function h(m,v){return bg.setFromMatrixPosition(m.matrixWorld),_g.setFromMatrixPosition(v.matrixWorld),bg.distanceToSquared(_g)}function d(m){const v=[];return m.traverseVisible(function(_){_.isCSS2DObject&&v.push(_)}),v}function f(m){const v=d(m).sort(function(y,x){if(y.renderOrder!==x.renderOrder)return x.renderOrder-y.renderOrder;const R=a.objects.get(y).distanceToCameraSquared,I=a.objects.get(x).distanceToCameraSquared;return R-I}),_=v.length;for(let y=0,x=v.length;y<x;y++)v[y].element.style.zIndex=_-y}}}class j1{constructor(e){this.viewer=e,this.renderer=e.renderer;{let t=new Si,n=new Li(.001,2,2),s=new ot(n,new Ut);s.position.set(36453,35163,764712),t.add(s),this.dummyMesh=s,this.dummyScene=t}}clearTargets(){}clear(){let{viewer:e,renderer:t}=this;e.background==="skybox"?t.setClearColor(16711680,1):e.background==="gradient"?t.setClearColor(65280,1):e.background==="black"?t.setClearColor(0,1):e.background==="white"?t.setClearColor(16777215,1):t.setClearColor(0,0),t.clear()}render(e){let{viewer:t,renderer:n}=this;const s=e.camera?e.camera:t.scene.getActiveCamera();t.dispatchEvent({type:"render.pass.begin",viewer:t});const r=n.getSize(new Se),o=e.viewport?e.viewport[2]:r.x,a=e.viewport?e.viewport[3]:r.y;t.background==="skybox"?(t.skybox.camera.rotation.copy(t.scene.cameraP.rotation),t.skybox.camera.fov=t.scene.cameraP.fov,t.skybox.camera.aspect=t.scene.cameraP.aspect,t.skybox.parent.rotation.x=0,t.skybox.parent.updateMatrixWorld(),t.skybox.camera.updateProjectionMatrix(),n.render(t.skybox.scene,t.skybox.camera)):t.background==="gradient"&&n.render(t.scene.sceneBG,t.scene.cameraBG);for(let l of this.viewer.scene.pointclouds){const{material:c}=l;c.useEDL=!1}t.pRenderer.render(t.scene.scenePointCloud,s,null,{clipSpheres:t.scene.volumes.filter(l=>l instanceof Potree.SphereVolume)}),n.render(t.scene.scene,s),t.labelRenderer.render(t.scene.scene,s),t.dispatchEvent({type:"render.pass.scene",viewer:t}),t.clippingTool.update(),n.render(t.clippingTool.sceneMarker,t.scene.cameraScreenSpace),n.render(t.clippingTool.sceneVolume,s),n.render(t.controls.sceneControls,s),n.clearDepth(),t.transformationTool.update(),t.dispatchEvent({type:"render.pass.perspective_overlay",viewer:t}),t.dispatchEvent({type:"render.pass.end",viewer:t})}}class W1{constructor(e){this.viewer=e,this.edlMaterial=null,this.rtRegular,this.rtEDL,this.gl=e.renderer.getContext(),this.shadowMap=new dg(this.viewer.pRenderer)}initEDL(){this.edlMaterial==null&&(this.edlMaterial=new Jm,this.edlMaterial.depthTest=!0,this.edlMaterial.depthWrite=!0,this.edlMaterial.transparent=!0,this.rtEDL=new bi(1024,1024,{minFilter:ei,magFilter:ei,format:jt,type:vn,depthTexture:new Ko(void 0,void 0,es)}),this.rtRegular=new bi(1024,1024,{minFilter:ei,magFilter:ei,format:jt,depthTexture:new Ko(void 0,void 0,es)}))}resize(e,t){this.screenshot&&(e=this.screenshot.target.width,t=this.screenshot.target.height),this.rtEDL.setSize(e,t),this.rtRegular.setSize(e,t)}makeScreenshot(e,t,n){e==null&&(e=this.viewer.scene.getActiveCamera()),t==null&&(t=this.viewer.renderer.getSize(new Se));let{width:s,height:r}=t;s=2*s,r=2*r;let o=new bi(s,r,{format:jt});this.screenshot={target:o},this.render();let a=s*r,l=new Uint8Array(4*a);this.viewer.renderer.readRenderTargetPixels(o,0,0,s,r,l);let c=s*4;for(let u=0;u<parseInt(r/2);u++){let h=r-u-1,d=l.slice(u*c,u*c+c),f=l.slice(h*c,h*c+c);l.set(f,u*c),l.set(d,h*c)}return this.screenshot.target.dispose(),delete this.screenshot,{width:s,height:r,buffer:l}}clearTargets(){const e=this.viewer,{renderer:t}=e,n=t.getRenderTarget();t.setRenderTarget(this.rtEDL),t.clear(!0,!0,!0),t.setRenderTarget(this.rtRegular),t.clear(!0,!0,!1),t.setRenderTarget(n)}clear(){this.initEDL();const e=this.viewer,{renderer:t,background:n}=e;n==="skybox"||n==="gradient"?t.setClearColor(0,0):n==="black"?t.setClearColor(0,1):n==="white"?t.setClearColor(16777215,1):t.setClearColor(0,0),t.clear(),this.clearTargets()}renderShadowMap(e,t,n){const{viewer:s}=this;if(n.length>0&&!n[0].disableShadowUpdates){let o=n[0];this.shadowMap.setLight(o);let a=new Map;for(let l of s.scene.pointclouds)a.set(l,l.material.activeAttributeName),l.material.disableEvents(),l.material.activeAttributeName="depth";this.shadowMap.render(s.scene.scenePointCloud,t);for(let l of e){let c=a.get(l);l.material.activeAttributeName=c,l.material.enableEvents()}s.shadowTestCam.updateMatrixWorld(),s.shadowTestCam.matrixWorldInverse.copy(s.shadowTestCam.matrixWorld).invert(),s.shadowTestCam.updateProjectionMatrix()}}render(e){this.initEDL();const t=this.viewer;let n=e.camera?e.camera:t.scene.getActiveCamera();const{width:s,height:r}=this.viewer.renderer.getSize(new Se);t.dispatchEvent({type:"render.pass.begin",viewer:t}),this.resize(s,r);const o=t.scene.pointclouds.filter(l=>l.visible);if(this.screenshot){let l=Potree.pointBudget;Potree.pointBudget=Math.max(10*1e3*1e3,2*l);let c=Potree.updatePointClouds(t.scene.pointclouds,n,t.renderer);Potree.pointBudget=l}let a=[];t.scene.scene.traverse(l=>{l.type==="SpotLight"&&a.push(l)}),t.background==="skybox"?(t.skybox.camera.rotation.copy(t.scene.cameraP.rotation),t.skybox.camera.fov=t.scene.cameraP.fov,t.skybox.camera.aspect=t.scene.cameraP.aspect,t.skybox.parent.rotation.x=0,t.skybox.parent.updateMatrixWorld(),t.skybox.camera.updateProjectionMatrix(),t.renderer.render(t.skybox.scene,t.skybox.camera)):t.background==="gradient"&&t.renderer.render(t.scene.sceneBG,t.scene.cameraBG),this.renderShadowMap(o,n,a);{for(let l of o){let c=l.pcoGeometry.boundingBox.getSize(new S).x,u=l.material;u.weighted=!1,u.useLogarithmicDepthBuffer=!1,u.useEDL=!0,u.screenWidth=s,u.screenHeight=r,u.uniforms.visibleNodes.value=l.material.visibleNodesTexture,u.uniforms.octreeSize.value=c,u.spacing=l.pcoGeometry.spacing}t.renderer.setRenderTarget(this.rtEDL),a.length>0?t.pRenderer.render(t.scene.scenePointCloud,n,this.rtEDL,{clipSpheres:t.scene.volumes.filter(l=>l instanceof _o),shadowMaps:[this.shadowMap],transparent:!1}):t.pRenderer.render(t.scene.scenePointCloud,n,this.rtEDL,{clipSpheres:t.scene.volumes.filter(l=>l instanceof _o),transparent:!1})}t.dispatchEvent({type:"render.pass.scene",viewer:t,renderTarget:this.rtRegular}),t.renderer.setRenderTarget(null),t.renderer.render(t.scene.scene,n),t.labelRenderer.render(t.scene.scene,n);{const l=this.edlMaterial.uniforms;l.screenWidth.value=s,l.screenHeight.value=r;let c=n.projectionMatrix,u=new Float32Array(16);u.set(c.elements),l.uNear.value=n.near,l.uFar.value=n.far,l.uEDLColor.value=this.rtEDL.texture,l.uEDLDepth.value=this.rtEDL.depthTexture,l.uProj.value=u,l.edlStrength.value=t.edlStrength,l.radius.value=t.edlRadius,l.opacity.value=t.edlOpacity,He.screenPass.render(t.renderer,this.edlMaterial),this.screenshot&&He.screenPass.render(t.renderer,this.edlMaterial,this.screenshot.target)}t.dispatchEvent({type:"render.pass.scene",viewer:t}),t.renderer.clearDepth(),t.transformationTool.update(),t.dispatchEvent({type:"render.pass.perspective_overlay",viewer:t}),t.renderer.render(t.controls.sceneControls,n),t.renderer.render(t.clippingTool.sceneVolume,n),t.renderer.render(t.transformationTool.scene,n),t.dispatchEvent({type:"render.pass.end",viewer:t})}}class $1{constructor(e){this.viewer=e,this.depthMaterials=new Map,this.attributeMaterials=new Map,this.normalizationMaterial=null,this.rtDepth=null,this.rtAttribute=null,this.gl=e.renderer.getContext(),this.initialized=!1}init(){this.initialized||(this.normalizationMaterial=new Qm,this.normalizationMaterial.depthTest=!0,this.normalizationMaterial.depthWrite=!0,this.normalizationMaterial.transparent=!0,this.normalizationEDLMaterial=new Km,this.normalizationEDLMaterial.depthTest=!0,this.normalizationEDLMaterial.depthWrite=!0,this.normalizationEDLMaterial.transparent=!0,this.rtDepth=new bi(1024,1024,{minFilter:ei,magFilter:ei,format:jt,type:vn,depthTexture:new Ko(void 0,void 0,es)}),this.rtAttribute=new bi(1024,1024,{minFilter:ei,magFilter:ei,format:jt,type:vn,depthTexture:this.rtDepth.depthTexture}),this.initialized=!0)}resize(e,t){this.rtDepth.setSize(e,t),this.rtAttribute.setSize(e,t)}clearTargets(){const e=this.viewer,{renderer:t}=e,n=t.getRenderTarget();t.setClearColor(0,0),t.setRenderTarget(this.rtDepth),t.clear(!0,!0,!0),t.setRenderTarget(this.rtAttribute),t.clear(!0,!0,!0),t.setRenderTarget(n)}clear(){this.init();const{renderer:e,background:t}=this.viewer;t==="skybox"||t==="gradient"?e.setClearColor(0,0):t==="black"?e.setClearColor(0,1):t==="white"?e.setClearColor(16777215,1):e.setClearColor(0,0),e.clear(),this.clearTargets()}render(e){this.init();const t=this.viewer,n=e.camera?e.camera:t.scene.getActiveCamera(),{width:s,height:r}=this.viewer.renderer.getSize(new Se);t.dispatchEvent({type:"render.pass.begin",viewer:t}),this.resize(s,r);const o=t.scene.pointclouds.filter(l=>l.visible),a=new Map;for(let l of o){if(a.set(l,l.material),!this.attributeMaterials.has(l)){let c=new Hr;this.attributeMaterials.set(l,c)}if(!this.depthMaterials.has(l)){let c=new Hr;c.setDefine("depth_pass","#define hq_depth_pass"),c.setDefine("use_edl","#define use_edl"),this.depthMaterials.set(l,c)}}{for(let l of o){let c=l.pcoGeometry.boundingBox.getSize(new S).x,u=a.get(l),h=this.depthMaterials.get(l);h.size=u.size,h.minSize=u.minSize,h.maxSize=u.maxSize,h.pointSizeType=u.pointSizeType,h.visibleNodesTexture=u.visibleNodesTexture,h.weighted=!1,h.screenWidth=s,h.shape=Eo.CIRCLE,h.screenHeight=r,h.uniforms.visibleNodes.value=u.visibleNodesTexture,h.uniforms.octreeSize.value=c,h.spacing=l.pcoGeometry.spacing,h.classification=u.classification,h.uniforms.classificationLUT.value.image.data=u.uniforms.classificationLUT.value.image.data,h.classificationTexture.needsUpdate=!0,h.uniforms.uFilterReturnNumberRange.value=u.uniforms.uFilterReturnNumberRange.value,h.uniforms.uFilterNumberOfReturnsRange.value=u.uniforms.uFilterNumberOfReturnsRange.value,h.uniforms.uFilterGPSTimeClipRange.value=u.uniforms.uFilterGPSTimeClipRange.value,h.uniforms.uFilterPointSourceIDClipRange.value=u.uniforms.uFilterPointSourceIDClipRange.value,h.clipTask=u.clipTask,h.clipMethod=u.clipMethod,h.setClipBoxes(u.clipBoxes),h.setClipPolygons(u.clipPolygons),l.material=h}t.pRenderer.render(t.scene.scenePointCloud,n,this.rtDepth,{clipSpheres:t.scene.volumes.filter(l=>l instanceof _o)})}{for(let c of o){let u=c.pcoGeometry.boundingBox.getSize(new S).x,h=a.get(c),d=this.attributeMaterials.get(c);d.size=h.size,d.minSize=h.minSize,d.maxSize=h.maxSize,d.pointSizeType=h.pointSizeType,d.activeAttributeName=h.activeAttributeName,d.visibleNodesTexture=h.visibleNodesTexture,d.weighted=!0,d.screenWidth=s,d.screenHeight=r,d.shape=Eo.CIRCLE,d.uniforms.visibleNodes.value=h.visibleNodesTexture,d.uniforms.octreeSize.value=u,d.spacing=c.pcoGeometry.spacing,d.classification=h.classification,d.uniforms.classificationLUT.value.image.data=h.uniforms.classificationLUT.value.image.data,d.classificationTexture.needsUpdate=!0,d.uniforms.uFilterReturnNumberRange.value=h.uniforms.uFilterReturnNumberRange.value,d.uniforms.uFilterNumberOfReturnsRange.value=h.uniforms.uFilterNumberOfReturnsRange.value,d.uniforms.uFilterGPSTimeClipRange.value=h.uniforms.uFilterGPSTimeClipRange.value,d.uniforms.uFilterPointSourceIDClipRange.value=h.uniforms.uFilterPointSourceIDClipRange.value,d.elevationGradientRepeat=h.elevationGradientRepeat,d.elevationRange=h.elevationRange,d.gradient=h.gradient,d.matcap=h.matcap,d.intensityRange=h.intensityRange,d.intensityGamma=h.intensityGamma,d.intensityContrast=h.intensityContrast,d.intensityBrightness=h.intensityBrightness,d.rgbGamma=h.rgbGamma,d.rgbContrast=h.rgbContrast,d.rgbBrightness=h.rgbBrightness,d.weightRGB=h.weightRGB,d.weightIntensity=h.weightIntensity,d.weightElevation=h.weightElevation,d.weightRGB=h.weightRGB,d.weightClassification=h.weightClassification,d.weightReturnNumber=h.weightReturnNumber,d.weightSourceID=h.weightSourceID,d.color=h.color,d.clipTask=h.clipTask,d.clipMethod=h.clipMethod,d.setClipBoxes(h.clipBoxes),d.setClipPolygons(h.clipPolygons),c.material=d}let l=this.gl;t.renderer.setRenderTarget(null),t.pRenderer.render(t.scene.scenePointCloud,n,this.rtAttribute,{clipSpheres:t.scene.volumes.filter(c=>c instanceof _o),blendFunc:[l.SRC_ALPHA,l.ONE],depthWrite:!1})}for(let[l,c]of a)l.material=c;t.renderer.setRenderTarget(null),t.background==="skybox"?(t.renderer.setClearColor(0,0),t.renderer.clear(),t.skybox.camera.rotation.copy(t.scene.cameraP.rotation),t.skybox.camera.fov=t.scene.cameraP.fov,t.skybox.camera.aspect=t.scene.cameraP.aspect,t.skybox.parent.rotation.x=0,t.skybox.parent.updateMatrixWorld(),t.skybox.camera.updateProjectionMatrix(),t.renderer.render(t.skybox.scene,t.skybox.camera)):t.background==="gradient"?(t.renderer.setClearColor(0,0),t.renderer.clear(),t.renderer.render(t.scene.sceneBG,t.scene.cameraBG)):t.background==="black"?(t.renderer.setClearColor(0,1),t.renderer.clear()):t.background==="white"?(t.renderer.setClearColor(16777215,1),t.renderer.clear()):(t.renderer.setClearColor(0,0),t.renderer.clear());{let l=this.useEDL?this.normalizationEDLMaterial:this.normalizationMaterial;this.useEDL&&(l.uniforms.edlStrength.value=t.edlStrength,l.uniforms.radius.value=t.edlRadius,l.uniforms.screenWidth.value=s,l.uniforms.screenHeight.value=r,l.uniforms.uEDLMap.value=this.rtDepth.texture),l.uniforms.uWeightMap.value=this.rtAttribute.texture,l.uniforms.uDepthMap.value=this.rtAttribute.depthTexture,He.screenPass.render(t.renderer,l)}t.renderer.render(t.scene.scene,n),t.labelRenderer.render(t.scene.scene,n),t.dispatchEvent({type:"render.pass.scene",viewer:t}),t.renderer.clearDepth(),t.transformationTool.update(),t.dispatchEvent({type:"render.pass.perspective_overlay",viewer:t}),t.renderer.render(t.controls.sceneControls,n),t.renderer.render(t.clippingTool.sceneVolume,n),t.renderer.render(t.transformationTool.scene,n),t.renderer.setViewport(s-t.navigationCube.width,r-t.navigationCube.width,t.navigationCube.width,t.navigationCube.width),t.renderer.render(t.navigationCube,t.navigationCube.camera),t.renderer.setViewport(0,0,s,r),t.dispatchEvent({type:"render.pass.end",viewer:t})}}class sf{constructor(){this.position=new S(0,0,0),this.yaw=Math.PI/4,this._pitch=-Math.PI/4,this.radius=1,this.maxPitch=Math.PI/2,this.minPitch=-Math.PI/2}clone(){let e=new sf;return e.yaw=this.yaw,e._pitch=this.pitch,e.radius=this.radius,e.maxPitch=this.maxPitch,e.minPitch=this.minPitch,e}get pitch(){return this._pitch}set pitch(e){this._pitch=Math.max(Math.min(e,this.maxPitch),this.minPitch)}get direction(){let e=new S(0,1,0);return e.applyAxisAngle(new S(1,0,0),this.pitch),e.applyAxisAngle(new S(0,0,1),this.yaw),e}set direction(e){if(e.x===0&&e.y===0)this.pitch=Math.PI/2*Math.sign(e.z);else{let t=Math.atan2(e.y,e.x)-Math.PI/2,n=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));this.yaw=t,this.pitch=n}}lookAt(e){let t;arguments.length===1?t=new S().subVectors(e,this.position):arguments.length===3&&(t=new S().subVectors(new S(...arguments),this.position));let n=t.length(),s=t.normalize();this.radius=n,this.direction=s}getPivot(){return new S().addVectors(this.position,this.direction.multiplyScalar(this.radius))}getSide(){let e=new S(1,0,0);return e.applyAxisAngle(new S(0,0,1),this.yaw),e}pan(e,t){let n=new S(0,1,0);n.applyAxisAngle(new S(1,0,0),this.pitch),n.applyAxisAngle(new S(0,0,1),this.yaw);let s=this.getSide(),r=s.clone().cross(n),o=s.multiplyScalar(e).add(r.multiplyScalar(t));this.position=this.position.add(o)}translate(e,t,n){let s=new S(0,1,0);s.applyAxisAngle(new S(1,0,0),this.pitch),s.applyAxisAngle(new S(0,0,1),this.yaw);let r=new S(1,0,0);r.applyAxisAngle(new S(0,0,1),this.yaw);let o=r.clone().cross(s),a=r.multiplyScalar(e).add(s.multiplyScalar(t)).add(o.multiplyScalar(n));this.position=this.position.add(a)}translateWorld(e,t,n){this.position.x+=e,this.position.y+=t,this.position.z+=n}setView(e,t,n=0,s=null){let r=null;e instanceof Array?r=new S(...e):e.x!=null&&(r=e.clone());let o=null;t instanceof Array?o=new S(...t):t.x!=null&&(o=t.clone());const a=this.position.clone(),l=this.getPivot();let c=TWEEN.Easing.Quartic.Out;if(n===0)this.position.copy(r),this.lookAt(o);else{let u={x:0},h=new TWEEN.Tween(u).to({x:1},n);h.easing(c),h.onUpdate(()=>{let d=u.x;const f=new S((1-d)*a.x+d*r.x,(1-d)*a.y+d*r.y,(1-d)*a.z+d*r.z),m=new S((1-d)*l.x+d*o.x,(1-d)*l.y+d*o.y,(1-d)*l.z+d*o.z);this.position.copy(f),this.lookAt(m)}),h.start(),h.onComplete(()=>{s&&s()})}}}class Mg extends Ne{constructor(){super(),this.annotations=new ra,this.scene=new Si,this.sceneBG=new Si,this.scenePointCloud=new Si,this.cameraP=new mi(this.fov,1,.1,1e3*1e3),this.cameraO=new Fn(-1,1,1,-1,.1,1e3*1e3),this.cameraVR=new mi,this.cameraBG=new bs,this.cameraScreenSpace=new Fn(-1,1,1,-1,.1,10),this.cameraMode=cs.PERSPECTIVE,this.overrideCamera=null,this.pointclouds=[],this.measurements=[],this.profiles=[],this.volumes=[],this.polygonClipVolumes=[],this.cameraAnimations=[],this.orientedImages=[],this.points=[],this.images360=[],this.geopackages=[],this.fpControls=null,this.orbitControls=null,this.earthControls=null,this.geoControls=null,this.deviceControls=null,this.inputHandler=null,this.view=new sf,this.directionalLight=null,this.initialize()}estimateHeightAt(e){let t=null,n=1/0;for(let s of this.pointclouds){if(s.root.geometryNode===void 0)continue;let r=null,o=1/0,a=e.clone().sub(s.position);a.z=0;let l=new We(a,new S(0,0,1)),c=[s.root];for(;c.length>0;){let u=c.pop(),h=u.getBoundingBox();if(!l.intersectBox(h))continue;let f=u.geometryNode.mean.z+s.position.z+u.geometryNode.boundingBox.min.z;u.geometryNode.spacing<=o&&(r=f,o=u.geometryNode.spacing);for(let m of Object.keys(u.children))u.children[m].geometryNode&&c.push(u.children[m])}(t===null||o<n)&&(t=r,n=o)}return t}getBoundingBox(e=this.pointclouds){let t=new Wt;this.scenePointCloud.updateMatrixWorld(!0),this.referenceFrame.updateMatrixWorld(!0);for(let n of e){n.updateMatrixWorld(!0);let s=n.pcoGeometry.tightBoundingBox?n.pcoGeometry.tightBoundingBox:n.boundingBox,r=He.computeTransformedBoundingBox(s,n.matrixWorld);t.union(r)}return t}addPointCloud(e){this.pointclouds.push(e),this.scenePointCloud.add(e),this.dispatchEvent({type:"pointcloud_added",pointcloud:e})}addVolume(e){this.volumes.push(e),this.dispatchEvent({type:"volume_added",scene:this,volume:e})}addOrientedImages(e){this.orientedImages.push(e),this.scene.add(e.node),this.dispatchEvent({type:"oriented_images_added",scene:this,images:e})}removeOrientedImages(e){let t=this.orientedImages.indexOf(e);t>-1&&(this.orientedImages.splice(t,1),this.dispatchEvent({type:"oriented_images_removed",scene:this,images:e}))}addPoints(e){this.points.push(e),this.scene.add(e.node)}add360Images(e){this.images360.push(e),this.scene.add(e.node),this.dispatchEvent({type:"360_images_added",scene:this,images:e})}remove360Images(e){let t=this.images360.indexOf(e);t>-1&&(this.images360.splice(t,1),this.dispatchEvent({type:"360_images_removed",scene:this,images:e}))}addGeopackage(e){this.geopackages.push(e),this.scene.add(e.node),this.dispatchEvent({type:"geopackage_added",scene:this,geopackage:e})}removeGeopackage(e){let t=this.geopackages.indexOf(e);t>-1&&(this.geopackages.splice(t,1),this.dispatchEvent({type:"geopackage_removed",scene:this,geopackage:e}))}removeVolume(e){let t=this.volumes.indexOf(e);t>-1&&(this.volumes.splice(t,1),this.dispatchEvent({type:"volume_removed",scene:this,volume:e}))}addCameraAnimation(e){this.cameraAnimations.push(e),this.dispatchEvent({type:"camera_animation_added",scene:this,animation:e})}removeCameraAnimation(e){let t=this.cameraAnimations.indexOf(volume);t>-1&&(this.cameraAnimations.splice(t,1),this.dispatchEvent({type:"camera_animation_removed",scene:this,animation:e}))}addPolygonClipVolume(e){this.polygonClipVolumes.push(e),this.dispatchEvent({type:"polygon_clip_volume_added",scene:this,volume:e})}removePolygonClipVolume(e){let t=this.polygonClipVolumes.indexOf(e);t>-1&&(this.polygonClipVolumes.splice(t,1),this.dispatchEvent({type:"polygon_clip_volume_removed",scene:this,volume:e}))}addMeasurement(e){e.lengthUnit=this.lengthUnit,e.lengthUnitDisplay=this.lengthUnitDisplay,this.measurements.push(e),this.dispatchEvent({type:"measurement_added",scene:this,measurement:e})}removeMeasurement(e){let t=this.measurements.indexOf(e);t>-1&&(this.measurements.splice(t,1),this.dispatchEvent({type:"measurement_removed",scene:this,measurement:e}))}addProfile(e){this.profiles.push(e),this.dispatchEvent({type:"profile_added",scene:this,profile:e})}removeProfile(e){let t=this.profiles.indexOf(e);t>-1&&(this.profiles.splice(t,1),this.dispatchEvent({type:"profile_removed",scene:this,profile:e}))}removeAllMeasurements(){for(;this.measurements.length>0;)this.removeMeasurement(this.measurements[0]);for(;this.profiles.length>0;)this.removeProfile(this.profiles[0]);for(;this.volumes.length>0;)this.removeVolume(this.volumes[0])}removeAllClipVolumes(){let e=this.volumes.filter(t=>t.clip===!0);for(let t of e)this.removeVolume(t);for(;this.polygonClipVolumes.length>0;)this.removePolygonClipVolume(this.polygonClipVolumes[0])}getActiveCamera(){return this.overrideCamera?this.overrideCamera:this.cameraMode===cs.PERSPECTIVE?this.cameraP:this.cameraMode===cs.ORTHOGRAPHIC?this.cameraO:this.cameraMode===cs.VR?this.cameraVR:null}initialize(){this.referenceFrame=new qe,this.referenceFrame.matrixAutoUpdate=!1,this.scenePointCloud.add(this.referenceFrame),this.cameraP.up.set(0,0,1),this.cameraP.position.set(1e3,1e3,1e3),this.cameraO.up.set(0,0,1),this.cameraO.position.set(1e3,1e3,1e3),this.cameraScreenSpace.lookAt(new S(0,0,0),new S(0,0,-1),new S(0,1,0)),this.directionalLight=new xo(16777215,.5),this.directionalLight.position.set(10,10,10),this.directionalLight.lookAt(new S(0,0,0)),this.scenePointCloud.add(this.directionalLight);let e=new Zc(5592405);this.scenePointCloud.add(e);{let t=He.createBackgroundTexture(512,512);t.minFilter=t.magFilter=ei,t.minFilter=t.magFilter=et;let n=new ot(new Ll(2,2,1),new Ut({map:t}));n.material.depthTest=!1,n.material.depthWrite=!1,this.sceneBG.add(n)}{{let t=new xo(16777215);t.position.set(10,10,1),t.target.position.set(0,0,0),this.scene.add(t)}{let t=new xo(16777215);t.position.set(-10,10,1),t.target.position.set(0,0,0),this.scene.add(t)}{let t=new xo(16777215);t.position.set(0,-10,20),t.target.position.set(0,0,0),this.scene.add(t)}{let t=new hh(16777215,4473924,1);t.position.set(0,200,0),this.scene.add(t)}}}addAnnotation(e,t={}){e instanceof Array?t.position=new S().fromArray(e):e.x!=null&&(t.position=e);let n=new ra(t);return this.annotations.add(n),n}getAnnotations(){return this.annotations}removeAnnotation(e){this.annotations.remove(e)}}proj4.defs([["UTM10N","+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"],["EPSG:6339","+proj=utm +zone=10 +ellps=GRS80 +units=m +no_defs"],["EPSG:6340","+proj=utm +zone=11 +ellps=GRS80 +units=m +no_defs"],["EPSG:6341","+proj=utm +zone=12 +ellps=GRS80 +units=m +no_defs"],["EPSG:6342","+proj=utm +zone=13 +ellps=GRS80 +units=m +no_defs"],["EPSG:6343","+proj=utm +zone=14 +ellps=GRS80 +units=m +no_defs"],["EPSG:6344","+proj=utm +zone=15 +ellps=GRS80 +units=m +no_defs"],["EPSG:6345","+proj=utm +zone=16 +ellps=GRS80 +units=m +no_defs"],["EPSG:6346","+proj=utm +zone=17 +ellps=GRS80 +units=m +no_defs"],["EPSG:6347","+proj=utm +zone=18 +ellps=GRS80 +units=m +no_defs"],["EPSG:6348","+proj=utm +zone=19 +ellps=GRS80 +units=m +no_defs"],["EPSG:26910","+proj=utm +zone=10 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26911","+proj=utm +zone=11 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26912","+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26913","+proj=utm +zone=13 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26914","+proj=utm +zone=14 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26915","+proj=utm +zone=15 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26916","+proj=utm +zone=16 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26917","+proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26918","+proj=utm +zone=18 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "],["EPSG:26919","+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs "]]);class q1{constructor(e){this.viewer=e,this.webMapService="WMTS",this.mapProjectionName="EPSG:3857",this.mapProjection=proj4.defs(this.mapProjectionName),this.sceneProjection=null,this.extentsLayer=null,this.cameraLayer=null,this.toolLayer=null,this.sourcesLayer=null,this.sourcesLabelLayer=null,this.images360Layer=null,this.enabled=!1,this.createAnnotationStyle=t=>[new ol.style.Style({image:new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:[255,255,255,.5],width:2}),fill:new ol.style.Fill({color:[0,0,0,.5]})})})],this.createLabelStyle=t=>new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"white",width:2}),fill:new ol.style.Fill({color:"green"})}),text:new ol.style.Text({font:"12px helvetica,sans-serif",text:t,fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})}showSources(e){this.sourcesLayer.setVisible(e),this.sourcesLabelLayer.setVisible(e)}init(){if(typeof ol>"u")return;this.elMap=$("#potree_map"),this.elMap.draggable({handle:$("#potree_map_header")}),this.elMap.resizable(),this.elTooltip=$('<div style="position: relative; z-index: 100"></div>'),this.elMap.append(this.elTooltip);let e=this.getExtentsLayer(),t=this.getCameraLayer();this.getToolLayer();let n=this.getSourcesLayer();this.images360Layer=this.getImages360Layer(),this.getSourcesLabelLayer(),this.getAnnotationsLayer();let s=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(5),projection:"EPSG:4326",undefinedHTML:"&nbsp;"}),r=this,o=function(u){let h=u||{},d=document.createElement("button");d.innerHTML="T",d.addEventListener("click",()=>{let y=n.getVisible();r.showSources(!y)},!1),d.style.float="left",d.title="show / hide tiles";let f=document.createElement("a");f.href="#",f.download="list.txt",f.style.float="left";let m=document.createElement("button");m.innerHTML="D",f.appendChild(m);let v=y=>{let x=l.getArray(),R=[document.location.protocol,"//",document.location.host,document.location.pathname].join("");if(x.length===0)return alert("No tiles were selected. Select area with ctrl + left mouse button!"),y.preventDefault(),y.stopImmediatePropagation(),!1;if(x.length===1){let I=x[0];if(I.source){let B=I.pointcloud.pcoGeometry.url,N=new URL(R+"/../"+B+"/../source/"+I.source.name);f.href=N.href,f.download=I.source.name}}else{let I="";for(let N=0;N<x.length;N++){let J=x[N];if(J.source){let ne=J.pointcloud.pcoGeometry.url,se=new URL(R+"/../"+ne+"/../source/"+J.source.name);I+=se.href+`
`}}let B="data:application/octet-stream;base64,"+btoa(I);f.href=B,f.download="list_of_files.txt"}};m.addEventListener("click",v,!1);let _=document.createElement("div");_.className="ol-unselectable ol-control",_.appendChild(f),_.appendChild(d),_.style.bottom="0.5em",_.style.left="0.5em",_.title="Download file or list of selected tiles. Select tile with left mouse button or area using ctrl + left mouse.",ol.control.Control.call(this,{element:_,target:h.target})};ol.inherits(o,ol.control.Control),this.map=new ol.Map({controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new o,s]),layers:[new ol.layer.Tile({source:new ol.source.OSM}),this.toolLayer,this.annotationsLayer,this.sourcesLayer,this.sourcesLabelLayer,this.images360Layer,e,t],target:"potree_map_content",view:new ol.View({center:this.olCenter,zoom:9})}),this.dragBoxLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0, 0, 255, 1)",width:2})})}),this.map.addLayer(this.dragBoxLayer);let a=new ol.interaction.Select;this.map.addInteraction(a);let l=a.getFeatures(),c=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly});this.map.addInteraction(c),this.map.on("click",u=>{let h=u.pixel,d=this.map.forEachFeatureAtPixel(h,function(f){return f});d&&d.onClick&&d.onClick(u)}),c.on("boxend",u=>{let h=c.getGeometry().getExtent();this.getSourcesLayer().getSource().forEachFeatureIntersectingExtent(h,d=>{l.push(d)})}),c.on("boxstart",u=>{l.clear()}),this.map.on("click",()=>{l.clear()}),this.viewer.addEventListener("scene_changed",u=>{this.setScene(u.scene)}),this.onPointcloudAdded=u=>{this.load(u.pointcloud)},this.on360ImagesAdded=u=>{this.addImages360(u.images)},this.onAnnotationAdded=u=>{if(!this.sceneProjection)return;let h=u.annotation,d=h.position,f=this.toMap.forward([d.x,d.y]),m=new ol.Feature({geometry:new ol.geom.Point(f),name:h.title});m.setStyle(this.createAnnotationStyle(h.title)),m.onHover=v=>{let _=m.getGeometry().getCoordinates(),y=this.map.getPixelFromCoordinate(_);this.elTooltip.html(h.title),this.elTooltip.css("display",""),this.elTooltip.css("left",`${y[0]}px`),this.elTooltip.css("top",`${y[1]}px`)},m.onClick=v=>{h.clickTitle()},this.getAnnotationsLayer().getSource().addFeature(m)},this.setScene(this.viewer.scene)}setScene(e){if(this.scene!==e){this.scene&&(this.scene.removeEventListener("pointcloud_added",this.onPointcloudAdded),this.scene.removeEventListener("360_images_added",this.on360ImagesAdded),this.scene.annotations.removeEventListener("annotation_added",this.onAnnotationAdded)),this.scene=e,this.scene.addEventListener("pointcloud_added",this.onPointcloudAdded),this.scene.addEventListener("360_images_added",this.on360ImagesAdded),this.scene.annotations.addEventListener("annotation_added",this.onAnnotationAdded);for(let t of this.viewer.scene.pointclouds)this.load(t);this.viewer.scene.annotations.traverseDescendants(t=>{this.onAnnotationAdded({annotation:t})});for(let t of this.viewer.scene.images360)this.on360ImagesAdded({images:t})}}getExtentsLayer(){if(this.extentsLayer)return this.extentsLayer;this.gExtent=new ol.geom.LineString([[0,0],[0,0]]);let e=new ol.Feature(this.gExtent),t=new ol.source.Vector({features:[e]});return this.extentsLayer=new ol.layer.Vector({source:t,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#0000ff",width:2}),image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:"#0000ff"})})})}),this.extentsLayer}getAnnotationsLayer(){return this.annotationsLayer?this.annotationsLayer:(this.annotationsLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2})})}),this.annotationsLayer)}getCameraLayer(){if(this.cameraLayer)return this.cameraLayer;this.gCamera=new ol.geom.LineString([[0,0],[0,0],[0,0],[0,0]]);let e=new ol.Feature(this.gCamera),t=new ol.source.Vector({features:[e]});return this.cameraLayer=new ol.layer.Vector({source:t,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#0000ff",width:2})})}),this.cameraLayer}getToolLayer(){return this.toolLayer?this.toolLayer:(this.toolLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2})})}),this.toolLayer)}getImages360Layer(){if(this.images360Layer)return this.images360Layer;let e=new ol.style.Style({image:new ol.style.Circle({radius:4,stroke:new ol.style.Stroke({color:[255,0,0,1],width:2}),fill:new ol.style.Fill({color:[255,100,100,1]})})}),t=new ol.layer.Vector({source:new ol.source.Vector({}),style:e});return this.images360Layer=t,this.images360Layer}getSourcesLayer(){return this.sourcesLayer?this.sourcesLayer:(this.sourcesLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0, 0, 150, 0.1)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 150, 1)",width:1})})}),this.sourcesLayer)}getSourcesLabelLayer(){return this.sourcesLabelLayer?this.sourcesLabelLayer:(this.sourcesLabelLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2})}),minResolution:.01,maxResolution:20}),this.sourcesLabelLayer)}setSceneProjection(e){this.sceneProjection=e,this.toMap=proj4(this.sceneProjection,this.mapProjection),this.toScene=proj4(this.mapProjection,this.sceneProjection)}getMapExtent(){let e=this.viewer.getBoundingBox(),t=this.toMap.forward([e.min.x,e.min.y]),n=this.toMap.forward([e.max.x,e.min.y]),s=this.toMap.forward([e.max.x,e.max.y]),r=this.toMap.forward([e.min.x,e.max.y]);return{bottomLeft:t,bottomRight:n,topRight:s,topLeft:r}}getMapCenter(){let e=this.getMapExtent();return[(e.bottomLeft[0]+e.topRight[0])/2,(e.bottomLeft[1]+e.topRight[1])/2]}updateToolDrawings(){this.toolLayer.getSource().clear();let e=this.viewer.profileTool.profiles;for(let n=0;n<e.length;n++){let s=e[n],r=[];for(let l=0;l<s.points.length;l++){let c=s.points[l],u=this.toMap.forward([c.x,c.y]);r.push(u)}let o=new ol.geom.LineString(r),a=new ol.Feature(o);this.toolLayer.getSource().addFeature(a)}let t=this.viewer.measuringTool.measurements;for(let n=0;n<t.length;n++){let s=t[n],r=[];for(let l=0;l<s.points.length;l++){let c=s.points[l].position,u=this.toMap.forward([c.x,c.y]);r.push(u)}s.closed&&s.points.length>0&&r.push(r[0]);let o=new ol.geom.LineString(r),a=new ol.Feature(o);this.toolLayer.getSource().addFeature(a)}}addImages360(e){let t=this.toMap.forward,n=this.getImages360Layer();for(let s of e.images){let r=t([s.position[0],s.position[1]]),o=new ol.Feature({geometry:new ol.geom.Point(r)});o.onClick=()=>{e.focus(s)},n.getSource().addFeature(o)}}async load(e){if(!e||!e.projection)return;if(!this.sceneProjection)try{this.setSceneProjection(e.projection)}catch(o){if(console.log("Failed projection:",o),e.fallbackProjection)try{console.log("Trying fallback projection..."),this.setSceneProjection(e.fallbackProjection),console.log("Set projection from fallback")}catch(a){console.log("Failed fallback projection:",a);return}else return}let t=this.getMapExtent(),n=this.getMapCenter(),s=this.map.getView();if(s.setCenter(n),this.gExtent.setCoordinates([t.bottomLeft,t.bottomRight,t.topRight,t.topLeft,t.bottomLeft]),s.fit(this.gExtent,[300,300],{constrainResolution:!1}),e.pcoGeometry.type=="ept")return;let r=`${e.pcoGeometry.url}/../sources.json`;fetch(r).then(async o=>{let l=(await o.json()).sources;for(let c=0;c<l.length;c++){let u=l[c],h=u.name,d=u.bounds,f={min:this.toMap.forward([d.min[0],d.min[1]]),max:this.toMap.forward([d.max[0],d.max[1]])},m=[(f.min[0]+f.max[0])/2,(f.min[1]+f.max[1])/2],v=this.toMap.forward([d.min[0],d.min[1]]),_=this.toMap.forward([d.max[0],d.min[1]]),y=this.toMap.forward([d.max[0],d.max[1]]),x=this.toMap.forward([d.min[0],d.max[1]]),R=new ol.Feature({geometry:new ol.geom.Polygon([[v,_,y,x,v]])});R.source=u,R.pointcloud=e,this.getSourcesLayer().getSource().addFeature(R),R=new ol.Feature({geometry:new ol.geom.Point(m),name:h}),R.setStyle(this.createLabelStyle(h)),this.sourcesLabelLayer.getSource().addFeature(R)}}).catch(()=>{})}toggle(){this.elMap.is(":visible")?(this.elMap.css("display","none"),this.enabled=!1):(this.elMap.css("display","block"),this.enabled=!0)}update(e){if(!this.sceneProjection)return;let t=$("#potree_map");if(!this.enabled)return;let n=this.map.getSize();(t.width()!==n[0]||t.height()!==n[1])&&this.map.updateSize();let r=this.viewer.scene.getActiveCamera(),o=this.map.getView().getResolution(),a=r.position,c=r.getWorldDirection(new S).clone().multiplyScalar(30*o).add(a),u=r.position,h=c,d=new Se().fromArray(this.toMap.forward([u.x,u.y])),f=new Se().fromArray(this.toMap.forward([h.x,h.y])),m=new Se().subVectors(f,d).normalize();f=d.clone().add(m.clone().multiplyScalar(30*o));let v=d.distanceTo(f),_=new Se(-m.y,m.x),y=d.toArray(),x=f.clone().sub(_.clone().multiplyScalar(.3*v)).toArray(),R=f.clone().add(_.clone().multiplyScalar(.3*v)).toArray();this.gCamera.setCoordinates([y,x,R,y])}get sourcesVisible(){return this.getSourcesLayer().getVisible()}set sourcesVisible(e){this.getSourcesLayer().setVisible(e)}}class ou{static toXYZ(e,t=!1){const n={x:[],y:[],z:[],minX:Number.MAX_VALUE,minY:Number.MAX_VALUE,minZ:Number.MAX_VALUE,maxX:-Number.MAX_VALUE,maxY:-Number.MAX_VALUE,maxZ:-Number.MAX_VALUE,numPoints:0},s=e.data,r=s.mileage,o=s.position,a=s.rgba;for(let l=0;l<e.numPoints;l++){const c=r[l],u=o[l*3+0],h=o[l*3+1],d=o[l*3+2];t===!0?(n.x.push(c),n.y.push(0),n.z.push(d),n.maxX<c&&(n.maxX=c),n.minX>c&&(n.minX=c),n.maxZ<d&&(n.maxZ=d),n.minZ>d&&(n.minZ=d)):(n.x.push(u),n.y.push(h),n.z.push(d),n.maxX<u&&(n.maxX=u),n.minX>u&&(n.minX=u),n.maxY<h&&(n.maxY=h),n.minY>h&&(n.minY=h),n.maxZ<d&&(n.maxZ=d),n.minZ>d&&(n.minZ=d))}return t===!0&&(n.maxY=0,n.minY=0),n.numPoints=e.numPoints,n}static plotPCloudPoint(e,t,n){return`0
POINT
8
layer_pointCloud
10
${e}
20
${t}
30
${n}
`}static toString(e,t=!1){const n=ou.toXYZ(e,t),s=`999
DXF created from potree
0
SECTION
2
HEADER
9
$ACADVER
1
AC1006
9
$INSBASE
10
0.0
20
0.0
30
0.0
9
$EXTMIN
10
${n.minX}
20
${n.minY}
30
${n.minZ}
9
$EXTMAX
10
${n.maxX}
20
${n.maxY}
30
${n.maxZ}
0
ENDSEC
`;let r=`0
SECTION
2
ENTITIES
`;for(let a=0;a<n.numPoints;a++)r+=ou.plotPCloudPoint(n.x[a],n.y[a],n.z[a]);return r+=`0
ENDSEC
`,s+r+`0
EOF`}}class X1{static toString(e){let t="",n=Object.keys(e.data).filter(r=>r!=="normal").sort((r,o)=>{if(r==="position")return-1;if(o==="position")return 1;if(r==="rgba")return-1;if(o==="rgba")return 1}),s=[];for(let r of n){let o=e.data[r].length/e.numPoints;if(r==="position")s=s.concat(["x","y","z"]);else if(r==="rgba")s=s.concat(["r","g","b","a"]);else if(o>1)for(let a=0;a<o;a++)s.push(`${r}_${a}`);else s.push(r)}t=s.join(", ")+`
`;for(let r=0;r<e.numPoints;r++){let o=[];for(let a of n){let l=e.data[a].length/e.numPoints,c=e.data[a].subarray(l*r,l*r+l).join(", ");o.push(c)}t+=o.join(", ")+`
`}return t}}class Y1{static toLAS(e){let t=e.boundingBox,n=t.min.clone(),s=t.min.distanceTo(t.max),r=new S(.001,.001,.001);s>1e3*1e3?r=new S(.01,.01,.01):r=new S(.001,.001,.001);let o=function(h,d,f){let m=new Uint8Array(f);for(let v=0;v<h.length;v++){let _=h.charCodeAt(v);m[d+v]=_}},a=new ArrayBuffer(227+28*e.numPoints),l=new DataView(a),c=new Uint8Array(a);o("LASF",0,a),c[24]=1,c[25]=2,o("Potree 1.7",58,a),l.setUint16(94,227,!0),l.setUint32(96,227,!0),c[104]=2,l.setUint16(105,28,!0),l.setUint32(107,e.numPoints,!0),l.setFloat64(131,r.x,!0),l.setFloat64(139,r.y,!0),l.setFloat64(147,r.z,!0),l.setFloat64(155,n.x,!0),l.setFloat64(163,n.y,!0),l.setFloat64(171,n.z,!0),l.setFloat64(179,t.max.x,!0),l.setFloat64(187,t.min.x,!0),l.setFloat64(195,t.max.y,!0),l.setFloat64(203,t.min.y,!0),l.setFloat64(211,t.max.z,!0),l.setFloat64(219,t.min.z,!0);let u=227;for(let h=0;h<e.numPoints;h++){let d=e.data.position[3*h+0],f=e.data.position[3*h+1],m=e.data.position[3*h+2],v=parseInt((d-n.x)/r.x),_=parseInt((f-n.y)/r.y),y=parseInt((m-n.z)/r.z);l.setUint32(u+0,v,!0),l.setUint32(u+4,_,!0),l.setUint32(u+8,y,!0),e.data.intensity&&l.setUint16(u+12,e.data.intensity[h],!0);let x=0;if(e.data.returnNumber&&(x+=e.data.returnNumber[h]),e.data.numberOfReturns&&(x+=e.data.numberOfReturns[h]<<3),l.setUint8(u+14,x),e.data.classification&&l.setUint8(u+15,e.data.classification[h]),e.data.pointSourceID&&l.setUint16(u+18,e.data.pointSourceID[h]),e.data.rgba||e.data.color){let R=e.data.rgba??e.data.color;l.setUint16(u+20,R[4*h+0]*255,!0),l.setUint16(u+22,R[4*h+1]*255,!0),l.setUint16(u+24,R[4*h+2]*255,!0)}u+=28}return a}}function Eg(i,e){for(let t of Object.keys(e.uniforms))e.uniforms[t].value=i.uniforms[t].value;e.gradientTexture=i.gradientTexture,e.visibleNodesTexture=i.visibleNodesTexture,e.classificationTexture=i.classificationTexture,e.matcapTexture=i.matcapTexture,e.activeAttributeName=i.activeAttributeName,e.ranges=i.ranges}class Z1{constructor(e,t){this.geometry=e,this.material=t,this.sceneNode=new ho(e,t),this.geometryNode={estimatedSpacing:1,geometry:e}}getLevel(){return 0}}class J1 extends Ja{constructor(e){super(),this.trueOctree=e,this.pcoGeometry=e.pcoGeometry,this.points=[],this.visibleNodes=[],this.material=new Hr,Eg(this.trueOctree.material,this.material),this.material.pointSizeType=Ws.FIXED,this.batchSize=100*1e3,this.currentBatch=null}getAttribute(e){return this.trueOctree.getAttribute(e)}dispose(){for(let e of this.visibleNodes)e.geometry.dispose();this.visibleNodes=[],this.currentBatch=null,this.points=[]}addPoints(e){this.currentBatch===null&&(this.currentBatch=this.createNewBatch(e)),this.points.push(e);let t={start:this.currentBatch.geometry.drawRange.count,count:0},n=new Wt,s=new S;for(let r=0;r<e.numPoints;r++){if(t.start+t.count>=this.batchSize){for(let h of Object.keys(this.currentBatch.geometry.attributes)){let d=this.currentBatch.geometry.attributes[h];d.updateRange.offset=t.start,d.updateRange.count=t.count,d.needsUpdate=!0}this.currentBatch.geometry.computeBoundingBox(),this.currentBatch.geometry.computeBoundingSphere(),this.currentBatch=this.createNewBatch(e),t={start:0,count:0}}s.set(e.data.position[3*r+0]+this.trueOctree.position.x,e.data.position[3*r+1]+this.trueOctree.position.y,e.data.position[3*r+2]+this.trueOctree.position.z);let o=e.data.mileage[r],a=0,l=s.z;n.expandByPoint(new S(o,a,l));let c=t.start+t.count,u=this.currentBatch.geometry;for(let h of Object.keys(e.data)){let d=e.data[h],f=u.attributes[h],m=f.itemSize;for(let v=0;v<m;v++)f.array[m*c+v]=d[m*r+v]}{let h=u.attributes.position;h.array[3*c+0]=o,h.array[3*c+1]=a,h.array[3*c+2]=l}t.count++,this.currentBatch.geometry.drawRange.count++}for(let r of Object.keys(this.currentBatch.geometry.attributes)){let o=this.currentBatch.geometry.attributes[r];o.updateRange.offset=t.start,o.updateRange.count=t.count,o.needsUpdate=!0}e.projectedBox=n,this.projectedBox=this.points.reduce((r,o)=>r.union(o.projectedBox),new Wt)}createNewBatch(e){let t=new wt;for(let s of Object.keys(e.data)){let r=e.data[s],o=r.length/e.numPoints,a=r.constructor,l=!1;this.trueOctree.root.sceneNode&&this.trueOctree.root.sceneNode.geometry.attributes[s]&&(l=this.trueOctree.root.sceneNode.geometry.attributes[s].normalized);let c=new a(o*this.batchSize),u=new tt(c,o,l);u.potree={range:[0,1]},t.setAttribute(s,u)}t.drawRange.start=0,t.drawRange.count=0;let n=new Z1(t,this.material);return this.visibleNodes.push(n),n}computeVisibilityTextureData(){let e=new Uint8Array(this.visibleNodes.length*4),t=new Map;for(let n=0;n<this.visibleNodes.length;n++){let s=this.visibleNodes[n];t[s]=n}return{data:e,offsets:t}}}class K1 extends Ne{constructor(e){super(),this.viewer=e,this.elRoot=$("#profile_window"),this.renderArea=this.elRoot.find("#profileCanvasContainer"),this.svg=d3.select("svg#profileSVG"),this.mouseIsDown=!1,this.projectedBox=new Wt,this.pointclouds=new Map,this.numPoints=0,this.lastAddPointsTimestamp=void 0,this.mouse=new Se(0,0),this.scale=new S(1,1,1),this.autoFitEnabled=!0,this.autoFit=!1;let t=`${z.resourcePath}/icons/arrow_cw.svg`;$("#potree_profile_rotate_cw").attr("src",t);let n=`${z.resourcePath}/icons/arrow_ccw.svg`;$("#potree_profile_rotate_ccw").attr("src",n);let s=`${z.resourcePath}/icons/arrow_up.svg`;$("#potree_profile_move_forward").attr("src",s);let r=`${z.resourcePath}/icons/arrow_down.svg`;$("#potree_profile_move_backward").attr("src",r);let o=`${z.resourcePath}/icons/file_dxf_2d.svg`;$("#potree_download_dxf2D_icon").attr("src",o);let a=`${z.resourcePath}/icons/file_dxf_3d.svg`;$("#potree_download_dxf3D_icon").attr("src",a);let l=`${z.resourcePath}/icons/file_csv_2d.svg`;$("#potree_download_csv_icon").attr("src",l);let c=`${z.resourcePath}/icons/file_las_3d.svg`;$("#potree_download_las_icon").attr("src",c);let u=`${z.resourcePath}/icons/close.svg`;$("#closeProfileContainer").attr("src",u),this.initTHREE(),this.initSVG(),this.initListeners(),this.pRenderer=new tf(this.renderer),this.elRoot.i18n()}initListeners(){$(window).resize(()=>{this.enabled&&this.render()}),this.renderArea.mousedown(s=>{this.mouseIsDown=!0}),this.renderArea.mouseup(s=>{this.mouseIsDown=!1});let e=()=>{let s=this.viewer.scene.getActiveCamera(),r=this.viewer.renderer.domElement,o=this.viewerPickSphere.position.distanceTo(s.position),l=10/He.projectedRadius(1,s,o,r.clientWidth,r.clientHeight);this.viewerPickSphere.scale.set(l,l,l)};this.renderArea.mousemove(s=>{if(this.pointclouds.size===0)return;let r=this.renderArea[0].getBoundingClientRect(),o=s.clientX-r.left,a=s.clientY-r.top,l=new Se(o,a);if(this.mouseIsDown){this.autoFit=!1,this.lastDrag=new Date().getTime();let c=[this.scaleX.invert(this.mouse.x),this.scaleY.invert(this.mouse.y)],u=[this.scaleX.invert(l.x),this.scaleY.invert(l.y)];this.camera.position.x-=u[0]-c[0],this.camera.position.z-=u[1]-c[1],this.render()}else if(this.pointclouds.size>0){let c=Math.abs(this.scaleX.invert(0)-this.scaleX.invert(40)),u=this.scaleX.invert(l.x),h=this.scaleY.invert(l.y),d=this.selectPoint(u,h,c);if(d){let f=d.point,m=new Float64Array([f.position[0]+d.pointcloud.position.x,f.position[1]+d.pointcloud.position.y,f.position[2]+d.pointcloud.position.z]);this.elRoot.find("#profileSelectionProperties").fadeIn(200),this.pickSphere.visible=!0,this.pickSphere.scale.set(.5*c,.5*c,.5*c),this.pickSphere.position.set(f.mileage,0,m[2]),this.viewerPickSphere.position.set(...m),this.viewer.scene.scene.children.includes(this.viewerPickSphere)||(this.viewer.scene.scene.add(this.viewerPickSphere),this.viewer.hasEventListener("update",e)||this.viewer.addEventListener("update",e));let v=this.elRoot.find("#profileSelectionProperties"),_="<table>";for(let y of Object.keys(f)){let x=f[y],R=d.pointcloud.getAttribute(y),I=B=>B;if(R&&R.type.size>4){let B=R.initialRange,N=1/(B[1]-B[0]),J=B[0];I=ne=>ne/N+J}if(y==="position"){let B=[...m].map(N=>He.addCommas(N.toFixed(3)));_+=`
								<tr>
									<td>x</td>
									<td>${B[0]}</td>
								</tr>
								<tr>
									<td>y</td>
									<td>${B[1]}</td>
								</tr>
								<tr>
									<td>z</td>
									<td>${B[2]}</td>
								</tr>`}else if(y==="rgba")_+=`
								<tr>
									<td>${y}</td>
									<td>${x.join(", ")}</td>
								</tr>`;else{if(y==="normal")continue;y==="mileage"?_+=`
								<tr>
									<td>${y}</td>
									<td>${x.toFixed(3)}</td>
								</tr>`:_+=`
								<tr>
									<td>${y}</td>
									<td>${I(x)}</td>
								</tr>`}}_+="</table>",v.html(_),this.selectedPoint=f}else{this.viewer.scene.scene.add(this.viewerPickSphere);let f=this.viewer.scene.scene.children.indexOf(this.viewerPickSphere);f>=0&&this.viewer.scene.scene.children.splice(f,1),this.viewer.removeEventListener("update",e)}this.render()}this.mouse.copy(l)});let t=s=>{this.autoFit=!1;let r=0;s.wheelDelta!==void 0?r=s.wheelDelta:s.detail!==void 0&&(r=-s.detail);let o=Math.sign(r),a=[this.scaleX.invert(this.mouse.x),this.scaleY.invert(this.mouse.y)];o>0?this.scale.multiplyScalar(1.1):this.scale.multiplyScalar(100/110),this.updateScales();let l=[this.scaleX.invert(this.mouse.x),this.scaleY.invert(this.mouse.y)];this.camera.position.x-=l[0]-a[0],this.camera.position.z-=l[1]-a[1],this.render(),this.updateScales()};$(this.renderArea)[0].addEventListener("mousewheel",t,!1),$(this.renderArea)[0].addEventListener("DOMMouseScroll",t,!1),$("#closeProfileContainer").click(()=>{this.hide()});let n=s=>{let r=new Dh;for(let[o,a]of this.pointclouds)for(let l of a.points){let c=l.data.position,u=new Float64Array(c);for(let h=0;h<l.numPoints;h++)s===!0&&(u[3*h+0]+=o.position.x,u[3*h+1]+=o.position.y),u[3*h+2]+=o.position.z;l.data.position=u,r.add(l),l.data.position=c}return r};$("#potree_download_dxf2D_icon").click(()=>{const s=n(),r=ou.toString(s,!0),o=new Blob([r],{type:"text/string"});$("#potree_download_profile_dxf2D_link").attr("href",URL.createObjectURL(o))}),$("#potree_download_dxf3D_icon").click(()=>{const s=n(!0),r=ou.toString(s),o=new Blob([r],{type:"text/string"});$("#potree_download_profile_dxf3D_link").attr("href",URL.createObjectURL(o))}),$("#potree_download_csv_icon").click(()=>{let s=n(!0),r=X1.toString(s),o=new Blob([r],{type:"text/string"});$("#potree_download_profile_ortho_link").attr("href",URL.createObjectURL(o))}),$("#potree_download_las_icon").click(()=>{let s=n(!0),r=Y1.toLAS(s),o=new Blob([r],{type:"application/octet-binary"});$("#potree_download_profile_link").attr("href",URL.createObjectURL(o))})}selectPoint(e,t,n){let s={distance:1/0,pointcloud:null,points:null,index:null},r=new Kc(new Se(e-n,t-n),new Se(e+n,t+n)),o=0,a=0,l=0,c=0;for(let[u,h]of this.pointclouds)for(let d of h.points){if(!new Kc(new Se(d.projectedBox.min.x,d.projectedBox.min.z),new Se(d.projectedBox.max.x,d.projectedBox.max.z)).intersectsBox(r)){a++,c+=d.numPoints;continue}o++,l+=d.numPoints;for(let v=0;v<d.numPoints;v++){let _=d.data.mileage[v]-e,y=d.data.position[3*v+2]-t+u.position.z,x=Math.sqrt(_*_+y*y);const R=x<n&&x<s.distance;let I=!0;if(d.data.classification){const B=u.material.classification,N=d.data.classification[v],J=B[N];J&&(!J.visible||J.color.w===0)&&(I=!1)}R&&I&&(s={distance:x,pointcloud:u,points:d,index:v})}}if(s.distance<1/0){let u=s.points,h={},d=Object.keys(u.data);for(let f of d){let m=u.data[f],v=m.length/u.numPoints,_=m.subarray(v*s.index,v*s.index+v);_.length===1?h[f]=_[0]:h[f]=_}return s.point=h,s}else return null}initTHREE(){this.renderer=new Il({alpha:!0,premultipliedAlpha:!1}),this.renderer.setClearColor(0,0),this.renderer.setSize(10,10),this.renderer.autoClear=!1,this.renderArea.append($(this.renderer.domElement)),this.renderer.domElement.tabIndex="2222",$(this.renderer.domElement).css("width","100%"),$(this.renderer.domElement).css("height","100%");{let n=this.renderer.getContext();if(n.createVertexArray==null){let s=n.getExtension("OES_vertex_array_object");if(!s)throw new Error("OES_vertex_array_object extension not supported");n.createVertexArray=s.createVertexArrayOES.bind(s),n.bindVertexArray=s.bindVertexArrayOES.bind(s)}}this.camera=new Fn(-1e3,1e3,1e3,-1e3,-1e3,1e3),this.camera.up.set(0,0,1),this.camera.rotation.order="ZXY",this.camera.rotation.x=Math.PI/2,this.scene=new Si,this.profileScene=new Si;let e=new Li(1,16,16),t=new Ki;this.pickSphere=new ot(e,t),this.scene.add(this.pickSphere),this.viewerPickSphere=new ot(e,t)}initSVG(){let e=this.renderArea[0].clientWidth,t=this.renderArea[0].clientHeight,n=this.renderArea[0].offsetLeft;this.svg.selectAll("*").remove(),this.scaleX=d3.scale.linear().domain([this.camera.left+this.camera.position.x,this.camera.right+this.camera.position.x]).range([0,e]),this.scaleY=d3.scale.linear().domain([this.camera.bottom+this.camera.position.z,this.camera.top+this.camera.position.z]).range([t,0]),this.xAxis=d3.svg.axis().scale(this.scaleX).orient("bottom").innerTickSize(-t).outerTickSize(1).tickPadding(10).ticks(e/50),this.yAxis=d3.svg.axis().scale(this.scaleY).orient("left").innerTickSize(-e).outerTickSize(1).tickPadding(10).ticks(t/20),this.elXAxis=this.svg.append("g").attr("class","x axis").attr("transform",`translate(${n}, ${t})`).call(this.xAxis),this.elYAxis=this.svg.append("g").attr("class","y axis").attr("transform",`translate(${n}, 0)`).call(this.yAxis)}addPoints(e,t){if(t.numPoints===0)return;let n=this.pointclouds.get(e);if(!n){n=new J1(e),this.pointclouds.set(e,n),this.profileScene.add(n);let r=()=>{this.render()};r(),e.material.addEventListener("material_property_changed",r),this.addEventListener("on_reset_once",()=>{e.material.removeEventListener("material_property_changed",r)})}if(n.addPoints(t),this.projectedBox.union(n.projectedBox),this.autoFit&&this.autoFitEnabled){let r=this.renderArea[0].clientWidth,o=this.renderArea[0].clientHeight,a=this.projectedBox.getSize(new S),l=r/a.x,c=o/a.z,u=Math.min(l,c),h=this.projectedBox.getCenter(new S);this.scale.set(u,u,1),this.camera.position.copy(h)}this.render();let s=0;for(let[r,o]of this.pointclouds.entries())s+=o.points.reduce((a,l)=>a+l.numPoints,0);$("#profile_num_points").html(He.addCommas(s))}reset(){this.lastReset=new Date().getTime(),this.dispatchEvent({type:"on_reset_once"}),this.removeEventListeners("on_reset_once"),this.autoFit=!0,this.projectedBox=new Wt;for(let[e,t]of this.pointclouds)t.dispose();this.pointclouds.clear(),this.mouseIsDown=!1,this.mouse.set(0,0),this.autoFitEnabled&&this.scale.set(1,1,1),this.pickSphere.visible=!1,this.elRoot.find("#profileSelectionProperties").hide(),this.render()}show(){this.elRoot.fadeIn(),this.enabled=!0}hide(){this.elRoot.fadeOut(),this.enabled=!1}updateScales(){let e=this.renderArea[0].clientWidth,t=this.renderArea[0].clientHeight,n=-e/2/this.scale.x,s=+e/2/this.scale.x,r=+t/2/this.scale.y,o=-t/2/this.scale.y;this.camera.left=n,this.camera.right=s,this.camera.top=r,this.camera.bottom=o,this.camera.updateProjectionMatrix(),this.scaleX.domain([this.camera.left+this.camera.position.x,this.camera.right+this.camera.position.x]).range([0,e]),this.scaleY.domain([this.camera.bottom+this.camera.position.z,this.camera.top+this.camera.position.z]).range([t,0]);let a=this.renderArea[0].offsetLeft;this.xAxis.scale(this.scaleX).orient("bottom").innerTickSize(-t).outerTickSize(1).tickPadding(10).ticks(e/50),this.yAxis.scale(this.scaleY).orient("left").innerTickSize(-e).outerTickSize(1).tickPadding(10).ticks(t/20),this.elXAxis.attr("transform",`translate(${a}, ${t})`).call(this.xAxis),this.elYAxis.attr("transform",`translate(${a}, 0)`).call(this.yAxis)}requestScaleUpdate(){let e=100;this.lastReset===void 0||this.lastScaleUpdate===void 0||new Date().getTime()-this.lastReset>e&&new Date().getTime()-this.lastScaleUpdate>e?(this.updateScales(),this.lastScaleUpdate=new Date().getTime(),this.scaleUpdatePending=!1):this.scaleUpdatePending||(setTimeout(this.requestScaleUpdate.bind(this),100),this.scaleUpdatePending=!0)}render(){let e=this.renderArea[0].clientWidth,t=this.renderArea[0].clientHeight,{renderer:n,pRenderer:s,camera:r,profileScene:o,scene:a}=this,{scaleX:l,pickSphere:c}=this;n.setSize(e,t),n.setClearColor(0,0),n.clear(!0,!0,!1);for(let h of this.pointclouds.keys()){let d=h.material,f=this.pointclouds.get(h).material;Eg(d,f),f.size=2}s.render(o,r,null);let u=Math.abs(l.invert(0)-l.invert(5));u===0?c.visible=!1:(c.scale.set(u,u,u),c.visible=!0),n.render(a,r),this.requestScaleUpdate()}}class Q1{constructor(e){this.viewer=e,this.profileWindow=e.profileWindow,this.profile=null,this.numPoints=0,this.threshold=60*1e3,this.rotateAmount=10,this.scheduledRecomputeTime=null,this.enabled=!0,this.requests=[],this._recompute=()=>{this.recompute()},this.viewer.addEventListener("scene_changed",n=>{n.oldScene.removeEventListener("pointcloud_added",this._recompute),n.scene.addEventListener("pointcloud_added",this._recompute)}),this.viewer.scene.addEventListener("pointcloud_added",this._recompute),$("#potree_profile_rotate_amount").val(parseInt(this.rotateAmount)),$("#potree_profile_rotate_amount").on("input",n=>{const s=$("#potree_profile_rotate_amount").val();if(isNaN(s))$("#potree_profile_rotate_amount").css("background-color","#ff9999");else{const r=parseFloat(s);this.rotateAmount=r,$("#potree_profile_rotate_amount").css("background-color","")}});const t=n=>{const s=this.profile,r=s.points,o=r[0],a=r[r.length-1],l=o.clone().add(a).multiplyScalar(.5),c=new xe().makeTranslation(-l.x,-l.y,-l.z),u=new xe().makeRotationZ(n),d=new xe().makeTranslation(l.x,l.y,l.z).multiply(u).multiply(c),f=r.map(m=>m.clone().applyMatrix4(d));this.profileWindow.autoFitEnabled=!1;for(let m=0;m<r.length;m++)s.setPosition(m,f[m])};$("#potree_profile_rotate_cw").click(()=>{const n=rt.degToRad(this.rotateAmount);t(-n)}),$("#potree_profile_rotate_ccw").click(()=>{const n=rt.degToRad(this.rotateAmount);t(n)}),$("#potree_profile_move_forward").click(()=>{const n=this.profile,s=n.points,r=s[0],a=s[s.length-1].clone().sub(r).normalize(),u=new S(0,0,1).cross(a).clone().multiplyScalar(n.width/2);this.profileWindow.autoFitEnabled=!1;for(let h=0;h<s.length;h++)n.setPosition(h,s[h].clone().add(u))}),$("#potree_profile_move_backward").click(()=>{const n=this.profile,s=n.points,r=s[0],a=s[s.length-1].clone().sub(r).normalize(),u=new S(0,0,1).cross(a).clone().multiplyScalar(-n.width/2);this.profileWindow.autoFitEnabled=!1;for(let h=0;h<s.length;h++)n.setPosition(h,s[h].clone().add(u))})}setProfile(e){this.profile!==null&&this.profile!==e&&(this.profile.removeEventListener("marker_moved",this._recompute),this.profile.removeEventListener("marker_added",this._recompute),this.profile.removeEventListener("marker_removed",this._recompute),this.profile.removeEventListener("width_changed",this._recompute)),this.profile=e,this.profile.addEventListener("marker_moved",this._recompute),this.profile.addEventListener("marker_added",this._recompute),this.profile.addEventListener("marker_removed",this._recompute),this.profile.addEventListener("width_changed",this._recompute),this.recompute()}reset(){if(this.profileWindow.reset(),this.numPoints=0,this.profile)for(let e of this.requests)e.cancel()}progressHandler(e,t){for(let n of t.segments)this.profileWindow.addPoints(e,n.points),this.numPoints+=n.points.numPoints}cancel(){for(let e of this.requests)e.cancel();this.requests=[]}finishLevelThenCancel(){for(let e of this.requests)e.finishLevelThenCancel();this.requests=[]}recompute(){if(this.profile&&!(this.scheduledRecomputeTime!==null&&this.scheduledRecomputeTime>new Date().getTime())){this.scheduledRecomputeTime=new Date().getTime()+100,this.scheduledRecomputeTime=null,this.reset();for(let e of this.viewer.scene.pointclouds.filter(t=>t.visible)){let t=e.getPointsInProfile(this.profile,null,{onProgress:n=>{this.enabled&&(this.progressHandler(e,n.points),this.numPoints>this.threshold&&this.finishLevelThenCancel())},onFinish:n=>{this.enabled},onCancel:()=>{this.enabled}});this.requests.push(t)}}}}class rf{static measurementToFeatures(e){let t=e.points.map(s=>s.position.toArray()),n=[];if(t.length===1){let s={type:"Feature",geometry:{type:"Point",coordinates:t[0]},properties:{name:e.name}};n.push(s)}else if(t.length>1&&!e.closed){let s={type:"Feature",geometry:{type:"LineString",coordinates:t},properties:{name:e.name}};n.push(s)}else if(t.length>1&&e.closed){let s={type:"Feature",geometry:{type:"Polygon",coordinates:[[...t,t[0]]]},properties:{name:e.name}};n.push(s)}if(e.showDistances&&e.edgeLabels.forEach(s=>{let r={type:"Feature",geometry:{type:"Point",coordinates:s.position.toArray()},properties:{distance:s.text}};n.push(r)}),e.showArea){let r={type:"Feature",geometry:{type:"Point",coordinates:e.areaLabel.position.toArray()},properties:{area:e.areaLabel.text}};n.push(r)}return n}static toString(e){e instanceof Array||(e=[e]),e=e.filter(s=>s instanceof Gr);let t=[];for(let s of e){let r=rf.measurementToFeatures(s);t=t.concat(r)}return JSON.stringify({type:"FeatureCollection",features:t},null,"	")}}class au{static measurementPointSection(e){let t=e.points[0].position;return t?`0
CIRCLE
8
layer_point
10
${t.x}
20
${t.y}
30
${t.z}
40
1.0
`:""}static measurementPolylineSection(e){let t=8;e.closed&&(t+=1);let n=`0
POLYLINE
8
layer_polyline
62
1
66
1
10
0.0
20
0.0
30
0.0
70
${t}
`,s=0,r=0,o=0;for(let a of e.points)a=a.position,s=Math.max(s,a.x),r=Math.max(r,a.y),o=Math.max(o,a.z),n+=`0
VERTEX
8
0
10
${a.x}
20
${a.y}
30
${a.z}
70
32
`;return n+=`0
SEQEND
`,n}static measurementSection(e){if(e.points.length===0)return"";if(e.points.length===1)return au.measurementPointSection(e);if(e.points.length>=2)return au.measurementPolylineSection(e)}static toString(e){e instanceof Array||(e=[e]),e=e.filter(l=>l instanceof Gr);let t=e.filter(l=>l instanceof Gr).map(l=>l.points).reduce((l,c)=>l.concat(c)).map(l=>l.position),n=new S(1/0,1/0,1/0),s=new S(-1/0,-1/0,-1/0);for(let l of t)n.min(l),s.max(l);let r=`999
DXF created from potree
0
SECTION
2
HEADER
9
$ACADVER
1
AC1006
9
$INSBASE
10
0.0
20
0.0
30
0.0
9
$EXTMIN
10
${n.x}
20
${n.y}
30
${n.z}
9
$EXTMAX
10
${s.x}
20
${s.y}
30
${s.z}
0
ENDSEC
`,o=`0
SECTION
2
ENTITIES
`;for(let l of e)o+=au.measurementSection(l);return o+=`0
ENDSEC
`,r+o+`0
EOF`}}class ua{constructor(e,t,n){this.viewer=e,this.measurement=t,this.propertiesPanel=n,this._update=()=>{this.update()}}createCoordinatesTable(e){let t=$(`
			<table class="measurement_value_table">
				<tr>
					<th>x</th>
					<th>y</th>
					<th>z</th>
					<th></th>
				</tr>
			</table>
		`),n=Potree.resourcePath+"/icons/copy.svg";for(let s of e){let r=He.addCommas(s.x.toFixed(3)),o=He.addCommas(s.y.toFixed(3)),a=He.addCommas(s.z.toFixed(3)),l=$(`
				<tr>
					<td><span>${r}</span></td>
					<td><span>${o}</span></td>
					<td><span>${a}</span></td>
					<td align="right" style="width: 25%">
						<img name="copy" title="copy" class="button-icon" src="${n}" style="width: 16px; height: 16px"/>
					</td>
				</tr>
			`);this.elCopy=l.find("img[name=copy]"),this.elCopy.click(()=>{let c=s.toArray().map(u=>u.toFixed(3)).join(", ");He.clipboardCopy(c),this.viewer.postMessage(`Copied value to clipboard: <br>'${c}'`,{duration:3e3})}),t.append(l)}return t}createAttributesTable(){let e=$('<table class="measurement_value_table"></table>'),t=this.measurement.points[0];for(let n of Object.keys(t))if(n!=="position")if(n==="rgba"){let r=t.rgba.join(", ");e.append($(`
					<tr>
						<td>rgb</td>
						<td>${r}</td>
					</tr>
				`))}else{let r=t[n].join(", ");e.append($(`
					<tr>
						<td>${n}</td>
						<td>${r}</td>
					</tr>
				`))}return e}update(){}}class e_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<table id="distances_table" class="measurement_value_table"></table>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span>
						<input type="button" name="make_profile" value="profile from measure" />
					</span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.elMakeProfile=this.elContent.find("input[name=make_profile]"),this.elMakeProfile.click(()=>{const r=new Ya;r.name=t.name,r.width=t.getTotalDistance()/50;for(const o of t.points)r.addMarker(o.position.clone());this.viewer.scene.addProfile(r)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(a=>a.position)));let t=this.measurement.points.map(a=>a.position),n=[];for(let a=0;a<t.length-1;a++){let l=t[a].distanceTo(t[a+1]);n.push(l.toFixed(3))}let s=this.measurement.getTotalDistance().toFixed(3),r=this.elContent.find("#distances_table");r.empty();for(let a=0;a<n.length;a++){let l=a===0?"Distances: ":"",c=n[a],u=$(`
				<tr>
					<th>${l}</th>
					<td style="width: 100%; padding-left: 10px">${c}</td>
				</tr>`);r.append(u)}let o=$(`
			<tr>
				<th>Total: </td><td style="width: 100%; padding-left: 10px">${s}</th>
			</tr>`);r.append(o)}}class Sg extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<span class="attributes_table_container"></span>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(n=>n.position)));let t=this.elContent.find(".attributes_table_container");t.empty(),t.append(this.createAttributesTable())}}class t_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<span style="font-weight: bold">Area: </span>
				<span id="measurement_area"></span>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(n=>n.position))),this.elContent.find("#measurement_area").html(this.measurement.getArea().toFixed(3))}}class i_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<table class="measurement_value_table">
					<tr>
						<th>\u03B1</th>
						<th>\u03B2</th>
						<th>\u03B3</th>
					</tr>
					<tr>
						<td align="center" id="angle_cell_alpha" style="width: 33%"></td>
						<td align="center" id="angle_cell_betta" style="width: 33%"></td>
						<td align="center" id="angle_cell_gamma" style="width: 33%"></td>
					</tr>
				</table>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(o=>o.position)));let t=[];for(let o=0;o<this.measurement.points.length;o++)t.push(this.measurement.getAngle(o)*(180/Math.PI));t=t.map(o=>o.toFixed(1)+"\xB0");let n=this.elContent.find("#angle_cell_alpha"),s=this.elContent.find("#angle_cell_betta"),r=this.elContent.find("#angle_cell_gamma");n.html(t[0]),s.html(t[1]),r.html(t[2])}}class n_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<table id="infos_table" class="measurement_value_table"></table>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(v=>v.position)));const t=this.elContent.find("#infos_table");if(this.measurement.points.length!==3){t.empty();return}const n=this.measurement.points[0].position,s=this.measurement.points[1].position,r=this.measurement.points[2].position,o=Potree.Utils.computeCircleCenter(n,s,r),a=o.distanceTo(n),l=2*Math.PI*a,c=v=>Potree.Utils.addCommas(v.toFixed(3)),u=`${c(o.x)} ${c(o.y)} ${c(o.z)}`,h=c(a),d=c(l),f='style="text-align: left"',m='style="width: 100%; padding: 5px;"';t.html(`
			<tr>
				<th ${f}>Center: </th>
				<td ${m}></td>
			</tr>
			<tr>
				<td ${m} colspan="2">
					${u}
				</td>
			</tr>
			<tr>
				<th ${f}>Radius: </th>
				<td ${m}>${h}</td>
			</tr>
			<tr>
				<th ${f}>Circumference: </th>
				<td ${m}>${d}</td>
			</tr>
		`)}}class s_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<span id="height_label">Height: </span><br>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeMeasurement(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points.map(t=>t.position)));{let n=this.measurement.points.slice().sort((c,u)=>c.position.z-u.position.z),s=n[0].position.clone(),r=n[n.length-1].position.clone(),o=s.z,l=r.z-o;l=l.toFixed(3),this.elHeightLabel=this.elContent.find("#height_label"),this.elHeightLabel.html(`<b>Height:</b> ${l}`)}}}class r_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/copy.svg",r=Potree.resourcePath+"/icons/remove.svg",o=new Map([[Xa,"length"],[_o,"rx"]]).get(t.constructor),a=new Map([[Xa,"width"],[_o,"ry"]]).get(t.constructor),l=new Map([[Xa,"height"],[_o,"rz"]]).get(t.constructor);this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>

				<table class="measurement_value_table">
					<tr>
						<th>\u03B1</th>
						<th>\u03B2</th>
						<th>\u03B3</th>
						<th></th>
					</tr>
					<tr>
						<td align="center" id="angle_cell_alpha" style="width: 33%"></td>
						<td align="center" id="angle_cell_betta" style="width: 33%"></td>
						<td align="center" id="angle_cell_gamma" style="width: 33%"></td>
						<td align="right" style="width: 25%">
							<img name="copyRotation" title="copy" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
						</td>
					</tr>
				</table>

				<table class="measurement_value_table">
					<tr>
						<th>${o}</th>
						<th>${a}</th>
						<th>${l}</th>
						<th></th>
					</tr>
					<tr>
						<td align="center" id="cell_length" style="width: 33%"></td>
						<td align="center" id="cell_width" style="width: 33%"></td>
						<td align="center" id="cell_height" style="width: 33%"></td>
						<td align="right" style="width: 25%">
							<img name="copyScale" title="copy" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
						</td>
					</tr>
				</table>

				<br>
				<span style="font-weight: bold">Volume: </span>
				<span id="measurement_volume"></span>

				<!--
				<li>
					<label style="whitespace: nowrap">
						<input id="volume_show" type="checkbox"/>
						<span>show volume</span>
					</label>
				</li>-->

				<li>
					<label style="whitespace: nowrap">
						<input id="volume_clip" type="checkbox"/>
						<span>make clip volume</span>
					</label>
				</li>

				<li style="margin-top: 10px">
					<input name="download_volume" type="button" value="prepare download" style="width: 100%" />
					<div name="download_message"></div>
				</li>


				<!-- ACTIONS -->
				<li style="display: grid; grid-template-columns: auto auto; grid-column-gap: 5px; margin-top: 10px">
					<input id="volume_reset_orientation" type="button" value="reset orientation"/>
					<input id="volume_make_uniform" type="button" value="make uniform"/>
				</li>
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${r}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elDownloadButton=this.elContent.find("input[name=download_volume]"),this.propertiesPanel.viewer.server?this.elDownloadButton.click(()=>this.download()):this.elDownloadButton.hide(),this.elCopyRotation=this.elContent.find("img[name=copyRotation]"),this.elCopyRotation.click(()=>{let u=this.measurement.rotation.toArray().slice(0,3).map(h=>h.toFixed(3)).join(", ");He.clipboardCopy(u),this.viewer.postMessage(`Copied value to clipboard: <br>'${u}'`,{duration:3e3})}),this.elCopyScale=this.elContent.find("img[name=copyScale]"),this.elCopyScale.click(()=>{let u=this.measurement.scale.toArray().map(h=>h.toFixed(3)).join(", ");He.clipboardCopy(u),this.viewer.postMessage(`Copied value to clipboard: <br>'${u}'`,{duration:3e3})}),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeVolume(t)}),this.elContent.find("#volume_reset_orientation").click(()=>{t.rotation.set(0,0,0)}),this.elContent.find("#volume_make_uniform").click(()=>{let c=(t.scale.x+t.scale.y+t.scale.z)/3;t.scale.set(c,c,c)}),this.elCheckClip=this.elContent.find("#volume_clip"),this.elCheckClip.click(c=>{this.measurement.clip=c.target.checked}),this.elCheckShow=this.elContent.find("#volume_show"),this.elCheckShow.click(c=>{this.measurement.visible=c.target.checked}),this.propertiesPanel.addVolatileListener(t,"position_changed",this._update),this.propertiesPanel.addVolatileListener(t,"orientation_changed",this._update),this.propertiesPanel.addVolatileListener(t,"scale_changed",this._update),this.propertiesPanel.addVolatileListener(t,"clip_changed",this._update),this.update()}async download(){let e=this.measurement,t=[];{let u=e.matrixWorld,h=new S(.5,0,0).applyMatrix4(u),d=new S(-.5,0,0).applyMatrix4(u),f=new S(0,.5,0).applyMatrix4(u),m=new S(0,-.5,0).applyMatrix4(u),v=new S(0,0,.5).applyMatrix4(u),_=new S(0,0,-.5).applyMatrix4(u),y=new S().subVectors(d,h).normalize(),x=y.clone().multiplyScalar(-1),R=new S().subVectors(m,f).normalize(),I=R.clone().multiplyScalar(-1),B=new S().subVectors(_,v).normalize(),N=B.clone().multiplyScalar(-1),J=[new yi().setFromNormalAndCoplanarPoint(y,h),new yi().setFromNormalAndCoplanarPoint(x,d),new yi().setFromNormalAndCoplanarPoint(R,f),new yi().setFromNormalAndCoplanarPoint(I,m),new yi().setFromNormalAndCoplanarPoint(B,v),new yi().setFromNormalAndCoplanarPoint(N,_)],ne=[];for(let E of J){let M=[E.normal.toArray(),E.constant].join(",");M=`[${M}]`,ne.push(M)}let se="["+ne.join(",")+"]";t.push(se)}let n=t.join(","),s=[];for(let u of this.viewer.scene.pointclouds){if(!u.visible)continue;let h=u.pcoGeometry.offset.clone(),d=new xe().makeTranslation(...h.multiplyScalar(-1).toArray()),f=u.matrixWorld,m=new xe().multiplyMatrices(f,d),_={path:`${window.location.pathname}/../${u.pcoGeometry.url}`,transform:m.elements},y=JSON.stringify(_);s.push(y)}let r=s.join(","),o=this.elContent.find("div[name=download_message]"),a=u=>{o.html(`<div style="color: #ff0000">ERROR: ${u}</div>`)},l=u=>{o.html(`${u}`)},c=null;{let u=`${viewer.server}/create_regions_filter?pointclouds=[${r}]&regions=[${n}]`;l("estimating results ...");let d=await(await fetch(u)).json();if(d.handle)c=d.handle;else{a(d.message);return}}{let u=`${viewer.server}/check_regions_filter?handle=${c}`,h=function(y){return new Promise((x,R)=>{setTimeout(()=>{x()},y)})},d=y=>{let{progress:x,estimate:R}=y,I=x["processed points"]/R.points,B=parseInt(I*100);l(`progress: ${B}%`)},f=y=>{let x="downloads ready: <br>";x+="<ul>";for(let I=0;I<y.pointclouds.length;I++){let B=`${viewer.server}/download_regions_filter_result?handle=${c}&index=${I}`;x+=`<li><a href="${B}">result_${I}.las</a> </li>
`}let R=`${viewer.server}/download_regions_filter_report?handle=${c}`;x+=`<li> <a href="${R}">report.json</a> </li>
`,x+="</ul>",l(x)},m=y=>{let x=`Unexpected Response. <br>status: ${y.status} <br>message: ${y.message}`;l(x)},v=y=>{let x=`ERROR: ${y.message}`;throw a(x),new Error(x)},_=Date.now();for(;;){let x=await(await fetch(u)).json();if(x.status==="ERROR")v(x);else if(x.status==="FILTERING")d(x);else if(x.status==="FINISHED"){f(x);break}else m(x);let I=(Date.now()-_)/1e3<10?100:1e3;await h(I)}}}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable([this.measurement.position]));{let t=this.measurement.rotation.toVector3();t=t.toArray(),t=t.map(o=>180*o/Math.PI),t=t.map(o=>o.toFixed(1)+"\xB0");let n=this.elContent.find("#angle_cell_alpha"),s=this.elContent.find("#angle_cell_betta"),r=this.elContent.find("#angle_cell_gamma");n.html(t[0]),s.html(t[1]),r.html(t[2])}{let t=this.measurement.scale.toArray();t=t.map(o=>He.addCommas(o.toFixed(2)));let n=this.elContent.find("#cell_length"),s=this.elContent.find("#cell_width"),r=this.elContent.find("#cell_height");n.html(t[0]),s.html(t[1]),r.html(t[2])}{let t=this.elContent.find("#measurement_volume"),n=this.measurement.getVolume();t.html(He.addCommas(n.toFixed(2)))}this.elCheckClip.prop("checked",this.measurement.clip),this.elCheckShow.prop("checked",this.measurement.visible)}}class o_ extends ua{constructor(e,t,n){super(e,t,n);let s=Potree.resourcePath+"/icons/remove.svg";this.elContent=$(`
			<div class="measurement_content selectable">
				<span class="coordinates_table_container"></span>
				<br>
				<span style="display:flex">
					<span style="display:flex; align-items: center; padding-right: 10px">Width: </span>
					<input id="sldProfileWidth" name="sldProfileWidth" value="5.06" style="flex-grow: 1; width:100%">
				</span>
				<br>

				<li style="margin-top: 10px">
					<input name="download_profile" type="button" value="prepare download" style="width: 100%" />
					<div name="download_message"></div>
				</li>

				<br>

				<input type="button" id="show_2d_profile" value="show 2d profile" style="width: 100%"/>

				<!-- ACTIONS -->
				<div style="display: flex; margin-top: 12px">
					<span></span>
					<span style="flex-grow: 1"></span>
					<img name="remove" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
				</div>
			</div>
		`),this.elRemove=this.elContent.find("img[name=remove]"),this.elRemove.click(()=>{this.viewer.scene.removeProfile(t)}),this.elDownloadButton=this.elContent.find("input[name=download_profile]"),this.propertiesPanel.viewer.server?this.elDownloadButton.click(()=>this.download()):this.elDownloadButton.hide();{let o=this.elContent.find("#sldProfileWidth");o.spinner({min:0,max:10*1e3*1e3,step:.01,numberFormat:"n",start:()=>{},spin:(l,c)=>{let u=o.spinner("value");t.setWidth(u)},change:(l,c)=>{let u=o.spinner("value");t.setWidth(u)},stop:(l,c)=>{let u=o.spinner("value");t.setWidth(u)},incremental:l=>{let c=o.spinner("value"),u=o.spinner("option","step"),h=c*.05;return Math.max(1,parseInt(h/u))}}),o.spinner("value",t.getWidth()),o.spinner("widget").css("width","100%");let a=l=>{o.spinner("value")!==t.getWidth()&&o.spinner("value",t.getWidth())};this.propertiesPanel.addVolatileListener(t,"width_changed",a)}this.elContent.find("#show_2d_profile").click(()=>{this.propertiesPanel.viewer.profileWindow.show(),this.propertiesPanel.viewer.profileWindowController.setProfile(t)}),this.propertiesPanel.addVolatileListener(t,"marker_added",this._update),this.propertiesPanel.addVolatileListener(t,"marker_removed",this._update),this.propertiesPanel.addVolatileListener(t,"marker_moved",this._update),this.update()}update(){let e=this.elContent.find(".coordinates_table_container");e.empty(),e.append(this.createCoordinatesTable(this.measurement.points))}async download(){let e=this.measurement,t=[];{let u=e.getSegments(),h=e.width;for(let d of u){let f=d.start.clone().multiply(new S(1,1,0)),m=d.end.clone().multiply(new S(1,1,0)),v=new S().addVectors(f,m).multiplyScalar(.5),_=new S().subVectors(m,f).normalize(),y=new S().subVectors(f,m).normalize(),x=new S(0,0,1),R=new S().crossVectors(_,x),I=new S().crossVectors(y,x);console.log(I);let B=R.clone().multiplyScalar(h*.5).add(v),N=I.clone().multiplyScalar(h*.5).add(v),J=[new yi().setFromNormalAndCoplanarPoint(_,f),new yi().setFromNormalAndCoplanarPoint(y,m),new yi().setFromNormalAndCoplanarPoint(I,B),new yi().setFromNormalAndCoplanarPoint(R,N)],ne=[];for(let E of J){let M=[E.normal.toArray(),E.constant].join(",");M=`[${M}]`,ne.push(M)}let se="["+ne.join(",")+"]";t.push(se)}}let n=t.join(","),s=[];for(let u of this.viewer.scene.pointclouds){if(!u.visible)continue;let h=u.pcoGeometry.offset.clone(),d=new xe().makeTranslation(...h.multiplyScalar(-1).toArray()),f=u.matrixWorld,m=new xe().multiplyMatrices(f,d),_={path:`${window.location.pathname}/../${u.pcoGeometry.url}`,transform:m.elements},y=JSON.stringify(_);s.push(y)}let r=s.join(","),o=this.elContent.find("div[name=download_message]"),a=u=>{o.html(`<div style="color: #ff0000">ERROR: ${u}</div>`)},l=u=>{o.html(`${u}`)},c=null;{let u=`${viewer.server}/create_regions_filter?pointclouds=[${r}]&regions=[${n}]`;l("estimating results ...");let d=await(await fetch(u)).json();if(d.handle)c=d.handle;else{a(d.message);return}}{let u=`${viewer.server}/check_regions_filter?handle=${c}`,h=function(y){return new Promise((x,R)=>{setTimeout(()=>{x()},y)})},d=y=>{let{progress:x,estimate:R}=y,I=x["processed points"]/R.points,B=parseInt(I*100);l(`progress: ${B}%`)},f=y=>{let x="downloads ready: <br>";x+="<ul>";for(let I=0;I<y.pointclouds.length;I++){let B=`${viewer.server}/download_regions_filter_result?handle=${c}&index=${I}`;x+=`<li><a href="${B}">result_${I}.las</a> </li>
`}let R=`${viewer.server}/download_regions_filter_report?handle=${c}`;x+=`<li> <a href="${R}">report.json</a> </li>
`,x+="</ul>",l(x)},m=y=>{let x=`Unexpected Response. <br>status: ${y.status} <br>message: ${y.message}`;l(x)},v=y=>{let x=`ERROR: ${y.message}`;throw a(x),new Error(x)},_=Date.now();for(;;){let x=await(await fetch(u)).json();if(x.status==="ERROR")v(x);else if(x.status==="FILTERING")d(x);else if(x.status==="FINISHED"){f(x);break}else m(x);let I=(Date.now()-_)/1e3<10?100:1e3;await h(I)}}}}class a_{constructor(e,t){this.viewer=e,this.propertiesPanel=t,this._update=()=>{this.update()};let n=Potree.resourcePath+"/icons/copy.svg";this.elContent=$(`
		<div class="propertypanel_content">
			<table>
				<tr>
					<th colspan="3">position</th>
					<th></th>
				</tr>
				<tr>
					<td align="center" id="camera_position_x" style="width: 25%"></td>
					<td align="center" id="camera_position_y" style="width: 25%"></td>
					<td align="center" id="camera_position_z" style="width: 25%"></td>
					<td align="right" id="copy_camera_position" style="width: 25%">
						<img name="copyPosition" title="copy" class="button-icon" src="${n}" style="width: 16px; height: 16px"/>
					</td>
				</tr>
				<tr>
					<th colspan="3">target</th>
					<th></th>
				</tr>
				<tr>
					<td align="center" id="camera_target_x" style="width: 25%"></td>
					<td align="center" id="camera_target_y" style="width: 25%"></td>
					<td align="center" id="camera_target_z" style="width: 25%"></td>
					<td align="right" id="copy_camera_target" style="width: 25%">
						<img name="copyTarget" title="copy" class="button-icon" src="${n}" style="width: 16px; height: 16px"/>
					</td>
				</tr>
			</table>
		</div>
		`),this.elCopyPosition=this.elContent.find("img[name=copyPosition]"),this.elCopyPosition.click(()=>{let r=this.viewer.scene.getActiveCamera().position.toArray().map(o=>o.toFixed(3)).join(", ");He.clipboardCopy(r),this.viewer.postMessage(`Copied value to clipboard: <br>'${r}'`,{duration:3e3})}),this.elCopyTarget=this.elContent.find("img[name=copyTarget]"),this.elCopyTarget.click(()=>{let r=this.viewer.scene.view.getPivot().toArray().map(o=>o.toFixed(3)).join(", ");He.clipboardCopy(r),this.viewer.postMessage(`Copied value to clipboard: <br>'${r}'`,{duration:3e3})}),this.propertiesPanel.addVolatileListener(e,"camera_changed",this._update),this.update()}update(){let e=this.viewer.scene.getActiveCamera(),t=this.viewer.scene.view,n=e.position.toArray().map(r=>He.addCommas(r.toFixed(3)));this.elContent.find("#camera_position_x").html(n[0]),this.elContent.find("#camera_position_y").html(n[1]),this.elContent.find("#camera_position_z").html(n[2]);let s=t.getPivot().toArray().map(r=>He.addCommas(r.toFixed(3)));this.elContent.find("#camera_target_x").html(s[0]),this.elContent.find("#camera_target_y").html(s[1]),this.elContent.find("#camera_target_z").html(s[2])}}class l_{constructor(e,t,n){this.viewer=e,this.propertiesPanel=t,this.annotation=n,this._update=()=>{this.update()};let s=`${Potree.resourcePath}/icons/copy.svg`;this.elContent=$(`
		<div class="propertypanel_content">
			<table>
				<tr>
					<th colspan="3">position</th>
					<th></th>
				</tr>
				<tr>
					<td align="center" id="annotation_position_x" style="width: 25%"></td>
					<td align="center" id="annotation_position_y" style="width: 25%"></td>
					<td align="center" id="annotation_position_z" style="width: 25%"></td>
					<td align="right" id="copy_annotation_position" style="width: 25%">
						<img name="copyPosition" title="copy" class="button-icon" src="${s}" style="width: 16px; height: 16px"/>
					</td>
				</tr>

			</table>

			<div>

				<div class="heading">Title</div>
				<div id="annotation_title" contenteditable="true">
					Annotation Title
				</div>

				<div class="heading">Description</div>
				<div id="annotation_description" contenteditable="true">
					A longer description of this annotation. 
						Can be multiple lines long. TODO: the user should be able
						to modify title and description. 
				</div>

			</div>

		</div>
		`),this.elCopyPosition=this.elContent.find("img[name=copyPosition]"),this.elCopyPosition.click(()=>{let o=this.annotation.position.toArray().map(a=>a.toFixed(3)).join(", ");He.clipboardCopy(o),this.viewer.postMessage(`Copied value to clipboard: <br>'${o}'`,{duration:3e3})}),this.elTitle=this.elContent.find("#annotation_title").html(n.title),this.elDescription=this.elContent.find("#annotation_description").html(n.description),this.elTitle[0].addEventListener("input",()=>{const r=this.elTitle.html();n.title=r},!1),this.elDescription[0].addEventListener("input",()=>{const r=this.elDescription.html();n.description=r},!1),this.update()}update(){const{annotation:e,elContent:t,elTitle:n,elDescription:s}=this;let r=e.position.toArray().map(o=>He.addCommas(o.toFixed(3)));t.find("#annotation_position_x").html(r[0]),t.find("#annotation_position_y").html(r[1]),t.find("#annotation_position_z").html(r[2]),n.html(e.title),s.html(e.description)}}class c_{constructor(e,t,n){this.viewer=e,this.propertiesPanel=t,this.animation=n,this.elContent=$(`
			<div class="propertypanel_content">
				<span id="animation_keyframes"></span>

				<span>

					<span style="display:flex">
						<span style="display:flex; align-items: center; padding-right: 10px">Duration: </span>
						<input name="spnDuration" value="5.0" style="flex-grow: 1; width:100%">
					</span>

					<span>Time: </span><span id="lblTime"></span> <div id="sldTime"></div>

					<input name="play" type="button" value="play"/>
				</span>
			</div>
		`),this.elContent.find("input[name=play]").click(()=>{n.play()}),this.elContent.find("#sldTime").slider({value:0,min:0,max:1,step:.001,slide:(c,u)=>{n.set(u.value)}});let o=this.elContent.find("input[name=spnDuration]");o.spinner({min:0,max:300,step:.01,numberFormat:"n",start:()=>{},spin:(c,u)=>{let h=o.spinner("value");n.setDuration(h)},change:(c,u)=>{let h=o.spinner("value");n.setDuration(h)},stop:(c,u)=>{let h=o.spinner("value");n.setDuration(h)},incremental:c=>{let u=o.spinner("value"),h=o.spinner("option","step"),d=u*.05;return Math.max(1,parseInt(d/h))}}),o.spinner("value",n.getDuration()),o.spinner("widget").css("width","100%");const a=this.elContent.find("#animation_keyframes"),l=()=>{a.empty();const c=d=>{let f=$(`
					<div style="display: flex; margin: 0.2em 0em">
						<span style="flex-grow: 1"></span>
						<input type="button" name="add" value="insert control point" />
						<span style="flex-grow: 1"></span>
					</div>
				`);f.find("input[name=add]").click(()=>{n.createControlPoint(d)}),a.append(f)},u=d=>{let f=$(`
					<div style="display: flex; margin: 0.2em 0em">
						<span style="flex-grow: 0;">
							<img name="assign" src="${Potree.resourcePath}/icons/assign.svg" style="width: 1.5em; height: 1.5em"/>
						</span>
						<span style="flex-grow: 0;">
							<img name="move" src="${Potree.resourcePath}/icons/circled_dot.svg" style="width: 1.5em; height: 1.5em"/>
						</span>
						<span style="flex-grow: 0; width: 1.5em; height: 1.5em"></span>
						<span style="flex-grow: 0; font-size: 1.5em">keyframe</span>
						<span style="flex-grow: 1"></span>
						<span style="flex-grow: 0;">
							<img name="delete" src="${Potree.resourcePath}/icons/remove.svg" style="width: 1.5em; height: 1.5em"/>
						</span>
					</div>
				`);const m=f.find("img[name=assign]"),v=f.find("img[name=move]"),_=f.find("img[name=delete]");m.click(()=>{const y=n.controlPoints[d];y.position.copy(e.scene.view.position),y.target.copy(e.scene.view.getPivot())}),v.click(()=>{const y=n.controlPoints[d];e.scene.view.position.copy(y.position),e.scene.view.lookAt(y.target)}),_.click(()=>{const y=n.controlPoints[d];n.removeControlPoint(y)}),a.append(f)};let h=0;c(h);for(const d of n.controlPoints)u(h),h++,c(h)};l(),n.addEventListener("controlpoint_added",l),n.addEventListener("controlpoint_removed",l)}update(){}}class u_{constructor(e,t){this.container=e,this.viewer=t,this.object=null,this.cleanupTasks=[],this.scene=null}setScene(e){this.scene=e}set(e){if(this.object!==e){this.object=e;for(let t of this.cleanupTasks)t();this.cleanupTasks=[],this.container.empty(),e instanceof Ja?this.setPointCloud(e):e instanceof Gr||e instanceof Ya||e instanceof bo?this.setMeasurement(e):e instanceof bs?this.setCamera(e):e instanceof ra?this.setAnnotation(e):e instanceof tc&&this.setCameraAnimation(e)}}addVolatileListener(e,t,n){e.addEventListener(t,n),this.cleanupTasks.push(()=>{e.removeEventListener(t,n)})}setPointCloud(e){let t=e.material,n=$(`
			<div class="scene_content selectable">
				<ul class="pv-menu-list">

				<li>
				<span data-i18n="appearance.point_size"></span>:&nbsp;<span id="lblPointSize"></span> <div id="sldPointSize"></div>
				</li>
				<li>
				<span data-i18n="appearance.min_point_size"></span>:&nbsp;<span id="lblMinPointSize"></span> <div id="sldMinPointSize"></div>
				</li>

				<!-- SIZE TYPE -->
				<li>
					<label for="optPointSizing" class="pv-select-label" data-i18n="appearance.point_size_type">Point Sizing </label>
					<select id="optPointSizing" name="optPointSizing">
						<option>FIXED</option>
						<option>ATTENUATED</option>
						<option>ADAPTIVE</option>
					</select>
				</li>

				<!-- SHAPE -->
				<li>
					<label for="optShape" class="pv-select-label" data-i18n="appearance.point_shape"></label><br>
					<select id="optShape" name="optShape">
						<option>SQUARE</option>
						<option>CIRCLE</option>
						<option>PARABOLOID</option>
					</select>
				</li>

				<li id="materials_backface_container">
				<label><input id="set_backface_culling" type="checkbox" /><span data-i18n="appearance.backface_culling"></span></label>
				</li>
				
				<!-- OPACITY -->
				<li><span data-i18n="appearance.point_opacity"></span>:<span id="lblOpacity"></span><div id="sldOpacity"></div></li>

				<div class="divider">
					<span>Attribute</span>
				</div>

				<li>
					<select id="optMaterial" name="optMaterial"></select>
				</li>

				<div id="materials.composite_weight_container">
					<div class="divider">
						<span>Attribute Weights</span>
					</div>

					<li>RGB: <span id="lblWeightRGB"></span> <div id="sldWeightRGB"></div>	</li>
					<li>Intensity: <span id="lblWeightIntensity"></span> <div id="sldWeightIntensity"></div>	</li>
					<li>Elevation: <span id="lblWeightElevation"></span> <div id="sldWeightElevation"></div>	</li>
					<li>Classification: <span id="lblWeightClassification"></span> <div id="sldWeightClassification"></div>	</li>
					<li>Return Number: <span id="lblWeightReturnNumber"></span> <div id="sldWeightReturnNumber"></div>	</li>
					<li>Source ID: <span id="lblWeightSourceID"></span> <div id="sldWeightSourceID"></div>	</li>
				</div>

				<div id="materials.rgb_container">
					<div class="divider">
						<span>RGB</span>
					</div>

					<li>Gamma: <span id="lblRGBGamma"></span> <div id="sldRGBGamma"></div>	</li>
					<li>Brightness: <span id="lblRGBBrightness"></span> <div id="sldRGBBrightness"></div>	</li>
					<li>Contrast: <span id="lblRGBContrast"></span> <div id="sldRGBContrast"></div>	</li>
				</div>

				<div id="materials.extra_container">
					<div class="divider">
						<span>Extra Attribute</span>
					</div>

					<li><span data-i18n="appearance.extra_range"></span>: <span id="lblExtraRange"></span> <div id="sldExtraRange"></div></li>

					<li>
						<selectgroup id="extra_gradient_repeat_option">
							<option id="extra_gradient_repeat_clamp" value="CLAMP">Clamp</option>
							<option id="extra_gradient_repeat_repeat" value="REPEAT">Repeat</option>
							<option id="extra_gradient_repeat_mirrored_repeat" value="MIRRORED_REPEAT">Mirrored Repeat</option>
						</selectgroup>
					</li>

					<li>
						<span>Gradient Scheme:</span>
						<div id="extra_gradient_scheme_selection" class="gradient_scheme" style="display: flex; padding: 1em 0em">
						</div>
					</li>
				</div>
				
				<div id="materials.matcap_container">
					<div class="divider">
						<span>MATCAP</span>
					</div>

					<li>
						<div id="matcap_scheme_selection" style="display: flex; flex-wrap: wrap;"> </div>
					</li>
				</div>

				<div id="materials.color_container">
					<div class="divider">
						<span>Color</span>
					</div>

					<input id="materials.color.picker" />
				</div>


				<div id="materials.elevation_container">
					<div class="divider">
						<span>Elevation</span>
					</div>

					<li><span data-i18n="appearance.elevation_range"></span>: <span id="lblHeightRange"></span> <div id="sldHeightRange"></div>	</li>

					<li>
						<selectgroup id="gradient_repeat_option">
							<option id="gradient_repeat_clamp" value="CLAMP">Clamp</option>
							<option id="gradient_repeat_repeat" value="REPEAT">Repeat</option>
							<option id="gradient_repeat_mirrored_repeat" value="MIRRORED_REPEAT">Mirrored Repeat</option>
						</selectgroup>
					</li>

					<li>
						<span>Gradient Scheme:</span>
						<div id="elevation_gradient_scheme_selection" class="gradient_scheme" style="display: flex; padding: 1em 0em">
						</div>
					</li>
				</div>

				<div id="materials.transition_container">
					<div class="divider">
						<span>Transition</span>
					</div>

					<li>transition: <span id="lblTransition"></span> <div id="sldTransition"></div>	</li>
				</div>

				<div id="materials.intensity_container">
					<div class="divider">
						<span>Intensity</span>
					</div>

					<li>Range: <span id="lblIntensityRange"></span> <div id="sldIntensityRange"></div>	</li>
					<li>Gamma: <span id="lblIntensityGamma"></span> <div id="sldIntensityGamma"></div>	</li>
					<li>Brightness: <span id="lblIntensityBrightness"></span> <div id="sldIntensityBrightness"></div>	</li>
					<li>Contrast: <span id="lblIntensityContrast"></span> <div id="sldIntensityContrast"></div>	</li>
				</div>

				<div id="materials.gpstime_container">
					<div class="divider">
						<span>GPS Time</span>
					</div>

				</div>
				
				<div id="materials.index_container">
					<div class="divider">
						<span>Indices</span>
					</div>
				</div>


				</ul>
			</div>
		`);n.i18n(),this.container.append(n);{let s=n.find("#sldPointSize"),r=n.find("#lblPointSize");s.slider({value:t.size,min:0,max:3,step:.01,slide:function(a,l){t.size=l.value}});let o=a=>{r.html(t.size.toFixed(2)),s.slider({value:t.size})};this.addVolatileListener(t,"point_size_changed",o),o()}{let s=n.find("#sldMinPointSize"),r=n.find("#lblMinPointSize");s.slider({value:t.size,min:0,max:3,step:.01,slide:function(a,l){t.minSize=l.value}});let o=a=>{r.html(t.minSize.toFixed(2)),s.slider({value:t.minSize})};this.addVolatileListener(t,"point_size_changed",o),o()}{let s=Object.keys(Ws)[t.pointSizeType],r=n.find("#optPointSizing");r.selectmenu(),r.val(s).selectmenu("refresh"),r.selectmenu({change:(o,a)=>{t.pointSizeType=Ws[a.item.value]}})}{let s=n.find("#optShape");s.selectmenu({change:(o,a)=>{let l=a.item.value;t.shape=Eo[l]}});let r=()=>{let o=Object.keys(Eo)[t.shape];s.selectmenu().val(o).selectmenu("refresh")};this.addVolatileListener(t,"point_shape_changed",r),r()}{let s=n.find("#set_backface_culling");s.click(()=>{t.backfaceCulling=s.prop("checked")});let r=()=>{let c=t.backfaceCulling;s.prop("checked",c)};this.addVolatileListener(t,"backface_changed",r),r();let o=$("#materials_backface_container");o.css("display","none");const a=e.pcoGeometry.pointAttributes;(a.hasNormals?a.hasNormals():!1)&&o.css("display","block")}{let s=n.find("#sldOpacity"),r=n.find("#lblOpacity");s.slider({value:t.opacity,min:0,max:1,step:.001,slide:function(a,l){t.opacity=l.value}});let o=a=>{r.html(t.opacity.toFixed(2)),s.slider({value:t.opacity})};this.addVolatileListener(t,"opacity_changed",o),o()}{const s=e.pcoGeometry.pointAttributes.attributes;let r=[];r.push(...s.map(h=>h.name));const o=r.indexOf("intensity");o>=0&&r.splice(o+1,0,"intensity gradient"),r.push("elevation","color","matcap","indices","level of detail","composite");const a=["POSITION_CARTESIAN","position"];r=r.filter(h=>!a.includes(h));let l=n.find("#optMaterial");for(let h of r){let d=$(`<option>${h}</option>`);l.append(d)}let c=(h,d)=>{let f=l.selectmenu().val();t.activeAttributeName=f;let m=e.getAttribute(f);if(f==="intensity gradient"&&(m=e.getAttribute("intensity")),m?["intensity","intensity gradient"].includes(m.name):!1){e.material.intensityRange[0]===1/0&&(e.material.intensityRange=m.range);const[E,M]=m.range;n.find("#sldIntensityRange").slider({range:!0,min:E,max:M,step:.01,values:[E,M],slide:(A,F)=>{let P=F.values[0],O=F.values[1];t.intensityRange=[P,O]}})}else if(m){const[E,M]=m.range;let A=t.getRange(m.name);A||(A=[...m.range]),typeof E=="number"&&typeof M=="number"&&n.find("#sldExtraRange").slider({range:!0,min:E,max:M,step:.01,values:A,slide:(P,O)=>{let[V,W]=O.values;t.setRange(m.name,[V,W])}})}let _=$("#materials\\.composite_weight_container"),y=$("#materials\\.elevation_container"),x=$("#materials\\.rgb_container"),R=$("#materials\\.extra_container"),I=$("#materials\\.color_container"),B=$("#materials\\.intensity_container"),N=$("#materials\\.index_container"),J=$("#materials\\.transition_container"),ne=$("#materials\\.gpstime_container"),se=$("#materials\\.matcap_container");N.css("display","none"),B.css("display","none"),y.css("display","none"),x.css("display","none"),R.css("display","none"),I.css("display","none"),_.css("display","none"),J.css("display","none"),se.css("display","none"),ne.css("display","none"),f==="composite"?(_.css("display","block"),y.css("display","block"),x.css("display","block"),B.css("display","block")):f==="elevation"?y.css("display","block"):f==="RGB and Elevation"?(x.css("display","block"),y.css("display","block")):f==="rgba"?x.css("display","block"):f==="color"?I.css("display","block"):f==="intensity"||f==="intensity gradient"?B.css("display","block"):f==="indices"?N.css("display","block"):f==="matcap"?se.css("display","block"):f==="classification"||(f==="gps-time"?ne.css("display","block"):f==="number of returns"||f==="return number"||["source id","point source id"].includes(f)||R.css("display","block"))};l.selectmenu({change:c});let u=()=>{l.val(t.activeAttributeName).selectmenu("refresh")};this.addVolatileListener(t,"point_color_type_changed",u),this.addVolatileListener(t,"active_attribute_changed",u),u(),c()}{const s=Object.keys(Potree.Gradients).map(o=>({name:o,values:Th[o]}));let r=n.find("div.gradient_scheme");for(let o of s)r.each(function(a,l){let c=$(`
						<span style="flex-grow: 1;">
						</span>
					`);const u=Potree.Utils.createSvgGradient(o.values);u.setAttributeNS(null,"class","button-icon"),c.append($(u)),c.click(()=>{t.gradient=Th[o.name]}),$(l).append(c)})}{let s=[{name:"Normals",icon:`${Potree.resourcePath}/icons/matcap/check_normal+y.jpg`},{name:"Basic 1",icon:`${Potree.resourcePath}/icons/matcap/basic_1.jpg`},{name:"Basic 2",icon:`${Potree.resourcePath}/icons/matcap/basic_2.jpg`},{name:"Basic Dark",icon:`${Potree.resourcePath}/icons/matcap/basic_dark.jpg`},{name:"Basic Side",icon:`${Potree.resourcePath}/icons/matcap/basic_side.jpg`},{name:"Ceramic Dark",icon:`${Potree.resourcePath}/icons/matcap/ceramic_dark.jpg`},{name:"Ceramic Lightbulb",icon:`${Potree.resourcePath}/icons/matcap/ceramic_lightbulb.jpg`},{name:"Clay Brown",icon:`${Potree.resourcePath}/icons/matcap/clay_brown.jpg`},{name:"Clay Muddy",icon:`${Potree.resourcePath}/icons/matcap/clay_muddy.jpg`},{name:"Clay Studio",icon:`${Potree.resourcePath}/icons/matcap/clay_studio.jpg`},{name:"Resin",icon:`${Potree.resourcePath}/icons/matcap/resin.jpg`},{name:"Skin",icon:`${Potree.resourcePath}/icons/matcap/skin.jpg`},{name:"Jade",icon:`${Potree.resourcePath}/icons/matcap/jade.jpg`},{name:"Metal_ Anisotropic",icon:`${Potree.resourcePath}/icons/matcap/metal_anisotropic.jpg`},{name:"Metal Carpaint",icon:`${Potree.resourcePath}/icons/matcap/metal_carpaint.jpg`},{name:"Metal Lead",icon:`${Potree.resourcePath}/icons/matcap/metal_lead.jpg`},{name:"Metal Shiny",icon:`${Potree.resourcePath}/icons/matcap/metal_shiny.jpg`},{name:"Pearl",icon:`${Potree.resourcePath}/icons/matcap/pearl.jpg`},{name:"Toon",icon:`${Potree.resourcePath}/icons/matcap/toon.jpg`},{name:"Check Rim Light",icon:`${Potree.resourcePath}/icons/matcap/check_rim_light.jpg`},{name:"Check Rim Dark",icon:`${Potree.resourcePath}/icons/matcap/check_rim_dark.jpg`},{name:"Contours 1",icon:`${Potree.resourcePath}/icons/matcap/contours_1.jpg`},{name:"Contours 2",icon:`${Potree.resourcePath}/icons/matcap/contours_2.jpg`},{name:"Contours 3",icon:`${Potree.resourcePath}/icons/matcap/contours_3.jpg`},{name:"Reflection Check Horizontal",icon:`${Potree.resourcePath}/icons/matcap/reflection_check_horizontal.jpg`},{name:"Reflection Check Vertical",icon:`${Potree.resourcePath}/icons/matcap/reflection_check_vertical.jpg`}],r=n.find("#matcap_scheme_selection");for(let o of s){let a=$(`
						<img src="${o.icon}" class="button-icon" style="width: 25%;" />
				`);a.click(()=>{t.matcap=o.icon.substring(o.icon.lastIndexOf("/"))}),r.append(a)}}{n.find("#sldRGBGamma").slider({value:t.rgbGamma,min:0,max:4,step:.01,slide:(c,u)=>{t.rgbGamma=u.value}}),n.find("#sldRGBContrast").slider({value:t.rgbContrast,min:-1,max:1,step:.01,slide:(c,u)=>{t.rgbContrast=u.value}}),n.find("#sldRGBBrightness").slider({value:t.rgbBrightness,min:-1,max:1,step:.01,slide:(c,u)=>{t.rgbBrightness=u.value}}),n.find("#sldExtraGamma").slider({value:t.extraGamma,min:0,max:4,step:.01,slide:(c,u)=>{t.extraGamma=u.value}}),n.find("#sldExtraBrightness").slider({value:t.extraBrightness,min:-1,max:1,step:.01,slide:(c,u)=>{t.extraBrightness=u.value}}),n.find("#sldExtraContrast").slider({value:t.extraContrast,min:-1,max:1,step:.01,slide:(c,u)=>{t.extraContrast=u.value}}),n.find("#sldHeightRange").slider({range:!0,min:0,max:1e3,step:.01,values:[0,1e3],slide:(c,u)=>{t.heightMin=u.values[0],t.heightMax=u.values[1]}}),n.find("#sldIntensityGamma").slider({value:t.intensityGamma,min:0,max:4,step:.01,slide:(c,u)=>{t.intensityGamma=u.value}}),n.find("#sldIntensityContrast").slider({value:t.intensityContrast,min:-1,max:1,step:.01,slide:(c,u)=>{t.intensityContrast=u.value}}),n.find("#sldIntensityBrightness").slider({value:t.intensityBrightness,min:-1,max:1,step:.01,slide:(c,u)=>{t.intensityBrightness=u.value}}),n.find("#sldWeightRGB").slider({value:t.weightRGB,min:0,max:1,step:.01,slide:(c,u)=>{t.weightRGB=u.value}}),n.find("#sldWeightIntensity").slider({value:t.weightIntensity,min:0,max:1,step:.01,slide:(c,u)=>{t.weightIntensity=u.value}}),n.find("#sldWeightElevation").slider({value:t.weightElevation,min:0,max:1,step:.01,slide:(c,u)=>{t.weightElevation=u.value}}),n.find("#sldWeightClassification").slider({value:t.weightClassification,min:0,max:1,step:.01,slide:(c,u)=>{t.weightClassification=u.value}}),n.find("#sldWeightReturnNumber").slider({value:t.weightReturnNumber,min:0,max:1,step:.01,slide:(c,u)=>{t.weightReturnNumber=u.value}}),n.find("#sldWeightSourceID").slider({value:t.weightSourceID,min:0,max:1,step:.01,slide:(c,u)=>{t.weightSourceID=u.value}}),n.find("#materials\\.color\\.picker").spectrum({flat:!0,showInput:!0,preferredFormat:"rgb",cancelText:"",chooseText:"Apply",color:`#${t.color.getHexString()}`,move:c=>{let u=c.toRgb(),h=new Ee().setRGB(u.r/255,u.g/255,u.b/255);t.color=h},change:c=>{let u=c.toRgb(),h=new Ee().setRGB(u.r/255,u.g/255,u.b/255);t.color=h}}),this.addVolatileListener(t,"color_changed",()=>{n.find("#materials\\.color\\.picker").spectrum("set",`#${t.color.getHexString()}`)});let s=function(){let c=e.getAttribute("position"),u,h;if(c){let f=c.range[0][2],m=c.range[1][2],v=m-f;u=f-.2*v,h=m+.2*v}else{let f=[e.pcoGeometry.tightBoundingBox,e.getBoundingBoxWorld()].find(v=>v!==void 0);e.updateMatrixWorld(!0),f=He.computeTransformedBoundingBox(f,e.matrixWorld);let m=f.max.z-f.min.z;u=f.min.z-.2*m,h=f.max.z+.2*m}let d=t.elevationRange;n.find("#lblHeightRange").html(`${d[0].toFixed(2)} to ${d[1].toFixed(2)}`),n.find("#sldHeightRange").slider({min:u,max:h,values:d})},r=function(){let c=t.activeAttributeName,u=e.getAttribute(c);if(u==null)return;let h=t.getRange(c);if(h==null&&(h=u.range),typeof h[0]=="number"&&typeof h[1]=="number")if(h){let f=`${h[0].toFixed(2)} to ${h[1].toFixed(2)}`;n.find("#lblExtraRange").html(f)}else n.find("could not deduce range")},o=function(){let c=t.intensityRange;n.find("#lblIntensityRange").html(`${parseInt(c[0])} to ${parseInt(c[1])}`)};s(),n.find("#sldHeightRange").slider("option","min"),n.find("#sldHeightRange").slider("option","max");{let c=n.find("#gradient_repeat_option");c.selectgroup({title:"Gradient"}),c.find("input").click(h=>{this.viewer.setElevationGradientRepeat(pr[h.target.value])});let u=Object.keys(pr).filter(h=>pr[h]===this.viewer.elevationGradientRepeat);c.find(`input[value=${u}]`).trigger("click")}{let c=n.find("#extra_gradient_repeat_option");c.selectgroup({title:"Gradient"}),c.find("input").click(h=>{this.viewer.setElevationGradientRepeat(pr[h.target.value])});let u=Object.keys(pr).filter(h=>pr[h]===this.viewer.elevationGradientRepeat);c.find(`input[value=${u}]`).trigger("click")}let a=()=>{let c=t.intensityGamma,u=t.intensityContrast,h=t.intensityBrightness;o(),n.find("#lblIntensityGamma").html(c.toFixed(2)),n.find("#lblIntensityContrast").html(u.toFixed(2)),n.find("#lblIntensityBrightness").html(h.toFixed(2)),n.find("#sldIntensityGamma").slider({value:c}),n.find("#sldIntensityContrast").slider({value:u}),n.find("#sldIntensityBrightness").slider({value:h})},l=()=>{let c=t.rgbGamma,u=t.rgbContrast,h=t.rgbBrightness;n.find("#lblRGBGamma").html(c.toFixed(2)),n.find("#lblRGBContrast").html(u.toFixed(2)),n.find("#lblRGBBrightness").html(h.toFixed(2)),n.find("#sldRGBGamma").slider({value:c}),n.find("#sldRGBContrast").slider({value:u}),n.find("#sldRGBBrightness").slider({value:h})};this.addVolatileListener(t,"material_property_changed",r),this.addVolatileListener(t,"material_property_changed",s),this.addVolatileListener(t,"material_property_changed",a),this.addVolatileListener(t,"material_property_changed",l),r(),s(),a(),l()}}setMeasurement(e){let t={DISTANCE:{panel:e_},AREA:{panel:t_},POINT:{panel:Sg},ANGLE:{panel:i_},HEIGHT:{panel:s_},PROFILE:{panel:o_},VOLUME:{panel:r_},CIRCLE:{panel:n_},OTHER:{panel:Sg}},r=(a=>{if(a instanceof Gr)return a.showDistances&&!a.showArea&&!a.showAngles?t.DISTANCE:a.showDistances&&a.showArea&&!a.showAngles?t.AREA:a.maxMarkers===1?t.POINT:!a.showDistances&&!a.showArea&&a.showAngles?t.ANGLE:a.showHeight?t.HEIGHT:a.showCircle?t.CIRCLE:t.OTHER;if(a instanceof Ya)return t.PROFILE;if(a instanceof bo)return t.VOLUME})(e).panel,o=new r(this.viewer,e,this);this.container.append(o.elContent)}setCamera(e){let t=new a_(this.viewer,this);this.container.append(t.elContent)}setAnnotation(e){let t=new l_(this.viewer,this,e);this.container.append(t.elContent)}setCameraAnimation(e){let t=new c_(this.viewer,this,e);this.container.append(t.elContent)}}function h_(i){i+="";let e=i.split("."),t=e[0],n=e.length>1?"."+e[1]:"",s=/(\d+)(\d{3})/;for(;s.test(t);)t=t.replace(s,"$1,$2");return t+n}function Tg(i){return h_(i.toFixed(3))}class of{constructor(e={}){this.element=document.createElement("div"),this.labels=[],this.sliders=[],this.range=e.range!=null?e.range:[0,1],this.slide=e.slide!=null?e.slide:null,this.step=e.step!=null?e.step:1e-4;let t=e.levels!=null?e.levels:1;for(let n=0;n<t;n++)this.addLevel()}setRange(e){this.range=[...e];{let t=this.sliders[0];$(t).slider({min:e[0],max:e[1]})}for(let t=1;t<this.sliders.length;t++){let n=this.sliders[t-1],s=this.sliders[t],o=[...$(n).slider("option","values")];$(s).slider({min:o[0],max:o[1]})}this.updateLabels()}setValues(e){for(let t of this.sliders)$(t).slider({values:[...e]});this.updateLabels()}addLevel(){const e=document.createElement("li"),t=document.createTextNode("Range: "),n=document.createElement("span"),s=document.createElement("div");let r=this.sliders.length,[o,a]=[0,0];if(this.sliders.length===0)[o,a]=this.range;else{let l=this.sliders[this.sliders.length-1];[o,a]=$(l).slider("option","values")}$(s).slider({range:!0,min:o,max:a,step:this.step,values:[o,a],slide:(l,c)=>{let u=this.sliders.length;for(let h=r+1;h<u;h++){let d=this.sliders[h];$(d).slider({range:!0,min:c.values[0],max:c.values[1],values:[...c.values]})}if(this.slide){let h=[...c.values];this.slide({target:this,range:this.range,values:h})}this.updateLabels()}}),e.append(t,n,s),this.sliders.push(s),this.labels.push(n),this.element.append(e),this.updateLabels()}removeLevel(){}updateSliders(){}updateLabels(){let e=this.sliders.length;for(let t=0;t<e;t++){let n=this.sliders[t],s=this.labels[t],[r,o]=$(n).slider("option","values"),a=Tg(r),l=Tg(o),c=`${a} to ${l}`;s.innerHTML=c}}}class d_ extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.originalCam=e.scene.getActiveCamera(),this.shearCam=e.scene.getActiveCamera().clone(),this.shearCam.rotation.set(this.originalCam.rotation.toArray()),this.shearCam.updateProjectionMatrix(),this.shearCam.updateProjectionMatrix=()=>this.shearCam.projectionMatrix,this.image=null,this.fadeFactor=20,this.fovDelta=0,this.fovMin=.1,this.fovMax=120,this.shear=[0,0],this.elUp=$('<input type="button" value="\u{1F845}" style="position: absolute; top: 10px; left: calc(50%); z-index: 1000" />'),this.elRight=$('<input type="button" value="\u{1F846}" style="position: absolute; top: calc(50%); right: 10px; z-index: 1000" />'),this.elDown=$('<input type="button" value="\u{1F847}" style="position: absolute; bottom: 10px; left: calc(50%); z-index: 1000" />'),this.elLeft=$('<input type="button" value="\u{1F844}" style="position: absolute; top: calc(50%); left: 10px; z-index: 1000" />'),this.elExit=$('<input type="button" value="Back to 3D view" style="position: absolute; bottom: 10px; right: 10px; z-index: 1000" />'),this.elExit.click(()=>{this.release()}),this.elUp.click(()=>{const n=e.getFOV(),s=Math.tan(rt.degToRad(n/2));this.shear[1]+=.1*s}),this.elRight.click(()=>{const n=e.getFOV(),s=Math.tan(rt.degToRad(n/2));this.shear[0]+=.1*s}),this.elDown.click(()=>{const n=e.getFOV(),s=Math.tan(rt.degToRad(n/2));this.shear[1]-=.1*s}),this.elLeft.click(()=>{const n=e.getFOV(),s=Math.tan(rt.degToRad(n/2));this.shear[0]-=.1*s}),this.scene=null,this.sceneControls=new Si;let t=n=>{this.fovDelta+=-n.delta*1};this.addEventListener("mousewheel",t)}hasSomethingCaptured(){return this.image!==null}capture(e){if(this.hasSomethingCaptured())return;this.image=e,this.originalFOV=this.viewer.getFOV(),this.originalControls=this.viewer.getControls(),this.viewer.setControls(this),this.viewer.scene.overrideCamera=this.shearCam;const t=this.viewer.renderer.domElement,n=$(t.parentElement);this.shear=[0,0],n.append(this.elUp),n.append(this.elRight),n.append(this.elDown),n.append(this.elLeft),n.append(this.elExit)}release(){this.image=null,this.viewer.scene.overrideCamera=null,this.elUp.detach(),this.elRight.detach(),this.elDown.detach(),this.elLeft.detach(),this.elExit.detach(),this.viewer.setFOV(this.originalFOV),this.viewer.setControls(this.originalControls)}setScene(e){this.scene=e}update(e){const s=this.viewer.getFOV();let r=1*this.fovDelta,o=s*(1+r/10);o=Math.max(this.fovMin,o),o=Math.min(this.fovMax,o);let a=o/s;const l=this.viewer.inputHandler.mouse,c=this.viewer.renderer.getSize(new Se),u=[l.x/c.x,(c.y-l.y)/c.y],h=o,d=c.x/c.y,m=2*Math.tan(rt.degToRad(h/2)),v=d*m,_=[this.shear[0]-.5*v,this.shear[0]+.5*v],y=[this.shear[1]-.5*m,this.shear[1]+.5*m],x=(1-u[0])*_[0]+u[0]*_[1],R=(1-u[1])*y[0]+u[1]*y[1],I=1-a,B=[(1-I)*this.shear[0]+I*x,(1-I)*this.shear[1]+I*R];this.shear=B,this.viewer.setFOV(o);const{originalCam:N,shearCam:J}=this;N.fov=o,N.updateMatrixWorld(),N.updateProjectionMatrix(),J.copy(N),J.rotation.set(...N.rotation.toArray()),J.updateMatrixWorld(),J.projectionMatrix.copy(N.projectionMatrix);const[ne,se]=this.shear,E=new xe().set(1,0,ne,0,0,1,se,0,0,0,1,0,0,0,0,1),M=J.projectionMatrix;M.multiply(E),J.projectionMatrixInverse.copy(M).invert();let A=J.projectionMatrix.elements.reduce((F,P)=>F+P,0);this.fovDelta*=0}}function f_(){let i=`
	uniform float uNear;
	varying vec2 vUV;
	varying vec4 vDebug;
	
	void main(){
		vDebug = vec4(0.0, 1.0, 0.0, 1.0);
		vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
		// make sure that this mesh is at least in front of the near plane
		modelViewPosition.xyz += normalize(modelViewPosition.xyz) * uNear;
		gl_Position = projectionMatrix * modelViewPosition;
		vUV = uv;
	}
	`,e=`
	uniform sampler2D tColor;
	uniform float uOpacity;
	varying vec2 vUV;
	varying vec4 vDebug;
	void main(){
		vec4 color = texture2D(tColor, vUV);
		gl_FragColor = color;
		gl_FragColor.a = uOpacity;
	}
	`;const t=new In({uniforms:{tColor:{value:new oi},uNear:{value:0},uOpacity:{value:1}},vertexShader:i,fragmentShader:e,side:Xi});return t.side=Xi,t}const p_=new jc(1,1),Ag=new ti;Ag.vertices.push(new S(-.5,-.5,0),new S(.5,-.5,0),new S(.5,.5,0),new S(-.5,.5,0),new S(-.5,-.5,0));class af{constructor(e){this.id=e,this.fov=1,this.position=new S,this.rotation=new S,this.width=0,this.height=0,this.fov=1;const t=f_(),n=new ri({color:65280});this.mesh=new ot(p_,t),this.line=new wn(Ag,n),this.texture=null,this.mesh.orientedImage=this}set(e,t,n,s){let r=t.map(rt.degToRad);this.position.set(...e),this.mesh.position.set(...e),this.rotation.set(...r),this.mesh.rotation.set(...r),[this.width,this.height]=n,this.mesh.scale.set(this.width/this.height,1,1),this.fov=s,this.updateTransform()}updateTransform(){let{mesh:e,line:t,fov:n}=this;e.updateMatrixWorld();const s=e.getWorldDirection(),r=rt.degToRad(n/2),o=-.5/Math.tan(r),a=s.clone().multiplyScalar(o);e.position.add(a),t.position.copy(e.position),t.scale.copy(e.scale),t.rotation.copy(e.rotation)}}class Cg extends Ne{constructor(){super(),this.node=null,this.cameraParams=null,this.imageParams=null,this.images=null,this._visible=!0}set visible(e){if(this._visible!==e){for(const t of this.images)t.mesh.visible=e,t.line.visible=e;this._visible=e,this.dispatchEvent({type:"visibility_changed",images:this})}}get visible(){return this._visible}}class Rh{static async loadCameraParams(e){const n=await(await fetch(e)).text(),r=new DOMParser().parseFromString(n,"application/xml"),o=parseInt(r.getElementsByTagName("width")[0].textContent),a=parseInt(r.getElementsByTagName("height")[0].textContent),l=parseFloat(r.getElementsByTagName("f")[0].textContent);let c=a/2/l,u=2*rt.radToDeg(Math.atan(c));return{path:e,width:o,height:a,f:l,fov:u}}static async loadImageParams(e){const t=await fetch(e);if(!t.ok){console.error(`failed to load ${e}`);return}const s=(await t.text()).split(/\r?\n/),r=[];for(let o=1;o<s.length;o++){const a=s[o];if(a.startsWith("#"))continue;const l=a.split(/\s+/);if(l.length<6)continue;const c={id:l[0],x:Number.parseFloat(l[1]),y:Number.parseFloat(l[2]),z:Number.parseFloat(l[3]),omega:Number.parseFloat(l[4]),phi:Number.parseFloat(l[5]),kappa:Number.parseFloat(l[6])};r.push(c)}return r}static async load(e,t,n){const s=performance.now(),[r,o]=await Promise.all([Rh.loadCameraParams(e),Rh.loadImageParams(t)]),a=new d_(n),l=new kr,c=performance.now();console.log(c-s);const{width:u,height:h}=r,d=[],f=new qe;f.name="oriented_images";for(const I of o){const{x:B,y:N,z:J,omega:ne,phi:se,kappa:E}=I;let M=new af(I.id),A=[B,N,J],F=[ne,se,E],P=[u,h];M.set(A,F,P,r.fov),f.add(M.mesh),f.add(M.line),d.push(M)}let m=null,v=null;const _=I=>{const B=performance.now();m&&m.line.material.color.setRGB(0,1,0),I.preventDefault();const N=n.renderer.domElement.getBoundingClientRect(),[J,ne]=[I.clientX,I.clientY],se=[(J-N.left)/N.width,(ne-N.top)/N.height],E=new Se(...se),M=n.scene.getActiveCamera(),A=new S(+(E.x*2)-1,-(E.y*2)+1),F=d.map(ve=>ve.mesh);l.setFromCamera(A,M);const P=l.intersectObjects(F);let O=!1;if(P.length>0){const pe=P[0].object.orientedImage;pe.line.material.color.setRGB(1,0,0),O=m!==pe,m=pe}else m=null;let V=v!==null&&m===null,W=v===null&&m!==null;if(v!==null&&(m===null||O)&&(n.scene.removePolygonClipVolume(v),v=null),W||O){const ve=m,pe=r.fov,Me=r.width/r.height,Fe=.1,at=1e3*1e3,bt=new mi(pe,Me,Fe,at);bt.rotation.order=n.scene.getActiveCamera().rotation.order,bt.rotation.copy(ve.mesh.rotation);{const he=ve.mesh,ge=he.getWorldDirection(),le=he.position,oe=rt.degToRad(pe/2),we=.5/Math.tan(oe),Le=le.clone().add(ge.clone().multiplyScalar(we)),Ae=le.clone().sub(Le),K=new S().addVectors(Le,Ae.clone().multiplyScalar(n.getMoveSpeed()));bt.position.copy(Le)}let Ie=new Potree.PolygonClipVolume(bt),Y=new ot,X=new ot,ce=new ot,ie=new ot;Y.position.set(-1,-1,0),X.position.set(1,-1,0),ce.position.set(1,1,0),ie.position.set(-1,1,0),Ie.markers.push(Y,X,ce,ie),Ie.initialized=!0,n.scene.addPolygonClipVolume(Ie),v=Ie}const fe=performance.now()},y=I=>{console.log("move to image "+I.id);const B=I.mesh,N=I.position.clone(),J=B.position.clone();if(n.scene.view.setView(N,J,500,()=>{a.capture(I)}),I.texture===null){const ne=I,se=`${Potree.resourcePath}/images/loading.jpg`;new jn().load(se,M=>{ne.texture===null&&(ne.texture=M,ne.mesh.material.uniforms.tColor.value=M,B.material.needsUpdate=!0)});const E=`${t}/../${ne.id}`;new jn().load(E,M=>{ne.texture=M,ne.mesh.material.uniforms.tColor.value=M,B.material.needsUpdate=!0})}},x=I=>{a.hasSomethingCaptured()||m&&y(m)};n.renderer.domElement.addEventListener("mousemove",_,!1),n.renderer.domElement.addEventListener("mousedown",x,!1),n.addEventListener("update",()=>{for(const I of d){const B=I.mesh.matrixWorld,{width:N,height:J}=I,ne=N/J,se=n.scene.getActiveCamera(),E=I.mesh.getWorldPosition(new S),A=se.position.distanceTo(E),P=rt.degToRad(1);let O=A*Math.tan(P);O=Math.max(O,1),I.mesh.scale.set(O*ne,O,1),I.line.scale.set(O*ne,O,1),I.mesh.material.uniforms.uNear.value=se.near}});const R=new Cg;return R.node=f,R.cameraParamsPath=e,R.imageParamsPath=t,R.cameraParams=r,R.imageParams=o,R.images=d,Potree.debug.moveToImage=y,R}}let m_=new Li(1,32,32),g_=new Li(1,128,128),lf=new Ut({side:Xi,transparent:!0,opacity:1,depthOffset:1}),v_=new Ut({side:qt,transparent:!0,opacity:1,depthOffset:1}),ME=new Ut({side:qt,transparent:!0,opacity:1,depthOffset:1,color:16711680}),Dg=new kr,ha=null,Ih={controls:null,position:null,target:null};class y_{constructor(e,t,n,s,r,o,a,l,c){this.file=e,this.time=t,this.longitude=n,this.latitude=s,this.altitude=r,this.course=o,this.pitch=a,this.roll=l,this.index=c,this.mesh=null}}class cf extends Ne{constructor(e){super(),this.viewer=e,this.selectingEnabled=!0,this.images=[],this.node=new qe,this.sphere=new ot(g_,v_),this.sphere.visible=!1,this.sphere.scale.set(1e3,1e3,1e3),this.node.add(this.sphere),this._visible=!0,this.focusedImage=null,this.viewer.addEventListener("update",()=>{this.update(this.viewer)}),this.viewer.inputHandler.addInputListener(this),this.addEventListener("mousedown",()=>{ha&&ha.image360?this.viewer.dispatchEvent({type:"selectImage360",info:ha.image360,current:this}):this.viewer.dispatchEvent({type:"imageFocus",info:null,current:this})})}set visible(e){if(this._visible!==e){for(const t of this.images)t.mesh.visible=e&&this.focusedImage==null;this.sphere.visible=e&&this.focusedImage!=null,this._visible=e,this.dispatchEvent({type:"visibility_changed",images:this})}}get visible(){return this._visible}focus(e){this.focusedImage!==null&&this.unfocus(),Ih={controls:this.viewer.controls,position:this.viewer.scene.view.position.clone(),target:this.viewer.scene.view.getPivot()},this.viewer.setControls(this.viewer.orbitControls),this.viewer.orbitControls.doubleClockZoomEnabled=!1;for(let o of this.images){let a=5;o.mesh.scale.set(1/a,1/a,1/a)}this.selectingEnabled=!1,this.sphere.visible=!1,this.load(e).then(()=>{this.sphere.visible=!0,this.sphere.material.map=e.texture,this.sphere.material.needsUpdate=!0});{let{course:o,pitch:a,roll:l}=e;this.sphere.rotation.set(rt.degToRad(+l+90),rt.degToRad(-a),rt.degToRad(-o+90),"ZYX")}this.sphere.position.set(...e.position);let t=new S(...e.position),s=t.clone().sub(this.viewer.scene.view.position).normalize().multiplyScalar(1e-6),r=t.clone().sub(s);this.viewer.scene.view.setView(r,t,500),this.focusedImage=e,ha&&this.viewer.dispatchEvent({type:"imageFocus",info:ha.image360,current:this})}unfocus(){this.selectingEnabled=!0;for(let a of this.images)a.mesh.visible=!1;if(this.focusedImage===null)return;this.sphere.material.map=null,this.sphere.material.needsUpdate=!0,this.sphere.visible=!1;let t=this.viewer.scene.view.position,n=this.viewer.scene.view.getPivot(),r=n.clone().sub(t).normalize().multiplyScalar(10),o=n.clone().sub(r);this.viewer.orbitControls.doubleClockZoomEnabled=!0,this.viewer.setControls(Ih.controls),this.viewer.scene.view.setView(Ih.position,Ih.target,500),this.focusedImage=null}load(e){return new Promise(t=>{let n=new jn().load(e.file,t);n.wrapS=vi,n.repeat.x=-1,e.texture=n})}handleHovering(){let e=this.viewer.inputHandler.mouse,t=this.viewer.scene.getActiveCamera(),n=this.viewer.renderer.domElement,s=Potree.Utils.mouseToRay(e,t,n.clientWidth,n.clientHeight);Dg.ray.copy(s);let r=Dg.intersectObjects(this.node.children);if(r.length===0)return;let o=r[0];o.object.name=="\u63A7\u5236\u70B9"&&(ha=o.object,document.body.style.cursor="pointer")}update(){let{viewer:e}=this;ha&&(document.body.style.cursor="auto",ha=null),this.handleHovering()}}class uf{static async load(e,t,n={}){n.transform||(n.transform={forward:h=>h});let s=1;if(n.scale&&(s=n.scale),n.map){let h=new jn().load(n.map);h.wrapS=h.wrapT=vi,h.repeat.set(1,1),lf.map=h,lf.needsUpdate=!0}let l=(await(await fetch(`${e}/coordinates.txt`)).text()).split(/\r?\n/).slice(1),c=new cf(t),u=0;for(let h of l){if(h.trim().length===0)continue;let d=h.split(/\t/),[f,m,v,_,y,x,R,I]=d;m=parseFloat(m),v=parseFloat(v),_=parseFloat(_),y=parseFloat(y),x=parseFloat(x),R=parseFloat(R),I=parseFloat(I),f=f.replace(/"/g,"");let B=`${e}/${f}`,N=new y_(B,m,v,_,y,x,R,I,u),ne=[...n.transform.forward([v,_]),y];N.position=ne,c.images.push(N),u++}return uf.createSceneNodes(c,n.transform,n),c}static createSceneNodes(e,t,n){for(let a of e.images){let{longitude:l,latitude:c,altitude:u}=a,h=t.forward([l,c]),d=new ot(m_,lf);d.name="\u63A7\u5236\u70B9",d.position.set(...h,-.5),d.scale.set(n.scale,n.scale,n.scale),d.material.transparent=!0,d.material.depthTest=!0,d.material.depthWrite=!0,d.image360=a;{var{course:s,pitch:r,roll:o}=a;d.rotation.set(rt.degToRad(+o+90),rt.degToRad(-r),rt.degToRad(-s+90),"ZYX")}e.node.add(d),a.mesh=d}}}var x_=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,w_=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,b_=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,hf={Space_Separator:x_,ID_Start:w_,ID_Continue:b_},en={isSpaceSeparator(i){return typeof i=="string"&&hf.Space_Separator.test(i)},isIdStartChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i==="$"||i==="_"||hf.ID_Start.test(i))},isIdContinueChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i>="0"&&i<="9"||i==="$"||i==="_"||i==="\u200C"||i==="\u200D"||hf.ID_Continue.test(i))},isDigit(i){return typeof i=="string"&&/[0-9]/.test(i)},isHexDigit(i){return typeof i=="string"&&/[0-9A-Fa-f]/.test(i)}};let df,Zn,So,Fh,da,gr,Mn,ff,lu;var __=function(e,t){df=String(e),Zn="start",So=[],Fh=0,da=1,gr=0,Mn=void 0,ff=void 0,lu=void 0;do Mn=M_(),T_[Zn]();while(Mn.type!=="eof");return typeof t=="function"?Pg({"":lu},"",t):lu};function Pg(i,e,t){const n=i[e];if(n!=null&&typeof n=="object")for(const s in n){const r=Pg(n,s,t);r===void 0?delete n[s]:n[s]=r}return t.call(i,e,n)}let Qt,$t,cu,To,ci;function M_(){for(Qt="default",$t="",cu=!1,To=1;;){ci=Ao();const i=Lg[Qt]();if(i)return i}}function Ao(){if(df[Fh])return String.fromCodePoint(df.codePointAt(Fh))}function Ze(){const i=Ao();return i===`
`?(da++,gr=0):i?gr+=i.length:gr++,i&&(Fh+=i.length),i}const Lg={default(){switch(ci){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":Ze();return;case"/":Ze(),Qt="comment";return;case void 0:return Ze(),Ii("eof")}if(en.isSpaceSeparator(ci)){Ze();return}return Lg[Zn]()},comment(){switch(ci){case"*":Ze(),Qt="multiLineComment";return;case"/":Ze(),Qt="singleLineComment";return}throw Fi(Ze())},multiLineComment(){switch(ci){case"*":Ze(),Qt="multiLineCommentAsterisk";return;case void 0:throw Fi(Ze())}Ze()},multiLineCommentAsterisk(){switch(ci){case"*":Ze();return;case"/":Ze(),Qt="default";return;case void 0:throw Fi(Ze())}Ze(),Qt="multiLineComment"},singleLineComment(){switch(ci){case`
`:case"\r":case"\u2028":case"\u2029":Ze(),Qt="default";return;case void 0:return Ze(),Ii("eof")}Ze()},value(){switch(ci){case"{":case"[":return Ii("punctuator",Ze());case"n":return Ze(),Ka("ull"),Ii("null",null);case"t":return Ze(),Ka("rue"),Ii("boolean",!0);case"f":return Ze(),Ka("alse"),Ii("boolean",!1);case"-":case"+":Ze()==="-"&&(To=-1),Qt="sign";return;case".":$t=Ze(),Qt="decimalPointLeading";return;case"0":$t=Ze(),Qt="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":$t=Ze(),Qt="decimalInteger";return;case"I":return Ze(),Ka("nfinity"),Ii("numeric",1/0);case"N":return Ze(),Ka("aN"),Ii("numeric",NaN);case'"':case"'":cu=Ze()==='"',$t="",Qt="string";return}throw Fi(Ze())},identifierNameStartEscape(){if(ci!=="u")throw Fi(Ze());Ze();const i=pf();switch(i){case"$":case"_":break;default:if(!en.isIdStartChar(i))throw Rg();break}$t+=i,Qt="identifierName"},identifierName(){switch(ci){case"$":case"_":case"\u200C":case"\u200D":$t+=Ze();return;case"\\":Ze(),Qt="identifierNameEscape";return}if(en.isIdContinueChar(ci)){$t+=Ze();return}return Ii("identifier",$t)},identifierNameEscape(){if(ci!=="u")throw Fi(Ze());Ze();const i=pf();switch(i){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!en.isIdContinueChar(i))throw Rg();break}$t+=i,Qt="identifierName"},sign(){switch(ci){case".":$t=Ze(),Qt="decimalPointLeading";return;case"0":$t=Ze(),Qt="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":$t=Ze(),Qt="decimalInteger";return;case"I":return Ze(),Ka("nfinity"),Ii("numeric",To*(1/0));case"N":return Ze(),Ka("aN"),Ii("numeric",NaN)}throw Fi(Ze())},zero(){switch(ci){case".":$t+=Ze(),Qt="decimalPoint";return;case"e":case"E":$t+=Ze(),Qt="decimalExponent";return;case"x":case"X":$t+=Ze(),Qt="hexadecimal";return}return Ii("numeric",To*0)},decimalInteger(){switch(ci){case".":$t+=Ze(),Qt="decimalPoint";return;case"e":case"E":$t+=Ze(),Qt="decimalExponent";return}if(en.isDigit(ci)){$t+=Ze();return}return Ii("numeric",To*Number($t))},decimalPointLeading(){if(en.isDigit(ci)){$t+=Ze(),Qt="decimalFraction";return}throw Fi(Ze())},decimalPoint(){switch(ci){case"e":case"E":$t+=Ze(),Qt="decimalExponent";return}if(en.isDigit(ci)){$t+=Ze(),Qt="decimalFraction";return}return Ii("numeric",To*Number($t))},decimalFraction(){switch(ci){case"e":case"E":$t+=Ze(),Qt="decimalExponent";return}if(en.isDigit(ci)){$t+=Ze();return}return Ii("numeric",To*Number($t))},decimalExponent(){switch(ci){case"+":case"-":$t+=Ze(),Qt="decimalExponentSign";return}if(en.isDigit(ci)){$t+=Ze(),Qt="decimalExponentInteger";return}throw Fi(Ze())},decimalExponentSign(){if(en.isDigit(ci)){$t+=Ze(),Qt="decimalExponentInteger";return}throw Fi(Ze())},decimalExponentInteger(){if(en.isDigit(ci)){$t+=Ze();return}return Ii("numeric",To*Number($t))},hexadecimal(){if(en.isHexDigit(ci)){$t+=Ze(),Qt="hexadecimalInteger";return}throw Fi(Ze())},hexadecimalInteger(){if(en.isHexDigit(ci)){$t+=Ze();return}return Ii("numeric",To*Number($t))},string(){switch(ci){case"\\":Ze(),$t+=E_();return;case'"':if(cu)return Ze(),Ii("string",$t);$t+=Ze();return;case"'":if(!cu)return Ze(),Ii("string",$t);$t+=Ze();return;case`
`:case"\r":throw Fi(Ze());case"\u2028":case"\u2029":A_(ci);break;case void 0:throw Fi(Ze())}$t+=Ze()},start(){switch(ci){case"{":case"[":return Ii("punctuator",Ze())}Qt="value"},beforePropertyName(){switch(ci){case"$":case"_":$t=Ze(),Qt="identifierName";return;case"\\":Ze(),Qt="identifierNameStartEscape";return;case"}":return Ii("punctuator",Ze());case'"':case"'":cu=Ze()==='"',Qt="string";return}if(en.isIdStartChar(ci)){$t+=Ze(),Qt="identifierName";return}throw Fi(Ze())},afterPropertyName(){if(ci===":")return Ii("punctuator",Ze());throw Fi(Ze())},beforePropertyValue(){Qt="value"},afterPropertyValue(){switch(ci){case",":case"}":return Ii("punctuator",Ze())}throw Fi(Ze())},beforeArrayValue(){if(ci==="]")return Ii("punctuator",Ze());Qt="value"},afterArrayValue(){switch(ci){case",":case"]":return Ii("punctuator",Ze())}throw Fi(Ze())},end(){throw Fi(Ze())}};function Ii(i,e){return{type:i,value:e,line:da,column:gr}}function Ka(i){for(const e of i){if(Ao()!==e)throw Fi(Ze());Ze()}}function E_(){switch(Ao()){case"b":return Ze(),"\b";case"f":return Ze(),"\f";case"n":return Ze(),`
`;case"r":return Ze(),"\r";case"t":return Ze(),"	";case"v":return Ze(),"\v";case"0":if(Ze(),en.isDigit(Ao()))throw Fi(Ze());return"\0";case"x":return Ze(),S_();case"u":return Ze(),pf();case`
`:case"\u2028":case"\u2029":return Ze(),"";case"\r":return Ze(),Ao()===`
`&&Ze(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Fi(Ze());case void 0:throw Fi(Ze())}return Ze()}function S_(){let i="",e=Ao();if(!en.isHexDigit(e)||(i+=Ze(),e=Ao(),!en.isHexDigit(e)))throw Fi(Ze());return i+=Ze(),String.fromCodePoint(parseInt(i,16))}function pf(){let i="",e=4;for(;e-- >0;){const t=Ao();if(!en.isHexDigit(t))throw Fi(Ze());i+=Ze()}return String.fromCodePoint(parseInt(i,16))}const T_={start(){if(Mn.type==="eof")throw Qa();mf()},beforePropertyName(){switch(Mn.type){case"identifier":case"string":ff=Mn.value,Zn="afterPropertyName";return;case"punctuator":Bh();return;case"eof":throw Qa()}},afterPropertyName(){if(Mn.type==="eof")throw Qa();Zn="beforePropertyValue"},beforePropertyValue(){if(Mn.type==="eof")throw Qa();mf()},beforeArrayValue(){if(Mn.type==="eof")throw Qa();if(Mn.type==="punctuator"&&Mn.value==="]"){Bh();return}mf()},afterPropertyValue(){if(Mn.type==="eof")throw Qa();switch(Mn.value){case",":Zn="beforePropertyName";return;case"}":Bh()}},afterArrayValue(){if(Mn.type==="eof")throw Qa();switch(Mn.value){case",":Zn="beforeArrayValue";return;case"]":Bh()}},end(){}};function mf(){let i;switch(Mn.type){case"punctuator":switch(Mn.value){case"{":i={};break;case"[":i=[];break}break;case"null":case"boolean":case"numeric":case"string":i=Mn.value;break}if(lu===void 0)lu=i;else{const e=So[So.length-1];Array.isArray(e)?e.push(i):e[ff]=i}if(i!==null&&typeof i=="object")So.push(i),Array.isArray(i)?Zn="beforeArrayValue":Zn="beforePropertyName";else{const e=So[So.length-1];e==null?Zn="end":Array.isArray(e)?Zn="afterArrayValue":Zn="afterPropertyValue"}}function Bh(){So.pop();const i=So[So.length-1];i==null?Zn="end":Array.isArray(i)?Zn="afterArrayValue":Zn="afterPropertyValue"}function Fi(i){return Nh(i===void 0?`JSON5: invalid end of input at ${da}:${gr}`:`JSON5: invalid character '${Ig(i)}' at ${da}:${gr}`)}function Qa(){return Nh(`JSON5: invalid end of input at ${da}:${gr}`)}function Rg(){return gr-=5,Nh(`JSON5: invalid identifier character at ${da}:${gr}`)}function A_(i){console.warn(`JSON5: '${Ig(i)}' in strings is not valid ECMAScript; consider escaping`)}function Ig(i){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[i])return e[i];if(i<" "){const t=i.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return i}function Nh(i){const e=new SyntaxError(i);return e.lineNumber=da,e.columnNumber=gr,e}var C_=function(e,t,n){const s=[];let r="",o,a,l="",c;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t.space,c=t.quote,t=t.replacer),typeof t=="function")a=t;else if(Array.isArray(t)){o=[];for(const v of t){let _;typeof v=="string"?_=v:(typeof v=="number"||v instanceof String||v instanceof Number)&&(_=String(v)),_!==void 0&&o.indexOf(_)<0&&o.push(_)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),l="          ".substr(0,n)):typeof n=="string"&&(l=n.substr(0,10)),u("",{"":e});function u(v,_){let y=_[v];switch(y!=null&&(typeof y.toJSON5=="function"?y=y.toJSON5(v):typeof y.toJSON=="function"&&(y=y.toJSON(v))),a&&(y=a.call(_,v,y)),y instanceof Number?y=Number(y):y instanceof String?y=String(y):y instanceof Boolean&&(y=y.valueOf()),y){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof y=="string")return h(y,!1);if(typeof y=="number")return String(y);if(typeof y=="object")return Array.isArray(y)?m(y):d(y)}function h(v){const _={"'":.1,'"':.2},y={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let x="";for(let I=0;I<v.length;I++){const B=v[I];switch(B){case"'":case'"':_[B]++,x+=B;continue;case"\0":if(en.isDigit(v[I+1])){x+="\\x00";continue}}if(y[B]){x+=y[B];continue}if(B<" "){let N=B.charCodeAt(0).toString(16);x+="\\x"+("00"+N).substring(N.length);continue}x+=B}const R=c||Object.keys(_).reduce((I,B)=>_[I]<_[B]?I:B);return x=x.replace(new RegExp(R,"g"),y[R]),R+x+R}function d(v){if(s.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");s.push(v);let _=r;r=r+l;let y=o||Object.keys(v),x=[];for(const I of y){const B=u(I,v);if(B!==void 0){let N=f(I)+":";l!==""&&(N+=" "),N+=B,x.push(N)}}let R;if(x.length===0)R="{}";else{let I;if(l==="")I=x.join(","),R="{"+I+"}";else{let B=`,
`+r;I=x.join(B),R=`{
`+r+I+`,
`+_+"}"}}return s.pop(),r=_,R}function f(v){if(v.length===0)return h(v,!0);const _=String.fromCodePoint(v.codePointAt(0));if(!en.isIdStartChar(_))return h(v,!0);for(let y=_.length;y<v.length;y++)if(!en.isIdContinueChar(String.fromCodePoint(v.codePointAt(y))))return h(v,!0);return v}function m(v){if(s.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");s.push(v);let _=r;r=r+l;let y=[];for(let R=0;R<v.length;R++){const I=u(String(R),v);y.push(I!==void 0?I:"null")}let x;if(y.length===0)x="[]";else if(l==="")x="["+y.join(",")+"]";else{let R=`,
`+r,I=y.join(R);x=`[
`+r+I+`,
`+_+"]"}return s.pop(),r=_,x}},gf={parse:__,stringify:C_};class D_{constructor(e){this.viewer=e,this.measuringTool=e.measuringTool,this.profileTool=e.profileTool,this.volumeTool=e.volumeTool,this.dom=$("#sidebar_root")}createToolIcon(e,t,n){let s=$(`
			<img src="${e}"
				style="width: 32px; height: 32px"
				class="button-icon"
				data-i18n="${t}" />
		`);return s.click(n),s}init(){this.initAccordion(),this.initAppearance(),this.initToolbar(),this.initScene(),this.initNavigation(),this.initFilters(),this.initClippingTool(),this.initSettings(),$("#potree_version_number").html(Potree.version.major+"."+Potree.version.minor+Potree.version.suffix)}initToolbar(){let e=$("#tools");e.append(this.createToolIcon(Potree.resourcePath+"/icons/angle.png","[title]tt.angle_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!1,showAngles:!0,showArea:!1,closed:!0,maxMarkers:3,name:"Angle"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/point.svg","[title]tt.point_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!1,showAngles:!1,showCoordinates:!0,showArea:!1,closed:!0,maxMarkers:1,name:"Point"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/distance.svg","[title]tt.distance_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!0,showArea:!1,closed:!1,name:"Distance"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/height.svg","[title]tt.height_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!1,showHeight:!0,showArea:!1,closed:!1,maxMarkers:2,name:"Height"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/circle.svg","[title]tt.circle_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!1,showHeight:!1,showArea:!1,showCircle:!0,showEdges:!1,closed:!1,maxMarkers:3,name:"Circle"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/azimuth.svg","Azimuth",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!1,showHeight:!1,showArea:!1,showCircle:!1,showEdges:!1,showAzimuth:!0,closed:!1,maxMarkers:2,name:"Azimuth"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/area.svg","[title]tt.area_measurement",()=>{$("#menu_measurements").next().slideDown();let t=this.measuringTool.startInsertion({showDistances:!0,showArea:!0,closed:!0,name:"Area"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/volume.svg","[title]tt.volume_measurement",()=>{let t=this.volumeTool.startInsertion(),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/sphere_distances.svg","[title]tt.volume_measurement",()=>{let t=this.volumeTool.startInsertion({type:_o}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/profile.svg","[title]tt.height_profile",()=>{$("#menu_measurements").next().slideDown();let t=this.profileTool.startInsertion(),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/annotation.svg","[title]tt.annotation",()=>{$("#menu_measurements").next().slideDown();let t=this.viewer.annotationTool.startInsertion(),s=$("#jstree_scene").jstree().get_json("annotations").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/reset_tools.svg","[title]tt.remove_all_measurement",()=>{this.viewer.scene.removeAllMeasurements()}));{let t=$("#measurement_options_show");t.selectgroup({title:"Show/Hide labels"}),t.find("input").click(s=>{const r=s.target.value==="SHOW";this.measuringTool.showLabels=r});let n=this.measuringTool.showLabels?"SHOW":"HIDE";t.find(`input[value=${n}]`).trigger("click")}}initScene(){let e=$("#menu_scene"),t=e.next().find("#scene_objects"),n=e.next().find("#scene_object_properties");{let M=e.next().find("#scene_export"),A=`${Potree.resourcePath}/icons/file_geojson.svg`,F=`${Potree.resourcePath}/icons/file_dxf.svg`,P=`${Potree.resourcePath}/icons/file_potree.svg`;M.append(`
				Export: <br>
				<a href="#" download="measure.json"><img name="geojson_export_button" src="${A}" class="button-icon" style="height: 24px" /></a>
				<a href="#" download="measure.dxf"><img name="dxf_export_button" src="${F}" class="button-icon" style="height: 24px" /></a>
				<a href="#" download="potree.json5"><img name="potree_export_button" src="${P}" class="button-icon" style="height: 24px" /></a>
			`);let O=M.find("img[name=geojson_export_button]").parent();O.click(fe=>{let ve=this.viewer.scene,pe=[...ve.measurements,...ve.profiles,...ve.volumes];if(pe.length>0){let Me=rf.toString(pe),Fe=window.URL.createObjectURL(new Blob([Me],{type:"data:application/octet-stream"}));O.attr("href",Fe)}else this.viewer.postError("no measurements to export"),fe.preventDefault()});let V=M.find("img[name=dxf_export_button]").parent();V.click(fe=>{let ve=this.viewer.scene,pe=[...ve.measurements,...ve.profiles,...ve.volumes];if(pe.length>0){let Me=au.toString(pe),Fe=window.URL.createObjectURL(new Blob([Me],{type:"data:application/octet-stream"}));V.attr("href",Fe)}else this.viewer.postError("no measurements to export"),fe.preventDefault()});let W=M.find("img[name=potree_export_button]").parent();W.click(fe=>{let ve=Potree.saveProject(this.viewer),pe=gf.stringify(ve,null,"	"),Me=window.URL.createObjectURL(new Blob([pe],{type:"data:application/octet-stream"}));W.attr("href",Me)})}let s=new u_(n,this.viewer);s.setScene(this.viewer.scene),localStorage.removeItem("jstree");let r=$('<div id="jstree_scene"></div>');t.append(r),r.jstree({plugins:["checkbox","state"],core:{dblclick_toggle:!1,state:{checked:!0},check_callback:!0,expand_selected_onload:!0},checkbox:{keep_selected_style:!0,three_state:!1,whole_node:!1,tie_selection:!1}});let o=(M,A,F,P)=>{let O=r.jstree("create_node",M,{text:A,icon:F,data:P},"last",!1,!1);return P.visible?r.jstree("check_node",O):r.jstree("uncheck_node",O),O},a=r.jstree("create_node","#",{text:"<b>Point Clouds</b>",id:"pointclouds"},"last",!1,!1),l=r.jstree("create_node","#",{text:"<b>Measurements</b>",id:"measurements"},"last",!1,!1),c=r.jstree("create_node","#",{text:"<b>Annotations</b>",id:"annotations"},"last",!1,!1),u=r.jstree("create_node","#",{text:"<b>Other</b>",id:"other"},"last",!1,!1),h=r.jstree("create_node","#",{text:"<b>Vectors</b>",id:"vectors"},"last",!1,!1),d=r.jstree("create_node","#",{text:"<b> Images</b>",id:"images"},"last",!1,!1);r.jstree("check_node",a),r.jstree("check_node",l),r.jstree("check_node",c),r.jstree("check_node",u),r.jstree("check_node",h),r.jstree("check_node",d),r.on("create_node.jstree",(M,A)=>{r.jstree("open_all")}),r.on("select_node.jstree",(M,A)=>{let F=A.node.data;s.set(F),this.viewer.inputHandler.deselectAll(),F instanceof bo&&this.viewer.inputHandler.toggleSelection(F),$(this.viewer.renderer.domElement).focus()}),r.on("deselect_node.jstree",(M,A)=>{s.set(null)}),r.on("delete_node.jstree",(M,A)=>{s.set(null)}),r.on("dblclick",".jstree-anchor",M=>{let P=$.jstree.reference(M.target).get_node(M.target).data;if(!M.target.classList.contains("jstree-checkbox"))if(P instanceof Ja){let O=this.viewer.getBoundingBox([P]),V=new qe;V.boundingBox=O,this.viewer.zoomTo(V,1,500)}else if(P instanceof Gr){let O=P.points.map(W=>W.position),V=new Wt().setFromPoints(O);if(V.getSize(new S).length()>0){let W=new qe;W.boundingBox=V,this.viewer.zoomTo(W,2,500)}}else if(P instanceof Ya){let O=P.points,V=new Wt().setFromPoints(O);if(V.getSize(new S).length()>0){let W=new qe;W.boundingBox=V,this.viewer.zoomTo(W,1,500)}}else if(P instanceof bo){let O=P.boundingBox.clone().applyMatrix4(P.matrixWorld);if(O.getSize(new S).length()>0){let V=new qe;V.boundingBox=O,this.viewer.zoomTo(V,1,500)}}else if(P instanceof ra)P.moveHere(this.viewer.scene.getActiveCamera());else if(P instanceof eu){let O=P.camera.getWorldDirection(new S),V;P.camera instanceof Fn?(O.multiplyScalar(P.camera.right),V=new S().addVectors(P.camera.position,O),this.viewer.setCameraMode(cs.ORTHOGRAPHIC)):P.camera instanceof mi&&(O.multiplyScalar(this.viewer.scene.view.radius),V=new S().addVectors(P.camera.position,O),this.viewer.setCameraMode(cs.PERSPECTIVE)),this.viewer.scene.view.position.copy(P.camera.position),this.viewer.scene.view.lookAt(V)}else if(P.type==="SpotLight"){let O=P.distance>0?P.distance/4:5e3,V=P.position,W=new S().addVectors(V,P.getWorldDirection(new S).multiplyScalar(O));this.viewer.scene.view.position.copy(P.position),this.viewer.scene.view.lookAt(W)}else if(P instanceof qe){let O=new Wt().setFromObject(P);if(O.getSize(new S).length()>0){let V=new qe;V.boundingBox=O,this.viewer.zoomTo(V,1,500)}}else P instanceof af||P instanceof cf||P instanceof Geopackage}),r.on("uncheck_node.jstree",(M,A)=>{let F=A.node.data;F&&(F.visible=!1)}),r.on("check_node.jstree",(M,A)=>{let F=A.node.data;F&&(F.visible=!0)});let f=M=>{let A=M.pointcloud,F=`${Potree.resourcePath}/icons/cloud.svg`,P=o(a,A.name,F,A);A.addEventListener("visibility_changed",()=>{A.visible?r.jstree("check_node",P):r.jstree("uncheck_node",P)})},m=M=>{let A=M.measurement,F=He.getMeasurementIcon(A);o(l,A.name,F,A)},v=M=>{let A=M.volume,F=He.getMeasurementIcon(A),P=o(l,A.name,F,A);A.addEventListener("visibility_changed",()=>{A.visible?r.jstree("check_node",P):r.jstree("uncheck_node",P)})},_=M=>{let A=M.profile,F=He.getMeasurementIcon(A);o(l,A.name,F,A)},y=M=>{let A=M.annotation,F=`${Potree.resourcePath}/icons/annotation.svg`,P=this.annotationMapping.get(A.parent),O=o(P,A.title,F,A);this.annotationMapping.set(A,O),A.addEventListener("annotation_changed",V=>{let fe=$("#jstree_scene").jstree().get_json("annotations").children.find(ve=>ve.data.uuid===A.uuid);$.jstree.reference(fe.id).rename_node(fe.id,A.title)})},x=M=>{const A=M.animation,F=`${Potree.resourcePath}/icons/camera_animation.svg`;o(u,"animation",F,A)},R=M=>{const A=M.images,F=`${Potree.resourcePath}/icons/picture.svg`,P=o(d,"images",F,A);A.addEventListener("visibility_changed",()=>{A.visible?r.jstree("check_node",P):r.jstree("uncheck_node",P)})},I=M=>{const A=M.images,F=`${Potree.resourcePath}/icons/picture.svg`,P=o(d,"360\xB0 images",F,A);A.addEventListener("visibility_changed",()=>{A.visible?r.jstree("check_node",P):r.jstree("uncheck_node",P)})};const B=M=>{const A=M.geopackage,F=`${Potree.resourcePath}/icons/triangle.svg`,P=$("#jstree_scene"),O="vectors";for(const V of A.node.children){const W=V.name;let fe=P.jstree("create_node",O,{text:W,icon:F,object:V,data:V},"last",!1,!1);P.jstree(V.visible?"check_node":"uncheck_node",fe)}};this.viewer.scene.addEventListener("pointcloud_added",f),this.viewer.scene.addEventListener("measurement_added",m),this.viewer.scene.addEventListener("profile_added",_),this.viewer.scene.addEventListener("volume_added",v),this.viewer.scene.addEventListener("camera_animation_added",x),this.viewer.scene.addEventListener("oriented_images_added",R),this.viewer.scene.addEventListener("360_images_added",I),this.viewer.scene.addEventListener("geopackage_added",B),this.viewer.scene.addEventListener("polygon_clip_volume_added",v),this.viewer.scene.annotations.addEventListener("annotation_added",y);let N=M=>{let F=$("#jstree_scene").jstree().get_json("measurements").children.find(P=>P.data.uuid===M.measurement.uuid);r.jstree("delete_node",F.id)},J=M=>{let F=$("#jstree_scene").jstree().get_json("measurements").children.find(P=>P.data.uuid===M.volume.uuid);r.jstree("delete_node",F.id)},ne=M=>{let F=$("#jstree_scene").jstree().get_json("measurements").children.find(P=>P.data.uuid===M.volume.uuid);r.jstree("delete_node",F.id)},se=M=>{let F=$("#jstree_scene").jstree().get_json("measurements").children.find(P=>P.data.uuid===M.profile.uuid);r.jstree("delete_node",F.id)};this.viewer.scene.addEventListener("measurement_removed",N),this.viewer.scene.addEventListener("volume_removed",J),this.viewer.scene.addEventListener("polygon_clip_volume_removed",ne),this.viewer.scene.addEventListener("profile_removed",se);{let M=`${Potree.resourcePath}/icons/annotation.svg`;this.annotationMapping=new Map,this.annotationMapping.set(this.viewer.scene.annotations,c),this.viewer.scene.annotations.traverseDescendants(A=>{let F=this.annotationMapping.get(A.parent),P=o(F,A.title,M,A);this.annotationMapping.set(A,P)})}const E=this.viewer.scene;for(let M of E.pointclouds)f({pointcloud:M});for(let M of E.measurements)m({measurement:M});for(let M of[...E.volumes,...E.polygonClipVolumes])v({volume:M});for(let M of E.cameraAnimations)x({animation:M});for(let M of E.orientedImages)R({images:M});for(let M of E.images360)I({images:M});for(const M of E.geopackages)B({geopackage:M});for(let M of E.profiles)_({profile:M});o(u,"Camera",null,new bs),this.viewer.addEventListener("scene_changed",M=>{s.setScene(M.scene),M.oldScene.removeEventListener("pointcloud_added",f),M.oldScene.removeEventListener("measurement_added",m),M.oldScene.removeEventListener("profile_added",_),M.oldScene.removeEventListener("volume_added",v),M.oldScene.removeEventListener("polygon_clip_volume_added",v),M.oldScene.removeEventListener("measurement_removed",N),M.scene.addEventListener("pointcloud_added",f),M.scene.addEventListener("measurement_added",m),M.scene.addEventListener("profile_added",_),M.scene.addEventListener("volume_added",v),M.scene.addEventListener("polygon_clip_volume_added",v),M.scene.addEventListener("measurement_removed",N)})}initClippingTool(){this.viewer.addEventListener("cliptask_changed",t=>{console.log("TODO")}),this.viewer.addEventListener("clipmethod_changed",t=>{console.log("TODO")});{let t=$("#cliptask_options");t.selectgroup({title:"Clip Task"}),t.find("input").click(s=>{this.viewer.setClipTask(fr[s.target.value])});let n=Object.keys(fr).filter(s=>fr[s]===this.viewer.clipTask);t.find(`input[value=${n}]`).trigger("click")}{let t=$("#clipmethod_options");t.selectgroup({title:"Clip Method"}),t.find("input").click(s=>{this.viewer.setClipMethod(oa[s.target.value])});let n=Object.keys(oa).filter(s=>oa[s]===this.viewer.clipMethod);t.find(`input[value=${n}]`).trigger("click")}let e=$("#clipping_tools");e.append(this.createToolIcon(Potree.resourcePath+"/icons/clip_volume.svg","[title]tt.clip_volume",()=>{let t=this.volumeTool.startInsertion({clip:!0}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/clip-polygon.svg","[title]tt.clip_polygon",()=>{let t=this.viewer.clippingTool.startInsertion({type:"polygon"}),s=$("#jstree_scene").jstree().get_json("measurements").children.find(r=>r.data.uuid===t.uuid);$.jstree.reference(s.id).deselect_all(),$.jstree.reference(s.id).select_node(s.id)}));{let t=new pg(this.viewer);e.append(this.createToolIcon(Potree.resourcePath+"/icons/clip-screen.svg","[title]tt.screen_clip_box",()=>{if(!(this.viewer.scene.getActiveCamera()instanceof Fn)){this.viewer.postMessage("Switch to Orthographic Camera Mode before using the Screen-Box-Select tool.",{duration:2e3});return}let n=t.startInsertion(),r=$("#jstree_scene").jstree().get_json("measurements").children.find(o=>o.data.uuid===n.uuid);$.jstree.reference(r.id).deselect_all(),$.jstree.reference(r.id).select_node(r.id)}))}e.append(this.createToolIcon(Potree.resourcePath+"/icons/remove.svg","[title]tt.remove_all_clipping_volumes",()=>{this.viewer.scene.removeAllClipVolumes()}))}initFilters(){this.initClassificationList(),this.initReturnFilters(),this.initGPSTimeFilters(),this.initPointSourceIDFilters()}initReturnFilters(){let e=$("#return_filter_panel");{let t=e.find("#sldReturnNumber"),n=e.find("#lblReturnNumber");t.slider({range:!0,min:0,max:7,step:1,values:[0,7],slide:(r,o)=>{this.viewer.setFilterReturnNumberRange(o.values[0],o.values[1])}});let s=r=>{let[o,a]=this.viewer.filterReturnNumberRange;n[0].innerHTML=`${o} to ${a}`,t.slider({values:[o,a]})};this.viewer.addEventListener("filter_return_number_range_changed",s),s()}{let t=e.find("#sldNumberOfReturns"),n=e.find("#lblNumberOfReturns");t.slider({range:!0,min:0,max:7,step:1,values:[0,7],slide:(r,o)=>{this.viewer.setFilterNumberOfReturnsRange(o.values[0],o.values[1])}});let s=r=>{let[o,a]=this.viewer.filterNumberOfReturnsRange;n[0].innerHTML=`${o} to ${a}`,t.slider({values:[o,a]})};this.viewer.addEventListener("filter_number_of_returns_range_changed",s),s()}}initGPSTimeFilters(){let e=$("#gpstime_filter_panel");{let t=new of({levels:4,slide:r=>{this.viewer.setFilterGPSTimeRange(...r.values)}}),n=!1,s=()=>{$("#gpstime_multilevel_range_container")[0].prepend(t.element);let o=this.viewer.getGpsTimeExtent();t.setRange(o),t.setValues(o),n=!0};this.viewer.addEventListener("update",r=>{let o=this.viewer.getGpsTimeExtent(),a=o[0]!==1/0;!n&&a&&s(),t.setRange(o)})}{const t=e.find("#txtGpsTime"),n=e.find("#btnFindGpsTime");let s=null;t.on("input",r=>{const o=t.val();isNaN(o)?(s=null,t.css("background-color","#ff9999")):(s=parseFloat(o),t.css("background-color",""))}),n.click(()=>{s!==null&&viewer.moveToGpsTimeVicinity(s)})}}initPointSourceIDFilters(){let e=$("#pointsourceid_filter_panel");{let t=new of({levels:4,range:[0,65535],precision:1,slide:r=>{let o=r.values;this.viewer.setFilterPointSourceIDRange(o[0],o[1])}}),n=!1,s=()=>{e[0].prepend(t.element),n=!0};this.viewer.addEventListener("update",r=>{let o=this.viewer.filterPointSourceIDRange;n||(s(),t.setValues(o))})}}initClassificationList(){let e=$("#classificationList"),t=(o,a)=>{const l=this.viewer.classifications[o],c="chkClassification_"+o,u="colorPickerClassification_"+o,h=l.visible?"checked":"";let d=$(`
				<li>
					<label style="whitespace: nowrap; display: flex">
						<input id="${c}" type="checkbox" ${h}/>
						<span style="flex-grow: 1">${a}</span>
						<input id="${u}" style="zoom: 0.5" />
					</label>
				</li>
			`);const f=d.find("input"),m=d.find(`#${u}`);f.click(_=>{this.viewer.setClassificationVisibility(o,_.target.checked)});let v=l.color.map(_=>_*255).join(", ");v=`rgb(${v})`,m.spectrum({color:v,showInput:!0,preferredFormat:"rgb",cancelText:"",chooseText:"Apply",move:_=>{let y=_.toRgb();const x=[y.r/255,y.g/255,y.b/255,1];l.color=x},change:_=>{let y=_.toRgb();const x=[y.r/255,y.g/255,y.b/255,1];l.color=x}}),e.append(d)};const n=()=>{const o=$(`
				<li>
					<label style="whitespace: nowrap">
						<input id="toggleClassificationFilters" type="checkbox" checked/>
						<span>show/hide all</span>
					</label>
				</li>
			`);o.find("input").click(l=>{this.viewer.toggleAllClassificationsVisibility()}),e.append(o)},s=()=>{const o=$(`
				<li>
					<input type="button" value="invert" />
				</li>
			`);o.find("input").click(()=>{const l=this.viewer.classifications;for(let c of Object.keys(l)){let u=l[c];this.viewer.setClassificationVisibility(c,!u.visible)}}),e.append(o)},r=()=>{n();for(let o in this.viewer.classifications)t(o,this.viewer.classifications[o].name);s()};r(),this.viewer.addEventListener("classifications_changed",()=>{e.empty(),r()}),this.viewer.addEventListener("classification_visibility_changed",()=>{for(const o of Object.keys(this.viewer.classifications)){const a=this.viewer.classifications[o];e.find(`#chkClassification_${o}`).prop("checked",a.visible)}{let o=0,a=0;for(const u of Object.keys(this.viewer.classifications))this.viewer.classifications[u].visible&&o++,a++;const l=o===a;e.find("#toggleClassificationFilters").prop("checked",l)}})}initAccordion(){$(".accordion > h3").each(function(){let n=$(this),s=$(this).next();s.hide(),n.click(()=>{s.slideToggle()})});let e=[["EN","en"],["FR","fr"],["DE","de"],["JP","jp"],["ES","es"],["SE","se"],["ZH","zh"],["IT","it"],["CA","ca"]],t=$("#potree_languages");for(let n=0;n<e.length;n++){let[s,r]=e[n],o=$(`<a>${s}</a>`);o.click(()=>this.viewer.setLanguage(r)),n===0&&o.css("margin-left","30px"),t.append(o),n<e.length-1&&t.append($(document.createTextNode(" - ")))}}initAppearance(){const e=this.dom.find("#sldPointBudget");e.slider({value:this.viewer.getPointBudget(),min:100*1e3,max:10*1e3*1e3,step:1e3,slide:(t,n)=>{this.viewer.setPointBudget(n.value)}}),this.dom.find("#sldFOV").slider({value:this.viewer.getFOV(),min:20,max:100,step:1,slide:(t,n)=>{this.viewer.setFOV(n.value)}}),$("#sldEDLRadius").slider({value:this.viewer.getEDLRadius(),min:1,max:4,step:.01,slide:(t,n)=>{this.viewer.setEDLRadius(n.value)}}),$("#sldEDLStrength").slider({value:this.viewer.getEDLStrength(),min:0,max:5,step:.01,slide:(t,n)=>{this.viewer.setEDLStrength(n.value)}}),$("#sldEDLOpacity").slider({value:this.viewer.getEDLOpacity(),min:0,max:1,step:.01,slide:(t,n)=>{this.viewer.setEDLOpacity(n.value)}}),this.viewer.addEventListener("point_budget_changed",t=>{$("#lblPointBudget")[0].innerHTML=He.addCommas(this.viewer.getPointBudget()),e.slider({value:this.viewer.getPointBudget()})}),this.viewer.addEventListener("fov_changed",t=>{$("#lblFOV")[0].innerHTML=parseInt(this.viewer.getFOV()),$("#sldFOV").slider({value:this.viewer.getFOV()})}),this.viewer.addEventListener("use_edl_changed",t=>{$("#chkEDLEnabled")[0].checked=this.viewer.getEDLEnabled()}),this.viewer.addEventListener("edl_radius_changed",t=>{$("#lblEDLRadius")[0].innerHTML=this.viewer.getEDLRadius().toFixed(1),$("#sldEDLRadius").slider({value:this.viewer.getEDLRadius()})}),this.viewer.addEventListener("edl_strength_changed",t=>{$("#lblEDLStrength")[0].innerHTML=this.viewer.getEDLStrength().toFixed(1),$("#sldEDLStrength").slider({value:this.viewer.getEDLStrength()})}),this.viewer.addEventListener("background_changed",t=>{$("input[name=background][value='"+this.viewer.getBackground()+"']").prop("checked",!0)}),$("#lblPointBudget")[0].innerHTML=He.addCommas(this.viewer.getPointBudget()),$("#lblFOV")[0].innerHTML=parseInt(this.viewer.getFOV()),$("#lblEDLRadius")[0].innerHTML=this.viewer.getEDLRadius().toFixed(1),$("#lblEDLStrength")[0].innerHTML=this.viewer.getEDLStrength().toFixed(1),$("#chkEDLEnabled")[0].checked=this.viewer.getEDLEnabled();{let t=$("#background_options");t.selectgroup(),t.find("input").click(s=>{this.viewer.setBackground(s.target.value)});let n=this.viewer.getBackground();$(`input[name=background_options][value=${n}]`).trigger("click")}$("#chkEDLEnabled").click(()=>{this.viewer.setEDLEnabled($("#chkEDLEnabled").prop("checked"))})}initNavigation(){let e=$("#navigation"),t=$("#sldMoveSpeed"),n=$("#lblMoveSpeed");e.append(this.createToolIcon(Potree.resourcePath+"/icons/earth_controls_1.png","[title]tt.earth_control",()=>{this.viewer.setControls(this.viewer.earthControls)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/fps_controls.svg","[title]tt.flight_control",()=>{this.viewer.setControls(this.viewer.fpControls),this.viewer.fpControls.lockElevation=!1})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/helicopter_controls.svg","[title]tt.heli_control",()=>{this.viewer.setControls(this.viewer.fpControls),this.viewer.fpControls.lockElevation=!0})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/orbit_controls.svg","[title]tt.orbit_control",()=>{this.viewer.setControls(this.viewer.orbitControls)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/focus.svg","[title]tt.focus_control",()=>{this.viewer.fitToScreen()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/navigation_cube.svg","[title]tt.navigation_cube_control",()=>{this.viewer.toggleNavigationCube()})),e.append(this.createToolIcon(Potree.resourcePath+"/images/compas.svg","[title]tt.compass",()=>{const c=!this.viewer.compass.isVisible();this.viewer.compass.setVisible(c)})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/camera_animation.svg","[title]tt.camera_animation",()=>{const c=tc.defaultFromView(this.viewer);viewer.scene.addCameraAnimation(c)})),e.append("<br>"),e.append(this.createToolIcon(Potree.resourcePath+"/icons/left.svg","[title]tt.left_view_control",()=>{this.viewer.setLeftView()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/right.svg","[title]tt.right_view_control",()=>{this.viewer.setRightView()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/front.svg","[title]tt.front_view_control",()=>{this.viewer.setFrontView()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/back.svg","[title]tt.back_view_control",()=>{this.viewer.setBackView()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/top.svg","[title]tt.top_view_control",()=>{this.viewer.setTopView()})),e.append(this.createToolIcon(Potree.resourcePath+"/icons/bottom.svg","[title]tt.bottom_view_control",()=>{this.viewer.setBottomView()}));let s=$(`
			<selectgroup id="camera_projection_options">
				<option id="camera_projection_options_perspective" value="PERSPECTIVE">Perspective</option>
				<option id="camera_projection_options_orthigraphic" value="ORTHOGRAPHIC">Orthographic</option>
			</selectgroup>
		`);e.append(s),s.selectgroup({title:"Camera Projection"}),s.find("input").click(c=>{this.viewer.setCameraMode(cs[c.target.value])});let r=Object.keys(cs).filter(c=>cs[c]===this.viewer.scene.cameraMode);s.find(`input[value=${r}]`).trigger("click");let o=new Se(1,10*1e3),a=c=>Math.pow(c,4)*o.y+o.x,l=c=>Math.pow((c-o.x)/o.y,1/4);t.slider({value:l(this.viewer.getMoveSpeed()),min:0,max:1,step:.01,slide:(c,u)=>{this.viewer.setMoveSpeed(a(u.value))}}),this.viewer.addEventListener("move_speed_changed",c=>{n.html(this.viewer.getMoveSpeed().toFixed(1)),t.slider({value:l(this.viewer.getMoveSpeed())})}),n.html(this.viewer.getMoveSpeed().toFixed(1))}initSettings(){$("#sldMinNodeSize").slider({value:this.viewer.getMinNodeSize(),min:0,max:1e3,step:.01,slide:(e,t)=>{this.viewer.setMinNodeSize(t.value)}}),this.viewer.addEventListener("minnodesize_changed",e=>{$("#lblMinNodeSize").html(parseInt(this.viewer.getMinNodeSize())),$("#sldMinNodeSize").slider({value:this.viewer.getMinNodeSize()})}),$("#lblMinNodeSize").html(parseInt(this.viewer.getMinNodeSize()));{let e=$("#splat_quality_options");e.selectgroup({title:"Splat Quality"}),e.find("input").click(n=>{n.target.value==="standard"?this.viewer.useHQ=!1:n.target.value==="hq"&&(this.viewer.useHQ=!0)});let t=this.viewer.useHQ?"hq":"standard";e.find(`input[value=${t}]`).trigger("click")}$("#show_bounding_box").click(()=>{this.viewer.setShowBoundingBox($("#show_bounding_box").prop("checked"))}),$("#set_freeze").click(()=>{this.viewer.setFreeze($("#set_freeze").prop("checked"))})}}class P_ extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.sg=new Li(.1),this.sm=new Ki,this.s=new ot(this.sg,this.sm)}startInsertion(e={}){let t=this.viewer.renderer.domElement,n=new ra({position:[589748.27,231444.54,753.675],title:"Annotation Title",description:"Annotation Description"});this.dispatchEvent({type:"start_inserting_annotation",annotation:n});const s=this.viewer.scene.annotations;s.add(n);let r={cancel:null,finish:null},o=c=>{c.button===Et.LEFT?r.finish():c.button===Et.RIGHT&&r.cancel()};r.cancel=c=>{s.remove(n),t.removeEventListener("mouseup",o,!0)},r.finish=c=>{t.removeEventListener("mouseup",o,!0)},t.addEventListener("mouseup",o,!0);let a=c=>{let u=He.getMousePointCloudIntersection(c.drag.end,c.viewer.scene.getActiveCamera(),c.viewer,c.viewer.scene.pointclouds,{pickClipped:!0});u&&(this.s.position.copy(u.location),n.position.copy(u.location))},l=c=>{this.viewer.scene.scene.remove(this.s),this.s.removeEventListener("drag",a),this.s.removeEventListener("drop",l)};return this.s.addEventListener("drag",a),this.s.addEventListener("drop",l),this.viewer.scene.scene.add(this.s),this.viewer.inputHandler.startDragging(this.s),n}update(){}render(){}}class L_ extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.domElement=this.renderer.domElement,this.enabled=!0,this.scene=null,this.interactiveScenes=[],this.interactiveObjects=new Set,this.inputListeners=[],this.blacklist=new Set,this.drag=null,this.mouse=new Se(0,0),this.selection=[],this.hoveredElements=[],this.pressedKeys={},this.wheelDelta=0,this.speed=1,this.logMessages=!1,this.domElement.tabIndex===-1&&(this.domElement.tabIndex=2222),this.domElement.addEventListener("contextmenu",t=>{t.preventDefault()},!1),this.domElement.addEventListener("click",this.onMouseClick.bind(this),!1),this.domElement.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.domElement.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.domElement.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.domElement.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.domElement.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.domElement.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.domElement.addEventListener("keydown",this.onKeyDown.bind(this)),this.domElement.addEventListener("keyup",this.onKeyUp.bind(this)),this.domElement.addEventListener("touchstart",this.onTouchStart.bind(this)),this.domElement.addEventListener("touchend",this.onTouchEnd.bind(this)),this.domElement.addEventListener("touchmove",this.onTouchMove.bind(this))}addInputListener(e){this.inputListeners.push(e)}removeInputListener(e){this.inputListeners=this.inputListeners.filter(t=>t!==e)}getSortedListeners(){return this.inputListeners.sort((e,t)=>{let n=e.importance!==void 0?e.importance:0;return(t.importance!==void 0?t.importance:0)-n})}onTouchStart(e){if(this.logMessages&&console.log(this.constructor.name+": onTouchStart"),e.preventDefault(),e.touches.length===1){let t=this.domElement.getBoundingClientRect(),n=e.touches[0].pageX-t.left,s=e.touches[0].pageY-t.top;this.mouse.set(n,s),this.startDragging(null)}for(let t of this.getSortedListeners())t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onTouchEnd(e){this.logMessages&&console.log(this.constructor.name+": onTouchEnd"),e.preventDefault();for(let t of this.getSortedListeners())t.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer});this.drag=null;for(let t of this.getSortedListeners())t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onTouchMove(e){if(this.logMessages&&console.log(this.constructor.name+": onTouchMove"),e.preventDefault(),e.touches.length===1){let t=this.domElement.getBoundingClientRect(),n=e.touches[0].pageX-t.left,s=e.touches[0].pageY-t.top;if(this.mouse.set(n,s),this.drag){this.drag.mouse=1,this.drag.lastDrag.x=n-this.drag.end.x,this.drag.lastDrag.y=s-this.drag.end.y,this.drag.end.set(n,s),this.logMessages&&console.log(this.constructor.name+": drag: ");for(let r of this.getSortedListeners())r.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer})}}for(let t of this.getSortedListeners())t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onKeyDown(e){this.logMessages&&console.log(this.constructor.name+": onKeyDown"),e.keyCode===Um.DELETE&&this.selection.length>0&&(this.dispatchEvent({type:"delete",selection:this.selection}),this.deselectAll()),this.dispatchEvent({type:"keydown",keyCode:e.keyCode,event:e}),this.pressedKeys[e.keyCode]=!0}onKeyUp(e){this.logMessages&&console.log(this.constructor.name+": onKeyUp"),delete this.pressedKeys[e.keyCode],e.preventDefault()}onDoubleClick(e){this.logMessages&&console.log(this.constructor.name+": onDoubleClick");let t=!1;for(let n of this.hoveredElements)if(n._listeners&&n._listeners.dblclick){n.object.dispatchEvent({type:"dblclick",mouse:this.mouse,object:n.object}),t=!0;break}if(!t)for(let n of this.getSortedListeners())n.dispatchEvent({type:"dblclick",mouse:this.mouse,object:null});e.preventDefault()}onMouseClick(e){this.logMessages&&console.log(this.constructor.name+": onMouseClick"),e.preventDefault()}onMouseDown(e){this.logMessages&&console.log(this.constructor.name+": onMouseDown"),e.preventDefault();let t=!1,n=()=>t=!0;if(this.hoveredElements.length===0)for(let s of this.getSortedListeners())s.dispatchEvent({type:"mousedown",viewer:this.viewer,mouse:this.mouse});else for(let s of this.hoveredElements)if(s.object.dispatchEvent({type:"mousedown",viewer:this.viewer,consume:n}),t)break;if(!this.drag){let s=this.hoveredElements.find(r=>r.object._listeners&&r.object._listeners.drag&&r.object._listeners.drag.length>0);s?this.startDragging(s.object,{location:s.point}):this.startDragging(null)}this.scene&&(this.viewStart=this.scene.view.clone())}onMouseUp(e){this.logMessages&&console.log(this.constructor.name+": onMouseUp"),e.preventDefault();let t=this.getNormalizedDrag().length()===0,n=!1,s=()=>n=!0;if(this.hoveredElements.length===0){for(let r of this.getSortedListeners())if(r.dispatchEvent({type:"mouseup",viewer:this.viewer,mouse:this.mouse,consume:s}),n)break}else{let r=this.hoveredElements.map(o=>o.object).find(o=>o._listeners&&o._listeners.mouseup);r&&r.dispatchEvent({type:"mouseup",viewer:this.viewer,consume:s})}if(this.drag){if(this.drag.object)this.logMessages&&console.log(`${this.constructor.name}: drop ${this.drag.object.name}`),this.drag.object.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer});else for(let o of this.getSortedListeners())o.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer});this.hoveredElements.map(o=>o.object).find(o=>o===this.drag.object)!==void 0&&(this.logMessages&&console.log(`${this.constructor.name}: click ${this.drag.object.name}`),this.drag.object.dispatchEvent({type:"click",viewer:this.viewer,consume:s})),this.drag=null}if(!n)if(e.button===Et.LEFT){if(t){let r=this.hoveredElements.find(o=>o.object._listeners&&o.object._listeners.select);r?(r=r.object,this.isSelected(r)?this.selection.filter(o=>o!==r).forEach(o=>this.toggleSelection(o)):(this.deselectAll(),this.toggleSelection(r))):this.deselectAll()}}else e.button===Et.RIGHT&&t&&this.deselectAll()}onMouseMove(e){e.preventDefault();let t=this.domElement.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top;this.mouse.set(n,s);let r=this.getHoveredElements();if(r.length>0){let o=r.map(a=>a.object.name).join(", ");this.logMessages&&console.log(`${this.constructor.name}: onMouseMove; hovered: '${o}'`)}if(this.drag)if(this.drag.mouse=e.buttons,this.drag.lastDrag.x=n-this.drag.end.x,this.drag.lastDrag.y=s-this.drag.end.y,this.drag.end.set(n,s),this.drag.object)this.logMessages&&console.log(this.constructor.name+": drag: "+this.drag.object.name),this.drag.object.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer});else{this.logMessages&&console.log(this.constructor.name+": drag: ");let o=!1;for(let a of this.getSortedListeners())if(a.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer,consume:()=>{o=!0}}),o)break}else{let o=r.map(l=>l.object).find(l=>!0),a=this.hoveredElements.map(l=>l.object).find(l=>!0);if(o!==a&&(o&&(this.logMessages&&console.log(`${this.constructor.name}: mouseover: ${o.name}`),o.dispatchEvent({type:"mouseover",object:o})),a&&(this.logMessages&&console.log(`${this.constructor.name}: mouseleave: ${a.name}`),a.dispatchEvent({type:"mouseleave",object:a}))),r.length>0){let l=r.map(c=>c.object).find(c=>c._listeners&&c._listeners.mousemove);l&&l.dispatchEvent({type:"mousemove",object:l})}}this.hoveredElements=r}onMouseWheel(e){if(!this.enabled)return;this.logMessages&&console.log(this.constructor.name+": onMouseWheel"),e.preventDefault();let t=0;e.wheelDelta!==void 0?t=e.wheelDelta:e.detail!==void 0&&(t=-e.detail);let n=Math.sign(t);if(this.hoveredElement)this.hoveredElement.object.dispatchEvent({type:"mousewheel",delta:n,object:this.hoveredElement.object});else for(let s of this.getSortedListeners())s.dispatchEvent({type:"mousewheel",delta:n,object:null})}startDragging(e,t=null){let n=e?e.name:"no name";if(this.logMessages&&console.log(`${this.constructor.name}: startDragging: '${n}'`),this.drag={start:this.mouse.clone(),end:this.mouse.clone(),lastDrag:new Se(0,0),startView:this.scene.view.clone(),object:e},t)for(let s of Object.keys(t))this.drag[s]=t[s]}getMousePointCloudIntersection(e){return He.getMousePointCloudIntersection(this.mouse,this.scene.getActiveCamera(),this.viewer,this.scene.pointclouds)}toggleSelection(e){let t=this.selection,n=this.selection.indexOf(e);n===-1?(this.selection.push(e),e.dispatchEvent({type:"select"})):(this.selection.splice(n,1),e.dispatchEvent({type:"deselect"})),this.dispatchEvent({type:"selection_changed",oldSelection:t,selection:this.selection})}deselect(e){let t=this.selection,n=this.selection.indexOf(e);n>=0&&(this.selection.splice(n,1),e.dispatchEvent({type:"deselect"}),this.dispatchEvent({type:"selection_changed",oldSelection:t,selection:this.selection}))}deselectAll(){for(let t of this.selection)t.dispatchEvent({type:"deselect"});let e=this.selection;this.selection.length>0&&(this.selection=[],this.dispatchEvent({type:"selection_changed",oldSelection:e,selection:this.selection}))}isSelected(e){return this.selection.indexOf(e)!==-1}registerInteractiveObject(e){this.interactiveObjects.add(e)}removeInteractiveObject(e){this.interactiveObjects.delete(e)}registerInteractiveScene(e){this.interactiveScenes.indexOf(e)===-1&&this.interactiveScenes.push(e)}unregisterInteractiveScene(e){let t=this.interactiveScenes.indexOf(e);t>-1&&this.interactiveScenes.splice(t,1)}getHoveredElement(){let e=this.getHoveredElements();return e.length>0?e[0]:null}getHoveredElements(){let e=this.interactiveScenes.concat(this.scene.scene),t=["mouseup","mousemove","mouseover","mouseleave","drag","drop","click","select","deselect"],n=[];for(let l of e)l.traverseVisible(c=>{c._listeners&&c.visible&&!this.blacklist.has(c)&&t.filter(h=>c._listeners[h]!==void 0).length>0&&n.push(c)});let s=this.scene.getActiveCamera(),r=He.mouseToRay(this.mouse,s,this.domElement.clientWidth,this.domElement.clientHeight),o=new kr;return o.ray.set(r.origin,r.direction),o.params.Line.threshold=.2,o.intersectObjects(n.filter(l=>l.visible),!1)}setScene(e){this.deselectAll(),this.scene=e}update(e){}getNormalizedDrag(){if(!this.drag)return new Se(0,0);let e=new Se().subVectors(this.drag.end,this.drag.start);return e.x=e.x/this.domElement.clientWidth,e.y=e.y/this.domElement.clientHeight,e}getNormalizedLastDrag(){if(!this.drag)return new Se(0,0);let e=this.drag.lastDrag.clone();return e.x=e.x/this.domElement.clientWidth,e.y=e.y/this.domElement.clientHeight,e}}class R_ extends qe{constructor(e){super(),this.viewer=e;let t=r=>{let o=new Ut({depthTest:!0,depthWrite:!0,side:Xi});return new jn().load(z.resourcePath+"/textures/navigation/"+r,function(a){a.anisotropy=e.renderer.capabilities.getMaxAnisotropy(),o.map=a,o.needsUpdate=!0}),o},n=new jc(1,1);this.front=new ot(n,t("F.png")),this.front.position.y=-.5,this.front.rotation.x=Math.PI/2,this.front.updateMatrixWorld(),this.front.name="F",this.add(this.front),this.back=new ot(n,t("B.png")),this.back.position.y=.5,this.back.rotation.x=Math.PI/2,this.back.updateMatrixWorld(),this.back.name="B",this.add(this.back),this.left=new ot(n,t("L.png")),this.left.position.x=-.5,this.left.rotation.y=Math.PI/2,this.left.updateMatrixWorld(),this.left.name="L",this.add(this.left),this.right=new ot(n,t("R.png")),this.right.position.x=.5,this.right.rotation.y=Math.PI/2,this.right.updateMatrixWorld(),this.right.name="R",this.add(this.right),this.bottom=new ot(n,t("D.png")),this.bottom.position.z=-.5,this.bottom.updateMatrixWorld(),this.bottom.name="D",this.add(this.bottom),this.top=new ot(n,t("U.png")),this.top.position.z=.5,this.top.updateMatrixWorld(),this.top.name="U",this.add(this.top),this.width=150,this.camera=new Fn(-1,1,1,-1,-1,1),this.camera.position.copy(new S(0,0,0)),this.camera.lookAt(new S(0,1,0)),this.camera.updateMatrixWorld(),this.camera.rotation.order="ZXY";let s=r=>{if(!this.visible)return;this.pickedFace=null;let o=new Se;if(o.x=r.clientX-(window.innerWidth-this.width),o.y=r.clientY,o.x<0||o.y>this.width)return;o.x=o.x/this.width*2-1,o.y=-(o.y/this.width)*2+1;let a=new kr;a.setFromCamera(o,this.camera),a.ray.origin.sub(this.camera.getWorldDirection(new S));let l=a.intersectObjects(this.children),c=1e3;for(let u=0;u<l.length;u++)l[u].distance<c&&(this.pickedFace=l[u].object.name,c=l[u].distance);this.pickedFace&&this.viewer.setView(this.pickedFace)};this.viewer.renderer.domElement.addEventListener("mousedown",s,!1)}update(e){this.camera.rotation.copy(e),this.camera.updateMatrixWorld()}}class I_ extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new Si,this.rotationSpeed=200,this.moveSpeed=3,this.lockElevation=!0,this.keys={FORWARD:[87,38],BACKWARD:[83,40],LEFT:[65,37],RIGHT:[68,39],UP:[82,33],DOWN:[70,34]},this.fadeFactor=50,this.yawDelta=0,this.pitchDelta=0,this.translationDelta=new S(0,0,0),this.translationWorldDelta=new S(0,0,0),this.tweens=[];let t=o=>{if(o.drag.object!==null)return;o.drag.startHandled===void 0&&(o.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let a=this.viewer.getMoveSpeed(),l={x:o.drag.lastDrag.x/this.renderer.domElement.clientWidth,y:o.drag.lastDrag.y/this.renderer.domElement.clientHeight};o.drag.mouse===Mo.LEFT?(this.yawDelta+=l.x*this.rotationSpeed,this.pitchDelta+=l.y*this.rotationSpeed):(o.drag.mouse,Mo.RIGHT)},n=o=>{this.dispatchEvent({type:"end"})},s=o=>{let a=this.viewer.getMoveSpeed();o.delta<0?a=a*.9:o.delta>0&&(a=a/.9),a=Math.max(a,.1),this.viewer.setMoveSpeed(a)},r=o=>{this.zoomToLocation(o.mouse)};this.addEventListener("drag",t),this.addEventListener("drop",n)}setScene(e){this.scene=e}stop(){this.yawDelta=0,this.pitchDelta=0,this.translationDelta.set(0,0,0)}zoomToLocation(e){let t=this.scene.getActiveCamera(),n=He.getMousePointCloudIntersection(e,t,this.viewer,this.scene.pointclouds);if(n===null)return;let s=0;{let c=.2,u=this.renderer.domElement,h=He.mouseToRay(e,t,u.clientWidth,u.clientHeight),d=n.pointcloud.nodesOnRay(n.pointcloud.visibleNodes,h),m=d[d.length-1].getBoundingSphere(new fi).radius;s=Math.min(this.scene.view.radius,m),s=Math.max(c,s)}let r=this.scene.view.direction.multiplyScalar(-1),o=new S().addVectors(n.location,r.multiplyScalar(s)),a=600,l=TWEEN.Easing.Quartic.Out;{let c={x:0},u=new TWEEN.Tween(c).to({x:1},a);u.easing(l),this.tweens.push(u);let h=this.scene.view.position.clone(),d=o.clone(),f=this.scene.view.radius,m=o.distanceTo(n.location);u.onUpdate(()=>{let v=c.x;this.scene.view.position.x=(1-v)*h.x+v*d.x,this.scene.view.position.y=(1-v)*h.y+v*d.y,this.scene.view.position.z=(1-v)*h.z+v*d.z,this.scene.view.radius=(1-v)*f+v*m,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),u.onComplete(()=>{this.tweens=this.tweens.filter(v=>v!==u)}),u.start()}}update(e){let t=this.scene.view;[this.yawDelta,this.pitchDelta,this.translationDelta.length(),this.translationWorldDelta.length()].some(r=>Math.abs(r)>.001)&&this.tweens.length>0&&(this.tweens.forEach(r=>r.stop()),this.tweens=[]);{let n=this.viewer.inputHandler,s=this.keys.FORWARD.some(u=>n.pressedKeys[u]),r=this.keys.BACKWARD.some(u=>n.pressedKeys[u]),o=this.keys.LEFT.some(u=>n.pressedKeys[u]),a=this.keys.RIGHT.some(u=>n.pressedKeys[u]),l=this.keys.UP.some(u=>n.pressedKeys[u]),c=this.keys.DOWN.some(u=>n.pressedKeys[u]);if(this.lockElevation){let u=t.direction;u.z=0,u.normalize(),s&&r?this.translationWorldDelta.set(0,0,0):s?this.translationWorldDelta.copy(u.multiplyScalar(3)):r&&this.translationWorldDelta.copy(u.multiplyScalar(-3))}else s&&r?(console.log(22222,""),this.translationDelta.y=0):s?(console.log(33333,""),this.translationDelta.y=this.viewer.getMoveSpeed()):r&&(console.log(44444,""),this.translationDelta.y=-this.viewer.getMoveSpeed());o&&a?this.translationDelta.x=0:o?this.translationDelta.x=-3:a&&(this.translationDelta.x=3),l&&c?this.translationWorldDelta.z=0:l?this.translationWorldDelta.z=3:c&&(this.translationWorldDelta.z=-3)}{let n=t.yaw,s=t.pitch;n-=this.yawDelta*e,s-=this.pitchDelta*e,t.yaw=n,t.pitch=s}t.translate(this.translationDelta.x*e,this.translationDelta.y*e,this.translationDelta.z*e),t.translateWorld(this.translationWorldDelta.x*e,this.translationWorldDelta.y*e,this.translationWorldDelta.z*e),t.radius=3*this.viewer.getMoveSpeed();{let n=Math.max(0,1-this.fadeFactor*e);this.yawDelta*=n,this.pitchDelta*=n,this.translationDelta.multiplyScalar(n),this.translationWorldDelta.multiplyScalar(n)}}}class Fg extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new Si,this.rotationSpeed=5,this.fadeFactor=20,this.yawDelta=0,this.pitchDelta=0,this.panDelta=new Se(0,0),this.radiusDelta=0,this.doubleClockZoomEnabled=!0,this.tweens=[];let t=u=>{if(u.drag.object!==null)return;u.drag.startHandled===void 0&&(u.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let h={x:u.drag.lastDrag.x/this.renderer.domElement.clientWidth,y:u.drag.lastDrag.y/this.renderer.domElement.clientHeight};u.drag.mouse===Mo.LEFT?(this.yawDelta+=h.x*this.rotationSpeed,this.pitchDelta+=h.y*this.rotationSpeed,this.stopTweens()):u.drag.mouse===Mo.RIGHT&&(this.panDelta.x+=h.x,this.panDelta.y+=h.y,this.stopTweens())},n=u=>{this.dispatchEvent({type:"end"})},s=u=>{let h=this.scene.view.radius+this.radiusDelta;this.radiusDelta+=-u.delta*h*.1,this.stopTweens()},r=u=>{this.doubleClockZoomEnabled&&this.zoomToLocation(u.mouse)},o=null,a=u=>{o=u},l=u=>{o=u},c=u=>{if(u.touches.length===2&&o.touches.length===2){let h=o,d=u,f=h.touches[0].pageX-h.touches[1].pageX,m=h.touches[0].pageY-h.touches[1].pageY,v=Math.sqrt(f*f+m*m),_=d.touches[0].pageX-d.touches[1].pageX,y=d.touches[0].pageY-d.touches[1].pageY,R=Math.sqrt(_*_+y*y)/v,I=this.scene.view.radius+this.radiusDelta,B=I/R;this.radiusDelta=B-I,this.stopTweens()}else if(u.touches.length===3&&o.touches.length===3){let h=o,d=u,f=(h.touches[0].pageX+h.touches[1].pageX+h.touches[2].pageX)/3,m=(h.touches[0].pageY+h.touches[1].pageY+h.touches[2].pageY)/3,v=(d.touches[0].pageX+d.touches[1].pageX+d.touches[2].pageX)/3,_=(d.touches[0].pageY+d.touches[1].pageY+d.touches[2].pageY)/3,y={x:(v-f)/this.renderer.domElement.clientWidth,y:(_-m)/this.renderer.domElement.clientHeight};this.panDelta.x+=y.x,this.panDelta.y+=y.y,this.stopTweens()}o=u};this.addEventListener("touchstart",a),this.addEventListener("touchend",l),this.addEventListener("touchmove",c),this.addEventListener("drag",t),this.addEventListener("drop",n),this.addEventListener("mousewheel",s),this.addEventListener("dblclick",r)}setScene(e){this.scene=e}stop(){this.yawDelta=0,this.pitchDelta=0,this.radiusDelta=0,this.panDelta.set(0,0)}zoomToLocation(e){let t=this.scene.getActiveCamera(),n=He.getMousePointCloudIntersection(e,t,this.viewer,this.scene.pointclouds,{pickClipped:!0});if(n===null)return;let s=0;{let c=.2,u=this.renderer.domElement,h=He.mouseToRay(e,t,u.clientWidth,u.clientHeight),d=n.pointcloud.nodesOnRay(n.pointcloud.visibleNodes,h),m=d[d.length-1].getBoundingSphere(new fi).radius;s=Math.min(this.scene.view.radius,m),s=Math.max(c,s)}let r=this.scene.view.direction.multiplyScalar(-1),o=new S().addVectors(n.location,r.multiplyScalar(s)),a=600,l=TWEEN.Easing.Quartic.Out;{let c={x:0},u=new TWEEN.Tween(c).to({x:1},a);u.easing(l),this.tweens.push(u);let h=this.scene.view.position.clone(),d=o.clone(),f=this.scene.view.radius,m=o.distanceTo(n.location);u.onUpdate(()=>{let v=c.x;this.scene.view.position.x=(1-v)*h.x+v*d.x,this.scene.view.position.y=(1-v)*h.y+v*d.y,this.scene.view.position.z=(1-v)*h.z+v*d.z,this.scene.view.radius=(1-v)*f+v*m,this.viewer.setMoveSpeed(this.scene.view.radius)}),u.onComplete(()=>{this.tweens=this.tweens.filter(v=>v!==u)}),u.start()}}stopTweens(){this.tweens.forEach(e=>e.stop()),this.tweens=[]}update(e){let t=this.scene.view;{let n=Math.min(1,this.fadeFactor*e),s=t.yaw,r=t.pitch,o=t.getPivot();s-=n*this.yawDelta,r-=n*this.pitchDelta,t.yaw=s,t.pitch=r;let a=this.scene.view.direction.multiplyScalar(-t.radius),l=new S().addVectors(o,a);t.position.copy(l)}{let s=Math.min(1,this.fadeFactor*e)*t.radius*3,r=-this.panDelta.x*s,o=this.panDelta.y*s;t.pan(r,o)}{let n=Math.min(1,this.fadeFactor*e),s=t.radius+n*this.radiusDelta,r=t.direction.multiplyScalar(-s),o=new S().addVectors(t.getPivot(),r);t.radius=s,t.position.copy(o)}{let n=t.radius;this.viewer.setMoveSpeed(n)}{let n=Math.min(1,this.fadeFactor*e),s=Math.max(0,1-this.fadeFactor*e);this.yawDelta*=s,this.pitchDelta*=s,this.panDelta.multiplyScalar(s),this.radiusDelta-=n*this.radiusDelta}}}class Bg extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new Si,this.rotationSpeed=200,this.moveSpeed=10,this.lockElevation=!1,this.keys={FORWARD:[87,38],BACKWARD:[83,40],LEFT:[65,37],RIGHT:[68,39],UP:[82,33],DOWN:[70,34]},this.fadeFactor=50,this.yawDelta=0,this.pitchDelta=0,this.translationDelta=new S(0,0,0),this.translationWorldDelta=new S(0,0,0),this.tweens=[];let t=o=>{if(o.drag.object!==null)return;o.drag.startHandled===void 0&&(o.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let a=this.viewer.getMoveSpeed(),l={x:o.drag.lastDrag.x/this.renderer.domElement.clientWidth,y:o.drag.lastDrag.y/this.renderer.domElement.clientHeight};o.drag.mouse===Mo.LEFT?(this.yawDelta+=l.x*this.rotationSpeed,this.pitchDelta+=l.y*this.rotationSpeed):o.drag.mouse===Mo.RIGHT&&(this.translationDelta.x-=l.x*a*100,this.translationDelta.z+=l.y*a*100)},n=o=>{this.dispatchEvent({type:"end"})},s=o=>{let a=this.viewer.getMoveSpeed();o.delta<0?a=a*.9:o.delta>0&&(a=a/.9),a=Math.max(a,.1),this.viewer.setMoveSpeed(a)},r=o=>{this.zoomToLocation(o.mouse)};this.addEventListener("drag",t),this.addEventListener("drop",n),this.addEventListener("mousewheel",s),this.addEventListener("dblclick",r)}setScene(e){this.scene=e}stop(){this.yawDelta=0,this.pitchDelta=0,this.translationDelta.set(0,0,0)}zoomToLocation(e){let t=this.scene.getActiveCamera(),n=He.getMousePointCloudIntersection(e,t,this.viewer,this.scene.pointclouds);if(n===null)return;let s=0;{let c=.2,u=this.renderer.domElement,h=He.mouseToRay(e,t,u.clientWidth,u.clientHeight),d=n.pointcloud.nodesOnRay(n.pointcloud.visibleNodes,h),m=d[d.length-1].getBoundingSphere(new fi).radius;s=Math.min(this.scene.view.radius,m),s=Math.max(c,s)}let r=this.scene.view.direction.multiplyScalar(-1),o=new S().addVectors(n.location,r.multiplyScalar(s)),a=600,l=TWEEN.Easing.Quartic.Out;{let c={x:0},u=new TWEEN.Tween(c).to({x:1},a);u.easing(l),this.tweens.push(u);let h=this.scene.view.position.clone(),d=o.clone(),f=this.scene.view.radius,m=o.distanceTo(n.location);u.onUpdate(()=>{let v=c.x;this.scene.view.position.x=(1-v)*h.x+v*d.x,this.scene.view.position.y=(1-v)*h.y+v*d.y,this.scene.view.position.z=(1-v)*h.z+v*d.z,this.scene.view.radius=(1-v)*f+v*m,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),u.onComplete(()=>{this.tweens=this.tweens.filter(v=>v!==u)}),u.start()}}update(e){let t=this.scene.view;[this.yawDelta,this.pitchDelta,this.translationDelta.length(),this.translationWorldDelta.length()].some(r=>Math.abs(r)>.001)&&this.tweens.length>0&&(this.tweens.forEach(r=>r.stop()),this.tweens=[]);{let n=this.viewer.inputHandler,s=this.keys.FORWARD.some(u=>n.pressedKeys[u]),r=this.keys.BACKWARD.some(u=>n.pressedKeys[u]),o=this.keys.LEFT.some(u=>n.pressedKeys[u]),a=this.keys.RIGHT.some(u=>n.pressedKeys[u]),l=this.keys.UP.some(u=>n.pressedKeys[u]),c=this.keys.DOWN.some(u=>n.pressedKeys[u]);if(this.lockElevation){let u=t.direction;u.z=0,u.normalize(),s&&r?this.translationWorldDelta.set(0,0,0):s?this.translationWorldDelta.copy(u.multiplyScalar(this.viewer.getMoveSpeed())):r&&this.translationWorldDelta.copy(u.multiplyScalar(-this.viewer.getMoveSpeed()))}else s&&r?this.translationDelta.y=0:s?this.translationDelta.y=this.viewer.getMoveSpeed():r&&(this.translationDelta.y=-this.viewer.getMoveSpeed());o&&a?this.translationDelta.x=0:o?this.translationDelta.x=-this.viewer.getMoveSpeed():a&&(this.translationDelta.x=this.viewer.getMoveSpeed()),l&&c?this.translationWorldDelta.z=0:l?this.translationWorldDelta.z=this.viewer.getMoveSpeed():c&&(this.translationWorldDelta.z=-this.viewer.getMoveSpeed())}{let n=t.yaw,s=t.pitch;n-=this.yawDelta*e,s-=this.pitchDelta*e,t.yaw=n,t.pitch=s}t.translate(this.translationDelta.x*e,this.translationDelta.y*e,this.translationDelta.z*e),t.translateWorld(this.translationWorldDelta.x*e,this.translationWorldDelta.y*e,this.translationWorldDelta.z*e),t.radius=3*this.viewer.getMoveSpeed();{let n=Math.max(0,1-this.fadeFactor*e);this.yawDelta*=n,this.pitchDelta*=n,this.translationDelta.multiplyScalar(n),this.translationWorldDelta.multiplyScalar(n)}}}class Ng extends Ne{constructor(e){super(e),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new Si,this.rotationSpeed=10,this.fadeFactor=20,this.wheelDelta=0,this.zoomDelta=new S,this.camStart=null,this.tweens=[];{let l=new Li(1,16,16),c=new Ki;this.pivotIndicator=new ot(l,c),this.pivotIndicator.visible=!1,this.sceneControls.add(this.pivotIndicator)}let t=l=>{if(l.drag.object!==null||!this.pivot)return;l.drag.startHandled===void 0&&(l.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let c=this.camStart,u=this.scene.getActiveCamera(),h=this.viewer.scene.view,d=l.drag.end,f=this.viewer.renderer.domElement;if(l.drag.mouse===Mo.LEFT){let m=He.mouseToRay(d,u,f.clientWidth,f.clientHeight),v=new yi().setFromNormalAndCoplanarPoint(new S(0,0,1),this.pivot),_=m.distanceToPlane(v);if(_>0){let y=new S().addVectors(c.position,m.direction.clone().multiplyScalar(_)),x=new S().subVectors(y,this.pivot),R=c.position.clone().sub(x);h.position.copy(R);{let I=R.distanceTo(this.pivot);h.radius=I;let B=h.radius/2.5;this.viewer.setMoveSpeed(B)}}}else if(l.drag.mouse===Mo.RIGHT){let m={x:l.drag.lastDrag.x/this.renderer.domElement.clientWidth,y:l.drag.lastDrag.y/this.renderer.domElement.clientHeight},v=-m.x*this.rotationSpeed*.5,_=-m.y*this.rotationSpeed*.2,y=h.pitch,x=h.clone();x.pitch=x.pitch+_,_=x.pitch-y;let R=new S().subVectors(h.position,this.pivot),I=new S().subVectors(h.getPivot(),this.pivot),B=h.getSide();R.applyAxisAngle(B,_),I.applyAxisAngle(B,_),R.applyAxisAngle(new S(0,0,1),v),I.applyAxisAngle(new S(0,0,1),v);let N=new S().addVectors(this.pivot,R);h.position.copy(N),h.yaw+=v,h.pitch+=_}},n=l=>{let c=He.getMousePointCloudIntersection(l.mouse,this.scene.getActiveCamera(),this.viewer,this.scene.pointclouds,{pickClipped:!1});c&&(this.pivot=c.location,this.camStart=this.scene.getActiveCamera().clone(),this.pivotIndicator.visible=!0,this.pivotIndicator.position.copy(c.location))},s=l=>{this.dispatchEvent({type:"end"})},r=l=>{this.camStart=null,this.pivot=null,this.pivotIndicator.visible=!1},o=l=>{this.wheelDelta+=l.delta},a=l=>{this.zoomToLocation(l.mouse)};this.addEventListener("drag",t),this.addEventListener("drop",s),this.addEventListener("mousewheel",o),this.addEventListener("mousedown",n),this.addEventListener("mouseup",r),this.addEventListener("dblclick",a)}setScene(e){this.scene=e}stop(){this.wheelDelta=0,this.zoomDelta.set(0,0,0)}zoomToLocation(e){let t=this.scene.getActiveCamera(),n=He.getMousePointCloudIntersection(e,t,this.viewer,this.scene.pointclouds);if(n===null)return;let s=0;{let c=.2,u=this.renderer.domElement,h=He.mouseToRay(e,t,u.clientWidth,u.clientHeight),d=n.pointcloud.nodesOnRay(n.pointcloud.visibleNodes,h),m=d[d.length-1].getBoundingSphere(new fi).radius;s=Math.min(this.scene.view.radius,m),s=Math.max(c,s)}let r=this.scene.view.direction.multiplyScalar(-1),o=new S().addVectors(n.location,r.multiplyScalar(s)),a=600,l=TWEEN.Easing.Quartic.Out;{let c={x:0},u=new TWEEN.Tween(c).to({x:1},a);u.easing(l),this.tweens.push(u);let h=this.scene.view.position.clone(),d=o.clone(),f=this.scene.view.radius,m=o.distanceTo(n.location);u.onUpdate(()=>{let v=c.x;this.scene.view.position.x=(1-v)*h.x+v*d.x,this.scene.view.position.y=(1-v)*h.y+v*d.y,this.scene.view.position.z=(1-v)*h.z+v*d.z,this.scene.view.radius=(1-v)*f+v*m,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),u.onComplete(()=>{this.tweens=this.tweens.filter(v=>v!==u)}),u.start()}}update(e){let t=this.scene.view,n=Math.pow(.5,this.fadeFactor*e),s=1-n,r=this.scene.getActiveCamera();if(this.wheelDelta!==0){let o=He.getMousePointCloudIntersection(this.viewer.inputHandler.mouse,this.scene.getActiveCamera(),this.viewer,this.scene.pointclouds);if(o){let a=new S().addVectors(t.position,this.zoomDelta),c=o.location.distanceTo(a)*.2*this.wheelDelta,u=new S().subVectors(o.location,t.position);u.normalize(),a.add(u.multiplyScalar(c)),this.zoomDelta.subVectors(a,t.position);{let h=a.distanceTo(o.location);t.radius=h;let d=t.radius/2.5;this.viewer.setMoveSpeed(d)}}}if(this.zoomDelta.length()!==0){let o=this.zoomDelta.clone().multiplyScalar(s),a=new S().addVectors(t.position,o);t.position.copy(a)}if(this.pivotIndicator.visible){let o=this.pivotIndicator.position.distanceTo(t.position),a=this.renderer.domElement.clientwidth,l=this.renderer.domElement.clientHeight,u=10/He.projectedRadius(1,r,o,a,l);this.pivotIndicator.scale.set(u,u,u)}this.zoomDelta.multiplyScalar(n),this.wheelDelta=0}}class Og extends Ne{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new Si,this.screenOrientation=window.orientation||0;let t=s=>{this.deviceOrientation=s},n=s=>{this.screenOrientation=window.orientation||0};"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",t):"ondeviceorientation"in window?window.addEventListener("deviceorientation",t):console.warn("No device orientation found."),window.addEventListener("orientationchange",n)}setScene(e){this.scene=e}update(e){let t=function(n,s,r,o){let a=new Ei,l=new S(0,0,1),c=new Mt,u=new Ei;return c.set(s,r,n,"ZXY"),a.setFromEuler(c),a.multiply(u.setFromAxisAngle(l,-o)),a};if(typeof this.deviceOrientation<"u"){let n=this.deviceOrientation.alpha?rt.degToRad(this.deviceOrientation.alpha):0,s=this.deviceOrientation.beta?rt.degToRad(this.deviceOrientation.beta):0,r=this.deviceOrientation.gamma?rt.degToRad(this.deviceOrientation.gamma):0,o=this.screenOrientation?rt.degToRad(this.screenOrientation):0,a=t(n,s,r,o);viewer.scene.cameraP.quaternion.set(a.x,a.y,a.z,a.w)}}}var F_=function(){function i(Y){gi.call(this,Y),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(X){return new o(X)}),this.register(function(X){return new l(X)}),this.register(function(X){return new c(X)}),this.register(function(X){return new a(X)}),this.register(function(X){return new s(X)}),this.register(function(X){return new u(X)})}i.prototype=Object.assign(Object.create(gi.prototype),{constructor:i,load:function(Y,X,ce,ie){var he=this,ge;this.resourcePath!==""?ge=this.resourcePath:this.path!==""?ge=this.path:ge=Or.extractUrlBase(Y),this.manager.itemStart(Y);var le=function(we){ie?ie(we):console.error(we),he.manager.itemError(Y),he.manager.itemEnd(Y)},oe=new ls(this.manager);oe.setPath(this.path),oe.setResponseType("arraybuffer"),oe.setRequestHeader(this.requestHeader),oe.setWithCredentials(this.withCredentials),oe.load(Y,function(we){try{he.parse(we,ge,function(Le){X(Le),he.manager.itemEnd(Y)},le)}catch(Le){le(Le)}},ce,le)},setDRACOLoader:function(Y){return this.dracoLoader=Y,this},setDDSLoader:function(Y){return this.ddsLoader=Y,this},setKTX2Loader:function(Y){return this.ktx2Loader=Y,this},setMeshoptDecoder:function(Y){return this.meshoptDecoder=Y,this},register:function(Y){return this.pluginCallbacks.indexOf(Y)===-1&&this.pluginCallbacks.push(Y),this},unregister:function(Y){return this.pluginCallbacks.indexOf(Y)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Y),1),this},parse:function(Y,X,ce,ie){var he,ge={},le={};if(typeof Y=="string")he=Y;else{var oe=Or.decodeText(new Uint8Array(Y,0,4));if(oe===h){try{ge[t.KHR_BINARY_GLTF]=new m(Y)}catch(Be){ie&&ie(Be);return}he=ge[t.KHR_BINARY_GLTF].content}else he=Or.decodeText(new Uint8Array(Y))}var we=JSON.parse(he);if(we.asset===void 0||we.asset.version[0]<2){ie&&ie(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var Le=new Fe(we,{path:X||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});Le.fileLoader.setRequestHeader(this.requestHeader);for(var Ae=0;Ae<this.pluginCallbacks.length;Ae++){var K=this.pluginCallbacks[Ae](Le);le[K.name]=K,ge[K.name]=!0}if(we.extensionsUsed)for(var Ae=0;Ae<we.extensionsUsed.length;++Ae){var Q=we.extensionsUsed[Ae],Ue=we.extensionsRequired||[];switch(Q){case t.KHR_MATERIALS_UNLIT:ge[Q]=new r;break;case t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:ge[Q]=new x;break;case t.KHR_DRACO_MESH_COMPRESSION:ge[Q]=new v(we,this.dracoLoader);break;case t.MSFT_TEXTURE_DDS:ge[Q]=new n(this.ddsLoader);break;case t.KHR_TEXTURE_TRANSFORM:ge[Q]=new _;break;case t.KHR_MESH_QUANTIZATION:ge[Q]=new R;break;default:Ue.indexOf(Q)>=0&&le[Q]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+Q+'".')}}Le.setExtensions(ge),Le.setPlugins(le),Le.parse(ce,ie)}});function e(){var Y={};return{get:function(X){return Y[X]},add:function(X,ce){Y[X]=ce},remove:function(X){delete Y[X]},removeAll:function(){Y={}}}}var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(Y){if(!Y)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=t.MSFT_TEXTURE_DDS,this.ddsLoader=Y}function s(Y){this.parser=Y,this.name=t.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}s.prototype._markDefs=function(){for(var Y=this.parser,X=this.parser.json.nodes||[],ce=0,ie=X.length;ce<ie;ce++){var he=X[ce];he.extensions&&he.extensions[this.name]&&he.extensions[this.name].light!==void 0&&Y._addNodeRef(this.cache,he.extensions[this.name].light)}},s.prototype._loadLight=function(Y){var X=this.parser,ce="light:"+Y,ie=X.cache.get(ce);if(ie)return ie;var he=X.json,ge=he.extensions&&he.extensions[this.name]||{},le=ge.lights||[],oe=le[Y],we,Le=new Ee(16777215);oe.color!==void 0&&Le.fromArray(oe.color);var Ae=oe.range!==void 0?oe.range:0;switch(oe.type){case"directional":we=new xo(Le),we.target.position.set(0,0,-1),we.add(we.target);break;case"point":we=new yo(Le),we.distance=Ae;break;case"spot":we=new Yc(Le),we.distance=Ae,oe.spot=oe.spot||{},oe.spot.innerConeAngle=oe.spot.innerConeAngle!==void 0?oe.spot.innerConeAngle:0,oe.spot.outerConeAngle=oe.spot.outerConeAngle!==void 0?oe.spot.outerConeAngle:Math.PI/4,we.angle=oe.spot.outerConeAngle,we.penumbra=1-oe.spot.innerConeAngle/oe.spot.outerConeAngle,we.target.position.set(0,0,-1),we.add(we.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+oe.type)}return we.position.set(0,0,0),we.decay=2,oe.intensity!==void 0&&(we.intensity=oe.intensity),we.name=X.createUniqueName(oe.name||"light_"+Y),ie=Promise.resolve(we),X.cache.add(ce,ie),ie},s.prototype.createNodeAttachment=function(Y){var X=this,ce=this.parser,ie=ce.json,he=ie.nodes[Y],ge=he.extensions&&he.extensions[this.name]||{},le=ge.light;return le===void 0?null:this._loadLight(le).then(function(oe){return ce._getNodeRef(X.cache,le,oe)})};function r(){this.name=t.KHR_MATERIALS_UNLIT}r.prototype.getMaterialType=function(){return Ut},r.prototype.extendParams=function(Y,X,ce){var ie=[];Y.color=new Ee(1,1,1),Y.opacity=1;var he=X.pbrMetallicRoughness;if(he){if(Array.isArray(he.baseColorFactor)){var ge=he.baseColorFactor;Y.color.fromArray(ge),Y.opacity=ge[3]}he.baseColorTexture!==void 0&&ie.push(ce.assignTexture(Y,"map",he.baseColorTexture))}return Promise.all(ie)};function o(Y){this.parser=Y,this.name=t.KHR_MATERIALS_CLEARCOAT}o.prototype.getMaterialType=function(Y){var X=this.parser,ce=X.json.materials[Y];return!ce.extensions||!ce.extensions[this.name]?null:fo},o.prototype.extendMaterialParams=function(Y,X){var ce=this.parser,ie=ce.json.materials[Y];if(!ie.extensions||!ie.extensions[this.name])return Promise.resolve();var he=[],ge=ie.extensions[this.name];if(ge.clearcoatFactor!==void 0&&(X.clearcoat=ge.clearcoatFactor),ge.clearcoatTexture!==void 0&&he.push(ce.assignTexture(X,"clearcoatMap",ge.clearcoatTexture)),ge.clearcoatRoughnessFactor!==void 0&&(X.clearcoatRoughness=ge.clearcoatRoughnessFactor),ge.clearcoatRoughnessTexture!==void 0&&he.push(ce.assignTexture(X,"clearcoatRoughnessMap",ge.clearcoatRoughnessTexture)),ge.clearcoatNormalTexture!==void 0&&(he.push(ce.assignTexture(X,"clearcoatNormalMap",ge.clearcoatNormalTexture)),ge.clearcoatNormalTexture.scale!==void 0)){var le=ge.clearcoatNormalTexture.scale;X.clearcoatNormalScale=new Se(le,le)}return Promise.all(he)};function a(Y){this.parser=Y,this.name=t.KHR_MATERIALS_TRANSMISSION}a.prototype.getMaterialType=function(Y){var X=this.parser,ce=X.json.materials[Y];return!ce.extensions||!ce.extensions[this.name]?null:fo},a.prototype.extendMaterialParams=function(Y,X){var ce=this.parser,ie=ce.json.materials[Y];if(!ie.extensions||!ie.extensions[this.name])return Promise.resolve();var he=[],ge=ie.extensions[this.name];return ge.transmissionFactor!==void 0&&(X.transmission=ge.transmissionFactor),ge.transmissionTexture!==void 0&&he.push(ce.assignTexture(X,"transmissionMap",ge.transmissionTexture)),Promise.all(he)};function l(Y){this.parser=Y,this.name=t.KHR_TEXTURE_BASISU}l.prototype.loadTexture=function(Y){var X=this.parser,ce=X.json,ie=ce.textures[Y];if(!ie.extensions||!ie.extensions[this.name])return null;var he=ie.extensions[this.name],ge=ce.images[he.source],le=X.options.ktx2Loader;if(!le){if(ce.extensionsRequired&&ce.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return X.loadTextureImage(Y,ge,le)};function c(Y){this.parser=Y,this.name=t.EXT_TEXTURE_WEBP,this.isSupported=null}c.prototype.loadTexture=function(Y){var X=this.name,ce=this.parser,ie=ce.json,he=ie.textures[Y];if(!he.extensions||!he.extensions[X])return null;var ge=he.extensions[X],le=ie.images[ge.source],oe=le.uri?ce.options.manager.getHandler(le.uri):ce.textureLoader;return this.detectSupport().then(function(we){if(we)return ce.loadTextureImage(Y,le,oe);if(ie.extensionsRequired&&ie.extensionsRequired.indexOf(X)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return ce.loadTexture(Y)})},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(Y){var X=new Image;X.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",X.onload=X.onerror=function(){Y(X.height===1)}})),this.isSupported};function u(Y){this.name=t.EXT_MESHOPT_COMPRESSION,this.parser=Y}u.prototype.loadBufferView=function(Y){var X=this.parser.json,ce=X.bufferViews[Y];if(ce.extensions&&ce.extensions[this.name]){var ie=ce.extensions[this.name],he=this.parser.getDependency("buffer",ie.buffer),ge=this.parser.options.meshoptDecoder;if(!ge||!ge.supported){if(X.extensionsRequired&&X.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([he,ge.ready]).then(function(le){var oe=ie.byteOffset||0,we=ie.byteLength||0,Le=ie.count,Ae=ie.byteStride,K=new ArrayBuffer(Le*Ae),Q=new Uint8Array(le[0],oe,we);return ge.decodeGltfBuffer(new Uint8Array(K),Le,Ae,Q,ie.mode,ie.filter),K})}else return null};var h="glTF",d=12,f={JSON:1313821514,BIN:5130562};function m(Y){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var X=new DataView(Y,0,d);if(this.header={magic:Or.decodeText(new Uint8Array(Y.slice(0,4))),version:X.getUint32(4,!0),length:X.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var ce=new DataView(Y,d),ie=0;ie<ce.byteLength;){var he=ce.getUint32(ie,!0);ie+=4;var ge=ce.getUint32(ie,!0);if(ie+=4,ge===f.JSON){var le=new Uint8Array(Y,d+ie,he);this.content=Or.decodeText(le)}else if(ge===f.BIN){var oe=d+ie;this.body=Y.slice(oe,oe+he)}ie+=he}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function v(Y,X){if(!X)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=t.KHR_DRACO_MESH_COMPRESSION,this.json=Y,this.dracoLoader=X,this.dracoLoader.preload()}v.prototype.decodePrimitive=function(Y,X){var ce=this.json,ie=this.dracoLoader,he=Y.extensions[this.name].bufferView,ge=Y.extensions[this.name].attributes,le={},oe={},we={};for(var Le in ge){var Ae=E[Le]||Le.toLowerCase();le[Ae]=ge[Le]}for(Le in Y.attributes){var Ae=E[Le]||Le.toLowerCase();if(ge[Le]!==void 0){var K=ce.accessors[Y.attributes[Le]],Q=N[K.componentType];we[Ae]=Q,oe[Ae]=K.normalized===!0}}return X.getDependency("bufferView",he).then(function(Ue){return new Promise(function(Be){ie.decodeDracoFile(Ue,function(ye){for(var Je in ye.attributes){var it=ye.attributes[Je],lt=oe[Je];lt!==void 0&&(it.normalized=lt)}Be(ye)},le,we)})})};function _(){this.name=t.KHR_TEXTURE_TRANSFORM}_.prototype.extendTexture=function(Y,X){return Y=Y.clone(),X.offset!==void 0&&Y.offset.fromArray(X.offset),X.rotation!==void 0&&(Y.rotation=X.rotation),X.scale!==void 0&&Y.repeat.fromArray(X.scale),X.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Y.needsUpdate=!0,Y};function y(Y){rs.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var X=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),ce=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),ie=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),he=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),ge=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),le={specular:{value:new Ee().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=le,this.onBeforeCompile=function(oe){for(var we in le)oe.uniforms[we]=le[we];oe.fragmentShader=oe.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",X).replace("#include <metalnessmap_pars_fragment>",ce).replace("#include <roughnessmap_fragment>",ie).replace("#include <metalnessmap_fragment>",he).replace("#include <lights_physical_fragment>",ge)},Object.defineProperties(this,{specular:{get:function(){return le.specular.value},set:function(oe){le.specular.value=oe}},specularMap:{get:function(){return le.specularMap.value},set:function(oe){le.specularMap.value=oe,oe?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return le.glossiness.value},set:function(oe){le.glossiness.value=oe}},glossinessMap:{get:function(){return le.glossinessMap.value},set:function(oe){le.glossinessMap.value=oe,oe?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Y)}y.prototype=Object.create(rs.prototype),y.prototype.constructor=y,y.prototype.copy=function(Y){return rs.prototype.copy.call(this,Y),this.specularMap=Y.specularMap,this.specular.copy(Y.specular),this.glossinessMap=Y.glossinessMap,this.glossiness=Y.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this};function x(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return y},extendParams:function(Y,X,ce){var ie=X.extensions[this.name];Y.color=new Ee(1,1,1),Y.opacity=1;var he=[];if(Array.isArray(ie.diffuseFactor)){var ge=ie.diffuseFactor;Y.color.fromArray(ge),Y.opacity=ge[3]}if(ie.diffuseTexture!==void 0&&he.push(ce.assignTexture(Y,"map",ie.diffuseTexture)),Y.emissive=new Ee(0,0,0),Y.glossiness=ie.glossinessFactor!==void 0?ie.glossinessFactor:1,Y.specular=new Ee(1,1,1),Array.isArray(ie.specularFactor)&&Y.specular.fromArray(ie.specularFactor),ie.specularGlossinessTexture!==void 0){var le=ie.specularGlossinessTexture;he.push(ce.assignTexture(Y,"glossinessMap",le)),he.push(ce.assignTexture(Y,"specularMap",le))}return Promise.all(he)},createMaterial:function(Y){var X=new y(Y);return X.fog=!0,X.color=Y.color,X.map=Y.map===void 0?null:Y.map,X.lightMap=null,X.lightMapIntensity=1,X.aoMap=Y.aoMap===void 0?null:Y.aoMap,X.aoMapIntensity=1,X.emissive=Y.emissive,X.emissiveIntensity=1,X.emissiveMap=Y.emissiveMap===void 0?null:Y.emissiveMap,X.bumpMap=Y.bumpMap===void 0?null:Y.bumpMap,X.bumpScale=1,X.normalMap=Y.normalMap===void 0?null:Y.normalMap,X.normalMapType=$e,Y.normalScale&&(X.normalScale=Y.normalScale),X.displacementMap=null,X.displacementScale=1,X.displacementBias=0,X.specularMap=Y.specularMap===void 0?null:Y.specularMap,X.specular=Y.specular,X.glossinessMap=Y.glossinessMap===void 0?null:Y.glossinessMap,X.glossiness=Y.glossiness,X.alphaMap=null,X.envMap=Y.envMap===void 0?null:Y.envMap,X.envMapIntensity=1,X.refractionRatio=.98,X}}}function R(){this.name=t.KHR_MESH_QUANTIZATION}function I(Y,X,ce,ie){os.call(this,Y,X,ce,ie)}I.prototype=Object.create(os.prototype),I.prototype.constructor=I,I.prototype.copySampleValue_=function(Y){for(var X=this.resultBuffer,ce=this.sampleValues,ie=this.valueSize,he=Y*ie*3+ie,ge=0;ge!==ie;ge++)X[ge]=ce[he+ge];return X},I.prototype.beforeStart_=I.prototype.copySampleValue_,I.prototype.afterEnd_=I.prototype.copySampleValue_,I.prototype.interpolate_=function(Y,X,ce,ie){for(var he=this.resultBuffer,ge=this.sampleValues,le=this.valueSize,oe=le*2,we=le*3,Le=ie-X,Ae=(ce-X)/Le,K=Ae*Ae,Q=K*Ae,Ue=Y*we,Be=Ue-we,ye=-2*Q+3*K,Je=Q-K,it=1-ye,lt=Je-K+Ae,nt=0;nt!==le;nt++){var xt=ge[Be+nt+le],At=ge[Be+nt+oe]*Le,kt=ge[Ue+nt+le],gt=ge[Ue+nt]*Le;he[nt]=it*xt+lt*At+ye*kt+Je*gt}return he};var B={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},N={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},J={9728:ei,9729:et,9984:Yr,9985:sn,9986:Pn,9987:Rs},ne={33071:li,33648:Kn,10497:vi},se={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},M={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A={CUBICSPLINE:void 0,LINEAR:Tr,STEP:io},F={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function P(Y,X){return typeof Y!="string"||Y===""?"":(/^https?:\/\//i.test(X)&&/^\//.test(Y)&&(X=X.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Y)||/^data:.*,.*$/i.test(Y)||/^blob:.*$/i.test(Y)?Y:X+Y)}function O(Y){return Y.DefaultMaterial===void 0&&(Y.DefaultMaterial=new rs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Kt})),Y.DefaultMaterial}function V(Y,X,ce){for(var ie in ce.extensions)Y[ie]===void 0&&(X.userData.gltfExtensions=X.userData.gltfExtensions||{},X.userData.gltfExtensions[ie]=ce.extensions[ie])}function W(Y,X){X.extras!==void 0&&(typeof X.extras=="object"?Object.assign(Y.userData,X.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+X.extras))}function fe(Y,X,ce){for(var ie=!1,he=!1,ge=0,le=X.length;ge<le;ge++){var oe=X[ge];if(oe.POSITION!==void 0&&(ie=!0),oe.NORMAL!==void 0&&(he=!0),ie&&he)break}if(!ie&&!he)return Promise.resolve(Y);for(var we=[],Le=[],ge=0,le=X.length;ge<le;ge++){var oe=X[ge];if(ie){var Ae=oe.POSITION!==void 0?ce.getDependency("accessor",oe.POSITION):Y.attributes.position;we.push(Ae)}if(he){var Ae=oe.NORMAL!==void 0?ce.getDependency("accessor",oe.NORMAL):Y.attributes.normal;Le.push(Ae)}}return Promise.all([Promise.all(we),Promise.all(Le)]).then(function(K){var Q=K[0],Ue=K[1];return ie&&(Y.morphAttributes.position=Q),he&&(Y.morphAttributes.normal=Ue),Y.morphTargetsRelative=!0,Y})}function ve(Y,X){if(Y.updateMorphTargets(),X.weights!==void 0)for(var ce=0,ie=X.weights.length;ce<ie;ce++)Y.morphTargetInfluences[ce]=X.weights[ce];if(X.extras&&Array.isArray(X.extras.targetNames)){var he=X.extras.targetNames;if(Y.morphTargetInfluences.length===he.length){Y.morphTargetDictionary={};for(var ce=0,ie=he.length;ce<ie;ce++)Y.morphTargetDictionary[he[ce]]=ce}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function pe(Y){var X=Y.extensions&&Y.extensions[t.KHR_DRACO_MESH_COMPRESSION],ce;return X?ce="draco:"+X.bufferView+":"+X.indices+":"+Me(X.attributes):ce=Y.indices+":"+Me(Y.attributes)+":"+Y.mode,ce}function Me(Y){for(var X="",ce=Object.keys(Y).sort(),ie=0,he=ce.length;ie<he;ie++)X+=ce[ie]+":"+Y[ce[ie]]+";";return X}function Fe(Y,X){this.json=Y||{},this.extensions={},this.plugins={},this.options=X||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new kd(this.options.manager):this.textureLoader=new jn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new ls(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}Fe.prototype.setExtensions=function(Y){this.extensions=Y},Fe.prototype.setPlugins=function(Y){this.plugins=Y},Fe.prototype.parse=function(Y,X){var ce=this,ie=this.json,he=this.extensions;this.cache.removeAll(),this._invokeAll(function(ge){return ge._markDefs&&ge._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(ge){var le={scene:ge[0][ie.scene||0],scenes:ge[0],animations:ge[1],cameras:ge[2],asset:ie.asset,parser:ce,userData:{}};V(he,le,ie),W(le,ie),Y(le)}).catch(X)},Fe.prototype._markDefs=function(){for(var Y=this.json.nodes||[],X=this.json.skins||[],ce=this.json.meshes||[],ie=0,he=X.length;ie<he;ie++)for(var ge=X[ie].joints,le=0,oe=ge.length;le<oe;le++)Y[ge[le]].isBone=!0;for(var we=0,Le=Y.length;we<Le;we++){var Ae=Y[we];Ae.mesh!==void 0&&(this._addNodeRef(this.meshCache,Ae.mesh),Ae.skin!==void 0&&(ce[Ae.mesh].isSkinnedMesh=!0)),Ae.camera!==void 0&&this._addNodeRef(this.cameraCache,Ae.camera)}},Fe.prototype._addNodeRef=function(Y,X){X!==void 0&&(Y.refs[X]===void 0&&(Y.refs[X]=Y.uses[X]=0),Y.refs[X]++)},Fe.prototype._getNodeRef=function(Y,X,ce){if(Y.refs[X]<=1)return ce;var ie=ce.clone();return ie.name+="_instance_"+Y.uses[X]++,ie},Fe.prototype._invokeOne=function(Y){var X=Object.values(this.plugins);X.push(this);for(var ce=0;ce<X.length;ce++){var ie=Y(X[ce]);if(ie)return ie}},Fe.prototype._invokeAll=function(Y){var X=Object.values(this.plugins);X.unshift(this);for(var ce=[],ie=0;ie<X.length;ie++){var he=Y(X[ie]);he&&ce.push(he)}return ce},Fe.prototype.getDependency=function(Y,X){var ce=Y+":"+X,ie=this.cache.get(ce);if(!ie){switch(Y){case"scene":ie=this.loadScene(X);break;case"node":ie=this.loadNode(X);break;case"mesh":ie=this._invokeOne(function(he){return he.loadMesh&&he.loadMesh(X)});break;case"accessor":ie=this.loadAccessor(X);break;case"bufferView":ie=this._invokeOne(function(he){return he.loadBufferView&&he.loadBufferView(X)});break;case"buffer":ie=this.loadBuffer(X);break;case"material":ie=this._invokeOne(function(he){return he.loadMaterial&&he.loadMaterial(X)});break;case"texture":ie=this._invokeOne(function(he){return he.loadTexture&&he.loadTexture(X)});break;case"skin":ie=this.loadSkin(X);break;case"animation":ie=this.loadAnimation(X);break;case"camera":ie=this.loadCamera(X);break;default:throw new Error("Unknown type: "+Y)}this.cache.add(ce,ie)}return ie},Fe.prototype.getDependencies=function(Y){var X=this.cache.get(Y);if(!X){var ce=this,ie=this.json[Y+(Y==="mesh"?"es":"s")]||[];X=Promise.all(ie.map(function(he,ge){return ce.getDependency(Y,ge)})),this.cache.add(Y,X)}return X},Fe.prototype.loadBuffer=function(Y){var X=this.json.buffers[Y],ce=this.fileLoader;if(X.type&&X.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+X.type+" buffer type is not supported.");if(X.uri===void 0&&Y===0)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var ie=this.options;return new Promise(function(he,ge){ce.load(P(X.uri,ie.path),he,void 0,function(){ge(new Error('THREE.GLTFLoader: Failed to load buffer "'+X.uri+'".'))})})},Fe.prototype.loadBufferView=function(Y){var X=this.json.bufferViews[Y];return this.getDependency("buffer",X.buffer).then(function(ce){var ie=X.byteLength||0,he=X.byteOffset||0;return ce.slice(he,he+ie)})},Fe.prototype.loadAccessor=function(Y){var X=this,ce=this.json,ie=this.json.accessors[Y];if(ie.bufferView===void 0&&ie.sparse===void 0)return Promise.resolve(null);var he=[];return ie.bufferView!==void 0?he.push(this.getDependency("bufferView",ie.bufferView)):he.push(null),ie.sparse!==void 0&&(he.push(this.getDependency("bufferView",ie.sparse.indices.bufferView)),he.push(this.getDependency("bufferView",ie.sparse.values.bufferView))),Promise.all(he).then(function(ge){var le=ge[0],oe=se[ie.type],we=N[ie.componentType],Le=we.BYTES_PER_ELEMENT,Ae=Le*oe,K=ie.byteOffset||0,Q=ie.bufferView!==void 0?ce.bufferViews[ie.bufferView].byteStride:void 0,Ue=ie.normalized===!0,Be,ye;if(Q&&Q!==Ae){var Je=Math.floor(K/Q),it="InterleavedBuffer:"+ie.bufferView+":"+ie.componentType+":"+Je+":"+ie.count,lt=X.cache.get(it);lt||(Be=new we(le,Je*Q,ie.count*Q/Le),lt=new Ms(Be,Q/Le),X.cache.add(it,lt)),ye=new ss(lt,oe,K%Q/Le,Ue)}else le===null?Be=new we(ie.count*oe):Be=new we(le,K,ie.count*oe),ye=new tt(Be,oe,Ue);if(ie.sparse!==void 0){var nt=se.SCALAR,xt=N[ie.sparse.indices.componentType],At=ie.sparse.indices.byteOffset||0,kt=ie.sparse.values.byteOffset||0,gt=new xt(ge[1],At,ie.sparse.count*nt),Rt=new we(ge[2],kt,ie.sparse.count*oe);le!==null&&(ye=new tt(ye.array.slice(),ye.itemSize,ye.normalized));for(var ii=0,En=gt.length;ii<En;ii++){var jr=gt[ii];if(ye.setX(jr,Rt[ii*oe]),oe>=2&&ye.setY(jr,Rt[ii*oe+1]),oe>=3&&ye.setZ(jr,Rt[ii*oe+2]),oe>=4&&ye.setW(jr,Rt[ii*oe+3]),oe>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return ye})},Fe.prototype.loadTexture=function(Y){var X=this,ce=this.json,ie=this.options,he=ce.textures[Y],ge=he.extensions||{},le;ge[t.MSFT_TEXTURE_DDS]?le=ce.images[ge[t.MSFT_TEXTURE_DDS].source]:le=ce.images[he.source];var oe;return le.uri&&(oe=ie.manager.getHandler(le.uri)),oe||(oe=ge[t.MSFT_TEXTURE_DDS]?X.extensions[t.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(Y,le,oe)},Fe.prototype.loadTextureImage=function(Y,X,ce){var ie=this,he=this.json,ge=this.options,le=he.textures[Y],oe=self.URL||self.webkitURL,we=X.uri,Le=!1,Ae=!0;return X.mimeType==="image/jpeg"&&(Ae=!1),X.bufferView!==void 0&&(we=ie.getDependency("bufferView",X.bufferView).then(function(K){if(X.mimeType==="image/png"){var Q=new DataView(K,25,1).getUint8(0,!1);Ae=Q===6||Q===4||Q===3}Le=!0;var Ue=new Blob([K],{type:X.mimeType});return we=oe.createObjectURL(Ue),we})),Promise.resolve(we).then(function(K){return new Promise(function(Q,Ue){var Be=Q;ce.isImageBitmapLoader===!0&&(Be=function(ye){Q(new ka(ye))}),ce.load(P(K,ge.path),Be,void 0,Ue)})}).then(function(K){Le===!0&&oe.revokeObjectURL(we),K.flipY=!1,le.name&&(K.name=le.name),Ae||(K.format=Yi);var Q=he.samplers||{},Ue=Q[le.sampler]||{};return K.magFilter=J[Ue.magFilter]||et,K.minFilter=J[Ue.minFilter]||Rs,K.wrapS=ne[Ue.wrapS]||vi,K.wrapT=ne[Ue.wrapT]||vi,ie.associations.set(K,{type:"textures",index:Y}),K})},Fe.prototype.assignTexture=function(Y,X,ce){var ie=this;return this.getDependency("texture",ce.index).then(function(he){if(ce.texCoord!==void 0&&ce.texCoord!=0&&!(X==="aoMap"&&ce.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+ce.texCoord+" for texture "+X+" not yet supported."),ie.extensions[t.KHR_TEXTURE_TRANSFORM]){var ge=ce.extensions!==void 0?ce.extensions[t.KHR_TEXTURE_TRANSFORM]:void 0;if(ge){var le=ie.associations.get(he);he=ie.extensions[t.KHR_TEXTURE_TRANSFORM].extendTexture(he,ge),ie.associations.set(he,le)}}Y[X]=he})},Fe.prototype.assignFinalMaterial=function(Y){var X=Y.geometry,ce=Y.material,ie=X.attributes.tangent!==void 0,he=X.attributes.color!==void 0,ge=X.attributes.normal===void 0,le=Y.isSkinnedMesh===!0,oe=Object.keys(X.morphAttributes).length>0,we=oe&&X.morphAttributes.normal!==void 0;if(Y.isPoints){var Le="PointsMaterial:"+ce.uuid,Ae=this.cache.get(Le);Ae||(Ae=new ur,Nt.prototype.copy.call(Ae,ce),Ae.color.copy(ce.color),Ae.map=ce.map,Ae.sizeAttenuation=!1,this.cache.add(Le,Ae)),ce=Ae}else if(Y.isLine){var Le="LineBasicMaterial:"+ce.uuid,K=this.cache.get(Le);K||(K=new ri,Nt.prototype.copy.call(K,ce),K.color.copy(ce.color),this.cache.add(Le,K)),ce=K}if(ie||he||ge||le||oe){var Le="ClonedMaterial:"+ce.uuid+":";ce.isGLTFSpecularGlossinessMaterial&&(Le+="specular-glossiness:"),le&&(Le+="skinning:"),ie&&(Le+="vertex-tangents:"),he&&(Le+="vertex-colors:"),ge&&(Le+="flat-shading:"),oe&&(Le+="morph-targets:"),we&&(Le+="morph-normals:");var Q=this.cache.get(Le);Q||(Q=ce.clone(),le&&(Q.skinning=!0),ie&&(Q.vertexTangents=!0),he&&(Q.vertexColors=!0),ge&&(Q.flatShading=!0),oe&&(Q.morphTargets=!0),we&&(Q.morphNormals=!0),this.cache.add(Le,Q),this.associations.set(Q,this.associations.get(ce))),ce=Q}ce.aoMap&&X.attributes.uv2===void 0&&X.attributes.uv!==void 0&&X.setAttribute("uv2",X.attributes.uv),ce.normalScale&&!ie&&(ce.normalScale.y=-ce.normalScale.y),ce.clearcoatNormalScale&&!ie&&(ce.clearcoatNormalScale.y=-ce.clearcoatNormalScale.y),Y.material=ce},Fe.prototype.getMaterialType=function(){return rs},Fe.prototype.loadMaterial=function(Y){var X=this,ce=this.json,ie=this.extensions,he=ce.materials[Y],ge,le={},oe=he.extensions||{},we=[];if(oe[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var Le=ie[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];ge=Le.getMaterialType(),we.push(Le.extendParams(le,he,X))}else if(oe[t.KHR_MATERIALS_UNLIT]){var Ae=ie[t.KHR_MATERIALS_UNLIT];ge=Ae.getMaterialType(),we.push(Ae.extendParams(le,he,X))}else{var K=he.pbrMetallicRoughness||{};if(le.color=new Ee(1,1,1),le.opacity=1,Array.isArray(K.baseColorFactor)){var Q=K.baseColorFactor;le.color.fromArray(Q),le.opacity=Q[3]}K.baseColorTexture!==void 0&&we.push(X.assignTexture(le,"map",K.baseColorTexture)),le.metalness=K.metallicFactor!==void 0?K.metallicFactor:1,le.roughness=K.roughnessFactor!==void 0?K.roughnessFactor:1,K.metallicRoughnessTexture!==void 0&&(we.push(X.assignTexture(le,"metalnessMap",K.metallicRoughnessTexture)),we.push(X.assignTexture(le,"roughnessMap",K.metallicRoughnessTexture))),ge=this._invokeOne(function(Be){return Be.getMaterialType&&Be.getMaterialType(Y)}),we.push(Promise.all(this._invokeAll(function(Be){return Be.extendMaterialParams&&Be.extendMaterialParams(Y,le)})))}he.doubleSided===!0&&(le.side=Xi);var Ue=he.alphaMode||F.OPAQUE;return Ue===F.BLEND?(le.transparent=!0,le.depthWrite=!1):(le.transparent=!1,Ue===F.MASK&&(le.alphaTest=he.alphaCutoff!==void 0?he.alphaCutoff:.5)),he.normalTexture!==void 0&&ge!==Ut&&(we.push(X.assignTexture(le,"normalMap",he.normalTexture)),le.normalScale=new Se(1,1),he.normalTexture.scale!==void 0&&le.normalScale.set(he.normalTexture.scale,he.normalTexture.scale)),he.occlusionTexture!==void 0&&ge!==Ut&&(we.push(X.assignTexture(le,"aoMap",he.occlusionTexture)),he.occlusionTexture.strength!==void 0&&(le.aoMapIntensity=he.occlusionTexture.strength)),he.emissiveFactor!==void 0&&ge!==Ut&&(le.emissive=new Ee().fromArray(he.emissiveFactor)),he.emissiveTexture!==void 0&&ge!==Ut&&we.push(X.assignTexture(le,"emissiveMap",he.emissiveTexture)),Promise.all(we).then(function(){var Be;return ge===y?Be=ie[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(le):Be=new ge(le),he.name&&(Be.name=he.name),Be.map&&(Be.map.encoding=H),Be.emissiveMap&&(Be.emissiveMap.encoding=H),W(Be,he),X.associations.set(Be,{type:"materials",index:Y}),he.extensions&&V(ie,Be,he),Be})},Fe.prototype.createUniqueName=function(Y){for(var X=an.sanitizeNodeName(Y||""),ce=X,ie=1;this.nodeNamesUsed[ce];++ie)ce=X+"_"+ie;return this.nodeNamesUsed[ce]=!0,ce};function at(Y,X,ce){var ie=X.attributes,he=new Wt;if(ie.POSITION!==void 0){var ge=ce.json.accessors[ie.POSITION],le=ge.min,oe=ge.max;if(le!==void 0&&oe!==void 0)he.set(new S(le[0],le[1],le[2]),new S(oe[0],oe[1],oe[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;var we=X.targets;if(we!==void 0){for(var Le=new S,Ae=new S,K=0,Q=we.length;K<Q;K++){var Ue=we[K];if(Ue.POSITION!==void 0){var ge=ce.json.accessors[Ue.POSITION],le=ge.min,oe=ge.max;le!==void 0&&oe!==void 0?(Ae.setX(Math.max(Math.abs(le[0]),Math.abs(oe[0]))),Ae.setY(Math.max(Math.abs(le[1]),Math.abs(oe[1]))),Ae.setZ(Math.max(Math.abs(le[2]),Math.abs(oe[2]))),Le.max(Ae)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}he.expandByVector(Le)}Y.boundingBox=he;var Be=new fi;he.getCenter(Be.center),Be.radius=he.min.distanceTo(he.max)/2,Y.boundingSphere=Be}function bt(Y,X,ce){var ie=X.attributes,he=[];function ge(Le,Ae){return ce.getDependency("accessor",Le).then(function(K){Y.setAttribute(Ae,K)})}for(var le in ie){var oe=E[le]||le.toLowerCase();oe in Y.attributes||he.push(ge(ie[le],oe))}if(X.indices!==void 0&&!Y.index){var we=ce.getDependency("accessor",X.indices).then(function(Le){Y.setIndex(Le)});he.push(we)}return W(Y,X),at(Y,X,ce),Promise.all(he).then(function(){return X.targets!==void 0?fe(Y,X.targets,ce):Y})}function Ie(Y,X){var ce=Y.getIndex();if(ce===null){var ie=[],he=Y.getAttribute("position");if(he!==void 0){for(var ge=0;ge<he.count;ge++)ie.push(ge);Y.setIndex(ie),ce=Y.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Y}var le=ce.count-2,oe=[];if(X===T)for(var ge=1;ge<=le;ge++)oe.push(ce.getX(0)),oe.push(ce.getX(ge)),oe.push(ce.getX(ge+1));else for(var ge=0;ge<le;ge++)ge%2===0?(oe.push(ce.getX(ge)),oe.push(ce.getX(ge+1)),oe.push(ce.getX(ge+2))):(oe.push(ce.getX(ge+2)),oe.push(ce.getX(ge+1)),oe.push(ce.getX(ge)));oe.length/3!==le&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var we=Y.clone();return we.setIndex(oe),we}return Fe.prototype.loadGeometries=function(Y){var X=this,ce=this.extensions,ie=this.primitiveCache;function he(Q){return ce[t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(Q,X).then(function(Ue){return bt(Ue,Q,X)})}for(var ge=[],le=0,oe=Y.length;le<oe;le++){var we=Y[le],Le=pe(we),Ae=ie[Le];if(Ae)ge.push(Ae.promise);else{var K;we.extensions&&we.extensions[t.KHR_DRACO_MESH_COMPRESSION]?K=he(we):K=bt(new wt,we,X),ie[Le]={primitive:we,promise:K},ge.push(K)}}return Promise.all(ge)},Fe.prototype.loadMesh=function(Y){for(var X=this,ce=this.json,ie=this.extensions,he=ce.meshes[Y],ge=he.primitives,le=[],oe=0,we=ge.length;oe<we;oe++){var Le=ge[oe].material===void 0?O(this.cache):this.getDependency("material",ge[oe].material);le.push(Le)}return le.push(X.loadGeometries(ge)),Promise.all(le).then(function(Ae){for(var K=Ae.slice(0,Ae.length-1),Q=Ae[Ae.length-1],Ue=[],Be=0,ye=Q.length;Be<ye;Be++){var Je=Q[Be],it=ge[Be],lt,nt=K[Be];if(it.mode===B.TRIANGLES||it.mode===B.TRIANGLE_STRIP||it.mode===B.TRIANGLE_FAN||it.mode===void 0)lt=he.isSkinnedMesh===!0?new kl(Je,nt):new ot(Je,nt),lt.isSkinnedMesh===!0&&!lt.geometry.attributes.skinWeight.normalized&&lt.normalizeSkinWeights(),it.mode===B.TRIANGLE_STRIP?lt.geometry=Ie(lt.geometry,w):it.mode===B.TRIANGLE_FAN&&(lt.geometry=Ie(lt.geometry,T));else if(it.mode===B.LINES)lt=new Hi(Je,nt);else if(it.mode===B.LINE_STRIP)lt=new wn(Je,nt);else if(it.mode===B.LINE_LOOP)lt=new qu(Je,nt);else if(it.mode===B.POINTS)lt=new ho(Je,nt);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+it.mode);Object.keys(lt.geometry.morphAttributes).length>0&&ve(lt,he),lt.name=X.createUniqueName(he.name||"mesh_"+Y),W(lt,he),it.extensions&&V(ie,lt,it),X.assignFinalMaterial(lt),Ue.push(lt)}if(Ue.length===1)return Ue[0];for(var xt=new xn,Be=0,ye=Ue.length;Be<ye;Be++)xt.add(Ue[Be]);return xt})},Fe.prototype.loadCamera=function(Y){var X,ce=this.json.cameras[Y],ie=ce[ce.type];if(!ie){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return ce.type==="perspective"?X=new mi(rt.radToDeg(ie.yfov),ie.aspectRatio||1,ie.znear||1,ie.zfar||2e6):ce.type==="orthographic"&&(X=new Fn(-ie.xmag,ie.xmag,ie.ymag,-ie.ymag,ie.znear,ie.zfar)),ce.name&&(X.name=this.createUniqueName(ce.name)),W(X,ce),Promise.resolve(X)},Fe.prototype.loadSkin=function(Y){var X=this.json.skins[Y],ce={joints:X.joints};return X.inverseBindMatrices===void 0?Promise.resolve(ce):this.getDependency("accessor",X.inverseBindMatrices).then(function(ie){return ce.inverseBindMatrices=ie,ce})},Fe.prototype.loadAnimation=function(Y){for(var X=this.json,ce=X.animations[Y],ie=[],he=[],ge=[],le=[],oe=[],we=0,Le=ce.channels.length;we<Le;we++){var Ae=ce.channels[we],K=ce.samplers[Ae.sampler],Q=Ae.target,Ue=Q.node!==void 0?Q.node:Q.id,Be=ce.parameters!==void 0?ce.parameters[K.input]:K.input,ye=ce.parameters!==void 0?ce.parameters[K.output]:K.output;ie.push(this.getDependency("node",Ue)),he.push(this.getDependency("accessor",Be)),ge.push(this.getDependency("accessor",ye)),le.push(K),oe.push(Q)}return Promise.all([Promise.all(ie),Promise.all(he),Promise.all(ge),Promise.all(le),Promise.all(oe)]).then(function(Je){for(var it=Je[0],lt=Je[1],nt=Je[2],xt=Je[3],At=Je[4],kt=[],gt=0,Rt=it.length;gt<Rt;gt++){var ii=it[gt],En=lt[gt],jr=nt[gt],fu=xt[gt],rc=At[gt];if(ii!==void 0){ii.updateMatrix(),ii.matrixAutoUpdate=!0;var oc;switch(M[rc.path]){case M.weights:oc=za;break;case M.rotation:oc=ql;break;case M.position:case M.scale:default:oc=Ua;break}var pu=ii.name?ii.name:ii.uuid,Df=fu.interpolation!==void 0?A[fu.interpolation]:Tr,Wr=[];M[rc.path]===M.weights?ii.traverse(function(ae){ae.isMesh===!0&&ae.morphTargetInfluences&&Wr.push(ae.name?ae.name:ae.uuid)}):Wr.push(pu);var qs=jr.array;if(jr.normalized){var ma;if(qs.constructor===Int8Array)ma=1/127;else if(qs.constructor===Uint8Array)ma=1/255;else if(qs.constructor==Int16Array)ma=1/32767;else if(qs.constructor===Uint16Array)ma=1/65535;else throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var mu=new Float32Array(qs.length),Sn=0,ac=qs.length;Sn<ac;Sn++)mu[Sn]=qs[Sn]*ma;qs=mu}for(var Sn=0,ac=Wr.length;Sn<ac;Sn++){var gu=new oc(Wr[Sn]+"."+M[rc.path],En.array,qs,Df);fu.interpolation==="CUBICSPLINE"&&(gu.createInterpolant=function(Ye){return new I(this.times,this.values,this.getValueSize()/3,Ye)},gu.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),kt.push(gu)}}}var Pf=ce.name?ce.name:"animation_"+Y;return new as(Pf,void 0,kt)})},Fe.prototype.loadNode=function(Y){var X=this.json,ce=this.extensions,ie=this,he=X.nodes[Y],ge=he.name?ie.createUniqueName(he.name):"";return function(){var le=[];return he.mesh!==void 0&&le.push(ie.getDependency("mesh",he.mesh).then(function(oe){var we=ie._getNodeRef(ie.meshCache,he.mesh,oe);return he.weights!==void 0&&we.traverse(function(Le){if(Le.isMesh)for(var Ae=0,K=he.weights.length;Ae<K;Ae++)Le.morphTargetInfluences[Ae]=he.weights[Ae]}),we})),he.camera!==void 0&&le.push(ie.getDependency("camera",he.camera).then(function(oe){return ie._getNodeRef(ie.cameraCache,he.camera,oe)})),ie._invokeAll(function(oe){return oe.createNodeAttachment&&oe.createNodeAttachment(Y)}).forEach(function(oe){le.push(oe)}),Promise.all(le)}().then(function(le){var oe;if(he.isBone===!0?oe=new Oa:le.length>1?oe=new xn:le.length===1?oe=le[0]:oe=new qe,oe!==le[0])for(var we=0,Le=le.length;we<Le;we++)oe.add(le[we]);if(he.name&&(oe.userData.name=he.name,oe.name=ge),W(oe,he),he.extensions&&V(ce,oe,he),he.matrix!==void 0){var Ae=new xe;Ae.fromArray(he.matrix),oe.applyMatrix4(Ae)}else he.translation!==void 0&&oe.position.fromArray(he.translation),he.rotation!==void 0&&oe.quaternion.fromArray(he.rotation),he.scale!==void 0&&oe.scale.fromArray(he.scale);return ie.associations.set(oe,{type:"nodes",index:Y}),oe})},Fe.prototype.loadScene=function(){function Y(X,ce,ie,he){var ge=ie.nodes[X];return he.getDependency("node",X).then(function(le){if(ge.skin===void 0)return le;var oe;return he.getDependency("skin",ge.skin).then(function(we){oe=we;for(var Le=[],Ae=0,K=oe.joints.length;Ae<K;Ae++)Le.push(he.getDependency("node",oe.joints[Ae]));return Promise.all(Le)}).then(function(we){return le.traverse(function(Le){if(Le.isMesh){for(var Ae=[],K=[],Q=0,Ue=we.length;Q<Ue;Q++){var Be=we[Q];if(Be){Ae.push(Be);var ye=new xe;oe.inverseBindMatrices!==void 0&&ye.fromArray(oe.inverseBindMatrices.array,Q*16),K.push(ye)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',oe.joints[Q])}Le.bind(new zl(Ae,K),Le.matrixWorld)}}),le})}).then(function(le){ce.add(le);var oe=[];if(ge.children)for(var we=ge.children,Le=0,Ae=we.length;Le<Ae;Le++){var K=we[Le];oe.push(Y(K,le,ie,he))}return Promise.all(oe)})}return function(ce){var ie=this.json,he=this.extensions,ge=this.json.scenes[ce],le=this,oe=new xn;ge.name&&(oe.name=le.createUniqueName(ge.name)),W(oe,ge),ge.extensions&&V(he,oe,ge);for(var we=ge.nodes||[],Le=[],Ae=0,K=we.length;Ae<K;Ae++)Le.push(Y(we[Ae],oe,ie,le));return Promise.all(Le).then(function(){return oe})}}(),i}();const qi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function kg(i){const e=await fetch(i);if(e.ok)return e.json();throw new Error(e.statusText)}async function B_(i){if(!i)throw new Error("No basePath supplied");return await kg(`${i}/profilesList.json`)}async function N_(i,e,t=null,n=!0){if(!i)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await B_(e);let r;if(i.profiles.some(l=>{const c=s[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=s[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await kg(r.profilePath);let a;if(n){let l;if(i.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[i.handedness],!l)throw new Error(`No matching handedness, ${i.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const O_={xAxis:0,yAxis:0,button:0,state:qi.ComponentState.DEFAULT};function k_(i=0,e=0){let t=i,n=e;if(Math.sqrt(i*i+e*e)>1){const o=Math.atan2(e,i);t=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class z_{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===qi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(O_)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=k_(e,t);switch(this.componentProperty){case qi.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case qi.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case qi.ComponentProperty.BUTTON:this.value=this.states.includes(s)?n:0;break;case qi.ComponentProperty.STATE:this.valueNodeProperty===qi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class U_{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const s=new z_(t.visualResponses[n]);this.visualResponses[n]=s}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:qi.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=qi.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=qi.ComponentState.PRESSED:(t.touched||this.values.button>qi.ButtonTouchThreshold)&&(this.values.state=qi.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===qi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>qi.AxisTouchThreshold&&(this.values.state=qi.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===qi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>qi.AxisTouchThreshold&&(this.values.state=qi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class G_{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new U_(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const H_="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",V_="generic-trigger";function vf(){qe.call(this),this.motionController=null,this.envMap=null}vf.prototype=Object.assign(Object.create(qe.prototype),{constructor:vf,setEnvironmentMap:function(i){return this.envMap==i?this:(this.envMap=i,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)},updateMatrixWorld:function(i){qe.prototype.updateMatrixWorld.call(this,i),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(t=>{const{valueNode:n,minNode:s,maxNode:r,value:o,valueNodeProperty:a}=t;n&&(a===qi.VisualResponseProperty.VISIBILITY?n.visible=o:a===qi.VisualResponseProperty.TRANSFORM&&(Ei.slerp(s.quaternion,r.quaternion,n.quaternion,o),n.position.lerpVectors(s.position,r.position,o)))})}))}});function j_(i,e){Object.values(i.components).forEach(t=>{const{type:n,touchPointNodeName:s,visualResponses:r}=t;if(n===qi.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(s),t.touchPointNode){const o=new ah(.001),a=new Ut({color:255}),l=new ot(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:u}=o;if(u===qi.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function zg(i,e){j_(i.motionController,e),i.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=i.envMap,t.material.needsUpdate=!0)}),i.add(e)}var W_=function(){function i(e=null){this.gltfLoader=e,this.path=H_,this._assetCache={},this.gltfLoader||(this.gltfLoader=new F_)}return i.prototype={constructor:i,createControllerModel:function(e){const t=new vf;let n=null;return e.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||N_(r,this.path,V_).then(({profile:o,assetPath:a})=>{t.motionController=new G_(r,o,a);const l=this._assetCache[t.motionController.assetUrl];if(l)n=l.scene.clone(),zg(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,n=c.scene.clone(),zg(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}},i}();let Ug=new mi;function fa(i,e){let t=e.clone();t.updateMatrix(),t.updateMatrixWorld();let n=i.clone().applyMatrix4(t.matrix);return n.z-=.8*t.scale.x,n}function Gg(i,e){if(!e||!e.inputSource||!e.inputSource.gamepad)return null;let n=e.inputSource.gamepad.axes,s=0;n.length===2?s=n[1]:n.length===4&&(s=n[3]),s=Math.sign(s)*(2*s)**2;let r=0;for(let v of viewer.scene.pointclouds){let _=v.boundingBox.min.distanceTo(v.boundingBox.max);r=Math.max(r,_)}let o=Math.pow(r,.5)/2,a=i.node.scale.x,l=viewer.getMoveSpeed(),c=o*s*l**.5/a,u=new Ei().setFromEuler(e.rotation),h=new S(0,0,-1);h.applyQuaternion(u);let d=h.clone().multiplyScalar(c),f=i.toScene(e.position);return d=i.toScene(e.position.clone().add(d)).clone().sub(f),d}class $_{constructor(e){this.moveFactor=1,this.dbgLabel=null}start(e){this.dbgLabel||(this.dbgLabel=new Potree.TextSprite("abc"),this.dbgLabel.name="debug label",e.viewer.sceneVR.add(this.dbgLabel),this.dbgLabel.visible=!1)}end(){}update(e,t){let n=e.cPrimary,s=e.cSecondary,r=Gg(e,n),o=Gg(e,s);r||(r=new S),o||(o=new S);let a=r.clone().add(o);a.multiplyScalar(-t*this.moveFactor),e.node.position.add(a);let l=e.node.scale.x,c=e.viewer.renderer.xr.getCamera(Ug),u=c.getWorldPosition(new S),h=c.getWorldDirection(new S),d=u.clone().add(h.multiplyScalar(l)),f=fa(u,e.node),m=fa(u.clone().add(h),e.node).sub(f);m.normalize().multiplyScalar(l);let v=f.clone().add(m);e.viewer.scene.view.setView(f,v),Potree.debug.message&&(this.dbgLabel.visible=!0,this.dbgLabel.setText(Potree.debug.message),this.dbgLabel.scale.set(.1,.1,.1),this.dbgLabel.position.copy(n.position))}}class q_{constructor(){this.controller=null,this.startPos=null,this.debugLine=null}start(e){this.controller=e.triggered.values().next().value,this.startPos=e.node.position.clone()}end(e){}update(e,t){let n=this.controller.start.position,s=this.controller.position;n=e.toScene(n),s=e.toScene(s);let r=s.clone().sub(n);r.set(-r.x,-r.y,-r.z);let o=new S().addVectors(this.startPos,r);e.node.position.copy(o)}}class X_{constructor(){this.line=null,this.startState=null}start(e){this.line||(this.line=Potree.Utils.debugLine(e.viewer.sceneVR,new S(0,0,0),new S(0,0,0),16776960),this.dbgLabel=new Potree.TextSprite("abc"),this.dbgLabel.scale.set(.1,.1,.1),e.viewer.sceneVR.add(this.dbgLabel)),this.line.node.visible=!0,this.startState=e.node.clone()}end(e){this.line.node.visible=!1,this.dbgLabel.visible=!1}update(e,t){let n=e.cPrimary.start.position.clone(),s=e.cSecondary.start.position.clone(),r=n.clone().add(s).multiplyScalar(.5),o=s.clone().sub(n),a=e.cPrimary.position.clone(),l=e.cSecondary.position.clone(),c=a.clone().add(l).multiplyScalar(.5),u=l.clone().sub(a),h=o.length(),d=u.length(),f=new Se(o.x,o.z).angle(),v=new Se(u.x,u.z).angle()-f,_=d/h,y=this.startState.clone();y.updateMatrix(),y.matrixAutoUpdate=!1;let x=new xe().makeTranslation(...fa(r,this.startState).multiplyScalar(-1).toArray()),R=new xe().makeTranslation(...fa(r,this.startState).toArray()),I=new xe().makeRotationZ(v),B=new xe().makeScale(1/_,1/_,1/_);y.applyMatrix4(x),y.applyMatrix4(I),y.applyMatrix4(B),y.applyMatrix4(R);let N=fa(r,this.startState),J=fa(c,y),ne=N.clone().sub(J),se=new xe().makeTranslation(...ne.toArray());y.applyMatrix4(se),y.matrix.decompose(y.position,y.quaternion,y.scale),e.node.position.copy(y.position),e.node.quaternion.copy(y.quaternion),e.node.scale.copy(y.scale),e.node.updateMatrix();{let E=e.node.scale.x,M=e.viewer.renderer.xr.getCamera(Ug),A=M.getWorldPosition(new S),F=M.getWorldDirection(new S),P=A.clone().add(F.multiplyScalar(E)),O=fa(A,this.startState),V=fa(A.clone().add(F),this.startState).sub(O);V.normalize().multiplyScalar(E);let W=O.clone().add(V);e.viewer.scene.view.setView(O,W),e.viewer.setMoveSpeed(E)}{this.line.set(a,l);let E=e.node.scale.x;this.dbgLabel.visible=!0,this.dbgLabel.position.copy(c),this.dbgLabel.setText(`scale: 1 : ${E.toFixed(2)}`),this.dbgLabel.scale.set(.05,.05,.05)}}}class Hg extends Ne{constructor(e){super(e),this.viewer=e,e.addEventListener("vr_start",this.onStart.bind(this)),e.addEventListener("vr_end",this.onEnd.bind(this)),this.node=new qe,this.node.up.set(0,0,1),this.triggered=new Set;let t=e.renderer.xr;{const o=new yo(16777215,5,0,1);o.position.set(0,2,0),this.viewer.sceneVR.add(o)}this.menu=null;const n=new W_;let s=new Li(1,32,32),r=new Ki;{let o=t.getController(0),a=t.getControllerGrip(0);a.name="grip(0)",a.add(n.createControllerModel(a)),this.viewer.sceneVR.add(a);let l=new ot(s,r);l.scale.set(.005,.005,.005),o.add(l),o.visible=!0,this.viewer.sceneVR.add(o);{let c=new _n;c.setPositions([0,0,-.15,0,0,.05]);let u=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3)});const h=new Bn(c,u);o.add(h)}o.addEventListener("connected",function(c){const u=c.data;o.inputSource=u}),o.addEventListener("selectstart",()=>{this.onTriggerStart(o)}),o.addEventListener("selectend",()=>{this.onTriggerEnd(o)}),this.cPrimary=o}{let o=t.getController(1),a=t.getControllerGrip(1),l=n.createControllerModel(a);a.add(l),this.viewer.sceneVR.add(a);let c=new ot(s,r);c.scale.set(.005,.005,.005),o.add(c),o.visible=!0,this.viewer.sceneVR.add(o);{let u=new _n;u.setPositions([0,0,-.15,0,0,.05]);let h=new dn({color:16711680,linewidth:2,resolution:new Se(1e3,1e3)});const d=new Bn(u,h);o.add(d)}o.addEventListener("connected",u=>{const h=u.data;o.inputSource=h,this.initMenu(o)}),o.addEventListener("selectstart",()=>{this.onTriggerStart(o)}),o.addEventListener("selectend",()=>{this.onTriggerEnd(o)}),this.cSecondary=o}this.mode_fly=new $_,this.mode_translate=new q_,this.mode_rotScale=new X_,this.setMode(this.mode_fly)}createSlider(e,t,n){let s=new Li(1,8,8),r=new Ku(1,1,1,8),o=new Ut({color:16711680}),a=new Ut({color:16729156}),l=new Ki,c=new qe("slider"),u=new Potree.TextSprite(`${e}: 0`),h=new ot(s,o),d=new ot(s,o),f=new ot(s,l),m=new ot(r,a);return u.scale.set(.2,.2,.2),u.position.set(0,.35,0),h.scale.set(.02,.02,.02),h.position.set(0,.25,0),d.scale.set(.02,.02,.02),d.position.set(0,-.25,0),f.scale.set(.02,.02,.02),f.position.set(0,0,0),m.scale.set(.005,.5,.005),c.add(u),c.add(h),c.add(d),c.add(f),c.add(m),c}createInfo(){let e=new jn().load(`${Potree.resourcePath}/images/vr_controller_help.jpg`),t=new Ll(1,1,1,1),n=new Ut({map:e});return new ot(t,n)}initMenu(e){if(this.menu)return;let t=new qe("vr menu");this.menu=t,window.vrMenu=t}toScene(e){let n=this.getCamera().matrixWorld;return e.clone().applyMatrix4(n)}toVR(e){let n=this.getCamera().matrixWorld.clone();return n.invert(),e.clone().applyMatrix4(n)}setMode(e){if(this.mode!==e){this.mode&&this.mode.end(this);for(let t of[this.cPrimary,this.cSecondary]){let n={position:t.position.clone(),rotation:t.rotation.clone()};t.start=n}this.mode=e,this.mode.start(this)}}onTriggerStart(e){this.triggered.add(e),this.triggered.size===0?this.setMode(this.mode_fly):this.triggered.size===1?this.setMode(this.mode_translate):this.triggered.size===2&&this.setMode(this.mode_rotScale)}onTriggerEnd(e){this.triggered.delete(e),this.triggered.size===0?this.setMode(this.mode_fly):this.triggered.size===1?this.setMode(this.mode_translate):this.triggered.size===2&&this.setMode(this.mode_rotScale)}onStart(){let e=this.viewer.scene.view.position.clone(),t=this.viewer.scene.view.direction;t.multiplyScalar(-1);let n=e.clone().add(t);n.z=e.z;let s=this.viewer.getMoveSpeed();this.node.position.copy(e),this.node.lookAt(n),this.node.scale.set(s,s,s),this.node.updateMatrix(),this.node.updateMatrixWorld()}onEnd(){}setScene(e){this.scene=e}getCamera(){let e=this.viewer.scene.getActiveCamera(),t=new mi,n=this.viewer.getMoveSpeed();return t.near=.1,t.far=1e3,t.up.set(0,0,1),t.lookAt(new S(0,-1,0)),t.updateMatrix(),t.updateMatrixWorld(),t.position.copy(this.node.position),t.rotation.copy(this.node.rotation),t.scale.set(n,n,n),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,t.parent=t,t}update(e){this.mode.update(this,e)}}class yf{constructor(){this.onStartListeners=[],this.onEndListeners=[],this.element=null}onStart(e){this.onStartListeners.push(e)}onEnd(e){this.onEndListeners.push(e)}static async createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=new yf,s=document.createElement("button");n.element=s;function r(){n.element.innerHTML=`
				<div style="font-size: 0.5em;">ENTER</div>
				<div style="font-weight: bold;">VR</div>
			`}function o(){n.element.innerHTML=`
				<div style="font-size: 0.5em;">EXIT</div>
				<div style="font-weight: bold;">VR</div>
			`}function a(){let c=null;function u(d){d.addEventListener("end",h);for(let f of n.onStartListeners)f();e.xr.setSession(d),o(),c=d}function h(){c.removeEventListener("end",h);for(let d of n.onEndListeners)d();r(),c=null}n.element.style.display="",n.element.style.cursor="pointer",r(),n.element.onmouseenter=function(){n.element.style.opacity="1.0"},n.element.onmouseleave=function(){n.element.style.opacity="0.7"},n.element.onclick=function(){if(c===null){const d={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",d).then(u)}else c.end()}}function l(c){c.style.position="absolute",c.style.bottom="20px",c.style.padding="12px 6px",c.style.border="1px solid #fff",c.style.borderRadius="4px",c.style.background="rgba(0,0,0,0.1)",c.style.color="#fff",c.style.font="normal 13px sans-serif",c.style.textAlign="center",c.style.opacity="0.7",c.style.outline="none",c.style.zIndex="999"}return"xr"in navigator?(n.element.id="VRButton",n.element.style.display="none",l(n.element),await navigator.xr.isSessionSupported("immersive-vr")?(a(),n):null):(window.isSecureContext===!1?console.log("WEBXR NEEDS HTTPS"):console.log("WEBXR not available"),null)}}class Y_ extends Ne{constructor(e,t={}){super(),this.renderType=!0,this.renderArea=e,this.guiLoaded=!1,this.guiLoadTasks=[],this.onVrListeners=[],this.messages=[],this.elMessages=$(`
		<div id="message_listing" 
			style="position: absolute; z-index: 1000; left: 10px; bottom: 10px">
		</div>`),$(e).append(this.elMessages);try{{if($(e).find("#potree_map").length===0){let s=$(`
					<div id="potree_map" class="mapBox" style="position: absolute; left: 50px; top: 50px; width: 400px; height: 400px; display: none">
						<div id="potree_map_header" style="position: absolute; width: 100%; height: 25px; top: 0px; background-color: rgba(0,0,0,0.5); z-index: 1000; border-top-left-radius: 3px; border-top-right-radius: 3px;">
						</div>
						<div id="potree_map_content" class="map" style="position: absolute; z-index: 100; top: 25px; width: 100%; height: calc(100% - 25px); border: 2px solid rgba(0,0,0,0.5); box-sizing: border-box;"></div>
					</div>
				`);$(e).append(s)}if($(e).find("#potree_description").length===0){let s=$('<div id="potree_description" class="potree_info_text"></div>');$(e).append(s)}if($(e).find("#potree_annotations").length===0){let s=$(`
					<div id="potree_annotation_container" 
						style="position: absolute; z-index: 100000; width: 100%; height: 100%; pointer-events: none;"></div>`);$(e).append(s)}if($(e).find("#potree_quick_buttons").length===0){let s=$(`
					<div id="potree_quick_buttons" class="quick_buttons_container" style="">
					</div>
				`);$(e).append(s)}}this.pointCloudLoadedCallback=t.onPointCloudLoaded||function(){},this.server=null,this.fov=60,this.isFlipYZ=!1,this.useDEMCollisions=!1,this.generateDEM=!1,this.minNodeSize=30,this.edlStrength=1,this.edlRadius=1.4,this.edlOpacity=1,this.useEDL=!1,this.description="",this.classifications=Ah.DEFAULT,this.moveSpeed=10,this.lengthUnit=Yn.METER,this.lengthUnitDisplay=Yn.METER,this.showBoundingBox=!1,this.showAnnotations=!0,this.freeze=!1,this.clipTask=fr.HIGHLIGHT,this.clipMethod=oa.INSIDE_ANY,this.elevationGradientRepeat=pr.CLAMP,this.filterReturnNumberRange=[0,7],this.filterNumberOfReturnsRange=[0,7],this.filterGPSTimeRange=[-1/0,1/0],this.filterPointSourceIDRange=[0,65535],this.potreeRenderer=null,this.edlRenderer=null,this.labelRenderer=null,this.renderer=null,this.pRenderer=null,this.scene=null,this.sceneVR=null,this.overlay=null,this.overlayCamera=null,this.inputHandler=null,this.controls=null,this.clippingTool=null,this.transformationTool=null,this.navigationCube=null,this.compass=null,this.skybox=null,this.clock=new lm,this.background=null,this.initThree(),t.noDragAndDrop||this.initDragAndDrop(),typeof Stats<"u"&&(this.stats=new Stats,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)),this.renderer.domElement.addEventListener("webglcontextlost",r=>{console.log(r),this.postMessage("WebGL context lost. \u2639");let a=this.renderer.getContext().getError();console.log(a)},!1),this.overlay=new Si,this.overlayCamera=new Fn(0,1,1,0,-1e3,1e3),this.pRenderer=new tf(this.renderer);{let s=2.5,r=10,o=90;this.shadowTestCam=new mi(90,1,s,r),this.shadowTestCam.position.set(3.5,-2.8,8.561),this.shadowTestCam.lookAt(new S(0,0,4.87))}let n=new Mg(this.renderer);this.sceneVR=new Si,this.setScene(n);{this.inputHandler=new L_(this),this.inputHandler.setScene(this.scene),this.clippingTool=new cg(this),this.transformationTool=new mg(this),this.navigationCube=new R_(this),this.navigationCube.visible=!1,this.compass=new vg(this),this.createControls(),this.clippingTool.setScene(this.scene);let s=o=>{if(this.scene.pointclouds.length===1){let a=o.pointcloud.boundingBox.getSize(new S).length();a=a/5,this.setMoveSpeed(a)}},r=o=>{this.inputHandler.deselect(o.volume)};this.addEventListener("scene_changed",o=>{this.inputHandler.setScene(o.scene),this.clippingTool.setScene(this.scene),o.scene.hasEventListener("pointcloud_added",s)||o.scene.addEventListener("pointcloud_added",s),o.scene.hasEventListener("volume_removed",s)||o.scene.addEventListener("volume_removed",r)}),this.scene.addEventListener("volume_removed",r),this.scene.addEventListener("pointcloud_added",s)}this.setFOV(60),this.setEDLEnabled(!1),this.setEDLRadius(1.4),this.setEDLStrength(.4),this.setEDLOpacity(1),this.setClipTask(fr.HIGHLIGHT),this.setClipMethod(oa.INSIDE_ANY),this.setPointBudget(1*1e3*1e3),this.setShowBoundingBox(!1),this.setFreeze(!1),this.setControls(this.orbitControls),this.setBackground("gradient"),this.scaleFactor=1,this.loadSettingsFromURL(),this.renderer.setAnimationLoop(this.loop.bind(this)),this.loadGUI=this.loadGUI.bind(this),this.annotationTool=new P_(this),this.measuringTool=new ug(this),this.profileTool=new fg(this),this.volumeTool=new gg(this)}catch(n){this.onCrash(n)}}onCrash(e){if($(this.renderArea).empty(),$(this.renderArea).find("#potree_failpage").length===0){let t=$(`
			<div id="#potree_failpage" class="potree_failpage"> 
				
				<h1>Potree Encountered An Error </h1>

				<p>
				This may happen if your browser or graphics card is not supported.
				<br>
				We recommend to use 
				<a href="https://www.google.com/chrome/browser" target="_blank" style="color:initial">Chrome</a>
				or 
				<a href="https://www.mozilla.org/" target="_blank">Firefox</a>.
				</p>

				<p>
				Please also visit <a href="http://webglreport.com/" target="_blank">webglreport.com</a> and 
				check whether your system supports WebGL.
				</p>
				<p>
				If you are already using one of the recommended browsers and WebGL is enabled, 
				consider filing an issue report at <a href="https://github.com/potree/potree/issues" target="_blank">github</a>,<br>
				including your operating system, graphics card, browser and browser version, as well as the 
				error message below.<br>
				Please do not report errors on unsupported browsers.
				</p>

				<pre id="potree_error_console" style="width: 100%; height: 100%"></pre>
				
			</div>`);t.find("#potree_error_console").html(e.stack),$(this.renderArea).append(t)}throw e}setScene(e){if(e===this.scene)return;let t=this.scene;this.scene=e,this.dispatchEvent({type:"scene_changed",oldScene:t,scene:e}),$(".annotation").detach(),this.scene.annotations.traverse(n=>{this.renderArea.appendChild(n.domElement[0])}),this.onAnnotationAdded||(this.onAnnotationAdded=n=>{n.annotation.traverse(s=>{$("#potree_annotation_container").append(s.domElement),s.scene=this.scene})}),t&&t.annotations.removeEventListener("annotation_added",this.onAnnotationAdded),this.scene.annotations.addEventListener("annotation_added",this.onAnnotationAdded)}setControls(e){e!==this.controls&&(this.controls&&(this.controls.enabled=!1,this.inputHandler.removeInputListener(this.controls)),this.controls=e,this.controls.enabled=!0,this.inputHandler.addInputListener(this.controls))}getControls(){return this.renderer.xr.isPresenting?this.vrControls:this.controls}getMinNodeSize(){return this.minNodeSize}setMinNodeSize(e){this.minNodeSize!==e&&(this.minNodeSize=e,this.dispatchEvent({type:"minnodesize_changed",viewer:this}))}getBackground(){return this.background}setBackground(e){this.background!==e&&(e==="skybox"&&(this.skybox=He.loadSkybox(new URL(Potree.resourcePath+"/textures/skybox2/").href)),this.background=e,this.dispatchEvent({type:"background_changed",viewer:this}))}setDescription(e){this.description=e,$("#potree_description").html(e)}getDescription(){return this.description}setShowBoundingBox(e){this.showBoundingBox!==e&&(this.showBoundingBox=e,this.dispatchEvent({type:"show_boundingbox_changed",viewer:this}))}getShowBoundingBox(){return this.showBoundingBox}setMoveSpeed(e){this.moveSpeed!==e&&(this.moveSpeed=e,this.dispatchEvent({type:"move_speed_changed",viewer:this,speed:e}))}getMoveSpeed(){return this.moveSpeed}setWeightClassification(e){for(let t=0;t<this.scene.pointclouds.length;t++)this.scene.pointclouds[t].material.weightClassification=e,this.dispatchEvent({type:"attribute_weights_changed"+t,viewer:this})}setFreeze(e){e=!!e,this.freeze!==e&&(this.freeze=e,this.dispatchEvent({type:"freeze_changed",viewer:this}))}getFreeze(){return this.freeze}getClipTask(){return this.clipTask}getClipMethod(){return this.clipMethod}setClipTask(e){this.clipTask!==e&&(this.clipTask=e,this.dispatchEvent({type:"cliptask_changed",viewer:this}))}setClipMethod(e){this.clipMethod!==e&&(this.clipMethod=e,this.dispatchEvent({type:"clipmethod_changed",viewer:this}))}setElevationGradientRepeat(e){this.elevationGradientRepeat!==e&&(this.elevationGradientRepeat=e,this.dispatchEvent({type:"elevation_gradient_repeat_changed",viewer:this}))}setPointBudget(e){Potree.pointBudget!==e&&(Potree.pointBudget=parseInt(e),this.dispatchEvent({type:"point_budget_changed",viewer:this}))}getPointBudget(){return Potree.pointBudget}setShowAnnotations(e){this.showAnnotations!==e&&(this.showAnnotations=e,this.dispatchEvent({type:"show_annotations_changed",viewer:this}))}getShowAnnotations(){return this.showAnnotations}setDEMCollisionsEnabled(e){this.useDEMCollisions!==e&&(this.useDEMCollisions=e,this.dispatchEvent({type:"use_demcollisions_changed",viewer:this}))}getDEMCollisionsEnabled(){return this.useDEMCollisions}setEDLEnabled(e){e=!!e&&Jd.SHADER_EDL.isSupported(),this.useEDL!==e&&(this.useEDL=e,this.dispatchEvent({type:"use_edl_changed",viewer:this}))}getEDLEnabled(){return this.useEDL}setEDLRadius(e){this.edlRadius!==e&&(this.edlRadius=e,this.dispatchEvent({type:"edl_radius_changed",viewer:this}))}getEDLRadius(){return this.edlRadius}setEDLStrength(e){this.edlStrength!==e&&(this.edlStrength=e,this.dispatchEvent({type:"edl_strength_changed",viewer:this}))}getEDLStrength(){return this.edlStrength}setEDLOpacity(e){this.edlOpacity!==e&&(this.edlOpacity=e,this.dispatchEvent({type:"edl_opacity_changed",viewer:this}))}getEDLOpacity(){return this.edlOpacity}setFOV(e){this.fov!==e&&(this.fov=e,this.dispatchEvent({type:"fov_changed",viewer:this}))}getFOV(){return this.fov}disableAnnotations(){this.scene.annotations.traverse(e=>{e.domElement.css("pointer-events","none")})}enableAnnotations(){this.scene.annotations.traverse(e=>{e.domElement.css("pointer-events","auto")})}setClassifications(e){this.classifications=e,this.dispatchEvent({type:"classifications_changed",viewer:this})}setClassificationVisibility(e,t){this.classifications[e]?this.classifications[e].visible!==t&&(this.classifications[e].visible=t,this.dispatchEvent({type:"classification_visibility_changed",viewer:this})):(this.classifications[e]={visible:t,name:"no name"},this.dispatchEvent({type:"classification_visibility_changed",viewer:this}))}toggleAllClassificationsVisibility(){let e=0,t=0;for(const r of Object.keys(this.classifications))this.classifications[r].visible&&e++,t++;let n=!0;e===t&&(n=!1);let s=!1;for(const r of Object.keys(this.classifications))this.classifications[r].visible!==n&&(this.classifications[r].visible=n,s=!0);s&&this.dispatchEvent({type:"classification_visibility_changed",viewer:this})}setFilterReturnNumberRange(e,t){this.filterReturnNumberRange=[e,t],this.dispatchEvent({type:"filter_return_number_range_changed",viewer:this})}setFilterNumberOfReturnsRange(e,t){this.filterNumberOfReturnsRange=[e,t],this.dispatchEvent({type:"filter_number_of_returns_range_changed",viewer:this})}setFilterGPSTimeRange(e,t){this.filterGPSTimeRange=[e,t],this.dispatchEvent({type:"filter_gps_time_range_changed",viewer:this})}setFilterPointSourceIDRange(e,t){this.filterPointSourceIDRange=[e,t],this.dispatchEvent({type:"filter_point_source_id_range_changed",viewer:this})}setLengthUnit(e){switch(e){case"m":this.lengthUnit=Yn.METER,this.lengthUnitDisplay=Yn.METER;break;case"ft":this.lengthUnit=Yn.FEET,this.lengthUnitDisplay=Yn.FEET;break;case"in":this.lengthUnit=Yn.INCH,this.lengthUnitDisplay=Yn.INCH;break}this.dispatchEvent({type:"length_unit_changed",viewer:this,value:e})}setLengthUnitAndDisplayUnit(e,t){switch(e){case"m":this.lengthUnit=Yn.METER;break;case"ft":this.lengthUnit=Yn.FEET;break;case"in":this.lengthUnit=Yn.INCH;break}switch(t){case"m":this.lengthUnitDisplay=Yn.METER;break;case"ft":this.lengthUnitDisplay=Yn.FEET;break;case"in":this.lengthUnitDisplay=Yn.INCH;break}this.dispatchEvent({type:"length_unit_changed",viewer:this,value:e})}zoomTo(e,t,n=0){let s=this.scene.view,r=this.scene.cameraP.clone();r.rotation.copy(this.scene.cameraP.rotation),r.rotation.order="ZXY",r.rotation.x=Math.PI/2+s.pitch,r.rotation.z=s.yaw,r.updateMatrix(),r.updateMatrixWorld(),r.zoomTo(e,t);let o;e.boundingSphere?o=e.boundingSphere:e.geometry&&e.geometry.boundingSphere?o=e.geometry.boundingSphere:o=e.boundingBox.getBoundingSphere(new fi),o=o.clone().applyMatrix4(e.matrixWorld);let a=s.position.clone(),l=r.position.clone(),c=s.getPivot(),u=o.center,h=s.radius,d=l.distanceTo(u),f=TWEEN.Easing.Quartic.Out;{let m=a.clone(),v=new TWEEN.Tween(m).to(l,n);v.easing(f),v.onUpdate(()=>{s.position.copy(m)}),v.start()}{let m=c.clone(),v=new TWEEN.Tween(m).to(u,n);v.easing(f),v.onUpdate(()=>{s.lookAt(m)}),v.onComplete(()=>{s.lookAt(m),this.dispatchEvent({type:"focusing_finished",target:this})}),this.dispatchEvent({type:"focusing_started",target:this}),v.start()}}moveToGpsTimeVicinity(e){const t=Potree.Utils.findClosestGpsTime(e,viewer),n=t.node.pointcloud.deepestNodeAt(t.position).getBoundingBox(),s=n.min.distanceTo(n.max),o=this.scene.getActiveCamera().getWorldDirection(new S).multiplyScalar(s),a=t.position.clone().sub(o);this.scene.view.position.copy(a),this.scene.view.lookAt(t.position)}showAbout(){$(function(){$("#about-panel").dialog()})}getBoundingBox(e){return this.scene.getBoundingBox(e)}getGpsTimeExtent(){const e=[1/0,-1/0];for(const t of this.scene.pointclouds){const s=t.pcoGeometry.pointAttributes.attributes.find(r=>r.name==="gps-time");s&&(e[0]=Math.min(e[0],s.range[0]),e[1]=Math.max(e[1],s.range[1]))}return e}fitToScreen(e=1,t=0){let n=this.getBoundingBox(this.scene.pointclouds),s=new qe;s.boundingBox=n,this.zoomTo(s,e,t),this.controls.stop()}toggleNavigationCube(){this.navigationCube.visible=!this.navigationCube.visible}setView(e){if(e)switch(e){case"F":this.setFrontView();break;case"B":this.setBackView();break;case"L":this.setLeftView();break;case"R":this.setRightView();break;case"U":this.setTopView();break;case"D":this.setBottomView();break}}setTopView(){this.scene.view.yaw=0,this.scene.view.pitch=-Math.PI/2,this.fitToScreen()}setBottomView(){this.scene.view.yaw=-Math.PI,this.scene.view.pitch=Math.PI/2,this.fitToScreen()}setFrontView(){this.scene.view.yaw=0,this.scene.view.pitch=0,this.fitToScreen()}setBackView(){this.scene.view.yaw=Math.PI,this.scene.view.pitch=0,this.fitToScreen()}setLeftView(){this.scene.view.yaw=-Math.PI/2,this.scene.view.pitch=0,this.fitToScreen()}setRightView(){this.scene.view.yaw=Math.PI/2,this.scene.view.pitch=0,this.fitToScreen()}flipYZ(){this.isFlipYZ=!this.isFlipYZ,console.log("TODO")}setCameraMode(e){this.scene.cameraMode=e;for(let t of this.scene.pointclouds)t.material.useOrthographicCamera=e==cs.ORTHOGRAPHIC}getProjection(){const e=this.scene.pointclouds[0];return e?e.projection:null}async loadProject(e){const n=await(await fetch(e)).text(),s=gf.parse(n);s.type==="Potree"&&Potree.loadProject(viewer,s)}saveProject(){return Potree.saveProject(this)}loadSettingsFromURL(){if(He.getParameterByName("pointSize")&&this.setPointSize(parseFloat(He.getParameterByName("pointSize"))),He.getParameterByName("FOV")&&this.setFOV(parseFloat(He.getParameterByName("FOV"))),He.getParameterByName("opacity")&&this.setOpacity(parseFloat(He.getParameterByName("opacity"))),He.getParameterByName("edlEnabled")){let e=He.getParameterByName("edlEnabled")==="true";this.setEDLEnabled(e)}if(He.getParameterByName("edlRadius")&&this.setEDLRadius(parseFloat(He.getParameterByName("edlRadius"))),He.getParameterByName("edlStrength")&&this.setEDLStrength(parseFloat(He.getParameterByName("edlStrength"))),He.getParameterByName("pointBudget")&&this.setPointBudget(parseFloat(He.getParameterByName("pointBudget"))),He.getParameterByName("showBoundingBox")&&(He.getParameterByName("showBoundingBox")==="true"?this.setShowBoundingBox(!0):this.setShowBoundingBox(!1)),He.getParameterByName("material")){let e=He.getParameterByName("material");this.setMaterial(e)}if(He.getParameterByName("pointSizing")){let e=He.getParameterByName("pointSizing");this.setPointSizing(e)}if(He.getParameterByName("quality")){let e=He.getParameterByName("quality");this.setQuality(e)}if(He.getParameterByName("position")){let e=He.getParameterByName("position");e=e.replace("[","").replace("]","");let t=e.split(";"),n=parseFloat(t[0]),s=parseFloat(t[1]),r=parseFloat(t[2]);this.scene.view.position.set(n,s,r)}if(He.getParameterByName("target")){let e=He.getParameterByName("target");e=e.replace("[","").replace("]","");let t=e.split(";"),n=parseFloat(t[0]),s=parseFloat(t[1]),r=parseFloat(t[2]);this.scene.view.lookAt(new S(n,s,r))}if(He.getParameterByName("background")){let e=He.getParameterByName("background");this.setBackground(e)}}createControls(){this.fpControls=new Bg(this),this.fpControls.enabled=!1,this.fpControls.customTypes="fp",this.fpControls.addEventListener("start",this.disableAnnotations.bind(this)),this.fpControls.addEventListener("end",this.enableAnnotations.bind(this)),this.plControls=new I_(this),this.plControls.enabled=!1,this.plControls.customTypes="pl",this.plControls.addEventListener("start",this.disableAnnotations.bind(this)),this.plControls.addEventListener("end",this.enableAnnotations.bind(this)),this.orbitControls=new Fg(this),this.orbitControls.enabled=!1,this.orbitControls.customTypes="orbit",this.orbitControls.addEventListener("start",this.disableAnnotations.bind(this)),this.orbitControls.addEventListener("end",this.enableAnnotations.bind(this)),this.earthControls=new Ng(this),this.earthControls.enabled=!1,this.earthControls.customTypes="earth",this.earthControls.addEventListener("start",this.disableAnnotations.bind(this)),this.earthControls.addEventListener("end",this.enableAnnotations.bind(this)),this.deviceControls=new Og(this),this.deviceControls.enabled=!1,this.deviceControls.customTypes="device",this.deviceControls.addEventListener("start",this.disableAnnotations.bind(this)),this.deviceControls.addEventListener("end",this.enableAnnotations.bind(this)),this.vrControls=new Hg(this),this.vrControls.enabled=!1,this.vrControls.customTypes="vr",this.vrControls.addEventListener("start",this.disableAnnotations.bind(this)),this.vrControls.addEventListener("end",this.enableAnnotations.bind(this))}toggleSidebar(){let e=$("#potree_render_area");e.css("left")!=="0px"?e.css("left","0px"):e.css("left","300px")}toggleMap(){this.mapView&&this.mapView.toggle()}onGUILoaded(e){this.guiLoaded?e():this.guiLoadTasks.push(e)}promiseGuiLoaded(){return new Promise(e=>{this.guiLoaded?e():this.guiLoadTasks.push(e)})}loadGUI(e){e&&this.onGUILoaded(e);let t=this,n=$("#potree_sidebar_container");return n.load(new URL(Potree.scriptPath+"/sidebar.html").href,()=>{n.css("width","300px"),n.css("height","100%");let s=document.createElement("img");s.src=new URL(Potree.resourcePath+"/icons/menu_button.svg").href,s.onclick=this.toggleSidebar,s.classList.add("potree_menu_toggle");let r=document.createElement("img");r.src=new URL(Potree.resourcePath+"/icons/map_icon.png").href,r.style.display="none",r.onclick=a=>{this.toggleMap()},r.id="potree_map_toggle";let o=$("#potree_quick_buttons").get(0);o.append(s),o.append(r),yf.createButton(this.renderer).then(a=>{if(a==null){console.log("VR not supported or active.");return}this.renderer.xr.enabled=!0;let l=a.element;l.style.position="",l.style.bottom="",l.style.left="",l.style.margin="4px",l.style.fontSize="100%",l.style.width="2.5em",l.style.height="2.5em",l.style.padding="0",l.style.textShadow="black 2px 2px 2px",l.style.display="block",o.append(l),a.onStart(()=>{this.dispatchEvent({type:"vr_start"})}),a.onEnd(()=>{this.dispatchEvent({type:"vr_end"})})}),this.mapView=new q1(this),this.mapView.init(),i18n.init({lng:"en",resGetPath:Potree.resourcePath+"/lang/__lng__/__ns__.json",preload:["en","fr","de","jp","se","es","zh","it","ca"],getAsync:!0,debug:!1},function(a){$("body").i18n()}),$(()=>{let a=new D_(this);a.init(),this.sidebar=a;let l=$("<div>").load(new URL(Potree.scriptPath+"/profile.html").href,()=>{$(document.body).append(l.children()),this.profileWindow=new K1(this),this.profileWindowController=new Q1(this),$("#profile_window").draggable({handle:$("#profile_titlebar"),containment:$(document.body)}),$("#profile_window").resizable({containment:$(document.body),handles:"n, e, s, w"}),$(()=>{this.guiLoaded=!0;for(let c of this.guiLoadTasks)c()})})})}),this.promiseGuiLoaded()}setLanguage(e){i18n.setLng(e),$("body").i18n()}setServer(e){this.server=e}initDragAndDrop(){function e(n){n.dataTransfer.dropEffect="copy",n.preventDefault()}let t=async n=>{console.log(n),n.preventDefault();for(const s of n.dataTransfer.items){if(console.log(s),s.kind!=="file")continue;const r=s.getAsFile(),o=r.name.toLowerCase().endsWith(".json5"),a=r.name.toLowerCase().endsWith(".gpkg");if(o)try{const l=await r.text(),c=gf.parse(l);c.type==="Potree"&&Potree.loadProject(viewer,c)}catch(l){console.error("failed to parse the dropped file as JSON"),console.error(l)}else if(a)if(viewer.scene.pointclouds.length>0){proj4.defs("WGS84","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"),proj4.defs("pointcloud",this.getProjection());let c=proj4("WGS84","pointcloud");const u=await r.arrayBuffer(),h={transform:c,source:r.name},d=await Potree.GeoPackageLoader.loadBuffer(u,h);viewer.scene.addGeopackage(d)}else{let c="At least one point cloud is needed that specifies the ";c+="coordinate reference system before loading vector data.",console.error(c)}}};$("body")[0].addEventListener("dragenter",e),$("body")[0].addEventListener("dragover",e),$("body")[0].addEventListener("drop",t)}initThree(){console.log(`initializing three.js ${st}`);let e=this.renderArea.clientWidth,t=this.renderArea.clientHeight,n={alpha:!0,depth:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},s=document.createElement("canvas"),r=s.getContext("webgl",n);this.labelRenderer=new V1,this.labelRenderer.setSize(window.innerWidth,window.innerHeight),this.labelRenderer.domElement.style.position="absolute",this.labelRenderer.domElement.style.top="0px",this.renderArea.appendChild(this.labelRenderer.domElement),this.renderer=new Il({alpha:!0,premultipliedAlpha:!1,canvas:s,context:r}),this.renderer.sortObjects=!1,this.renderer.setSize(e,t),this.renderer.autoClear=!1,this.renderArea.appendChild(this.renderer.domElement),this.renderer.domElement.tabIndex="2222",this.renderer.domElement.style.position="absolute",this.renderer.domElement.addEventListener("mousedown",()=>{this.renderer.domElement.focus()});let o=this.renderer.getContext();if(o.getExtension("EXT_frag_depth"),o.getExtension("WEBGL_depth_texture"),o.getExtension("WEBGL_color_buffer_float"),o.createVertexArray==null){let a=o.getExtension("OES_vertex_array_object");if(!a)throw new Error("OES_vertex_array_object extension not supported");o.createVertexArray=a.createVertexArrayOES.bind(a),o.bindVertexArray=a.bindVertexArrayOES.bind(a)}}updateAnnotations(){this.visibleAnnotations||(this.visibleAnnotations=new Set),this.scene.annotations.updateBounds(),this.scene.cameraP.updateMatrixWorld(),this.scene.cameraO.updateMatrixWorld();let e=[],t=this.renderer.getSize(new Se),n=this,s=[];this.scene.annotations.traverse(o=>{if(o===this.scene.annotations)return!0;if(!o.visible)return!1;o.scene=this.scene;let a=o.domElement,l=o.position.clone();l.add(o.offset),l||(l=o.boundingBox.getCenter(new S));let c=n.scene.cameraP.position.distanceTo(l),u=o.boundingBox.getBoundingSphere(new fi).radius,h=new S,d=0;if(h.copy(l).project(this.scene.getActiveCamera()),h.x=t.x*(h.x+1)/2,h.y=t.y*(1-(h.y+1)/2),n.scene.cameraMode==cs.PERSPECTIVE){let m=Math.PI*n.scene.cameraP.fov/180,v=Math.tan(m/2),_=.5*t.y/(v*c);d=u*_}else d=He.projectedRadiusOrtho(u,n.scene.cameraO.projectionMatrix,t.x,t.y);a.css("left",h.x+"px"),a.css("top",h.y+"px");let f=1e7-c*(1e7/this.scene.cameraP.far);if(o.descriptionVisible&&(f+=1e7),a.css("z-index",parseInt(f)),o.children.length>0){let m=d>o.collapseThreshold||o.boundingBox.containsPoint(this.scene.getActiveCamera().position);return o.expand=m,m||h.z>=-1&&h.z<=1&&s.push(o),m}else h.z>=-1&&h.z<=1&&s.push(o)});let r=new Set(this.visibleAnnotations);for(let o of s)o.display=!0,r.delete(o);this.visibleAnnotations=s;for(let o of r)o.display=!1}updateMaterialDefaults(e){const t=e.material,n=e.getAttribute("intensity");n!=null&&t.intensityRange[0]===1/0&&(t.intensityRange=[...n.range])}update(e,t){Potree.measureTimings&&performance.mark("update-start"),this.dispatchEvent({type:"update_start",delta:e,timestamp:t});const n=this.scene,s=n.getActiveCamera(),r=this.scene.pointclouds.filter(l=>l.visible);Potree.pointLoadLimit=Potree.pointBudget*2;const o=s.position.clone().add(s.getWorldDirection(new S).multiplyScalar(1e3));this.scene.directionalLight.position.copy(s.position),this.scene.directionalLight.lookAt(o);for(let l of r){l.showBoundingBox=this.showBoundingBox,l.generateDEM=this.generateDEM,l.minimumNodePixelSize=this.minNodeSize;let c=l.material;c.uniforms.uFilterReturnNumberRange.value=this.filterReturnNumberRange,c.uniforms.uFilterNumberOfReturnsRange.value=this.filterNumberOfReturnsRange,c.uniforms.uFilterGPSTimeClipRange.value=this.filterGPSTimeRange,c.uniforms.uFilterPointSourceIDClipRange.value=this.filterPointSourceIDRange,c.classification=this.classifications,c.recomputeClassification(),this.updateMaterialDefaults(l)}if(this.showBoundingBox){let l=this.scene.scene.getObjectByName("potree_bounding_box_root");if(!l){let u=new qe;u.name="potree_bounding_box_root",this.scene.scene.add(u),l=u}let c=[];for(let u of this.scene.pointclouds)for(let h of u.visibleNodes.filter(d=>d.boundingBoxNode!==void 0)){let d=h.boundingBoxNode;c.push(d)}l.children=c}if(!this.freeze){let l=Potree.updatePointClouds(n.pointclouds,s,this.renderer);const c=performance.now(),u=s.position;let h=1/0;for(const f of this.scene.orientedImages)for(const m of f.images){const v=m.mesh.position.distanceTo(u);h=Math.min(h,v)}const d=performance.now();if(l.lowestSpacing!==1/0){let f=l.lowestSpacing*10,m=-this.getBoundingBox().applyMatrix4(s.matrixWorldInverse).min.z;m=Math.max(m*1.5,1e4),f=Math.min(100,Math.max(.01,f)),f=Math.min(f,h),m=Math.max(m,f+1e4),f===1/0&&(f=.1),s.near=f,s.far=m}this.scene.cameraMode==cs.ORTHOGRAPHIC&&(s.near=-s.far)}this.scene.cameraP.fov=this.fov;let a=this.getControls();a===this.deviceControls?(this.controls.setScene(n),this.controls.update(e),this.scene.cameraP.position.copy(n.view.position),this.scene.cameraO.position.copy(n.view.position)):a!==null&&(a.setScene(n),a.update(e),typeof debugDisabled>"u"&&(this.scene.cameraP.position.copy(n.view.position),this.scene.cameraP.rotation.order="ZXY",this.scene.cameraP.rotation.x=Math.PI/2+this.scene.view.pitch,this.scene.cameraP.rotation.z=this.scene.view.yaw),this.scene.cameraO.position.copy(n.view.position),this.scene.cameraO.rotation.order="ZXY",this.scene.cameraO.rotation.x=Math.PI/2+this.scene.view.pitch,this.scene.cameraO.rotation.z=this.scene.view.yaw),s.updateMatrix(),s.updateMatrixWorld(),s.matrixWorldInverse.copy(s.matrixWorld).invert(),this._previousCamera===void 0&&(this._previousCamera=this.scene.getActiveCamera().clone(),this._previousCamera.rotation.copy(this.scene.getActiveCamera().rotation)),this._previousCamera.matrixWorld.equals(s.matrixWorld)?this._previousCamera.projectionMatrix.equals(s.projectionMatrix)||this.dispatchEvent({type:"camera_changed",previous:this._previousCamera,camera:s}):this.dispatchEvent({type:"camera_changed",previous:this._previousCamera,camera:s}),this._previousCamera=this.scene.getActiveCamera().clone(),this._previousCamera.rotation.copy(this.scene.getActiveCamera().rotation);{let l=[];l.push(...this.scene.volumes.filter(d=>d.clip&&d instanceof Xa));for(let d of this.scene.profiles)l.push(...d.boxes);let c=d=>d.matrixWorld.determinant()!==0,u=l.filter(c).map(d=>{d.updateMatrixWorld();let f=d.matrixWorld.clone().invert(),m=d.getWorldPosition(new S);return{box:d,inverse:f,position:m}}),h=this.scene.polygonClipVolumes.filter(d=>d.initialized);for(let d of r)d.material.setClipBoxes(u),d.material.setClipPolygons(h,this.clippingTool.maxPolygonVertices),d.material.clipTask=this.clipTask,d.material.clipMethod=this.clipMethod}for(let l of r)l.material.elevationGradientRepeat=this.elevationGradientRepeat;this.navigationCube.update(s.rotation),this.updateAnnotations(),this.mapView&&(this.mapView.update(e),this.mapView.sceneProjection&&$("#potree_map_toggle").css("display","block")),TWEEN.update(t),this.dispatchEvent({type:"update",delta:e,timestamp:t}),Potree.measureTimings&&(performance.mark("update-end"),performance.measure("update","update-start","update-end"))}getPRenderer(){return this.useHQ?(this.hqRenderer||(this.hqRenderer=new $1(this)),this.hqRenderer.useEDL=this.useEDL,this.hqRenderer):this.useEDL&&Jd.SHADER_EDL.isSupported()?(this.edlRenderer||(this.edlRenderer=new W1(this)),this.edlRenderer):(this.potreeRenderer||(this.potreeRenderer=new j1(this)),this.potreeRenderer)}renderVR(){let e=this.renderer;e.setClearColor(5570560,0),e.clear();let t=e.xr,n=new mi,s=t.getCamera(n);if(s.cameras.length!==2)return;let r=this.vrControls.getCamera.bind(this.vrControls);if(viewer.background==="skybox"?e.setClearColor(16711680,1):viewer.background==="gradient"?e.setClearColor(1122867,1):viewer.background==="black"?e.setClearColor(0,1):viewer.background==="white"?e.setClearColor(16777215,1):e.setClearColor(0,0),e.clear(),this.background==="skybox"){let{skybox:l}=this,c=r();l.camera.rotation.copy(c.rotation),l.camera.fov=c.fov,l.camera.aspect=c.aspect;let u=l.parent;u.rotation.x=Math.PI/2,u.updateMatrix(),u.updateMatrixWorld(),l.camera.updateMatrix(),l.camera.updateMatrixWorld(),l.camera.updateProjectionMatrix(),e.render(l.scene,l.camera)}else this.background;this.renderer.xr.getSession().updateRenderState({depthNear:.1,depthFar:1e4});let o=null,a=null;o=r(),o.position.z-=.8*o.scale.x,o.parent=null,o.near=viewer.scene.getActiveCamera().near,o.far=viewer.scene.getActiveCamera().far,o.updateMatrix(),o.updateMatrixWorld(),this.scene.scene.updateMatrix(),this.scene.scene.updateMatrixWorld(),this.scene.scene.matrixAutoUpdate=!1,a=o.matrixWorld.clone().clone().invert(),this.scene.scene.matrix.copy(a),this.scene.scene.matrixWorld.copy(a),o.matrix.identity(),o.matrixWorld.identity(),o.matrixWorldInverse.identity(),e.render(this.scene.scene,o),this.scene.scene.matrixWorld.identity();for(let l of this.scene.pointclouds){let c=s.cameras[0].viewport;l.material.useEDL=!1,l.screenHeight=c.height,l.screenWidth=c.width}for(let l of s.cameras){let c=l.viewport;e.setViewport(c.x,c.y,c.width,c.height);{let f=l.projectionMatrix.clone().invert(),_=180*(new _t(0,1,-1,1).applyMatrix4(f).y/Math.PI);l.fov=_}for(let d of this.scene.pointclouds){const{material:f}=d;f.useEDL=!1}let u=a.clone().invert();u.multiply(l.matrixWorld);let h=u.clone().invert();this.pRenderer.render(this.scene.scenePointCloud,l,null,{viewOverride:h})}{let l=r();l.parent=null,e.render(this.sceneVR,l)}e.resetState()}renderDefault(){let e=this.getPRenderer();{const t=this.scaleFactor*this.renderArea.clientWidth,n=this.scaleFactor*this.renderArea.clientHeight;this.renderer.setSize(t,n),this.labelRenderer.setSize(t,n);const s=this.renderer.getPixelRatio(),r=t/n,o=this.scene;o.cameraP.aspect=r,o.cameraP.updateProjectionMatrix();let a=this.scene.view.radius;o.cameraO.left=-a,o.cameraO.right=a,o.cameraO.top=a*1/r,o.cameraO.bottom=-a*1/r,o.cameraO.updateProjectionMatrix(),o.cameraScreenSpace.top=1/r,o.cameraScreenSpace.bottom=-1/r,o.cameraScreenSpace.updateProjectionMatrix()}e.clear(),e.render(this.renderer),this.renderer.render(this.overlay,this.overlayCamera)}render(){if(this.renderType!=!1){Potree.measureTimings&&performance.mark("render-start");try{this.renderer.xr.isPresenting?this.renderVR():this.renderDefault()}catch(e){this.onCrash(e)}Potree.measureTimings&&(performance.mark("render-end"),performance.measure("render","render-start","render-end"))}}resolveTimings(e){if(Potree.measureTimings&&(this.toggle||(this.toggle=e),e-this.toggle>1e3)){let n=performance.getEntriesByType("measure"),s=new Set;for(let f of n)s.add(f.name);let r=new Map;for(let f of s)r.set(f,{measures:[],sum:0,n:0,min:1/0,max:-1/0});for(let f of n){let m=r.get(f.name);m.measures.push(f),m.sum+=f.duration,m.n++,m.min=Math.min(m.min,f.duration),m.max=Math.max(m.max,f.duration)}let o=Potree.resolveQueries(this.renderer.getContext());for(let[f,m]of o){let v={measures:m.map(y=>({duration:y})),sum:m.reduce((y,x)=>y+x,0),n:m.length,min:Math.min(...m),max:Math.max(...m)},_=`[tq] ${f}`;r.set(_,v),s.add(_)}for(let[f,m]of r)m.mean=m.sum/m.n,m.measures.sort((v,_)=>v.duration-_.duration),m.n===1?m.median=m.measures[0].duration:m.n>1&&(m.median=m.measures[parseInt(m.n/2)].duration);let a=Array.from(s).reduce((f,m)=>Math.max(f,m.length),0)+5,l=10,c=10,u=10,h=6,d=` ${"NAME".padEnd(a)} | ${"MIN".padStart(l)} | ${"MEDIAN".padStart(c)} | ${"MAX".padStart(u)} | ${"SAMPLES".padStart(h)} 
`;d+=` ${"-".repeat(d.length)}
`,s=Array.from(s).sort();for(let f of s){let m=r.get(f),v=m.min.toFixed(3),_=m.median.toFixed(3),y=m.max.toFixed(3),x=m.n;d+=` ${f.padEnd(a)} | ${v.padStart(l)} | ${_.padStart(c)} | ${y.padStart(u)} | ${x.toString().padStart(h)}
`}d+=`
`,console.log(d),performance.clearMarks(),performance.clearMeasures(),this.toggle=e}}loop(e){this.stats&&this.stats.begin(),Potree.measureTimings&&performance.mark("loop-start"),this.update(this.clock.getDelta(),e),this.render(),Potree.measureTimings&&(performance.mark("loop-end"),performance.measure("loop","loop-start","loop-end")),this.resolveTimings(e),Potree.framenumber++,this.stats&&this.stats.end()}postError(e,t={}){let n=this.postMessage(e,t);return n.element.addClass("potree_message_error"),n}postMessage(e,t={}){let n=new hg(e),s=100;if(n.element.css("display","none"),n.elClose.click(()=>{n.element.slideToggle(s);let r=this.messages.indexOf(n);r>=0&&this.messages.splice(r,1)}),this.elMessages.prepend(n.element),n.element.slideToggle(s),this.messages.push(n),t.duration!==void 0){let r=500,o=200;setTimeout(()=>{n.element.animate({opacity:0},r),n.element.slideToggle(o)},t.duration)}return n}}/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var Vg={},Ts=void 0,Z_=Vg;function xf(i,e){var t=i.split("."),n=Z_;!(t[0]in n)&&n.execScript&&n.execScript("var "+t[0]);for(var s;t.length&&(s=t.shift());)!t.length&&e!==Ts?n[s]=e:n=n[s]?n[s]:n[s]={}}var Bi=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u"&&typeof DataView<"u";function el(i){var e=i.length,t=0,n=Number.POSITIVE_INFINITY,s,r,o,a,l,c,u,h,d,f;for(h=0;h<e;++h)i[h]>t&&(t=i[h]),i[h]<n&&(n=i[h]);for(s=1<<t,r=new(Bi?Uint32Array:Array)(s),o=1,a=0,l=2;o<=t;){for(h=0;h<e;++h)if(i[h]===o){for(c=0,u=a,d=0;d<o;++d)c=c<<1|u&1,u>>=1;for(f=o<<16|h,d=c;d<s;d+=l)r[d]=f;++a}++o,a<<=1,l<<=1}return[r,t,n]}function pa(i,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=Bi?new Uint8Array(i):i,this.m=!1,this.i=Oh,this.r=!1,(e||!(e={}))&&(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case wf:this.b=32768,this.c=new(Bi?Uint8Array:Array)(32768+this.h+258);break;case Oh:this.b=0,this.c=new(Bi?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var wf=0,Oh=1,jg={t:wf,s:Oh};pa.prototype.k=function(){for(;!this.m;){var i=$s(this,3);switch(i&1&&(this.m=!0),i>>>=1,i){case 0:var e=this.input,t=this.a,n=this.c,s=this.b,r=e.length,o=Ts,a=Ts,l=n.length,c=Ts;if(this.d=this.f=0,t+1>=r)throw Error("invalid uncompressed block header: LEN");if(o=e[t++]|e[t++]<<8,t+1>=r)throw Error("invalid uncompressed block header: NLEN");if(a=e[t++]|e[t++]<<8,o===~a)throw Error("invalid uncompressed block header: length verify");if(t+o>e.length)throw Error("input buffer is broken");switch(this.i){case wf:for(;s+o>n.length;){if(c=l-s,o-=c,Bi)n.set(e.subarray(t,t+c),s),s+=c,t+=c;else for(;c--;)n[s++]=e[t++];this.b=s,n=this.e(),s=this.b}break;case Oh:for(;s+o>n.length;)n=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(Bi)n.set(e.subarray(t,t+o),s),s+=o,t+=o;else for(;o--;)n[s++]=e[t++];this.a=t,this.b=s,this.c=n;break;case 1:this.j(J_,K_);break;case 2:for(var u=$s(this,5)+257,h=$s(this,5)+1,d=$s(this,4)+4,f=new(Bi?Uint8Array:Array)(bf.length),m=Ts,v=Ts,_=Ts,y=Ts,x=Ts,R=Ts,I=Ts,N=Ts,B=Ts,N=0;N<d;++N)f[bf[N]]=$s(this,3);if(!Bi)for(N=d,d=f.length;N<d;++N)f[bf[N]]=0;for(m=el(f),y=new(Bi?Uint8Array:Array)(u+h),N=0,B=u+h;N<B;)switch(x=uu(this,m),x){case 16:for(I=3+$s(this,2);I--;)y[N++]=R;break;case 17:for(I=3+$s(this,3);I--;)y[N++]=0;R=0;break;case 18:for(I=11+$s(this,7);I--;)y[N++]=0;R=0;break;default:R=y[N++]=x}v=el(Bi?y.subarray(0,u):y.slice(0,u)),_=el(Bi?y.subarray(u):y.slice(u)),this.j(v,_);break;default:throw Error("unknown BTYPE: "+i)}}return this.n()};var Wg=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],bf=Bi?new Uint16Array(Wg):Wg,$g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],qg=Bi?new Uint16Array($g):$g,Xg=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],kh=Bi?new Uint8Array(Xg):Xg,Yg=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Zg=Bi?new Uint16Array(Yg):Yg,Jg=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],zh=Bi?new Uint8Array(Jg):Jg,_f=new(Bi?Uint8Array:Array)(288),tl,Kg;for(tl=0,Kg=_f.length;tl<Kg;++tl)_f[tl]=143>=tl?8:255>=tl?9:279>=tl?7:8;var J_=el(_f),Mf=new(Bi?Uint8Array:Array)(30),Uh,Qg;for(Uh=0,Qg=Mf.length;Uh<Qg;++Uh)Mf[Uh]=5;var K_=el(Mf);function $s(i,e){for(var t=i.f,n=i.d,s=i.input,r=i.a,o=s.length,a;n<e;){if(r>=o)throw Error("input buffer is broken");t|=s[r++]<<n,n+=8}return a=t&(1<<e)-1,i.f=t>>>e,i.d=n-e,i.a=r,a}function uu(i,e){for(var t=i.f,n=i.d,s=i.input,r=i.a,o=s.length,a=e[0],l=e[1],c,u;n<l&&!(r>=o);)t|=s[r++]<<n,n+=8;if(c=a[t&(1<<l)-1],u=c>>>16,u>n)throw Error("invalid code length: "+u);return i.f=t>>u,i.d=n-u,i.a=r,c&65535}pa.prototype.j=function(i,e){var t=this.c,n=this.b;this.o=i;for(var s=t.length-258,r,o,a,l;(r=uu(this,i))!==256;)if(256>r)n>=s&&(this.b=n,t=this.e(),n=this.b),t[n++]=r;else for(o=r-257,l=qg[o],0<kh[o]&&(l+=$s(this,kh[o])),r=uu(this,e),a=Zg[r],0<zh[r]&&(a+=$s(this,zh[r])),n>=s&&(this.b=n,t=this.e(),n=this.b);l--;)t[n]=t[n++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},pa.prototype.w=function(i,e){var t=this.c,n=this.b;this.o=i;for(var s=t.length,r,o,a,l;(r=uu(this,i))!==256;)if(256>r)n>=s&&(t=this.e(),s=t.length),t[n++]=r;else for(o=r-257,l=qg[o],0<kh[o]&&(l+=$s(this,kh[o])),r=uu(this,e),a=Zg[r],0<zh[r]&&(a+=$s(this,zh[r])),n+l>s&&(t=this.e(),s=t.length);l--;)t[n]=t[n++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},pa.prototype.e=function(){var i=new(Bi?Uint8Array:Array)(this.b-32768),e=this.b-32768,t,n,s=this.c;if(Bi)i.set(s.subarray(32768,i.length));else for(t=0,n=i.length;t<n;++t)i[t]=s[t+32768];if(this.g.push(i),this.l+=i.length,Bi)s.set(s.subarray(e,e+32768));else for(t=0;32768>t;++t)s[t]=s[e+t];return this.b=32768,s},pa.prototype.z=function(i){var e,t=this.input.length/this.a+1|0,n,s,r,o=this.input,a=this.c;return i&&(typeof i.p=="number"&&(t=i.p),typeof i.u=="number"&&(t+=i.u)),2>t?(n=(o.length-this.a)/this.o[2],r=258*(n/2)|0,s=r<a.length?a.length+r:a.length<<1):s=a.length*t,Bi?(e=new Uint8Array(s),e.set(a)):e=a,this.c=e},pa.prototype.n=function(){var i=0,e=this.c,t=this.g,n,s=new(Bi?Uint8Array:Array)(this.l+(this.b-32768)),r,o,a,l;if(t.length===0)return Bi?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(r=0,o=t.length;r<o;++r)for(n=t[r],a=0,l=n.length;a<l;++a)s[i++]=n[a];for(r=32768,o=this.b;r<o;++r)s[i++]=e[r];return this.g=[],this.buffer=s},pa.prototype.v=function(){var i,e=this.b;return Bi?this.r?(i=new Uint8Array(e),i.set(this.c.subarray(0,e))):i=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),i=this.c),this.buffer=i};function Ef(i,e){var t,n;switch(this.input=i,this.a=0,(e||!(e={}))&&(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),t=i[this.a++],n=i[this.a++],t&15){case e0:this.method=e0;break;default:throw Error("unsupported compression method")}if(((t<<8)+n)%31!==0)throw Error("invalid fcheck flag:"+((t<<8)+n)%31);if(n&32)throw Error("fdict flag is not supported");this.q=new pa(i,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}Ef.prototype.k=function(){var i=this.input,e,t;if(e=this.q.k(),this.a=this.q.a,this.A){t=(i[this.a++]<<24|i[this.a++]<<16|i[this.a++]<<8|i[this.a++])>>>0;var n=e;if(typeof n=="string"){var s=n.split(""),r,o;for(r=0,o=s.length;r<o;r++)s[r]=(s[r].charCodeAt(0)&255)>>>0;n=s}for(var a=1,l=0,c=n.length,u,h=0;0<c;){u=1024<c?1024:c,c-=u;do a+=n[h++],l+=a;while(--u);a%=65521,l%=65521}if(t!==(l<<16|a)>>>0)throw Error("invalid adler-32 checksum")}return e};var e0=8;xf("Zlib.Inflate",Ef),xf("Zlib.Inflate.prototype.decompress",Ef.prototype.k);var Sf={ADAPTIVE:jg.s,BLOCK:jg.t},hu,du,nc,t0;if(Object.keys)hu=Object.keys(Sf);else for(du in hu=[],nc=0,Sf)hu[nc++]=du;for(nc=0,t0=hu.length;nc<t0;++nc)du=hu[nc],xf("Zlib.Inflate.BufferType."+du,Sf[du]);var i0=Vg.Zlib.Inflate;function il(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let s=i,r=n,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function sc(i,e,t,n){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[i+1-a],o[a]=n[i+a]-e;let l=0;for(let c=0;c<a;++c){const u=o[c+1],h=r[a-c],d=s[c]/(u+h);s[c]=l+u*d,l=h*d}s[a]=l}return s}function Q_(i,e,t,n){const s=il(i,n,e),r=sc(s,n,i,e),o=new _t(0,0,0,0);for(let a=0;a<=i;++a){const l=t[s-i+a],c=r[a],u=l.w*c;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*c}return o}function eM(i,e,t,n,s){const r=[];for(let h=0;h<=t;++h)r[h]=0;const o=[];for(let h=0;h<=n;++h)o[h]=r.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let h=1;h<=t;++h){l[h]=e-s[i+1-h],c[h]=s[i+h]-e;let d=0;for(let f=0;f<h;++f){const m=c[f+1],v=l[h-f];a[h][f]=m+v;const _=a[f][h-1]/a[h][f];a[f][h]=d+m*_,d=v*_}a[h][h]=d}for(let h=0;h<=t;++h)o[0][h]=a[h][t];for(let h=0;h<=t;++h){let d=0,f=1;const m=[];for(let v=0;v<=t;++v)m[v]=r.slice(0);m[0][0]=1;for(let v=1;v<=n;++v){let _=0;const y=h-v,x=t-v;h>=v&&(m[f][0]=m[d][0]/a[x+1][y],_=m[f][0]*a[y][x]);const R=y>=-1?1:-y,I=h-1<=x?v-1:t-h;for(let N=R;N<=I;++N)m[f][N]=(m[d][N]-m[d][N-1])/a[x+1][y+N],_+=m[f][N]*a[y+N][x];h<=x&&(m[f][v]=-m[d][v-1]/a[x+1][h],_+=m[f][v]*a[h][x]),o[v][h]=_;const B=d;d=f,f=B}}let u=t;for(let h=1;h<=n;++h){for(let d=0;d<=t;++d)o[h][d]*=u;u*=t-h}return o}function tM(i,e,t,n,s){const r=s<i?s:i,o=[],a=il(i,n,e),l=eM(a,n,i,r,e),c=[];for(let u=0;u<t.length;++u){const h=t[u].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,c[u]=h}for(let u=0;u<=r;++u){const h=c[a-i].clone().multiplyScalar(l[u][0]);for(let d=1;d<=i;++d)h.add(c[a-i+d].clone().multiplyScalar(l[u][d]));o[u]=h}for(let u=r+1;u<=s+1;++u)o[u]=new _t(0,0,0);return o}function iM(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=i-e;++s)n*=s;return t/n}function nM(i){const e=i.length,t=[],n=[];for(let r=0;r<e;++r){const o=i[r];t[r]=new S(o.x,o.y,o.z),n[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(iM(r,a)*n[a]));s[r]=o.divideScalar(n[0])}return s}function sM(i,e,t,n,s){const r=tM(i,e,t,n,s);return nM(r)}function SE(i,e,t,n,s,r,o,a){const l=il(i,r,t),c=il(e,o,n),u=sc(l,r,i,t),h=sc(c,o,e,n),d=[];for(let m=0;m<=e;++m){d[m]=new _t(0,0,0,0);for(let v=0;v<=i;++v){const _=s[l-i+v][c-e+m].clone(),y=_.w;_.x*=y,_.y*=y,_.z*=y,d[m].add(_.multiplyScalar(u[v]))}}const f=new _t(0,0,0,0);for(let m=0;m<=e;++m)f.add(d[m].multiplyScalar(h[m]));f.divideScalar(f.w),a.set(f.x,f.y,f.z)}function TE(i,e,t,n,s,r,o,a,l,c,u){const h=il(i,a,n),d=il(e,l,s),f=il(t,c,r),m=sc(h,a,i,n),v=sc(d,l,e,s),_=sc(f,c,t,r),y=[];for(let R=0;R<=t;++R){y[R]=[];for(let I=0;I<=e;++I){y[R][I]=new _t(0,0,0,0);for(let B=0;B<=i;++B){const N=o[h-i+B][d-e+I][f-t+R].clone(),J=N.w;N.x*=J,N.y*=J,N.z*=J,y[R][I].add(N.multiplyScalar(m[B]))}}}const x=new _t(0,0,0,0);for(let R=0;R<=t;++R)for(let I=0;I<=e;++I)x.add(y[R][I].multiplyScalar(_[R]).multiplyScalar(v[I]));x.divideScalar(x.w),u.set(x.x,x.y,x.z)}class n0 extends Dt{constructor(e,t,n,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new _t(a.x,a.y,a.z,a.w)}}getPoint(e,t=new S){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Q_(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new S){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=sM(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}}var rM=function(){var i,e,t;function n(E){gi.call(this,E)}n.prototype=Object.assign(Object.create(gi.prototype),{constructor:n,load:function(E,M,A,F){var P=this,O=P.path===""?Or.extractUrlBase(E):P.path,V=new ls(this.manager);V.setPath(P.path),V.setResponseType("arraybuffer"),V.setRequestHeader(P.requestHeader),V.setWithCredentials(P.withCredentials),V.load(E,function(W){try{M(P.parse(W,O))}catch(fe){F?F(fe):console.error(fe),P.manager.itemError(E)}},A,F)},parse:function(E,M){if(h(E))i=new l().parse(E);else{var A=N(E);if(!d(A))throw new Error("THREE.FBXLoader: Unknown format.");if(f(A)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+f(A));i=new a().parse(A)}var F=new jn(this.manager).setPath(this.resourcePath||M).setCrossOrigin(this.crossOrigin);return new s(F,this.manager).parse(i)}});function s(E,M){this.textureLoader=E,this.manager=M}s.prototype={constructor:s,parse:function(){e=this.parseConnections();var E=this.parseImages(),M=this.parseTextures(E),A=this.parseMaterials(M),F=this.parseDeformers(),P=new r().parse(F);return this.parseScene(F,P,A),t},parseConnections:function(){var E=new Map;if("Connections"in i){var M=i.Connections.connections;M.forEach(function(A){var F=A[0],P=A[1],O=A[2];E.has(F)||E.set(F,{parents:[],children:[]});var V={ID:P,relationship:O};E.get(F).parents.push(V),E.has(P)||E.set(P,{parents:[],children:[]});var W={ID:F,relationship:O};E.get(P).children.push(W)})}return E},parseImages:function(){var E={},M={};if("Video"in i.Objects){var A=i.Objects.Video;for(var F in A){var P=A[F],O=parseInt(F);if(E[O]=P.RelativeFilename||P.Filename,"Content"in P){var V=P.Content instanceof ArrayBuffer&&P.Content.byteLength>0,W=typeof P.Content=="string"&&P.Content!=="";if(V||W){var fe=this.parseImage(A[F]);M[P.RelativeFilename||P.Filename]=fe}}}}for(var O in E){var ve=E[O];M[ve]!==void 0?E[O]=M[ve]:E[O]=E[O].split("\\").pop()}return E},parseImage:function(E){var M=E.Content,A=E.RelativeFilename||E.Filename,F=A.slice(A.lastIndexOf(".")+1).toLowerCase(),P;switch(F){case"bmp":P="image/bmp";break;case"jpg":case"jpeg":P="image/jpeg";break;case"png":P="image/png";break;case"tif":P="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",A),P="image/tga";break;default:console.warn('FBXLoader: Image type "'+F+'" is not supported.');return}if(typeof M=="string")return"data:"+P+";base64,"+M;var O=new Uint8Array(M);return window.URL.createObjectURL(new Blob([O],{type:P}))},parseTextures:function(E){var M=new Map;if("Texture"in i.Objects){var A=i.Objects.Texture;for(var F in A){var P=this.parseTexture(A[F],E);M.set(parseInt(F),P)}}return M},parseTexture:function(E,M){var A=this.loadTexture(E,M);A.ID=E.id,A.name=E.attrName;var F=E.WrapModeU,P=E.WrapModeV,O=F!==void 0?F.value:0,V=P!==void 0?P.value:0;if(A.wrapS=O===0?vi:li,A.wrapT=V===0?vi:li,"Scaling"in E){var W=E.Scaling.value;A.repeat.x=W[0],A.repeat.y=W[1]}return A},loadTexture:function(E,M){var A,F=this.textureLoader.path,P=e.get(E.id).children;P!==void 0&&P.length>0&&M[P[0].ID]!==void 0&&(A=M[P[0].ID],(A.indexOf("blob:")===0||A.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));var O,V=E.FileName.slice(-3).toLowerCase();if(V==="tga"){var W=this.manager.getHandler(".tga");W===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",E.RelativeFilename),O=new oi):O=W.load(A)}else V==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",E.RelativeFilename),O=new oi):O=this.textureLoader.load(A);return this.textureLoader.setPath(F),O},parseMaterials:function(E){var M=new Map;if("Material"in i.Objects){var A=i.Objects.Material;for(var F in A){var P=this.parseMaterial(A[F],E);P!==null&&M.set(parseInt(F),P)}}return M},parseMaterial:function(E,M){var A=E.id,F=E.attrName,P=E.ShadingModel;if(typeof P=="object"&&(P=P.value),!e.has(A))return null;var O=this.parseParameters(E,M,A),V;switch(P.toLowerCase()){case"phong":V=new Lr;break;case"lambert":V=new po;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',P),V=new Lr;break}return V.setValues(O),V.name=F,V},parseParameters:function(E,M,A){var F={};E.BumpFactor&&(F.bumpScale=E.BumpFactor.value),E.Diffuse?F.color=new Ee().fromArray(E.Diffuse.value):E.DiffuseColor&&(E.DiffuseColor.type==="Color"||E.DiffuseColor.type==="ColorRGB")&&(F.color=new Ee().fromArray(E.DiffuseColor.value)),E.DisplacementFactor&&(F.displacementScale=E.DisplacementFactor.value),E.Emissive?F.emissive=new Ee().fromArray(E.Emissive.value):E.EmissiveColor&&(E.EmissiveColor.type==="Color"||E.EmissiveColor.type==="ColorRGB")&&(F.emissive=new Ee().fromArray(E.EmissiveColor.value)),E.EmissiveFactor&&(F.emissiveIntensity=parseFloat(E.EmissiveFactor.value)),E.Opacity&&(F.opacity=parseFloat(E.Opacity.value)),F.opacity<1&&(F.transparent=!0),E.ReflectionFactor&&(F.reflectivity=E.ReflectionFactor.value),E.Shininess&&(F.shininess=E.Shininess.value),E.Specular?F.specular=new Ee().fromArray(E.Specular.value):E.SpecularColor&&E.SpecularColor.type==="Color"&&(F.specular=new Ee().fromArray(E.SpecularColor.value));var P=this;return e.get(A).children.forEach(function(O){var V=O.relationship;switch(V){case"Bump":F.bumpMap=P.getTexture(M,O.ID);break;case"Maya|TEX_ao_map":F.aoMap=P.getTexture(M,O.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":F.map=P.getTexture(M,O.ID),F.map.encoding=H;break;case"DisplacementColor":F.displacementMap=P.getTexture(M,O.ID);break;case"EmissiveColor":F.emissiveMap=P.getTexture(M,O.ID),F.emissiveMap.encoding=H;break;case"NormalMap":case"Maya|TEX_normal_map":F.normalMap=P.getTexture(M,O.ID);break;case"ReflectionColor":F.envMap=P.getTexture(M,O.ID),F.envMap.mapping=Yt,F.envMap.encoding=H;break;case"SpecularColor":F.specularMap=P.getTexture(M,O.ID),F.specularMap.encoding=H;break;case"TransparentColor":case"TransparencyFactor":F.alphaMap=P.getTexture(M,O.ID),F.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",V);break}}),F},getTexture:function(E,M){return"LayeredTexture"in i.Objects&&M in i.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),M=e.get(M).children[0].ID),E.get(M)},parseDeformers:function(){var E={},M={};if("Deformer"in i.Objects){var A=i.Objects.Deformer;for(var F in A){var P=A[F],O=e.get(parseInt(F));if(P.attrType==="Skin"){var V=this.parseSkeleton(O,A);V.ID=F,O.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),V.geometryID=O.parents[0].ID,E[F]=V}else if(P.attrType==="BlendShape"){var W={id:F};W.rawTargets=this.parseMorphTargets(O,A),W.id=F,O.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),M[F]=W}}}return{skeletons:E,morphTargets:M}},parseSkeleton:function(E,M){var A=[];return E.children.forEach(function(F){var P=M[F.ID];if(P.attrType==="Cluster"){var O={ID:F.ID,indices:[],weights:[],transformLink:new xe().fromArray(P.TransformLink.a)};"Indexes"in P&&(O.indices=P.Indexes.a,O.weights=P.Weights.a),A.push(O)}}),{rawBones:A,bones:[]}},parseMorphTargets:function(E,M){for(var A=[],F=0;F<E.children.length;F++){var P=E.children[F],O=M[P.ID],V={name:O.attrName,initialWeight:O.DeformPercent,id:O.id,fullWeights:O.FullWeights.a};if(O.attrType!=="BlendShapeChannel")return;V.geoID=e.get(parseInt(P.ID)).children.filter(function(W){return W.relationship===void 0})[0].ID,A.push(V)}return A},parseScene:function(E,M,A){t=new xn;var F=this.parseModels(E.skeletons,M,A),P=i.Objects.Model,O=this;F.forEach(function(W){var fe=P[W.ID];O.setLookAtProperties(W,fe);var ve=e.get(W.ID).parents;ve.forEach(function(pe){var Me=F.get(pe.ID);Me!==void 0&&Me.add(W)}),W.parent===null&&t.add(W)}),this.bindSkeleton(E.skeletons,M,F),this.createAmbientLight(),this.setupMorphMaterials(),t.traverse(function(W){if(W.userData.transformData){W.parent&&(W.userData.transformData.parentMatrixWorld=W.parent.matrix);var fe=R(W.userData.transformData);W.applyMatrix4(fe)}});var V=new o().parse();t.children.length===1&&t.children[0].isGroup&&(t.children[0].animations=V,t=t.children[0]),t.animations=V},parseModels:function(E,M,A){var F=new Map,P=i.Objects.Model;for(var O in P){var V=parseInt(O),W=P[O],fe=e.get(V),ve=this.buildSkeleton(fe,E,V,W.attrName);if(!ve){switch(W.attrType){case"Camera":ve=this.createCamera(fe);break;case"Light":ve=this.createLight(fe);break;case"Mesh":ve=this.createMesh(fe,M,A);break;case"NurbsCurve":ve=this.createCurve(fe,M);break;case"LimbNode":case"Root":ve=new Oa;break;case"Null":default:ve=new xn;break}ve.name=W.attrName?an.sanitizeNodeName(W.attrName):"",ve.ID=V}this.getTransformData(ve,W),F.set(V,ve)}return F},buildSkeleton:function(E,M,A,F){var P=null;return E.parents.forEach(function(O){for(var V in M){var W=M[V];W.rawBones.forEach(function(fe,ve){if(fe.ID===O.ID){var pe=P;P=new Oa,P.matrixWorld.copy(fe.transformLink),P.name=F?an.sanitizeNodeName(F):"",P.ID=A,W.bones[ve]=P,pe!==null&&P.add(pe)}})}}),P},createCamera:function(E){var M,A;if(E.children.forEach(function(Me){var Fe=i.Objects.NodeAttribute[Me.ID];Fe!==void 0&&(A=Fe)}),A===void 0)M=new qe;else{var F=0;A.CameraProjectionType!==void 0&&A.CameraProjectionType.value===1&&(F=1);var P=1;A.NearPlane!==void 0&&(P=A.NearPlane.value/1e3);var O=1e3;A.FarPlane!==void 0&&(O=A.FarPlane.value/1e3);var V=window.innerWidth,W=window.innerHeight;A.AspectWidth!==void 0&&A.AspectHeight!==void 0&&(V=A.AspectWidth.value,W=A.AspectHeight.value);var fe=V/W,ve=45;A.FieldOfView!==void 0&&(ve=A.FieldOfView.value);var pe=A.FocalLength?A.FocalLength.value:null;switch(F){case 0:M=new mi(ve,fe,P,O),pe!==null&&M.setFocalLength(pe);break;case 1:M=new Fn(-V/2,V/2,W/2,-W/2,P,O);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+F+"."),M=new qe;break}}return M},createLight:function(E){var M,A;if(E.children.forEach(function(pe){var Me=i.Objects.NodeAttribute[pe.ID];Me!==void 0&&(A=Me)}),A===void 0)M=new qe;else{var F;A.LightType===void 0?F=0:F=A.LightType.value;var P=16777215;A.Color!==void 0&&(P=new Ee().fromArray(A.Color.value));var O=A.Intensity===void 0?1:A.Intensity.value/100;A.CastLightOnObject!==void 0&&A.CastLightOnObject.value===0&&(O=0);var V=0;A.FarAttenuationEnd!==void 0&&(A.EnableFarAttenuation!==void 0&&A.EnableFarAttenuation.value===0?V=0:V=A.FarAttenuationEnd.value);var W=1;switch(F){case 0:M=new yo(P,O,V,W);break;case 1:M=new xo(P,O);break;case 2:var fe=Math.PI/3;A.InnerAngle!==void 0&&(fe=rt.degToRad(A.InnerAngle.value));var ve=0;A.OuterAngle!==void 0&&(ve=rt.degToRad(A.OuterAngle.value),ve=Math.max(ve,1)),M=new Yc(P,O,V,fe,ve,W);break;default:console.warn("THREE.FBXLoader: Unknown light type "+A.LightType.value+", defaulting to a PointLight."),M=new yo(P,O);break}A.CastShadows!==void 0&&A.CastShadows.value===1&&(M.castShadow=!0)}return M},createMesh:function(E,M,A){var F,P=null,O=null,V=[];return E.children.forEach(function(W){M.has(W.ID)&&(P=M.get(W.ID)),A.has(W.ID)&&V.push(A.get(W.ID))}),V.length>1?O=V:V.length>0?O=V[0]:(O=new Lr({color:13421772}),V.push(O)),"color"in P.attributes&&V.forEach(function(W){W.vertexColors=!0}),P.FBX_Deformer?(V.forEach(function(W){W.skinning=!0}),F=new kl(P,O),F.normalizeSkinWeights()):F=new ot(P,O),F},createCurve:function(E,M){var A=E.children.reduce(function(P,O){return M.has(O.ID)&&(P=M.get(O.ID)),P},null),F=new ri({color:3342591,linewidth:1});return new wn(A,F)},getTransformData:function(E,M){var A={};"InheritType"in M&&(A.inheritType=parseInt(M.InheritType.value)),"RotationOrder"in M?A.eulerOrder=I(M.RotationOrder.value):A.eulerOrder="ZYX","Lcl_Translation"in M&&(A.translation=M.Lcl_Translation.value),"PreRotation"in M&&(A.preRotation=M.PreRotation.value),"Lcl_Rotation"in M&&(A.rotation=M.Lcl_Rotation.value),"PostRotation"in M&&(A.postRotation=M.PostRotation.value),"Lcl_Scaling"in M&&(A.scale=M.Lcl_Scaling.value),"ScalingOffset"in M&&(A.scalingOffset=M.ScalingOffset.value),"ScalingPivot"in M&&(A.scalingPivot=M.ScalingPivot.value),"RotationOffset"in M&&(A.rotationOffset=M.RotationOffset.value),"RotationPivot"in M&&(A.rotationPivot=M.RotationPivot.value),E.userData.transformData=A},setLookAtProperties:function(E,M){if("LookAtProperty"in M){var A=e.get(E.ID).children;A.forEach(function(F){if(F.relationship==="LookAtProperty"){var P=i.Objects.Model[F.ID];if("Lcl_Translation"in P){var O=P.Lcl_Translation.value;E.target!==void 0?(E.target.position.fromArray(O),t.add(E.target)):E.lookAt(new S().fromArray(O))}}})}},bindSkeleton:function(E,M,A){var F=this.parsePoseNodes();for(var P in E){var O=E[P],V=e.get(parseInt(O.ID)).parents;V.forEach(function(W){if(M.has(W.ID)){var fe=W.ID,ve=e.get(fe);ve.parents.forEach(function(pe){if(A.has(pe.ID)){var Me=A.get(pe.ID);Me.bind(new zl(O.bones),F[pe.ID])}})}})}},parsePoseNodes:function(){var E={};if("Pose"in i.Objects){var M=i.Objects.Pose;for(var A in M)if(M[A].attrType==="BindPose"){var F=M[A].PoseNode;Array.isArray(F)?F.forEach(function(P){E[P.Node]=new xe().fromArray(P.Matrix.a)}):E[F.Node]=new xe().fromArray(F.Matrix.a)}}return E},createAmbientLight:function(){if("GlobalSettings"in i&&"AmbientColor"in i.GlobalSettings){var E=i.GlobalSettings.AmbientColor.value,M=E[0],A=E[1],F=E[2];if(M!==0||A!==0||F!==0){var P=new Ee(M,A,F);t.add(new Zc(P,1))}}},setupMorphMaterials:function(){var E=this;t.traverse(function(M){M.isMesh&&M.geometry.morphAttributes.position&&M.geometry.morphAttributes.position.length&&(Array.isArray(M.material)?M.material.forEach(function(A,F){E.setupMorphMaterial(M,A,F)}):E.setupMorphMaterial(M,M.material))})},setupMorphMaterial:function(E,M,A){var F=E.uuid,P=M.uuid,O=!1;if(t.traverse(function(W){W.isMesh&&(Array.isArray(W.material)?W.material.forEach(function(fe){fe.uuid===P&&W.uuid!==F&&(O=!0)}):W.material.uuid===P&&W.uuid!==F&&(O=!0))}),O===!0){var V=M.clone();V.morphTargets=!0,A===void 0?E.material=V:E.material[A]=V}else M.morphTargets=!0}};function r(){}r.prototype={constructor:r,parse:function(E){var M=new Map;if("Geometry"in i.Objects){var A=i.Objects.Geometry;for(var F in A){var P=e.get(parseInt(F)),O=this.parseGeometry(P,A[F],E);M.set(parseInt(F),O)}}return M},parseGeometry:function(E,M,A){switch(M.attrType){case"Mesh":return this.parseMeshGeometry(E,M,A);case"NurbsCurve":return this.parseNurbsGeometry(M)}},parseMeshGeometry:function(E,M,A){var F=A.skeletons,P=[],O=E.parents.map(function(pe){return i.Objects.Model[pe.ID]});if(O.length!==0){var V=E.children.reduce(function(pe,Me){return F[Me.ID]!==void 0&&(pe=F[Me.ID]),pe},null);E.children.forEach(function(pe){A.morphTargets[pe.ID]!==void 0&&P.push(A.morphTargets[pe.ID])});var W=O[0],fe={};"RotationOrder"in W&&(fe.eulerOrder=I(W.RotationOrder.value)),"InheritType"in W&&(fe.inheritType=parseInt(W.InheritType.value)),"GeometricTranslation"in W&&(fe.translation=W.GeometricTranslation.value),"GeometricRotation"in W&&(fe.rotation=W.GeometricRotation.value),"GeometricScaling"in W&&(fe.scale=W.GeometricScaling.value);var ve=R(fe);return this.genGeometry(M,V,P,ve)}},genGeometry:function(E,M,A,F){var P=new wt;E.attrName&&(P.name=E.attrName);var O=this.parseGeoNode(E,M),V=this.genBuffers(O),W=new ft(V.vertex,3);if(W.applyMatrix4(F),P.setAttribute("position",W),V.colors.length>0&&P.setAttribute("color",new ft(V.colors,3)),M&&(P.setAttribute("skinIndex",new Ra(V.weightsIndices,4)),P.setAttribute("skinWeight",new ft(V.vertexWeights,4)),P.FBX_Deformer=M),V.normal.length>0){var fe=new rn().getNormalMatrix(F),ve=new ft(V.normal,3);ve.applyNormalMatrix(fe),P.setAttribute("normal",ve)}if(V.uvs.forEach(function(bt,Ie){var Y="uv"+(Ie+1).toString();Ie===0&&(Y="uv"),P.setAttribute(Y,new ft(V.uvs[Ie],2))}),O.material&&O.material.mappingType!=="AllSame"){var pe=V.materialIndex[0],Me=0;if(V.materialIndex.forEach(function(bt,Ie){bt!==pe&&(P.addGroup(Me,Ie-Me,pe),pe=bt,Me=Ie)}),P.groups.length>0){var Fe=P.groups[P.groups.length-1],at=Fe.start+Fe.count;at!==V.materialIndex.length&&P.addGroup(at,V.materialIndex.length-at,pe)}P.groups.length===0&&P.addGroup(0,V.materialIndex.length,V.materialIndex[0])}return this.addMorphTargets(P,E,A,F),P},parseGeoNode:function(E,M){var A={};if(A.vertexPositions=E.Vertices!==void 0?E.Vertices.a:[],A.vertexIndices=E.PolygonVertexIndex!==void 0?E.PolygonVertexIndex.a:[],E.LayerElementColor&&(A.color=this.parseVertexColors(E.LayerElementColor[0])),E.LayerElementMaterial&&(A.material=this.parseMaterialIndices(E.LayerElementMaterial[0])),E.LayerElementNormal&&(A.normal=this.parseNormals(E.LayerElementNormal[0])),E.LayerElementUV){A.uv=[];for(var F=0;E.LayerElementUV[F];)E.LayerElementUV[F].UV&&A.uv.push(this.parseUVs(E.LayerElementUV[F])),F++}return A.weightTable={},M!==null&&(A.skeleton=M,M.rawBones.forEach(function(P,O){P.indices.forEach(function(V,W){A.weightTable[V]===void 0&&(A.weightTable[V]=[]),A.weightTable[V].push({id:O,weight:P.weights[W]})})})),A},genBuffers:function(E){var M={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},A=0,F=0,P=!1,O=[],V=[],W=[],fe=[],ve=[],pe=[],Me=this;return E.vertexIndices.forEach(function(Fe,at){var bt=!1;Fe<0&&(Fe=Fe^-1,bt=!0);var Ie=[],Y=[];if(O.push(Fe*3,Fe*3+1,Fe*3+2),E.color){var X=_(at,A,Fe,E.color);W.push(X[0],X[1],X[2])}if(E.skeleton){if(E.weightTable[Fe]!==void 0&&E.weightTable[Fe].forEach(function(le){Y.push(le.weight),Ie.push(le.id)}),Y.length>4){P||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),P=!0);var ce=[0,0,0,0],ie=[0,0,0,0];Y.forEach(function(le,oe){var we=le,Le=Ie[oe];ie.forEach(function(Ae,K,Q){if(we>Ae){Q[K]=we,we=Ae;var Ue=ce[K];ce[K]=Le,Le=Ue}})}),Ie=ce,Y=ie}for(;Y.length<4;)Y.push(0),Ie.push(0);for(var he=0;he<4;++he)ve.push(Y[he]),pe.push(Ie[he])}if(E.normal){var X=_(at,A,Fe,E.normal);V.push(X[0],X[1],X[2])}if(E.material&&E.material.mappingType!=="AllSame")var ge=_(at,A,Fe,E.material)[0];E.uv&&E.uv.forEach(function(le,oe){var we=_(at,A,Fe,le);fe[oe]===void 0&&(fe[oe]=[]),fe[oe].push(we[0]),fe[oe].push(we[1])}),F++,bt&&(Me.genFace(M,E,O,ge,V,W,fe,ve,pe,F),A++,F=0,O=[],V=[],W=[],fe=[],ve=[],pe=[])}),M},genFace:function(E,M,A,F,P,O,V,W,fe,ve){for(var pe=2;pe<ve;pe++)E.vertex.push(M.vertexPositions[A[0]]),E.vertex.push(M.vertexPositions[A[1]]),E.vertex.push(M.vertexPositions[A[2]]),E.vertex.push(M.vertexPositions[A[(pe-1)*3]]),E.vertex.push(M.vertexPositions[A[(pe-1)*3+1]]),E.vertex.push(M.vertexPositions[A[(pe-1)*3+2]]),E.vertex.push(M.vertexPositions[A[pe*3]]),E.vertex.push(M.vertexPositions[A[pe*3+1]]),E.vertex.push(M.vertexPositions[A[pe*3+2]]),M.skeleton&&(E.vertexWeights.push(W[0]),E.vertexWeights.push(W[1]),E.vertexWeights.push(W[2]),E.vertexWeights.push(W[3]),E.vertexWeights.push(W[(pe-1)*4]),E.vertexWeights.push(W[(pe-1)*4+1]),E.vertexWeights.push(W[(pe-1)*4+2]),E.vertexWeights.push(W[(pe-1)*4+3]),E.vertexWeights.push(W[pe*4]),E.vertexWeights.push(W[pe*4+1]),E.vertexWeights.push(W[pe*4+2]),E.vertexWeights.push(W[pe*4+3]),E.weightsIndices.push(fe[0]),E.weightsIndices.push(fe[1]),E.weightsIndices.push(fe[2]),E.weightsIndices.push(fe[3]),E.weightsIndices.push(fe[(pe-1)*4]),E.weightsIndices.push(fe[(pe-1)*4+1]),E.weightsIndices.push(fe[(pe-1)*4+2]),E.weightsIndices.push(fe[(pe-1)*4+3]),E.weightsIndices.push(fe[pe*4]),E.weightsIndices.push(fe[pe*4+1]),E.weightsIndices.push(fe[pe*4+2]),E.weightsIndices.push(fe[pe*4+3])),M.color&&(E.colors.push(O[0]),E.colors.push(O[1]),E.colors.push(O[2]),E.colors.push(O[(pe-1)*3]),E.colors.push(O[(pe-1)*3+1]),E.colors.push(O[(pe-1)*3+2]),E.colors.push(O[pe*3]),E.colors.push(O[pe*3+1]),E.colors.push(O[pe*3+2])),M.material&&M.material.mappingType!=="AllSame"&&(E.materialIndex.push(F),E.materialIndex.push(F),E.materialIndex.push(F)),M.normal&&(E.normal.push(P[0]),E.normal.push(P[1]),E.normal.push(P[2]),E.normal.push(P[(pe-1)*3]),E.normal.push(P[(pe-1)*3+1]),E.normal.push(P[(pe-1)*3+2]),E.normal.push(P[pe*3]),E.normal.push(P[pe*3+1]),E.normal.push(P[pe*3+2])),M.uv&&M.uv.forEach(function(Me,Fe){E.uvs[Fe]===void 0&&(E.uvs[Fe]=[]),E.uvs[Fe].push(V[Fe][0]),E.uvs[Fe].push(V[Fe][1]),E.uvs[Fe].push(V[Fe][(pe-1)*2]),E.uvs[Fe].push(V[Fe][(pe-1)*2+1]),E.uvs[Fe].push(V[Fe][pe*2]),E.uvs[Fe].push(V[Fe][pe*2+1])})},addMorphTargets:function(E,M,A,F){if(A.length!==0){E.morphTargetsRelative=!0,E.morphAttributes.position=[];var P=this;A.forEach(function(O){O.rawTargets.forEach(function(V){var W=i.Objects.Geometry[V.geoID];W!==void 0&&P.genMorphGeometry(E,M,W,F,V.name)})})}},genMorphGeometry:function(E,M,A,F,P){for(var O=M.PolygonVertexIndex!==void 0?M.PolygonVertexIndex.a:[],V=A.Vertices!==void 0?A.Vertices.a:[],W=A.Indexes!==void 0?A.Indexes.a:[],fe=E.attributes.position.count*3,ve=new Float32Array(fe),pe=0;pe<W.length;pe++){var Me=W[pe]*3;ve[Me]=V[pe*3],ve[Me+1]=V[pe*3+1],ve[Me+2]=V[pe*3+2]}var Fe={vertexIndices:O,vertexPositions:ve},at=this.genBuffers(Fe),bt=new ft(at.vertex,3);bt.name=P||A.attrName,bt.applyMatrix4(F),E.morphAttributes.position.push(bt)},parseNormals:function(E){var M=E.MappingInformationType,A=E.ReferenceInformationType,F=E.Normals.a,P=[];return A==="IndexToDirect"&&("NormalIndex"in E?P=E.NormalIndex.a:"NormalsIndex"in E&&(P=E.NormalsIndex.a)),{dataSize:3,buffer:F,indices:P,mappingType:M,referenceType:A}},parseUVs:function(E){var M=E.MappingInformationType,A=E.ReferenceInformationType,F=E.UV.a,P=[];return A==="IndexToDirect"&&(P=E.UVIndex.a),{dataSize:2,buffer:F,indices:P,mappingType:M,referenceType:A}},parseVertexColors:function(E){var M=E.MappingInformationType,A=E.ReferenceInformationType,F=E.Colors.a,P=[];return A==="IndexToDirect"&&(P=E.ColorIndex.a),{dataSize:4,buffer:F,indices:P,mappingType:M,referenceType:A}},parseMaterialIndices:function(E){var M=E.MappingInformationType,A=E.ReferenceInformationType;if(M==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:A};for(var F=E.Materials.a,P=[],O=0;O<F.length;++O)P.push(O);return{dataSize:1,buffer:F,indices:P,mappingType:M,referenceType:A}},parseNurbsGeometry:function(E){if(n0===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new wt;var M=parseInt(E.Order);if(isNaN(M))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",E.Order,E.id),new wt;for(var A=M-1,F=E.KnotVector.a,P=[],O=E.Points.a,V=0,W=O.length;V<W;V+=4)P.push(new _t().fromArray(O,V));var fe,ve;if(E.Form==="Closed")P.push(P[0]);else if(E.Form==="Periodic"){fe=A,ve=F.length-1-fe;for(var V=0;V<A;++V)P.push(P[V])}var pe=new n0(A,F,P,fe,ve),Me=pe.getPoints(P.length*7),Fe=new Float32Array(Me.length*3);Me.forEach(function(bt,Ie){bt.toArray(Fe,Ie*3)});var at=new wt;return at.setAttribute("position",new tt(Fe,3)),at}};function o(){}o.prototype={constructor:o,parse:function(){var E=[],M=this.parseClips();if(M!==void 0)for(var A in M){var F=M[A],P=this.addClip(F);E.push(P)}return E},parseClips:function(){if(i.Objects.AnimationCurve!==void 0){var E=this.parseAnimationCurveNodes();this.parseAnimationCurves(E);var M=this.parseAnimationLayers(E),A=this.parseAnimStacks(M);return A}},parseAnimationCurveNodes:function(){var E=i.Objects.AnimationCurveNode,M=new Map;for(var A in E){var F=E[A];if(F.attrName.match(/S|R|T|DeformPercent/)!==null){var P={id:F.id,attr:F.attrName,curves:{}};M.set(P.id,P)}}return M},parseAnimationCurves:function(E){var M=i.Objects.AnimationCurve;for(var A in M){var F={id:M[A].id,times:M[A].KeyTime.a.map(m),values:M[A].KeyValueFloat.a},P=e.get(F.id);if(P!==void 0){var O=P.parents[0].ID,V=P.parents[0].relationship;V.match(/X/)?E.get(O).curves.x=F:V.match(/Y/)?E.get(O).curves.y=F:V.match(/Z/)?E.get(O).curves.z=F:V.match(/d|DeformPercent/)&&E.has(O)&&(E.get(O).curves.morph=F)}}},parseAnimationLayers:function(E){var M=i.Objects.AnimationLayer,A=new Map;for(var F in M){var P=[],O=e.get(parseInt(F));if(O!==void 0){var V=O.children;V.forEach(function(W,fe){if(E.has(W.ID)){var ve=E.get(W.ID);if(ve.curves.x!==void 0||ve.curves.y!==void 0||ve.curves.z!==void 0){if(P[fe]===void 0){var pe=e.get(W.ID).parents.filter(function(Y){return Y.relationship!==void 0})[0].ID;if(pe!==void 0){var Me=i.Objects.Model[pe.toString()];if(Me===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",W);return}var Fe={modelName:Me.attrName?an.sanitizeNodeName(Me.attrName):"",ID:Me.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};t.traverse(function(Y){Y.ID===Me.id&&(Fe.transform=Y.matrix,Y.userData.transformData&&(Fe.eulerOrder=Y.userData.transformData.eulerOrder))}),Fe.transform||(Fe.transform=new xe),"PreRotation"in Me&&(Fe.preRotation=Me.PreRotation.value),"PostRotation"in Me&&(Fe.postRotation=Me.PostRotation.value),P[fe]=Fe}}P[fe]&&(P[fe][ve.attr]=ve)}else if(ve.curves.morph!==void 0){if(P[fe]===void 0){var at=e.get(W.ID).parents.filter(function(ie){return ie.relationship!==void 0})[0].ID,bt=e.get(at).parents[0].ID,Ie=e.get(bt).parents[0].ID,pe=e.get(Ie).parents[0].ID,Me=i.Objects.Model[pe],Fe={modelName:Me.attrName?an.sanitizeNodeName(Me.attrName):"",morphName:i.Objects.Deformer[at].attrName};P[fe]=Fe}P[fe][ve.attr]=ve}}}),A.set(parseInt(F),P)}}return A},parseAnimStacks:function(E){var M=i.Objects.AnimationStack,A={};for(var F in M){var P=e.get(parseInt(F)).children;P.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var O=E.get(P[0].ID);A[F]={name:M[F].attrName,layer:O}}return A},addClip:function(E){var M=[],A=this;return E.layer.forEach(function(F){M=M.concat(A.generateTracks(F))}),new as(E.name,-1,M)},generateTracks:function(E){var M=[],A=new S,F=new Ei,P=new S;if(E.transform&&E.transform.decompose(A,F,P),A=A.toArray(),F=new Mt().setFromQuaternion(F,E.eulerOrder).toArray(),P=P.toArray(),E.T!==void 0&&Object.keys(E.T.curves).length>0){var O=this.generateVectorTrack(E.modelName,E.T.curves,A,"position");O!==void 0&&M.push(O)}if(E.R!==void 0&&Object.keys(E.R.curves).length>0){var V=this.generateRotationTrack(E.modelName,E.R.curves,F,E.preRotation,E.postRotation,E.eulerOrder);V!==void 0&&M.push(V)}if(E.S!==void 0&&Object.keys(E.S.curves).length>0){var W=this.generateVectorTrack(E.modelName,E.S.curves,P,"scale");W!==void 0&&M.push(W)}if(E.DeformPercent!==void 0){var fe=this.generateMorphTrack(E);fe!==void 0&&M.push(fe)}return M},generateVectorTrack:function(E,M,A,F){var P=this.getTimesForAllAxes(M),O=this.getKeyframeTrackValues(P,M,A);return new Ua(E+"."+F,P,O)},generateRotationTrack:function(E,M,A,F,P,O){M.x!==void 0&&(this.interpolateRotations(M.x),M.x.values=M.x.values.map(rt.degToRad)),M.y!==void 0&&(this.interpolateRotations(M.y),M.y.values=M.y.values.map(rt.degToRad)),M.z!==void 0&&(this.interpolateRotations(M.z),M.z.values=M.z.values.map(rt.degToRad));var V=this.getTimesForAllAxes(M),W=this.getKeyframeTrackValues(V,M,A);F!==void 0&&(F=F.map(rt.degToRad),F.push(O),F=new Mt().fromArray(F),F=new Ei().setFromEuler(F)),P!==void 0&&(P=P.map(rt.degToRad),P.push(O),P=new Mt().fromArray(P),P=new Ei().setFromEuler(P).invert());for(var fe=new Ei,ve=new Mt,pe=[],Me=0;Me<W.length;Me+=3)ve.set(W[Me],W[Me+1],W[Me+2],O),fe.setFromEuler(ve),F!==void 0&&fe.premultiply(F),P!==void 0&&fe.multiply(P),fe.toArray(pe,Me/3*4);return new ql(E+".quaternion",V,pe)},generateMorphTrack:function(E){var M=E.DeformPercent.curves.morph,A=M.values.map(function(P){return P/100}),F=t.getObjectByName(E.modelName).morphTargetDictionary[E.morphName];return new za(E.modelName+".morphTargetInfluences["+F+"]",M.times,A)},getTimesForAllAxes:function(E){var M=[];if(E.x!==void 0&&(M=M.concat(E.x.times)),E.y!==void 0&&(M=M.concat(E.y.times)),E.z!==void 0&&(M=M.concat(E.z.times)),M=M.sort(function(V,W){return V-W}),M.length>1){for(var A=1,F=M[0],P=1;P<M.length;P++){var O=M[P];O!==F&&(M[A]=O,F=O,A++)}M=M.slice(0,A)}return M},getKeyframeTrackValues:function(E,M,A){var F=A,P=[],O=-1,V=-1,W=-1;return E.forEach(function(fe){if(M.x&&(O=M.x.times.indexOf(fe)),M.y&&(V=M.y.times.indexOf(fe)),M.z&&(W=M.z.times.indexOf(fe)),O!==-1){var ve=M.x.values[O];P.push(ve),F[0]=ve}else P.push(F[0]);if(V!==-1){var pe=M.y.values[V];P.push(pe),F[1]=pe}else P.push(F[1]);if(W!==-1){var Me=M.z.values[W];P.push(Me),F[2]=Me}else P.push(F[2])}),P},interpolateRotations:function(E){for(var M=1;M<E.values.length;M++){var A=E.values[M-1],F=E.values[M]-A,P=Math.abs(F);if(P>=180){for(var O=P/180,V=F/O,W=A+V,fe=E.times[M-1],ve=E.times[M]-fe,pe=ve/O,Me=fe+pe,Fe=[],at=[];Me<E.times[M];)Fe.push(Me),Me+=pe,at.push(W),W+=V;E.times=se(E.times,M,Fe),E.values=se(E.values,M,at)}}}};function a(){}a.prototype={constructor:a,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(E){this.nodeStack.push(E),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(E,M){this.currentProp=E,this.currentPropName=M},parse:function(E){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var M=this,A=E.split(/[\r\n]+/);return A.forEach(function(F,P){var O=F.match(/^[\s\t]*;/),V=F.match(/^[\s\t]*$/);if(!(O||V)){var W=F.match("^\\t{"+M.currentIndent+"}(\\w+):(.*){",""),fe=F.match("^\\t{"+M.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),ve=F.match("^\\t{"+(M.currentIndent-1)+"}}");W?M.parseNodeBegin(F,W):fe?M.parseNodeProperty(F,fe,A[++P]):ve?M.popStack():F.match(/^[^\s\t}]/)&&M.parseNodePropertyContinued(F)}}),this.allNodes},parseNodeBegin:function(E,M){var A=M[1].trim().replace(/^"/,"").replace(/"$/,""),F=M[2].split(",").map(function(W){return W.trim().replace(/^"/,"").replace(/"$/,"")}),P={name:A},O=this.parseNodeAttr(F),V=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(A,P):A in V?(A==="PoseNode"?V.PoseNode.push(P):V[A].id!==void 0&&(V[A]={},V[A][V[A].id]=V[A]),O.id!==""&&(V[A][O.id]=P)):typeof O.id=="number"?(V[A]={},V[A][O.id]=P):A!=="Properties70"&&(A==="PoseNode"?V[A]=[P]:V[A]=P),typeof O.id=="number"&&(P.id=O.id),O.name!==""&&(P.attrName=O.name),O.type!==""&&(P.attrType=O.type),this.pushStack(P)},parseNodeAttr:function(E){var M=E[0];E[0]!==""&&(M=parseInt(E[0]),isNaN(M)&&(M=E[0]));var A="",F="";return E.length>1&&(A=E[1].replace(/^(\w+)::/,""),F=E[2]),{id:M,name:A,type:F}},parseNodeProperty:function(E,M,A){var F=M[1].replace(/^"/,"").replace(/"$/,"").trim(),P=M[2].replace(/^"/,"").replace(/"$/,"").trim();F==="Content"&&P===","&&(P=A.replace(/"/g,"").replace(/,$/,"").trim());var O=this.getCurrentNode(),V=O.name;if(V==="Properties70"){this.parseNodeSpecialProperty(E,F,P);return}if(F==="C"){var W=P.split(",").slice(1),fe=parseInt(W[0]),ve=parseInt(W[1]),pe=P.split(",").slice(3);pe=pe.map(function(Me){return Me.trim().replace(/^"/,"")}),F="connections",P=[fe,ve],J(P,pe),O[F]===void 0&&(O[F]=[])}F==="Node"&&(O.id=P),F in O&&Array.isArray(O[F])?O[F].push(P):F!=="a"?O[F]=P:O.a=P,this.setCurrentProp(O,F),F==="a"&&P.slice(-1)!==","&&(O.a=B(P))},parseNodePropertyContinued:function(E){var M=this.getCurrentNode();M.a+=E,E.slice(-1)!==","&&(M.a=B(M.a))},parseNodeSpecialProperty:function(E,M,A){var F=A.split('",').map(function(ve){return ve.trim().replace(/^\"/,"").replace(/\s/,"_")}),P=F[0],O=F[1],V=F[2],W=F[3],fe=F[4];switch(O){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":fe=parseFloat(fe);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":fe=B(fe);break}this.getPrevNode()[P]={type:O,type2:V,flag:W,value:fe},this.setCurrentProp(this.getPrevNode(),P)}};function l(){}l.prototype={constructor:l,parse:function(E){var M=new c(E);M.skip(23);var A=M.getUint32();if(A<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+A);for(var F=new u;!this.endOfContent(M);){var P=this.parseNode(M,A);P!==null&&F.add(P.name,P)}return F},endOfContent:function(E){return E.size()%16===0?(E.getOffset()+160+16&-16)>=E.size():E.getOffset()+160+16>=E.size()},parseNode:function(E,M){var A={},F=M>=7500?E.getUint64():E.getUint32(),P=M>=7500?E.getUint64():E.getUint32();M>=7500?E.getUint64():E.getUint32();var O=E.getUint8(),V=E.getString(O);if(F===0)return null;for(var W=[],fe=0;fe<P;fe++)W.push(this.parseProperty(E));var ve=W.length>0?W[0]:"",pe=W.length>1?W[1]:"",Me=W.length>2?W[2]:"";for(A.singleProperty=P===1&&E.getOffset()===F;F>E.getOffset();){var Fe=this.parseNode(E,M);Fe!==null&&this.parseSubNode(V,A,Fe)}return A.propertyList=W,typeof ve=="number"&&(A.id=ve),pe!==""&&(A.attrName=pe),Me!==""&&(A.attrType=Me),V!==""&&(A.name=V),A},parseSubNode:function(E,M,A){if(A.singleProperty===!0){var F=A.propertyList[0];Array.isArray(F)?(M[A.name]=A,A.a=F):M[A.name]=F}else if(E==="Connections"&&A.name==="C"){var P=[];A.propertyList.forEach(function(Me,Fe){Fe!==0&&P.push(Me)}),M.connections===void 0&&(M.connections=[]),M.connections.push(P)}else if(A.name==="Properties70"){var O=Object.keys(A);O.forEach(function(Me){M[Me]=A[Me]})}else if(E==="Properties70"&&A.name==="P"){var V=A.propertyList[0],W=A.propertyList[1],fe=A.propertyList[2],ve=A.propertyList[3],pe;V.indexOf("Lcl ")===0&&(V=V.replace("Lcl ","Lcl_")),W.indexOf("Lcl ")===0&&(W=W.replace("Lcl ","Lcl_")),W==="Color"||W==="ColorRGB"||W==="Vector"||W==="Vector3D"||W.indexOf("Lcl_")===0?pe=[A.propertyList[4],A.propertyList[5],A.propertyList[6]]:pe=A.propertyList[4],M[V]={type:W,type2:fe,flag:ve,value:pe}}else M[A.name]===void 0?typeof A.id=="number"?(M[A.name]={},M[A.name][A.id]=A):M[A.name]=A:A.name==="PoseNode"?(Array.isArray(M[A.name])||(M[A.name]=[M[A.name]]),M[A.name].push(A)):M[A.name][A.id]===void 0&&(M[A.name][A.id]=A)},parseProperty:function(E){var M=E.getString(1);switch(M){case"C":return E.getBoolean();case"D":return E.getFloat64();case"F":return E.getFloat32();case"I":return E.getInt32();case"L":return E.getInt64();case"R":var A=E.getUint32();return E.getArrayBuffer(A);case"S":var A=E.getUint32();return E.getString(A);case"Y":return E.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var F=E.getUint32(),P=E.getUint32(),O=E.getUint32();if(P===0)switch(M){case"b":case"c":return E.getBooleanArray(F);case"d":return E.getFloat64Array(F);case"f":return E.getFloat32Array(F);case"i":return E.getInt32Array(F);case"l":return E.getInt64Array(F)}typeof i0>"u"&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var V=new i0(new Uint8Array(E.getArrayBuffer(O))),W=new c(V.decompress().buffer);switch(M){case"b":case"c":return W.getBooleanArray(F);case"d":return W.getFloat64Array(F);case"f":return W.getFloat32Array(F);case"i":return W.getInt32Array(F);case"l":return W.getInt64Array(F)}default:throw new Error("THREE.FBXLoader: Unknown property type "+M)}}};function c(E,M){this.dv=new DataView(E),this.offset=0,this.littleEndian=M!==void 0?M:!0}c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(E){this.offset+=E},getBoolean:function(){return(this.getUint8()&1)===1},getBooleanArray:function(E){for(var M=[],A=0;A<E;A++)M.push(this.getBoolean());return M},getUint8:function(){var E=this.dv.getUint8(this.offset);return this.offset+=1,E},getInt16:function(){var E=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,E},getInt32:function(){var E=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,E},getInt32Array:function(E){for(var M=[],A=0;A<E;A++)M.push(this.getInt32());return M},getUint32:function(){var E=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,E},getInt64:function(){var E,M;return this.littleEndian?(E=this.getUint32(),M=this.getUint32()):(M=this.getUint32(),E=this.getUint32()),M&2147483648?(M=~M&4294967295,E=~E&4294967295,E===4294967295&&(M=M+1&4294967295),E=E+1&4294967295,-(M*4294967296+E)):M*4294967296+E},getInt64Array:function(E){for(var M=[],A=0;A<E;A++)M.push(this.getInt64());return M},getUint64:function(){var E,M;return this.littleEndian?(E=this.getUint32(),M=this.getUint32()):(M=this.getUint32(),E=this.getUint32()),M*4294967296+E},getFloat32:function(){var E=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,E},getFloat32Array:function(E){for(var M=[],A=0;A<E;A++)M.push(this.getFloat32());return M},getFloat64:function(){var E=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,E},getFloat64Array:function(E){for(var M=[],A=0;A<E;A++)M.push(this.getFloat64());return M},getArrayBuffer:function(E){var M=this.dv.buffer.slice(this.offset,this.offset+E);return this.offset+=E,M},getString:function(E){for(var M=[],A=0;A<E;A++)M[A]=this.getUint8();var F=M.indexOf(0);return F>=0&&(M=M.slice(0,F)),Or.decodeText(new Uint8Array(M))}};function u(){}u.prototype={constructor:u,add:function(E,M){this[E]=M}};function h(E){var M="Kaydara FBX Binary  \0";return E.byteLength>=M.length&&M===N(E,0,M.length)}function d(E){var M=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],A=0;function F(V){var W=E[V-1];return E=E.slice(A+V),A++,W}for(var P=0;P<M.length;++P){var O=F(1);if(O===M[P])return!1}return!0}function f(E){var M=/FBXVersion: (\d+)/,A=E.match(M);if(A){var F=parseInt(A[1]);return F}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function m(E){return E/46186158e3}var v=[];function _(E,M,A,F){var P;switch(F.mappingType){case"ByPolygonVertex":P=E;break;case"ByPolygon":P=M;break;case"ByVertice":P=A;break;case"AllSame":P=F.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+F.mappingType)}F.referenceType==="IndexToDirect"&&(P=F.indices[P]);var O=P*F.dataSize,V=O+F.dataSize;return ne(v,F.buffer,O,V)}var y=new Mt,x=new S;function R(E){var M=new xe,A=new xe,F=new xe,P=new xe,O=new xe,V=new xe,W=new xe,fe=new xe,ve=new xe,pe=new xe,Me=new xe,Fe=E.inheritType?E.inheritType:0;if(E.translation&&M.setPosition(x.fromArray(E.translation)),E.preRotation){var at=E.preRotation.map(rt.degToRad);at.push(E.eulerOrder),A.makeRotationFromEuler(y.fromArray(at))}if(E.rotation){var at=E.rotation.map(rt.degToRad);at.push(E.eulerOrder),F.makeRotationFromEuler(y.fromArray(at))}if(E.postRotation){var at=E.postRotation.map(rt.degToRad);at.push(E.eulerOrder),P.makeRotationFromEuler(y.fromArray(at))}E.scale&&O.scale(x.fromArray(E.scale)),E.scalingOffset&&W.setPosition(x.fromArray(E.scalingOffset)),E.scalingPivot&&V.setPosition(x.fromArray(E.scalingPivot)),E.rotationOffset&&fe.setPosition(x.fromArray(E.rotationOffset)),E.rotationPivot&&ve.setPosition(x.fromArray(E.rotationPivot)),E.parentMatrixWorld&&(pe=E.parentMatrixWorld);var bt=A.multiply(F).multiply(P),Ie=new xe;pe.extractRotation(Ie);var Y=new xe;Y.copyPosition(pe);var X=new xe;X.copy(Ie).invert().multiply(pe);var ce=new xe;if(Fe===0)ce.copy(Ie).multiply(bt).multiply(X).multiply(O);else if(Fe===1)ce.copy(Ie).multiply(X).multiply(bt).multiply(O);else{var ie=new xe;ie.copy(O).invert();var he=new xe().multiply(X).multiply(ie);ce.copy(Ie).multiply(bt).multiply(he).multiply(O)}var ge=new xe;ge.copy(ve).invert();var le=new xe;le.copy(V).invert();var oe=new xe;oe.copy(M).multiply(fe).multiply(ve).multiply(A).multiply(F).multiply(P).multiply(ge).multiply(W).multiply(V).multiply(O).multiply(le);var we=new xe().copyPosition(oe),Le=new xe().copy(pe).multiply(we);return Me.copyPosition(Le),oe=new xe().multiply(Me).multiply(ce),oe}function I(E){E=E||0;var M=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return E===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),M[0]):M[E]}function B(E){var M=E.split(",").map(function(A){return parseFloat(A)});return M}function N(E,M,A){return M===void 0&&(M=0),A===void 0&&(A=E.byteLength),Or.decodeText(new Uint8Array(E,M,A))}function J(E,M){for(var A=0,F=E.length,P=M.length;A<P;A++,F++)E[F]=M[A]}function ne(E,M,A,F){for(var P=A,O=0;P<F;P++,O++)E[O]=M[P];return E}function se(E,M,A){return E.slice(0,M).concat(A).concat(E.slice(M))}return n}();let AE,CE=new rM,oM=new Li(1,128,128),aM=new Li(1,128,128),Tf=new Ut({side:Xi,transparent:!0,opacity:1,depthOffset:1}),lM=new Ut({side:Xi,transparent:!0,opacity:1,depthOffset:1}),DE=new Ut({side:Xi,transparent:!0,opacity:1,depthOffset:1,color:16711680}),s0=new kr,Vr=null,Gh={controls:null,position:null,target:null};class cM{constructor(e,t,n,s,r,o,a,l){this.file=e,this.longitude=t,this.latitude=n,this.altitude=s,this.course=r,this.pitch=o,this.roll=a,this.index=l,this.mesh=null}}class uM extends Ne{constructor(e){super(),this.viewer=e,this.selectingEnabled=!0,this.images=[],this.node=new qe,this.sphere=new ot(aM,lM),this.sphere.visible=!1,this.sphere.scale.set(1e3,1e3,1e3),this.node.add(this.sphere),this._visible=!0,this.focusedImage=null,this.viewer.addEventListener("update",()=>{this.update()}),this.viewer.inputHandler.addInputListener(this),this.addEventListener("mousedown",()=>{Vr?(Vr.image360&&this.viewer.dispatchEvent({type:"selectPoints",info:Vr.image360,current:this}),Vr.parent.image360&&this.viewer.dispatchEvent({type:"selectPoints",info:Vr.parent.image360,current:this})):this.viewer.dispatchEvent({type:"pointsFocus",info:null,current:this})})}set visible(e){if(this._visible!==e){for(const t of this.images)t.mesh.visible=e&&this.focusedImage==null;this.sphere.visible=e&&this.focusedImage!=null,this._visible=e,this.dispatchEvent({type:"visibility_changed",images:this})}}get visible(){return this._visible}focus(e){this.focusedImage!==null&&this.unfocus(),Gh={controls:this.viewer.controls,position:this.viewer.scene.view.position.clone(),target:this.viewer.scene.view.getPivot()};for(let o of this.images){let a=10;o.mesh.scale.set(1/a,1/a,1/a)}this.selectingEnabled=!1,this.sphere.visible=!1;{let{course:o,pitch:a,roll:l}=e;this.sphere.rotation.set(rt.degToRad(+l+90),rt.degToRad(-a),rt.degToRad(-o+90),"ZYX")}this.sphere.position.set(...e.position);let t=new S(...e.position),s=t.clone().sub(this.viewer.scene.view.position).normalize().multiplyScalar(.5),r=t.clone().sub(s);this.viewer.scene.view.setView(r,t,500),this.focusedImage=e,Vr&&this.viewer.dispatchEvent({type:"pointsFocus",info:Vr.image360,current:this})}unfocus(){this.selectingEnabled=!0;for(let a of this.images)a.mesh.visible=!0;if(this.focusedImage===null)return;this.sphere.material.map=null,this.sphere.material.needsUpdate=!0,this.sphere.visible=!1;let t=this.viewer.scene.view.position,n=this.viewer.scene.view.getPivot(),r=n.clone().sub(t).normalize().multiplyScalar(10),o=n.clone().sub(r);this.viewer.orbitControls.doubleClockZoomEnabled=!0,this.viewer.setControls(Gh.controls),this.viewer.scene.view.setView(Gh.position,Gh.target,500),this.focusedImage=null}load(e){return new Promise(t=>{let n=new jn().load(e.file,t);n.wrapS=vi,n.repeat.x=-1,e.texture=n})}handleHovering(){let e=this.viewer.inputHandler.mouse,t=this.viewer.scene.getActiveCamera(),n=this.viewer.renderer.domElement,s=Potree.Utils.mouseToRay(e,t,n.clientWidth,n.clientHeight);s0.ray.copy(s);let r=s0.intersectObjects(this.node.children,!0);if(r.length===0)return;let o=r[0];o.object.name=="\u63A7\u5236\u70B9"&&(Vr=o.object,document.body.style.cursor="pointer")}update(){Vr&&(document.body.style.cursor="auto",Vr=null),this.handleHovering()}}class Af{static async load(e,t,n={}){if(n.transform||(n.transform={forward:r=>r}),n.map){let r=new jn().load(n.map);r.wrapS=vi,r.wrapT=vi,r.repeat.set(1,1),Tf.map=r,Tf.needsUpdate=!0}let s=new uM(t);for(let r=0;r<e.length;r++){let o=e[r],a=new cM(o.file,Number(o.long),Number(o.lat),Number(o.alt),o.course,o.pitch,o.roll,r),c=[...n.transform.forward([Number(o.long),Number(o.lat)]),Number(o.alt)];a.position=c,s.images.push(a)}return Af.createSceneNodes(s,n.transform,n),s}static createSceneNodes(e,t,n){for(let a of e.images){let{longitude:l,latitude:c,altitude:u}=a,h=t.forward([l,c]),d=new ot(oM,Tf);d.name="\u63A7\u5236\u70B9",d.position.set(...h,u),d.scale.set(n.scale,n.scale,n.scale),d.renderOrder=1e3,d.image360=a;{var{course:s,pitch:r,roll:o}=a;d.rotation.set(rt.degToRad(+o+90),rt.degToRad(-r),rt.degToRad(-s+90),"ZYX")}e.node.add(d),a.mesh=d}}}class hM extends Ne{constructor(e,t={}){super(),this.text=t.text?t.text:"\u6D4B\u8BD5",this.viewer=e,this.init()}init(){const e=document.createElement("div");e.className="waterMarker",e.style.position="fixed",e.style.bottom="10px",e.style.right="10px",e.style.zIndex="10",e.style.opacity="0.5",e.style.pointerEvents="none",e.style.color="antiquewhite",e.style.fontSize="20px";const t=document.createElement("div");t.innerHTML=this.text,e.appendChild(t),document.body.appendChild(e)}createTextTexture(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=512,t.height=256,n.font="48px Arial",n.fillStyle="rgba(255, 255, 255, 0.5)",n.textAlign="center",n.textBaseline="middle",n.fillText(e,t.width/2,t.height/2);const s=new oi(t);return s.needsUpdate=!0,s}createTextPlane(e){const t=this.createTextTexture(e),n=new Ut({map:t,transparent:!0}),s=new jc(5,2.5),r=new ot(s,n);return r.position.set(0,0,-5),r}}class dM extends Ne{constructor(e,t){super(),this.viewer=e,this.annotation=void 0,this.raycaster=new kr,this.mouse=new Se,this.eventType=0,this._isClick=!1,this._isClickPopup=!0,this.initParams(t),this.initRaycaster(),this.initAnnotation(),this.initEvent()}get isClick(){return this._isClick}set isClick(e){this._isClick=e,this._isClickPopup==!0&&(this.annotation.visible=!1)}get isClickPopup(){return this._isClickPopup}set isClickPopup(e){this._isClickPopup=e}initParams(e){e.isClick==!0?this._isClick=!0:e.isClick==!1&&(this._isClick=!1),e.isClickPopup==!0?this._isClickPopup=!0:e.isClickPopup==!1&&(this._isClickPopup=!1)}initRaycaster(){this.raycaster.near=0,this.raycaster.far=1e5,this.raycaster.params.Points.threshold=.1}initAnnotation(){this.annotation=new ra({position:[0,0,0],title:"0,0,0"}),this.annotation.visible=!1,this.viewer.scene.annotations.add(this.annotation)}initEvent(){this.viewer.renderArea.addEventListener("mousedown",e=>{if(this._isClick==!0){if(e.button!==this.eventType)return;console.log(e.button,"event.button");var t=this.viewer.renderArea.getBoundingClientRect();let n=e.clientX-t.left,s=e.clientY-t.top;this.mouse.x=n/this.viewer.renderArea.clientWidth*2-1,this.mouse.y=-(s/this.viewer.renderArea.clientHeight)*2+1,this.raycaster.setFromCamera(this.mouse,this.viewer.scene.getActiveCamera());let r=this.raycaster.intersectObjects(this.viewer.scene.pointclouds,!0);if(r.length>0){let a=r[0].point;if(this.eventType==0&&(this.annotation.position.set(a.x,a.y,a.z),this._isClickPopup==!0)){let l="x:"+a.x.toFixed(5)+",y:"+a.y.toFixed(5)+",z:"+a.z.toFixed(5);this.annotation.title=l,this.annotation.visible=!0}this.dispatchEvent({type:"pointPick",position:a,event:e})}else this.annotation.visible=!1}else this.annotation.visible=!1})}setAnnotationTitle(e){this.annotation.title=e}remove(){this.annotation.visible=!1,this.viewer.renderArea.removeEventListener("click",void 0)}}class r0{constructor(){}lngLatToWorld(e,t,n,s){let o=`+proj=tmerc +lat_0=0 +lon_0=${this.calculateCentralMeridian(e[0],t)} +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs`;return proj4(o).forward(e)}calculateCentralMeridian(e,t){return Math.floor(e/t)*t+t/2}}class Cf extends Ne{constructor(e,t){super(),this.viewer=e,this.tagType=1,this.meshs=[],this.initSceneGroup(t)}initSceneGroup(e){e?this.group=e:(this.group=new xn,this.group.name="customTagGroup",this.viewer.scene.scene.add(this.group))}addTag(e,t,n,s,r){if(n&&e){let o=this.getComputedStyle(e,t),a=new yg(o);a.position.set(n.x,n.y,n.z),s&&a.scale.set(s.x,s.y,s.z),r&&a.center.set(r.x,r.y),this.group.add(a),a.layers.set(0);let l={mesh:a,text:e,type:t,position:n,scale:s,center:r};this.meshs.push(l)}}getComputedStyle(e,t){if(this.getType(t)===1){let s=document.createElement("div");s.className="box1",s.style.display="block";let r=document.createElement("div");r.className="titleBox",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.background="rgba(2, 13, 49, 0.7)",r.style.borderColor="rgba(0, 104, 255, 1)",r.style.borderWidth="2px",r.style.boxShadow="none",r.style.borderRadius="100px";let o=document.createElement("span");return o.className="titleBoxSpan",o.style.color="rgba(239, 247, 255, 1)",o.style.fontSize="14px",o.style.fontFamily="MicrosoftYaHei",o.style.fontWeight="700",o.style.marginLeft="10px",o.style.marginRight="10px",o.style.marginTop="5px",o.style.marginBottom="5px",o.style.cursor="pointer",o.textContent=e,r.appendChild(o),s.appendChild(r),s}}getType(e){let t;return e?t=e:t=this.tagType,e}}class fM extends Ne{constructor(e,t,n){super(),this.viewer=e,this.degreeBand=t,this.coord=n,this.meshs=[],this.coordTransformation=new r0,this.initSceneGroup(),this.initMesh()}initSceneGroup(){this.pointGroup=new xn,this.pointGroup.name="customPointPointGroup",this.viewer.scene.scene.add(this.pointGroup),this.textGroup=new xn,this.textGroup.name="customTagGroup",this.viewer.scene.scene.add(this.textGroup),this.tagLayer=new Cf(this.viewer,this.textGroup)}initMesh(){this.geometry=new Li(1,32,32),this.material=new Ut({color:"#ff0000"}),this.mesh=new ot(this.geometry,this.material)}addPoint(e){if(e.length>0)for(let t=0;t<e.length;t++){let n=e[t];if(n.lngLat){let s;n.coordOffset?s=this.handelLngLat(n.lngLat,!0):s=this.handelLngLat(n.lngLat,!1),this.mesh.position.set(s[0],s[1],0);let r=this.mesh.clone();this.pointGroup.add(r);let o;n.tagName?(this.tagLayer.addTag(n.tagName,1,{x:s[0],y:s[1],z:1.5}),o={point:{mesh:r,position:s},tag:this.tagLayer.meshs[t]}):o={point:{mesh:r,position:s}},this.meshs.push(o)}}}handelLngLat(e,t){let n,s;return t?(n=this.coordTransformation.lngLatToWorld(e,this.degreeBand),s=n):(n=this.coordTransformation.lngLatToWorld(e,this.degreeBand),s=[n[0]-this.coord[0],n[1]-this.coord[1],n[2]]),s}}class pM extends Ne{constructor(e,t,n){super(),this.viewer=e,this.tagType=1,this.meshs=[],this.delImgPath=n,this.initSceneGroup(t)}initSceneGroup(e){e?this.group=e:(this.group=new xn,this.group.name="customLableGroup",this.viewer.scene.scene.add(this.group))}addLabel(e,t,n,s,r,o){if(e&&t&&n){let a=this.getComputedStyle(e,t,s),l=new yg(a);l.position.set(n.x,n.y,n.z),r&&l.scale.set(r.x,r.y,r.z),o&&l.center.set(o.x,o.y),this.group.add(l),l.layers.set(0);let c={tag:l,title:e,lisits:t,position:n,type:s,scale:r,center:o};this.meshs.push(c)}}getComputedStyle(e,t,n){if(this.getType(n)===1){let r=document.createElement("div");r.className="box1";let o=document.createElement("div");o.className="box1",o.style.width="255px",o.style.background="rgba(35, 52, 82, 0.4)",o.style.border="1px solid rgba(255, 255, 255, 0.3)",o.style.padding="10px",o.style.fontFamily="SourceHanSansSC-Bold, SourceHanSansSC",o.style.color="#f5f5f5",r.appendChild(o);let a=document.createElement("div");a.className="titleDiv",a.style.display="flex",a.style.flexDirection="row",a.style.justifyContent="space-between",a.style.alignItems="center",a.style.fontSize="18px",a.style.fontWeight="bold",a.style.borderBottom="1px solid rgba(255, 255, 255, 0.1)",a.style.paddingBottom="3px",a.style.lineHeight="27px",a.textContent=e,o.appendChild(a);let l=document.createElement("img");l.src=this.delImgPath,l.className="delImg",l.style.cursor="pointer",a.appendChild(l);let c=document.createElement("div");c.className="lists",c.style.marginTop="10px",c.style.marginBottom="10px",o.appendChild(c);for(let u=0;u<t.length;u++){let h=t[u],d=document.createElement("div");d.className="list",d.style.height="30px",d.style.display="flex",d.style.flexDirection="row",d.style.justifyContent="space-between",d.style.alignItems="center",d.style.fontSize="14px",d.style.marginBottom="3px",d.style.background="rgba(0, 0, 0, 0.2)",d.style.paddingLeft="6px",d.style.paddingRight="6px";let f=document.createElement("span");f.textContent=h.key,d.appendChild(f);let m=document.createElement("span");m.textContent=h.value,d.appendChild(m),c.appendChild(d)}return r}}getType(e){let t;return e?t=e:t=this.tagType,e}}class mM extends Ne{constructor(e,t,n){super(),this.viewer=e,this.degreeBand=t,this.coord=n,this.meshs=[],this.coordTransformation=new r0,this.initSceneGroup(),this.initMesh()}initSceneGroup(){this.pointGroup=new xn,this.pointGroup.name="customPointPointGroup",this.viewer.scene.scene.add(this.pointGroup),this.textGroup=new xn,this.textGroup.name="customTagGroup",this.viewer.scene.scene.add(this.textGroup),this.tagLayer=new Cf(this.viewer,this.textGroup)}initMesh(){this.geometry=new Li(1,32,32),this.material=new Ut({color:"#ff0000"}),this.mesh=new ot(this.geometry,this.material)}addPoint(e){if(e.length>0)for(let t=0;t<e.length;t++){let n=e[t];if(n.lngLat){let s;n.coordOffset?s=this.handelLngLat(n.lngLat,!0):s=this.handelLngLat(n.lngLat,!1),this.mesh.position.set(s[0],s[1],0);let r=this.mesh.clone();this.pointGroup.add(r);let o;n.tagName?(this.tagLayer.addTag(n.tagName,1,{x:s[0],y:s[1],z:1.5}),o={point:{mesh:r,position:s},tag:this.tagLayer.meshs[t]}):o={point:{mesh:r,position:s}},this.meshs.push(o)}}}updatePointPosition(e,t,n=1,s){let r=this.meshs[e];if(console.log(e,"index"),console.log(t,"position"),console.log(n,"type"),console.log(s,"coordOffset"),console.log(r,"mesh"),r){if(n==1)r.point.mesh.position.set(t[0],t[1],0),r.tag.mesh.position.set(t[0],t[1],1.5);else if(n==2){let o;s?o=this.handelLngLat(t,!0):o=this.handelLngLat(t,!1),r.point.mesh.position.set(o[0],o[1],0),r.tag.mesh.position.set(o[0],o[1],1.5)}}}handelLngLat(e,t){let n,s;return t?(n=this.coordTransformation.lngLatToWorld(e,this.degreeBand),s=n):(n=this.coordTransformation.lngLatToWorld(e,this.degreeBand),s=[n[0]-this.coord[0],n[1]-this.coord[1],n[2]]),s}}Fn.prototype.zoomTo=function(i,e=1){!i.geometry&&!i.boundingBox||this.updateProjectionMatrix()},mi.prototype.zoomTo=function(i,e){if(!i.geometry&&!i.boundingSphere&&!i.boundingBox)return;i.geometry&&i.geometry.boundingSphere===null&&i.geometry.computeBoundingSphere(),i.updateMatrixWorld();let t;i.boundingSphere?t=i.boundingSphere:i.geometry&&i.geometry.boundingSphere?t=i.geometry.boundingSphere:t=i.boundingBox.getBoundingSphere(new fi);let n=e||1;t=t.clone().applyMatrix4(i.matrixWorld);let s=t.radius,r=this.fov*Math.PI/180;this.aspect<1&&(r=r*this.aspect);let o=Math.abs(s/Math.sin(r/2))*n,a=this.getWorldDirection(new S).multiplyScalar(-o);this.position.copy(t.center.clone().add(a))},We.prototype.distanceToPlaneWithNegative=function(i){let e=i.normal.dot(this.direction);return e===0?i.distanceToPoint(this.origin)===0?0:null:-(this.origin.dot(i.normal)+i.constant)/e};const gM=new Zm,Hh={major:1,minor:8,suffix:".0"};let vM=new Hm;console.log("Potree "+Hh.major+"."+Hh.minor+Hh.suffix);let yM=1*1e3*1e3,xM=0,wM=0,bM=4;const _M={};z.scriptPath="",document.currentScript&&document.currentScript.src?(z.scriptPath=new URL(document.currentScript.src+"/..").href,z.scriptPath.slice(-1)==="/"&&(z.scriptPath=z.scriptPath.slice(0,-1))):(typeof document>"u"?new(require("url")).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("potree.js",document.baseURI).href,z.scriptPath=new URL((typeof document>"u"?new(require("url")).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("potree.js",document.baseURI).href)+"/..").href,z.scriptPath.slice(-1)==="/"&&(z.scriptPath=z.scriptPath.slice(0,-1)));let MM=z.scriptPath+"/resources";function EM(i,e,t){let n=function(r){r.pointcloud.name=e,t(r)},s=new Promise(r=>{i&&(i.includes("ept.json")?ng.load(i,function(o){if(!o)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let a=new ec(o);r({type:"pointcloud_loaded",pointcloud:a})}}):i.includes(".copc.laz")?sg.load(i,function(o){if(!o)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let a=new ec(o);r({type:"pointcloud_loaded",pointcloud:a})}}):i.indexOf("cloud.js")>0?tg.load(i,function(o){if(!o)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let a=new ec(o);r({type:"pointcloud_loaded",pointcloud:a})}}):i.indexOf("metadata.json")>0?(Potree.OctreeLoader.load(i).then(o=>{let a=o.geometry;if(!a)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let l=new ec(a),c=l.getAttribute("position"),u=l.material;u.elevationRange=[c.range[0][2],c.range[1][2]],r({type:"pointcloud_loaded",pointcloud:l})}}),ru.load(i,function(o){if(!o)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let a=new ec(o);r({type:"pointcloud_loaded",pointcloud:a})}})):i.indexOf(".vpc")>0?PointCloudArena4DGeometry.load(i,function(o){if(!o)console.error(new Error(`failed to load point cloud from URL: ${i}`));else{let a=new PointCloudArena4D(o);r({type:"pointcloud_loaded",pointcloud:a})}}):console.error(new Error(`failed to load point cloud from URL: ${i}`)))});if(t)s.then(r=>{n(r)});else return s}(function(i){i.fn.extend({selectgroup:function(e={}){let t=i(this),s=`${t.prop("id")}`,r=e.title!==void 0?e.title:"",o=[];t.find("option").each((c,u)=>{let h=i(u).prop("id"),d=i(u).html(),f=i(u).prop("value"),m=i(`
					<span style="flex-grow: 1; display: inherit">
					<label for="${h}" class="ui-button" style="width: 100%; padding: .4em .1em">${d}</label>
					<input type="radio" name="${s}" id="${h}" value="${f}" style="display: none"/>
					</span>
				`),v=m.find("label"),_=m.find("input");_.change(()=>{t.find("label").removeClass("ui-state-active"),t.find("label").addClass("ui-state-default"),_.is(":checked")&&v.addClass("ui-state-active")}),o.push(m)});let a=i(`
				<fieldset style="border: none; margin: 0px; padding: 0px">
					<legend>${r}</legend>
					<span style="display: flex">

					</span>
				</fieldset>
			`),l=a.find("span");for(let c of o)l.append(c);l.find("label").each((c,u)=>{i(u).css("margin","0px"),i(u).css("border-radius","0px"),i(u).css("border","1px solid black"),i(u).css("border-left","none")}),l.find("label:first").each((c,u)=>{i(u).css("border-radius","4px 0px 0px 4px")}),l.find("label:last").each((c,u)=>{i(u).css("border-radius","0px 4px 4px 0px"),i(u).css("border-left","none")}),t.empty(),t.append(a)}})})(jQuery),z.Action=Ve,z.AnimationPath=Hb,z.Annotation=ra,z.Box3Helper=$m,z.BoxVolume=Xa,z.CameraAnimation=tc,z.CameraMode=cs,z.ClassificationScheme=Ah,z.ClipMethod=oa,z.ClipTask=fr,z.ClipVolume=lg,z.ClippingTool=cg,z.Compass=vg,z.CopcLaszipLoader=O1,z.CopcLoader=sg,z.CustomLable=pM,z.CustomPoint=fM,z.CustomPointMove=mM,z.CustomTag=Cf,z.DeviceOrientationControls=Og,z.EarthControls=Ng,z.ElevationGradientRepeat=pr,z.Enum=Eh,z.EnumItem=km,z.EptBinaryLoader=rg,z.EptLaszipLoader=N1,z.EptLazBatcher=nf,z.EptLoader=ng,z.EptZstandardLoader=k1,z.EventDispatcher=Ne,z.EyeDomeLightingMaterial=Jm,z.Features=Jd,z.FirstPersonControls=Bg,z.GeoPackageLoader=Lh,z.Geopackage=ag,z.Gradients=Th,z.HierarchicalSlider=of,z.Images360=cf,z.Images360Loader=uf,z.KeyCodes=Um,z.LRU=Hm,z.LRUItem=Gm,z.LengthUnits=Yn,z.MOUSE=Mo,z.Measure=Gr,z.MeasuringTool=ug,z.Message=hg,z.NodeLoader=ig,z.NormalizationEDLMaterial=Km,z.NormalizationMaterial=Qm,z.OctreeLoader=ru,z.OrbitControls=Fg,z.OrientedImage=af,z.OrientedImageLoader=Rh,z.OrientedImages=Cg,z.POCLoader=tg,z.PathAnimation=Om,z.PointAttribute=St,z.PointAttributeTypes=Lt,z.PointAttributes=Ql,z.PointCloudCopcGeometry=Kd,z.PointCloudCopcGeometryNode=Sh,z.PointCloudEptGeometry=Qd,z.PointCloudMaterial=Hr,z.PointCloudOctree=ec,z.PointCloudOctreeGeometry=Wm,z.PointCloudOctreeGeometryNode=aa,z.PointCloudOctreeNode=Ch,z.PointCloudSM=dg,z.PointCloudTree=Ja,z.PointCloudTreeNode=iu,z.PointPick=dM,z.PointShape=Eo,z.PointSizeType=Ws,z.Points=Dh,z.PointsLoader=Af,z.PolygonClipVolume=eu,z.Profile=Ya,z.ProfileData=Ph,z.ProfileRequest=t1,z.ProfileTool=fg,z.Renderer=tf,z.Scene=Mg,z.ScreenBoxSelectTool=pg,z.ShapefileLoader=z1,z.SphereVolume=_o,z.SpotLightHelper=H1,z.TextSprite=wo,z.TransformationTool=mg,z.TreeType=tu,z.Utils=He,z.VRControls=Hg,z.Version=ca,z.Viewer=Y_,z.Volume=bo,z.VolumeTool=gg,z.WaterMarkerLoader=hM,z.WorkerPool=Zm,z.XHRFactory=qa,z.debug=_M,z.framenumber=xM,z.loadPointCloud=EM,z.loadProject=C1,z.lru=vM,z.maxNodesLoading=bM,z.numNodesLoading=wM,z.pointBudget=yM,z.resourcePath=MM,z.saveProject=p1,z.updatePointClouds=Kb,z.updateVisibility=Xm,z.updateVisibilityStructures=qm,z.version=Hh,z.workerPool=gM,Object.defineProperty(z,"__esModule",{value:!0})});function BinaryHeap(z){this.content=[],this.scoreFunction=z}BinaryHeap.prototype={push:function(z){this.content.push(z),this.bubbleUp(this.content.length-1)},pop:function(){var z=this.content[0],Ne=this.content.pop();return this.content.length>0&&(this.content[0]=Ne,this.sinkDown(0)),z},remove:function(z){for(var Ne=this.content.length,Ve=0;Ve<Ne;Ve++)if(this.content[Ve]==z){var st=this.content.pop();if(Ve==Ne-1)break;this.content[Ve]=st,this.bubbleUp(Ve),this.sinkDown(Ve);break}},size:function(){return this.content.length},bubbleUp:function(z){for(var Ne=this.content[z],Ve=this.scoreFunction(Ne);z>0;){var st=Math.floor((z+1)/2)-1,Et=this.content[st];if(Ve>=this.scoreFunction(Et))break;this.content[st]=Ne,this.content[z]=Et,z=st}},sinkDown:function(z){for(var Ne=this.content.length,Ve=this.content[z],st=this.scoreFunction(Ve);;){var Et=(z+1)*2,pi=Et-1,Ni=null;if(pi<Ne){var An=this.content[pi],fn=this.scoreFunction(An);fn<st&&(Ni=pi)}if(Et<Ne){var As=this.content[Et],Cs=this.scoreFunction(As);Cs<(Ni==null?st:fn)&&(Ni=Et)}if(Ni==null)break;this.content[z]=this.content[Ni],this.content[Ni]=Ve,z=Ni}}},Date.now===void 0&&(Date.now=function(){return new Date().valueOf()});var TWEEN=TWEEN||function(){var z=[];return{REVISION:"14",getAll:function(){return z},removeAll:function(){z=[]},add:function(Ne){z.push(Ne)},remove:function(Ne){var Ve=z.indexOf(Ne);Ve!==-1&&z.splice(Ve,1)},update:function(Ne){if(z.length===0)return!1;var Ve=0;for(Ne=Ne!==void 0?Ne:typeof window<"u"&&window.performance!==void 0&&window.performance.now!==void 0?window.performance.now():Date.now();Ve<z.length;)z[Ve].update(Ne)?Ve++:z.splice(Ve,1);return!0}}}();TWEEN.Tween=function(z){var Ne=z,Ve={},st={},Et={},pi=1e3,Ni=0,An=!1,fn=!1,As=!1,Cs=0,Nn=null,$r=TWEEN.Easing.Linear.None,Ds=TWEEN.Interpolation.Linear,Kt=[],qt=null,Xi=!1,L=null,qr=null,cn=null;for(var Ps in z)Ve[Ps]=parseFloat(z[Ps],10);this.to=function(Ht,Vt){return Vt!==void 0&&(pi=Vt),st=Ht,this},this.start=function(Ht){TWEEN.add(this),fn=!0,Xi=!1,Nn=Ht!==void 0?Ht:typeof window<"u"&&window.performance!==void 0&&window.performance.now!==void 0?window.performance.now():Date.now(),Nn+=Cs;for(var Vt in st){if(st[Vt]instanceof Array){if(st[Vt].length===0)continue;st[Vt]=[Ne[Vt]].concat(st[Vt])}Ve[Vt]=Ne[Vt],!(Ve[Vt]instanceof Array)&&(Ve[Vt]*=1),Et[Vt]=Ve[Vt]||0}return this},this.stop=function(){return fn?(TWEEN.remove(this),fn=!1,cn!==null&&cn.call(Ne),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var Ht=0,Vt=Kt.length;Vt>Ht;Ht++)Kt[Ht].stop()},this.delay=function(Ht){return Cs=Ht,this},this.repeat=function(Ht){return Ni=Ht,this},this.yoyo=function(Ht){return An=Ht,this},this.easing=function(Ht){return $r=Ht,this},this.interpolation=function(Ht){return Ds=Ht,this},this.chain=function(){return Kt=arguments,this},this.onStart=function(Ht){return qt=Ht,this},this.onUpdate=function(Ht){return L=Ht,this},this.onComplete=function(Ht){return qr=Ht,this},this.onStop=function(Ht){return cn=Ht,this},this.update=function(Ht){var Vt;if(Nn>Ht)return!0;Xi===!1&&(qt!==null&&qt.call(Ne),Xi=!0);var pn=(Ht-Nn)/pi;pn=pn>1?1:pn;var Cn=$r(pn);for(Vt in st){var mn=Ve[Vt]||0,On=st[Vt];On instanceof Array?Ne[Vt]=Ds(On,Cn):(typeof On=="string"&&(On=mn+parseFloat(On,10)),typeof On=="number"&&(Ne[Vt]=mn+(On-mn)*Cn))}if(L!==null&&L.call(Ne,Cn),pn==1){if(Ni>0){isFinite(Ni)&&Ni--;for(Vt in Et){if(typeof st[Vt]=="string"&&(Et[Vt]=Et[Vt]+parseFloat(st[Vt],10)),An){var nn=Et[Vt];Et[Vt]=st[Vt],st[Vt]=nn}Ve[Vt]=Et[Vt]}return An&&(As=!As),Nn=Ht+Cs,!0}qr!==null&&qr.call(Ne);for(var hs=0,ds=Kt.length;ds>hs;hs++)Kt[hs].start(Ht);return!1}return!0}},TWEEN.Easing={Linear:{None:function(z){return z}},Quadratic:{In:function(z){return z*z},Out:function(z){return z*(2-z)},InOut:function(z){return(z*=2)<1?.5*z*z:-.5*(--z*(z-2)-1)}},Cubic:{In:function(z){return z*z*z},Out:function(z){return--z*z*z+1},InOut:function(z){return(z*=2)<1?.5*z*z*z:.5*((z-=2)*z*z+2)}},Quartic:{In:function(z){return z*z*z*z},Out:function(z){return 1- --z*z*z*z},InOut:function(z){return(z*=2)<1?.5*z*z*z*z:-.5*((z-=2)*z*z*z-2)}},Quintic:{In:function(z){return z*z*z*z*z},Out:function(z){return--z*z*z*z*z+1},InOut:function(z){return(z*=2)<1?.5*z*z*z*z*z:.5*((z-=2)*z*z*z*z+2)}},Sinusoidal:{In:function(z){return 1-Math.cos(z*Math.PI/2)},Out:function(z){return Math.sin(z*Math.PI/2)},InOut:function(z){return .5*(1-Math.cos(Math.PI*z))}},Exponential:{In:function(z){return z===0?0:Math.pow(1024,z-1)},Out:function(z){return z===1?1:1-Math.pow(2,-10*z)},InOut:function(z){return z===0?0:z===1?1:(z*=2)<1?.5*Math.pow(1024,z-1):.5*(-Math.pow(2,-10*(z-1))+2)}},Circular:{In:function(z){return 1-Math.sqrt(1-z*z)},Out:function(z){return Math.sqrt(1- --z*z)},InOut:function(z){return(z*=2)<1?-.5*(Math.sqrt(1-z*z)-1):.5*(Math.sqrt(1-(z-=2)*z)+1)}},Elastic:{In:function(z){var Ne,Ve=.1,st=.4;return z===0?0:z===1?1:(!Ve||1>Ve?(Ve=1,Ne=st/4):Ne=st*Math.asin(1/Ve)/(2*Math.PI),-(Ve*Math.pow(2,10*(z-=1))*Math.sin(2*(z-Ne)*Math.PI/st)))},Out:function(z){var Ne,Ve=.1,st=.4;return z===0?0:z===1?1:(!Ve||1>Ve?(Ve=1,Ne=st/4):Ne=st*Math.asin(1/Ve)/(2*Math.PI),Ve*Math.pow(2,-10*z)*Math.sin(2*(z-Ne)*Math.PI/st)+1)},InOut:function(z){var Ne,Ve=.1,st=.4;return z===0?0:z===1?1:(!Ve||1>Ve?(Ve=1,Ne=st/4):Ne=st*Math.asin(1/Ve)/(2*Math.PI),(z*=2)<1?-.5*Ve*Math.pow(2,10*(z-=1))*Math.sin(2*(z-Ne)*Math.PI/st):Ve*Math.pow(2,-10*(z-=1))*Math.sin(2*(z-Ne)*Math.PI/st)*.5+1)}},Back:{In:function(z){var Ne=1.70158;return z*z*((Ne+1)*z-Ne)},Out:function(z){var Ne=1.70158;return--z*z*((Ne+1)*z+Ne)+1},InOut:function(z){var Ne=2.5949095;return(z*=2)<1?.5*z*z*((Ne+1)*z-Ne):.5*((z-=2)*z*((Ne+1)*z+Ne)+2)}},Bounce:{In:function(z){return 1-TWEEN.Easing.Bounce.Out(1-z)},Out:function(z){return 1/2.75>z?7.5625*z*z:2/2.75>z?7.5625*(z-=1.5/2.75)*z+.75:2.5/2.75>z?7.5625*(z-=2.25/2.75)*z+.9375:7.5625*(z-=2.625/2.75)*z+.984375},InOut:function(z){return .5>z?.5*TWEEN.Easing.Bounce.In(2*z):.5*TWEEN.Easing.Bounce.Out(2*z-1)+.5}}},TWEEN.Interpolation={Linear:function(z,Ne){var Ve=z.length-1,st=Ve*Ne,Et=Math.floor(st),pi=TWEEN.Interpolation.Utils.Linear;return 0>Ne?pi(z[0],z[1],st):Ne>1?pi(z[Ve],z[Ve-1],Ve-st):pi(z[Et],z[Et+1>Ve?Ve:Et+1],st-Et)},Bezier:function(z,Ne){var Ve,st=0,Et=z.length-1,pi=Math.pow,Ni=TWEEN.Interpolation.Utils.Bernstein;for(Ve=0;Et>=Ve;Ve++)st+=pi(1-Ne,Et-Ve)*pi(Ne,Ve)*z[Ve]*Ni(Et,Ve);return st},CatmullRom:function(z,Ne){var Ve=z.length-1,st=Ve*Ne,Et=Math.floor(st),pi=TWEEN.Interpolation.Utils.CatmullRom;return z[0]===z[Ve]?(0>Ne&&(Et=Math.floor(st=Ve*(1+Ne))),pi(z[(Et-1+Ve)%Ve],z[Et],z[(Et+1)%Ve],z[(Et+2)%Ve],st-Et)):0>Ne?z[0]-(pi(z[0],z[0],z[1],z[1],-st)-z[0]):Ne>1?z[Ve]-(pi(z[Ve],z[Ve],z[Ve-1],z[Ve-1],st-Ve)-z[Ve]):pi(z[Et?Et-1:0],z[Et],z[Et+1>Ve?Ve:Et+1],z[Et+2>Ve?Ve:Et+2],st-Et)},Utils:{Linear:function(z,Ne,Ve){return(Ne-z)*Ve+z},Bernstein:function(z,Ne){var Ve=TWEEN.Interpolation.Utils.Factorial;return Ve(z)/Ve(Ne)/Ve(z-Ne)},Factorial:function(){var z=[1];return function(Ne){var Ve,st=1;if(z[Ne])return z[Ne];for(Ve=Ne;Ve>1;Ve--)st*=Ve;return z[Ne]=st}}(),CatmullRom:function(z,Ne,Ve,st,Et){var pi=.5*(Ve-z),Ni=.5*(st-Ne),An=Et*Et,fn=Et*An;return(2*Ne-2*Ve+pi+Ni)*fn+(-3*Ne+3*Ve-2*pi-Ni)*An+pi*Et+Ne}}},typeof module<"u"&&module.exports&&(module.exports=TWEEN);
